<!doctype html>
<html lang="zh-hans">
<head>
<meta charset="utf-8" />
<title>原版模组入门教程</title>
<meta name='author' content='ruhuasiyu@mcbbs' />
<meta name='keywords' content='minecraft, 原版模组, vanilla mod, datapacks, Crafting++' />
<meta name='description' content='Minecraft 原版模组 更多的合成' />
<meta name='revised' content='ruhuasiyu@mcbbs' />
<base href="" />
<link rel="shortcut icon" href="https://zsx.neocities.org/main/favicon.ico" />
<link rel="stylesheet" href="items/style.css" />
</head>

<body>
<nav>
<ul>
    <li style="border-bottom: #ddd 4px solid;padding-top:3px;padding-bottom: 3px;"><a href="#banner">原版模组入门教程</a></li>
    <li><a href="#§1_预备知识">§1 预备知识</a><ul>
        <li><a href="#§1.1_新人指引">§1.1 新人指引</a></li>
        <li><a href="#§1.2_工具准备">§1.2 工具准备</a></li>
        <li><a href="#§1.2.1_文本编辑器">§1.2.1 文本编辑器</a></li>
        <li><a href="#§1.2.2_压缩工具">§1.2.2 压缩工具</a></li>
        <li><a href="#§1.2.3_NBT_编辑器">§1.2.3 NBT 编辑器</a></li>
        <li><a href="#§1.2.4_绘图工具">§1.2.4 绘图工具</a></li>
        <li><a href="#§1.3_文件结构">§1.3 文件结构</a></li>
        <li><a href="#§1.3.1_游戏文件结构">§1.3.1 游戏文件结构</a></li>
        <li><a href="#§1.3.2_存档文件结构">§1.3.2 存档文件结构</a></li>
        <li><a href="#§1.4_JSON文件">§1.4 JSON文件</a></li>
    </ul></li>
    <li><a href="#§2_数据包">§2 数据包</a><ul>
        <li><a href="#§2.1_元信息和图标">§2.1 元信息和图标</a></li>
        <li><a href="#§2.2_命名空间">§2.2 命名空间</a></li>
        <li><a href="#§2.3_函数">§2.3 函数</a></li>
        <li><a href="#§2.4_进度">§2.4 进度</a></li>
        <li><a href="#§2.5_战利品表">§2.5 战利品表</a></li>
        <li><a href="#§2.6_断言">§2.6 断言</a></li>
        <li><a href="#§2.7_配方">§2.7 配方</a></li>
        <li><a href="#§2.8_结构">§2.8 结构</a></li>
        <li><a href="#§2.9_标签">§2.9 标签</a></li>
        <li><a href="#§2.9.1_预设标签">§2.9.1 预设标签</a></li>
        <li><a href="#§2.10_维度和维度类型">§2.10 维度和维度类型</a></li>
    </ul></li>
    <li><a href="#§3_资源包">§3 资源包</a><ul>
        <li><a href="#§3.1_元信息和图标">§3.1 元信息和图标</a></li>
        <li><a href="#§3.2_命名空间">§3.2 命名空间</a></li>
        <li><a href="#§3.3_语言文件">§3.3 语言文件</a></li>
        <li><a href="#§3.4_自定义物品模型">§3.4 自定义物品模型</a></li>
        <li><a href="#§3.5_模型">§3.5 模型</a></li>
        <li><a href="#§3.6_材质">§3.6 材质</a></li>
        <li><a href="#§3.7_声音">§3.7 声音</a></li>
        <li><a href="#§3.8_字体">§3.8 字体</a></li>
        <li><a href="#§3.9_着色器">§3.9 着色器</a></li>
    </ul></li>
    <li><a href="#§4_规划">§4 规划</a><ul>
        <li><a href="#§4.1_名称设计">§4.1 名称设计</a></li>
        <li><a href="#§4.2_调试">§4.2 调试</a></li>
        <li><a href="#§4.3_前置与附属">§4.3 前置与附属</a></li>
        <li><a href="#§4.4_发布">§4.4 发布</a></li>
    </ul></li>
    <li><a href="#§5_物品设计">§5 物品设计</a><ul>
        <li><a href="#§5.1_通用处理">§5.1 通用处理</a></li>
        <li><a href="#§5.2_右键交互">§5.2 右键交互</a></li>
        <li><a href="#§5.3_食物">§5.3 食物</a></li>
        <li><a href="#§5.4_药水">§5.4 药水</a></li>
        <li><a href="#§5.5_自定义状态效果">§5.5 自定义状态效果</a></li>
        <li><a href="#§5.6_头饰">§5.6 头饰</a></li>
        <li><a href="#§5.7_盔甲">§5.7 盔甲</a></li>
        <li><a href="#§5.8_工具和武器">§5.8 工具和武器</a></li>
        <li><a href="#§5.9_画">§5.9 画</a></li>
    </ul></li>
    <li><a href="#§6_方块设计">§6 方块设计</a><ul>
        <li><a href="#§6.1_视线追踪法">§6.1 视线追踪法</a></li>
        <li><a href="#§6.2_计算交点法">§6.2 计算交点法</a></li>
        <li><a href="#§6.3_命令方块替换法">§6.3 命令方块替换法</a></li>
        <li><a href="#§6.4_破坏事件">§6.4 破坏事件</a></li>
        <li><a href="#§6.5_模型设置">§6.5 模型设置</a></li>
    </ul></li>
    <li><a href="#§7_合成与烧炼">§7 合成与烧炼</a><ul>
        <li><a href="#§7.1_语法">§7.1 语法</a></li>
        <li><a href="#§7.2_有序合成">§7.2 有序合成</a></li>
        <li><a href="#§7.3_无序合成">§7.3 无序合成</a></li>
        <li><a href="#§7.4_切石机配方">§7.4 切石机配方</a></li>
        <li><a href="#§7.5_烧炼配方">§7.5 烧炼配方</a></li>
        <li><a href="#§7.6_覆盖原版配方">§7.6 覆盖原版配方</a></li>
        <li><a href="#§7.7_配方获取">§7.7 配方获取</a></li>
    </ul></li>
    <li class="up6"><a href="#§8_机器设计">§8 机器设计</a><ul>
        <li><a href="#§8.1_GUI材质模型">§8.1 GUI材质模型</a></li>
        <li><a href="#§8.2_GUI背景处理">§8.2 GUI背景处理</a></li>
        <li><a href="#§8.3_GUI命令">§8.3 GUI命令</a></li>
        <li><a href="#§8.4_物品输出">§8.4 物品输出</a></li>
        <li><a href="#§8.5_配方处理">§8.5 配方处理</a></li>
        <li><a href="#§8.6_插件">§8.6 插件</a></li>
        <li><a href="#§8.7_容器扩展">§8.7 容器扩展</a></li>
        <li><a href="#§8.8_接口">§8.8 接口</a></li>
        <li><a href="#§8.9_管道">§8.9 管道</a></li>
        <li><a href="#§8.9.1_无线传输">§8.9.1 无线传输</a></li>
        <li><a href="#§8.9.2_管道式">§8.9.2 管道式</a></li>
        <li><a href="#§8.9.3_激光式">§8.9.3 激光式</a></li>
        <li><a href="#§8.9.4_载体式">§8.9.4 载体式</a></li>
        <li><a href="#§8.9.5_管道设计">§8.9.5 管道设计</a></li>
    </ul></li>
    <li class="up4"><a href="#§9_NBT合成与烧炼">§9 NBT合成与烧炼</a><ul>
        <li><a href="#§9.1_地板合成">§9.1 地板合成</a></li>
        <li><a href="#§9.2_实体背包合成">§9.2 实体背包合成</a></li>
        <li><a href="#§9.3_容器合成">§9.3 容器合成</a></li>
        <li><a href="#§9.4_NBT烧炼">§9.4 NBT烧炼</a></li>
        <li><a href="#§9.4.1_替换产物法">§9.4.1 替换产物法</a></li>
        <li><a href="#§9.4.2_记分板模拟">§9.4.2 记分板模拟</a></li>
        <li><a href="#§9.5_NBT酿造">§9.5 NBT酿造</a></li>
    </ul></li>
    <li class="up2"><a href="#§10_植物">§10 植物</a><ul>
        <li><a href="#§10.1_作物">§10.1 作物</a></li>
        <li><a href="#§10.2_花草">§10.2 花草</a></li>
        <li><a href="#§10.3_树">§10.3 树</a></li>
    </ul></li>
    <li class="up5"><a href="#§11_物品与实体处理">§11 物品与实体处理</a><ul>
        <li><a href="#§11.1_随机数">§11.1 随机数</a></li>
        <li><a href="#§11.2_修改玩家背包">§11.2 修改玩家背包</a></li>
        <li><a href="#§11.3_耐久处理">§11.3 耐久处理</a></li>
        <li><a href="#§11.4_红石信号">§11.4 红石信号</a></li>
        <li><a href="#§11.5_方块交互">§11.5 方块交互</a></li>
        <li><a href="#§11.6_生物移动">§11.6 生物移动</a></li>
        <li><a href="#§11.7_交易">§11.7 交易</a></li>
        <li><a href="#§11.8_清理特定物品">§11.8 清理特定物品</a></li>
        <li><a href="#§11.9_连锁">§11.9 连锁</a></li>
    </ul></li>
    <li class="up4"><a href="#§12_算法">§12 算法</a><ul>
        <li><a href="#§12.1_世界生成结构">§12.1 世界生成结构</a></li>
        <li><a href="#§12.2_绘制图案">§12.2 绘制图案</a></li>
        <li><a href="#§12.3_循环与递归">§12.3 循环与递归</a></li>
        <li><a href="#§12.4_字符操作">§12.4 字符操作</a></li>
        <li><a href="#§12.5_位运算与种子">§12.5 位运算与种子</a></li>
    </ul></li>
</ul>
</nav>
<footer style="height: 3.5em; z-index: 99;"><p class="noindent" style="margin:0 15px 5px 0; text-align:right;color: hsl(220, 90%, 90%);;">ruhuasiyu <br/> 2020-07-02</p></footer>


<div id="main_part">
<img id="banner" src="items/banner.png" style="width:100%;"/>

<article>
<p>原版模组一般指在不修改 Minecraft 游戏本体的前提下，通过命令方块、一键命令、数据包、资源包等方式对游戏的可玩性做出修改。而自 Minecraft Java 版 1.13 起的数据包概念问世之后，原版模组的制作已变得十分便捷。因此我将为大家做一个简单的入门，以期抛砖引玉。</p>
<p>本文内容适用于 Minecraft Java 版 1.16 版本，但大部分内容也适合 1.13-1.15 版本，请读者注意区分。系统环境为 Windows10，其它环境下有较小的差异。本文参考和吸取了大量其他玩家的意见、建议、教程等。有任何错误和疑问请联系我，谢谢！</p>
<p>由于国内访问 <a href="https://minecraft-zh.gamepedia.com/">Minecraft Wiki</a> 速度较慢，因此本文中 wiki 页面链接均使用 <a href="https://wiki.biligame.com/mc/">biligame 的镜像</a>。由于 <a href="https://minecraft.gamepedia.com/">Minecraft 英文 Wiki</a> 内容往往更准确，因此有英文阅读能力和访问能力的可直接查看英文 wiki 的相关内容。</p>
<p>编写进度：§1-§12.1 校对：§2.5(2020/07/02)</p>

<h1 id="§1_预备知识">§1 预备知识</h1>
<p>本节部分段落常为部分读者所熟知，但仍建议原版模组新手按顺序浏览一遍，可跳过自己熟知的部分。对于首次接触者，请耐心阅读。</p>

<h2 id="§1.1_新人指引">§1.1 新人指引</h2>
<p>本文为原版模组入门教程，而非命令的入门教程，因此本文不会对命令部分做过多的详解。若你对命令尚不了解，可先依次通过如下链接学习并了解：</p>
<ul>
    <li><strong>命令手册</strong>
        <ul>
            <li><a href="https://wiki.biligame.com/mc/命令">命令 - Minecraft Wiki，最详细的官方我的世界百科</a></li>
            <li><a href="https://commandtutorials.neocities.org/">新人手册-MC命令方块资源</a></li>
            <li><a href="http://mc-command.oschina.io/command-tutorial/">命令进阶教程</a></li>
        </ul>
    </li>
    <li><strong>记分板和 NBT 手册</strong>
        <ul>
            <li><a href="https://wiki.biligame.com/mc/记分板">记分板 - Minecraft Wiki，最详细的官方我的世界百科</a></li>
            <li><a href="https://wiki.biligame.com/mc/区块格式">区块格式 - Minecraft Wiki，最详细的官方我的世界百科</a></li>
            <li><a href="https://wiki.biligame.com/mc/Player.dat格式">player.dat格式 - Minecraft Wiki，最详细的官方我的世界百科</a></li>
        </ul>
    </li>
</ul>
<p>可先熟悉各项命令后，再学习记分板和 NBT 相关命令。实体和方块 NBT 亦可通过在游戏中使用 <code>data get entity/block</code> 命令来获取，以避免记忆大量的 NBT。</p>

<p>若你已对 1.16 之前版本的命令较为熟悉，可在<a href="https://wiki.biligame.com/mc/Java版版本记录">Java版版本记录</a>中查看各版本间差异。</p>

<h2 id="§1.2_工具准备">§1.2 工具准备</h2>
<h3 id="§1.2.1_文本编辑器">§1.2.1 文本编辑器</h3>
<p>我们所涉及的所有文本文件，包括文本文档(.txt)、函数文件(.mcfunction)、JSON文件(.json, .mcmeta)、日志文件(.log)，均需使用 <code>UTF-8</code> 编码格式。以下列出的文本编辑器均默认为 <code>UTF-8</code> 编码，可以在编辑器页面的右下角状态栏看到。</p>
<ul>
    <li><strong><a href="https://code.visualstudio.com/">Visual Studio Code</a></strong> 下载安装后，可以安装如下插件：
        <ul>
            <li><em>Chinese (Simplified) Language Pack for Visual Studio Code</em> 用于支持中文语言</li>
            <li><em>Datapack Helper Plus (JSON)</em> 用于JSON语法补全和纠错</li>
            <li><em>Datapack Helper Plus (MCF)</em> 用于函数语法补全和纠错</li>
            <li><em>language-mcfunction</em> 用于函数语法高亮</li>
        </ul>
    </li>
    <li><strong>记事本</strong> 为 Windows 系统自带。Windows10 的记事本已经默认是 <code>UTF-8</code> 编码了。点击<code>查看->状态栏</code>可以在右下角状态栏看到，因此可以正常使用。旧版本 Windows 的记事本仍然不是，请勿使用。</li>
    <li><strong><a href="https://notepad-plus-plus.org/">Notepad++</a></strong>
    可从 <a href="http://www.mcbbs.net/thread-806816-1-1.html">mcfunction 的语言样式和自动补全</a>帖中下载相关文件并导入，另外请将 Notepad++ 中<code>设置->首选项->其它->自动检测字符编码</code>选项关闭。</li>
</ul>
<p>编辑器右下角可以看到 <code>LF</code> 或 <code>CRLF</code>，分别表示两种换行符，二者均可正常使用，建议使用 <code>LF</code>。</p>
<p>注意编码不要误选了 <code>UTF-8 with BOM</code> 格式。</p>
<p>由于编辑器插件相比 Minecraft 版本更新具有延后性，因此上述语法补全/高亮/纠错等未必准确。</p>

<h3 id="§1.2.2_压缩工具">§1.2.2 压缩工具</h3>
<p>数据包和资源包均可以为文件夹或 zip 压缩文件格式。游戏本体和模组本体的 jar 文件也需要压缩工具来打开。</p>
<ul>
    <li><strong>Windows 资源管理器</strong> Windows10 系统自带 zip 格式的压缩和解压缩。zip 格式可以直接打开，压缩则用<code>选择->右键->发送到->压缩文件夹</code>。</li>
    <li><strong><a href="http://www.7-zip.org/">7-Zip</a></strong> 免费软件。</li>
    <li><strong><a href="http://www.winrar.com.cn/">WinRAR</a></strong> 付费软件。</li>
</ul>
<p>jar 文件可以通过重命名为 zip 文件直接用 Windows 资源管理器打开。显然，这不如<code>右键->7-zip->打开压缩包</code>方便。</p>

<h3 id="§1.2.3_NBT_编辑器">§1.2.3 NBT 编辑器</h3>
<p>推荐使用 <a href="https://github.com/jaquadro/NBTExplorer/releases">NBTExplorer</a> 来打开 dat 和其它 NBT 格式文件。汉化版本可<a href="https://www.mcbbs.net/thread-735265-1-1.html">由此下载</a>。</p>

<h3 id="§1.2.4_绘图工具">§1.2.4 绘图工具</h3>
<p>推荐使用 <a href="https://www.adobe.com/cn/products/photoshop.html">Adobe Photoshop</a> 或其它绘图工具来绘制材质。Windows 自带的画图由于无法生成透明背景，因此不推荐使用。</p>

<h2 id="§1.3_文件结构">§1.3 文件结构</h2>
<p>本节中我们将对各个主要的文件夹结构和文件做简单的介绍。为便于查看文件后缀，请将<code>文件->文件夹选项->查看->隐藏已知文件类型的扩展名</code>选项去掉勾选。所有的文件中可以使用文本编辑器打开的文件可通过新建文本文件并修改后缀来创建。</p>

<h3 id="§1.3.1_游戏文件结构">§1.3.1 游戏文件结构</h3>
<p>打开 <code>.minecraft</code> 所在的文件夹，这通常位于你的启动器目录下。如果启动器中设置为各版本独立，则类似的文件结构位于 <code>versions/[版本号]</code>下。见<a href="https://wiki.biligame.com/mc/.minecraft">.minecraft</a>。</td>
<table><thead><tr><th style="width:6em;">文件</th><th style="width:19em;">文件位置</th><th>说明</th><th>wiki</th></tr></thead><tbody>
<tr>
    <th>资源文件索引</th>
    <td><code>assets/indexes/[版本号].json</code></td>
    <td rowspan="2">从资源文件索引中 <code>minecraft/lang/zh_cn.json</code> 的值可知中文语言文件 hash，找到后使用文本编辑器打开。其它资源文件也可以类似寻找并用相应软件打开。</td>
    <td>-</td>
</tr>
<tr>
    <th>资源文件</th>
    <td><code>assets/objects/[hash开头]/[hash]</code></td>
    <td>-</td>
</tr>
<tr>
    <th>备份文件</th>
    <td><code>backups/[日期-世界名称].zip</code></td>
    <td>存档的备份文件。</td>
    <td>-</td>
</tr>
<tr>
    <th>崩溃报告</th>
    <td><code>crash-reports/[时间].txt</code></td>
    <td>如果是由于资源包或数据包引起的崩溃，可以在该文件中看到原因。</td>
    <td>-</td>
</tr>
<tr>
    <th rowspan="2">日志</th>
    <td><code>logs/[时间].log.gz</code></td>
    <td>历史日志，使用压缩工具打开后使用文本编辑器打开。</td>
    <td>-</td>
</tr>
<tr>
    <td><code>logs/latest.log</code></td>
    <td>当前日志，可随时查看加载资源包和数据包时的错误信息，包括错误的文件名称、位置、错误的行列数等。</td>
    <td>-</td>
</tr>
<tr>
    <th>资源包</th>
    <td><code>resourcepacks/[资源包名]</code><br />
        <code>resourcepacks/[资源包名].zip</code></td>
    <td>具体结构见 <a href="#§3_资源包">§3 资源包</a>。</td>
    <td><a href="https://wiki.biligame.com/mc/资源包">资源包</a></td>
</tr>
<tr>
    <th>存档文件</th>
    <td><code>saves/[世界名称]</code></td>
    <td>具体结构见 <a href="#§1.3.2_存档文件结构">§1.3.2 存档文件结构</a>。</td>
    <td><a href="https://wiki.biligame.com/mc/世界格式">世界格式</a></td>
</tr>
<tr>
    <th>游戏截图</th>
    <td><code>screenshots/[时间].png</code></td>
    <td>游戏截图</td>
    <td><a href="https://wiki.biligame.com/mc/截屏">截屏</a></td>
</tr>
<tr>
    <th>服务器资源包</th>
    <td><code>server-resource-packs/[服务器]</code></td>
    <td>具体结构见 <a href="#§3_资源包">§3 资源包</a>。</td>
    <td><a href="https://wiki.biligame.com/mc/资源包">资源包</a></td>
</tr>
<tr>
    <th>存储的物品栏</th>
    <td><code>hotbar.nbt</code></td>
    <td>游戏内使用<code>C+[数字]</code>存储、<code>X+[数字]</code>取出的创造模式物品快捷栏。</td>
    <td>-</td>
</tr>
<tr>
    <th>游戏设置</th>
    <td><code>options.txt</code></td>
    <td>可直接设置游戏内快捷键、音量、视距等选项。</td>
    <td><a href="https://wiki.biligame.com/mc/options.txt">options.txt</a></td>
</tr>
<tr>
    <th>服务器</th>
    <td><code>servers.dat</code></td>
    <td>包含服务器信息。</td>
    <td><a href="https://wiki.biligame.com/mc/Servers.dat格式">Servers.dat格式</a></td>
</tr>
<tr>
    <th>玩家缓存</th>
    <td><code>usercache.json</code></td>
    <td>为服务器玩家登录名和 UUID 对应。</td>
    <td>-</td>
</tr>
<tr>
    <th>玩家名缓存</th>
    <td><code>usernamecache.json</code></td>
    <td>为单机玩家登录名和 UUID 对应。</td>
    <td>-</td>
</tr>
<tr>
    <th>游戏本体</th>
    <td><code>versions/[版本号]/[版本号].jar</code></td>
    <td>包含了对应版本的资源和数据文件。<code>assets</code> 结构见 <a href="#资源包">§3 资源包</a>，<code>data</code> 结构见 <a href="#数据包">§2 数据包</a>。</td>
    <td><a href="https://wiki.biligame.com/mc/Client.jar">Client.jar</a></td>
</tr>
</tbody></table>
<figure>
    <img src="items/游戏本体文件结构.png" alt="游戏本体文件结构" />
    <figcaption>图1.1 游戏本体文件结构</figcaption>
</figure>

<h3 id="§1.3.2_存档文件结构">§1.3.2 存档文件结构</h3>
<p>位于 <code>.minecraft/saves/[世界名称]</code>，完整的信息参见<a href="https://wiki.biligame.com/mc/世界格式">世界格式</a>。区块文件、地图文件等不建议使用 NBT 编辑器来编辑，而是用 MCEdit、地图文件生成工具等来编辑。</p>
<table><thead><tr><th style="width:5em;">文件</th><th style="width:24em;">文件位置</th><th>说明</th><th>wiki</th></tr></thead><tbody>
<tr>
    <th>世界信息</th>
    <td><code>level.dat</code></td>
    <td>记录了种子、生成类型、难度、出生点、世界边界、游戏规则等内容。</td>
    <td><a href="https://wiki.biligame.com/mc/世界格式#level.dat格式">世界格式</a></td>
</tr>
<tr>
    <th>属性</th>
    <td><code>playerdata/[玩家UUID].dat</code></td>
    <td>记录了玩家的所有个人信息，如位置、复活点、飞行速度等。</td>
    <td><a href="https://wiki.biligame.com/mc/Player.dat格式">Player.dat格式</a></td>
</tr>
<tr>
    <th>统计</th>
    <td><code>stats/[玩家UUID].json</code></td>
    <td>使用文本编辑器打开，记录了玩家的统计信息。</td>
    <td><a href="https://wiki.biligame.com/mc/统计#存储">统计</a></td>
</tr>
<tr>
    <th>进度</th>
    <td><code>advancements/[玩家 UUID].json</code></td>
    <td>使用文本编辑器打开，记录了玩家已完成的进度和进度判据的完成时间。</td>
</tr>
<tr>
    <th>地图数</th>
    <td><code>data/idcounts.json</code></td>
    <td>使用文本编辑器打开，记录了当前已使用的地图数量，游戏内新使用的空地图会由此开始计数。</td>
    <td><a href="https://wiki.biligame.com/mc/地图物品格式#idcounts.dat格式">地图物品格式</a></td>
</tr>
<tr>
    <th>地图</th>
    <td><code>data/map_[数字].dat</code></td>
    <td>记录了地图 <code>filled_map{data:[数字]}</code> 的信息。</td>
    <td><a href="https://wiki.biligame.com/mc/地图物品格式#map_<#>.dat格式">地图物品格式</a></td>
</tr>
<tr>
    <th>记分板</th>
    <td><code>data/scoreboard.dat</code></td>
    <td>记录了记分板、记分板的值、组。</td>
    <td><a href="https://wiki.biligame.com/mc/记分板#NBT格式">记分板</a></td>
</tr>
<tr>
    <th>存储区</th>
    <td><code>data/command_storage_[命名空间].dat</code></td>
    <td>存储了存储区 (storage) 的 NBT。</td>
    <td><a href="https://wiki.biligame.com/mc/命令存储格式">命令存储格式</a></td>
</tr>
<tr>
    <th rowspan="4">区块</th>
    <td><code>region/r.[数值].[数值].mca</code></td>
    <td>记录了主世界的区块信息，每32×32个区块存储为一个文件，。</td>
    <td rowspan="4"><a href="https://wiki.biligame.com/mc/Anvil文件格式">Anvil文件格式</a><br />
        <a href="https://wiki.biligame.com/mc/区块格式">区块格式</a></td>
</tr>
<tr>
    <td><code>DIM-1/region/r.[数值].[数值].mca</code></td>
    <td>记录了下界的区块信息，同上。</td>
</tr>
<tr>
    <td><code>DIM1/region/r.[数值].[数值].mca</code></td>
    <td>记录了末地的区块信息，同上。</td>
</tr>
<tr>
    <td><code>dimensions/[命名空间]/[路径]/region/r.[数值].[数值].mca</code></td>
    <td>记录了自定义维度的区块信息，同上。</td>
</tr>
<tr>
    <th>村民兴趣点</th>
    <td><code>poi/r.[数值].[数值].mca</code><br/>
        <code>DIM-1/poi/r.[数值].[数值].mca</code><br/>
        <code>DIM1/poi/r.[数值].[数值].mca</code><br/>
        <code>dimensions/[命名空间]/[路径]/poi/r.[数值].[数值].mca</code></td>
    <td>记录了主世界/下界/末地/自定义维度村民兴趣点，即特定的床、工作站点和钟。每32×32个区块存储为一个文件。<br />
        1.13及更早版本则记录村庄信息在 <code>villages.dat</code>。</td>
    <td><a href="https://wiki.biligame.com/mc/世界格式#poi格式">世界格式</a><br />
        <a href="https://wiki.biligame.com/mc/Villages.dat格式">Villages.dat格式</a></td>
</tr>
<tr>
    <th>袭击</th>
    <td><code>data/raids.dat</code><br/>
        <code>DIM-1/data/raids_nether.dat</code><br/>
        <code>DIM1/data/raids_end.dat</code><br/>
        <code>dimensions/[命名空间]/[路径]/data/raids.dat</code></td>
    <td>记录了主世界/下界/末地/自定义维度袭击的信息。</td>
    <td><a href="https://wiki.biligame.com/mc/Raids.dat格式">raids.dat格式</a></td>
</tr>
<tr>
    <th>常加载区块</th>
    <td><code>data/chunks.dat</code><br/>
        <code>DIM-1/data/chunks.dat</code><br/>
        <code>DIM1/data/chunks.dat</code><br/>
        <code>dimensions/[命名空间]/[路径]/data/chunks.dat</code></td>
    <td>记录了主世界/下界/末地/自定义维度的常加载区块。</td>
    <td>-</td>
</tr>
<tr>
    <th>数据包</th>
    <td><code>datapacks/[数据包名]</code><br/>
        <code>datapacks/[数据包名].zip</code></td>
    <td>具体结构见 <a href="#datapack">§2 数据包</a>。</td>
    <td><a href="https://wiki.biligame.com/mc/数据包">数据包</a></td>
</tr>
<tr>
    <th>结构</th>
    <td><code>generated/[命名空间]/structures/[文件].nbt</code></td>
    <td>记录了游戏内使用结构方块保存的结构，将其移动至数据包内方可使用。</td>
    <td><a href="https://wiki.biligame.com/mc/结构方块文件格式">结构方块文件格式</a></td>
</tr>
</tbody></table>

<h3 id="§1.4_JSON文件">§1.4 JSON文件</h3>
<p>数据包的进度、战利品表、标签、断言、配方、维度、维度类型，资源包的语言文件、模型等文件均为JSON格式文件。<code>.mcmeta</code> 文件也是JSON文件，因此格式也是相同的。编写时，使用空格或制表符(Tab)缩进，以便于查看括号匹配和层次。wiki 上有关页面使用了 NBT 的数据类型标注，但其实并不适用于JSON格式。</p>
<p>JSON文件包括一对根括号{}，包含类似 <code>"abc":"def"</code> (<code>键:值</code>)的对。相同的键后者会覆盖前者。键为需引号圈住的字符串，值的数据类型为</p>

<table><thead><tr><th style="width:6em;">数据类型</th><th>示例</th><th>说明</th></tr></thead><tbody>
<tr>
    <th rowspan="2">布尔型</th>
    <td><code>"is_on_fire": false</code></td>
    <td rowspan="2">值为<code>true</code>和<code>false</code>。</td>
</tr>
<tr><td><code>"is_baby": true</code></td></tr>
<tr>
    <th rowspan="2">数值</th>
    <td><code>"count": 2</code></td>
    <td rowspan="2">2和2.0没有效果上的差异。</td>
</tr>
<tr><td><code>"chance": 0.025</code></td></tr>
<tr>
    <th rowspan="4">字符串</th>
    <td><code>"item": "minecraft:shears"</code></td>
    <td rowspan="4">使用双引号圈住，可以使用颜色代码如§6、换行符\n。</td>
</tr>
<tr><td><code>"condition": "minecraft:match_tool"</code></td></tr>
<tr><td><code>"layer0": "ex:crop/bauhinia_seeds"</code></td></tr>
<tr><td><code>"description": "§6更多的合成 1.10\n§6by ruhuasiyu"</code></td></tr>
<tr>
    <th rowspan="3">列表</th>
    <td><code>"chances": [0.05, 0.0625, 0.083333336, 0.1]</code></td>
    <td rowspan="3">使用中括号圈住。</td>
</tr>
<tr><td><pre style="padding: 0; margin:0">"items": [
    {"item": "minecraft:zombie_head"},
    {"item": "minecraft:skeleton_skull"},
    {"item": minecraft:wither_skeleton_skull"},
    {"item": "minecraft:creeper_head"}
]</pre></td>
</tr>
<tr><td><pre style="padding: 0; margin:0">"requirements":[
    [
        "wing_of_sky",
        "heart_of_crystal",
        "nova_of_fire"
    ]
]</pre></td>
</tr>
<tr>
    <th rowspan="2">JSON对象</th>
    <td><code>"count": { "min": 1, "max": 2 }</code></td>
    <td rowspan="2">使用大括号圈住。整个JSON文件内容本身就是一个JSON对象。</td>
</tr>
<tr><td><pre style="padding: 0; margin:0">"modifiers": [
    {
        "name": "legs_armor",
        "attribute": "generic.armor",
        "operation": "addition",
        "amount": 4,
        "slot": "legs"
    }
]</pre></td>
</tr>
</tbody></table>

<h1 id="§2_数据包">§2 数据包</h1>
<p>数据包文件层次为</p>
<pre class="file">datapacks/数据包名称或数据包名称.zip/</pre>
<pre>
pack.mcmeta
pack.png
data
    命名空间
        advancements
        functions
        loot_tables
        predicates
        recipes
        structures
        tags
            blocks
            items
            fluids
            functions
            entity_types
    minecraft
        dimension
            命名空间
        dimension_type
            命名空间
</pre>
<p><code>data</code> 下所有文件和文件夹需使用小写英文、数字或-,_来命名，<strong>不可使用大写字母</strong>，所有文本文件使用 <code>UTF-8</code> 编码。数据包可以为文件夹格式或 zip 格式，发布时可将所有内容压缩为一个 zip 文件。压缩和解压的时候，注意文件层次，应当打开 zip 文件就可以看到数据包的 pack.mcmeta 和 data 文件夹。稳妥的做法是<code>打开文件夹->全选->右键->发送到->压缩文件夹</code>。游戏内输入 <code>/datapack list</code> 可以列出所有的数据包。</p>
<p><strong>原版数据包 (Vanilla)</strong> 是 Minecraft 自带的一个默认开启的数据包，其 <code>data</code> 文件夹位于 <code>.minecraft/versions/[版本号]/[版本号].jar/data</code>，其中包含的原版进度、配方、结构、战利品表等内容，是制作数据包的文件样板。</p>

<h2 id="§2.1_元信息和图标">§2.1 元信息和图标</h2>
<p>Minecraft 通过文件 <code>pack.mcmeta</code> 来识别数据包，因此该文件是不可或缺的。例如：</p>
<pre class="file">pack.mcmeta</pre>
<pre>
{
    "pack": {
        "pack_format": 5,
        "description": "§6数据包名称\n§a简要介绍 §6by 某某作者"
    }
}
</pre>
<p class="noindent">其中</p>
<table><thead><tr><th style="width:5em;">含义</th><th style="width:6em;">键</th><th>说明</th></tr></thead><tbody>
<tr>
    <th>数据包版本</th>
    <td><code>pack_format</code></td>
    <td>1.13-1.14 版本为 4，1.15-1.16 版本为 5。</td>
</tr>
<tr>
    <th>数据包描述</th>
    <td><code>description</code></td>
    <td>单个字符串或一个<a href="https://wiki.biligame.com/mc/命令#.E5.8E.9F.E5.A7.8BJSON.E6.96.87.E6.9C.AC">原始JSON文本</a>。在输入 <code>/datapack list</code> 命令后，鼠标移至数据包名称上会显示 <code>description</code> 信息。</td>
</tr>
</tbody></table>
<p>数据包可以包含一个 <code>pack.png</code>，它是大小为 <code>16×16</code> 的图片，用于生成世界时在数据包菜单中显示。</p>

<h2 id="§2.2_命名空间">§2.2 命名空间</h2>
<p>命名空间 (namespace) 为玩家自定义的、可操作的空间。使用独立的命名空间也有利于解决和他人的冲突。数据包下可以有多个命名空间，如果不同数据包中有相同的命名空间，则其中相同的文件名内容会根据加载先后顺序被覆盖。特别地，原版内容被保存在 <code>minecraft</code> 命名空间，想要修改和替换原版的内容只需在你的数据包内建立 <code>minecraft</code> 命名空间和相应的同名文件并修改即可。</p>
<p><a href="#§2.9_标签">标签</a>文件，即 <code>tags</code> 中的文件内容默认追加而不是覆盖。因此标签文件是解决数据包冲突和联动的有力工具。</p>
<p>数据包加载顺序并不固定，因此不要在不同数据包中同一命名空间下使用相同的文件名。原版 <code>minecraft</code> 下内容总是最先被加载。可以在游戏内通过手动开启/关闭来调整加载次序，也可以在生成世界加入数据包时调整顺序，但由于玩家行为不受控制，不建议如此做。</p>

<table><thead><tr><th>类型</th><th>调用格式(命名空间ID)</th><th>文件路径</th></tr></thead><tbody>
<tr>
    <th>函数</th>
    <td><code>[命名空间]:[文件夹]/[文件名]</code></td>
    <td><code>[命名空间]/functions/[文件夹]/[文件名].mcfunction</code></td>
</tr>
<tr>
    <th>进度</th>
    <td><code>[命名空间]:[文件夹]/[文件名]</code></td>
    <td><code>[命名空间]/advancements/[文件夹]/[文件名].json</code></td>
</tr>
<tr>
    <th>战利品表</th>
    <td><code>[命名空间]:[文件夹]/[文件名]</code></td>
    <td><code>[命名空间]/loot_tables/[文件夹]/[文件名].json</code></td>
</tr>
<tr>
    <th>断言</th>
    <td><code>[命名空间]:[文件夹]/[文件名]</code></td>
    <td><code>[命名空间]/predicates/[文件夹]/[文件名].json</code></td>
</tr>
<tr>
    <th>配方</th>
    <td><code>[命名空间]:[文件夹]/[文件名]</code></td>
    <td><code>[命名空间]/recipes/[文件夹]/[文件名].json</code></td>
</tr>
<tr>
    <th>结构</th>
    <td><code>[命名空间]:[文件夹]/[文件名]</code></td>
    <td><code>[命名空间]/strutures/[文件夹]/[文件名].nbt</code></td>
</tr>
<tr>
    <th>标签-方块</th>
    <td><code>[命名空间]:[文件夹]/[文件名]</code></td>
    <td><code>[命名空间]/tags/blocks/[文件夹]/[文件名].json</code></td>
</tr>
<tr>
    <th>标签-物品</th>
    <td><code>[命名空间]:[文件夹]/[文件名]</code></td>
    <td><code>[命名空间]/tags/items/[文件夹]/[文件名].json</code></td>
</tr>
<tr>
    <th>标签-实体类型</th>
    <td><code>[命名空间]:[文件夹]/[文件名]</code></td>
    <td><code>[命名空间]/tags/entity_types/[文件夹]/[文件名].json</code></td>
</tr>
<tr>
    <th>标签-函数</th>
    <td><code>[命名空间]:[文件夹]/[文件名]</code></td>
    <td><code>[命名空间]/tags/functions/[文件夹]/[文件名].json</code></td>
</tr>
<tr>
    <th>维度</th>
    <td><code>[命名空间]:[文件夹]/[文件名]</code></td>
    <td><code>minecraft/dimension/[命名空间]/[文件夹]/[文件名].json</code></td>
</tr>
<tr>
    <th>维度类型</th>
    <td><code>[命名空间]:[文件夹]/[文件名]</code></td>
    <td><code>minecraft/dimension_type/[命名空间]/[文件夹]/[文件名].json</code></td>
</tr>
</tbody></table>

<p>若命名空间为 <code>minecraft</code>，则可直接省略 <code>minecraft:</code>。本文中我们会混用两种写法，注意区分。</p>

<h2 id="§2.3_函数">§2.3 函数</h2>
<p>可参考<a href="https://wiki.biligame.com/mc/函数（Java版）">函数</a>。函数 (functions) 为一些命令的集合。函数文件为纯文本文件，后缀为 <code>mcfunction</code>，每一行表示一个单独的命令，无需/开头。执行时会按顺序依次执行，使用 <code>#</code> 开头的行为注释行。游戏内或函数内使用 <code>function [命名空间]:[路径]</code>命令来依次执行函数的每一条命令。函数还可用于完成进度时的奖励函数。</p>
<p>如果函数被另一个函数执行，则默认无执行者，执行地点为出生点，除非在执行时继承上一层命令的执行者和执行位置。如果函数被命令方块执行，则无执行者，执行地点为命令方块位置。如果函数被玩家手动执行，则执行者为玩家自身，执行地点为玩家位置。更多的说明请查看<a href="https://wiki.biligame.com/mc/命令/execute">命令/execute</a>的各项子命令。</p>

<p>如果需要函数在游戏加载/每刻执行，则需要将其加入函数标签中，参考 <a href="#§2.9.1_预设标签">§2.9.1 预设标签</a>。</p>

<h2 id="§2.4_进度">§2.4 进度</h2>
<p>可参考<a href="https://wiki.biligame.com/mc/进度/JSON格式">进度/JSON格式</a>。进度 (advancements) 为游戏内检测玩家行为，触发后完成进度并执行奖励的系统，游戏内按 L 即可查看。进度文件为JSON文件。我们先通过两个例子来看进度文件的格式。</p>

<p class="noindent"><strong>显示效果</strong> 当一个进度没有 <code>parent</code> 时，称之为根进度，即它没有上游进度。此时我们一般会指定 <code>display</code> 来规定显示效果，例如</p>
<pre class="file">ex/advancements/root.json</pre>
<pre>
{
    "display": {
        "icon": {
            "item": "minecraft:carrot_on_a_stick",
            "nbt": "{CustomModelData:12970010}"
        },
        "title":{
            "translate": "advancements.ex.root.title"
        },
        "description": {
            "translate": "advancements.ex.root.description"
        },
        "frame": "goal",
        "background": "ex:bg.png"
    },
    "criteria": {
        "dream_wand": {
            "trigger": "minecraft:inventory_changed",
            "conditions":{
                "items":[
                    {
                        "nbt":"{id:'ex:dream_wand'}"
                    }
                ]
            }
        }
    }
}
</pre>
<p class="noindent">其中各个键的含义为</p>
<table><thead><tr><th style="width:7em;">含义</th><th style="width:6em;">层次和键</th><th>说明</th></tr></thead><tbody>
<tr>
    <th rowspan="3">图标</th>
    <td><code>display.icon</code></td>
    <td>图标，这里为胡萝卜钓竿的自定义物品模型。</td>
</tr>
<tr>
    <td><code>display.icon.item</code></td>
    <td>图标物品 ID，这里为胡萝卜钓竿。</td>
</tr>
<tr>
    <td><code>display.icon.nbt</code></td>
    <td>图标物品 NBT，物品的材质模型可能会根据 NBT 不同而不同。</td>
</tr>
<tr>
    <th>标题</th>
    <td><code>display.title</code></td>
    <td>进度的名称，可以是单个字符串或一个<a href="https://wiki.biligame.com/mc/原始JSON文本格式">原始JSON文本格式</a>，样例中 <code>translate</code> 文本是会随着语言改变的文本，参考 <a href="资源包">§3 资源包</a>。</td>
</tr>
<tr>
    <th>描述</th>
    <td><code>display.description</code></td>
    <td>格式同上。</td>
</tr>
<tr>
    <th>边框</th>
    <td><code>display.frame</code></td>
    <td>分为 <code>task</code>(任务 方形边框)，<code>challenge</code>(挑战 尖形边框)，<code>goal</code>(目标 圆形边框)。</td>
</tr>
<tr>
    <th>选项卡背景</th>
    <td><code>display.background</code></td>
    <td>仅根进度有，决定该选项卡的背景图，为资源包内图片引用，参考 <a href="#texture">§3.6 材质</a>，这里为资源包中图片文件 <code>ex/textures/bg.png</code>。</td>
</tr>
<tr>
    <th rowspan="3">其它显示开关</th>
    <td><code>display.show_toast</code></td>
    <td>为true或false。是否在完成此进度后显示提示信息。默认为true，若无显示效果则无效。一般可省略。</td>
</tr>
<tr>
    <td><code>display.announce_to_chat</code></td>
    <td>为true或false。是否在完成此进度时在聊天窗口提示。默认为true，若无显示效果则无效。一般可省略。</td>
</tr>
<tr>
    <td><code>display.hidden</code></td>
    <td>可以为true或false。是否在进度屏幕隐藏此进度，直到完成进度。会影响其子进度。当父进度值为true后便无法覆盖。默认为false。一般仅用于隐藏的进度。</td>
</tr>
</tbody></table>
<p>若一个进度没有 <code>display</code> 或其根进度无选项卡，则该进度不会出现在进度页面。</p>

<p class="noindent"><strong>触发条件</strong> 进度通过 <code>criteria</code> 来指定触发条件，默认其列出的所有条件均需满足才会完成进度，但我们可以通过 <code>requirements</code> 来指定其它格式。<code>requirements</code> 的格式为或的与(合取范式)，即其列表中的每一个项(该项还是一个列表)中的均有一个列出的触发条件满足。例如 <code>"requirements": [["a","b"],["c","d"]]</code> 表示当 <code>a</code> 和 <code>b</code> 至少有一个满足且 <code>c</code> 和 <code>d</code> 至少有一个满足时，进度会完成。例如下例中两个判据 <code>sealing_wand</code>, <code>dream_wand</code> 分别表示玩家获取了相应 NBT 物品的触发器，只要其中有一个满足即可完成进度。</p>
<pre class="file">ex/advancements/wand.json</pre>
<pre>{
    "parent": "ex:root",
    "display": {
        "icon": {
            "item": "minecraft:carrot_on_a_stick",
            "nbt":"{CustomModelData:12970062}"
        },
        "title":{
            "translate": "advancements.ex.wand.title"
        },
        "description": {
            "translate": "advancements.ex.wand.description"
        },
        "frame": "challenge"
    },
    "criteria": {
        "sealing_wand": {
            "trigger": "minecraft:inventory_changed",
            "conditions":{
                "items":[
                    {
                        "nbt":"{id:'ex:sealing_wand'}"
                    }
                ]
            }
        },
        "dream_wand": {
            "trigger": "minecraft:inventory_changed",
            "conditions":{
                "items":[
                    {
                        "nbt":"{id:'ex:dream_wand'}"
                    }
                ]
            }
        }
    },
    "rewards": {
        "function": "ex:foo",
        "loot": ["ex:bar"],
        "recipes": ["minecraft:crafting_table","ex:strange_block"],
        "experience": 200
    },
    "requirements": [
        [
            "mahoushoujo",
            "dream_wand"
        ]
    ]
}</pre>
<p>触发条件下为触发条件的名称、触发器和触发器的条件，完整的触发器和触发器的条件请查看<a href="https://wiki.biligame.com/mc/进度/JSON格式#触发器列表">进度/JSON格式#触发器列表</a>。我们简要列出常见的触发器：</p>

<table><thead><tr><th>触发器</th><th>触发器的条件</th></tr></thead><tbody>
<tr>
    <td><code>minecraft:impossible</code></td>
    <td>仅可使用命令触发，例如使用触发器以外的条件来触发的进度。</td>
</tr>
<tr>
    <td><code>minecraft:tick</code></td>
    <td>每个游戏刻触发。</td>
</tr>
<tr>
    <td><code>minecraft:location</code></td>
    <td>检查玩家的位置，例如玩家进入某个维度或生物群系等。</td>
</tr>
<tr>
    <td><code>minecraft:enter_block</code></td>
    <td>玩家进入方块时触发，例如水、传送门、花等。</td>
</tr>
<tr>
    <td><code>minecraft:placed_block</code></td>
    <td>玩家放置方块时触发，例如玩家放置了木桶、熔炉、树苗等。</td>
</tr>

<tr>
    <td><code>minecraft:inventory_changed</code></td>
    <td>玩家物品栏变化时触发，例如玩家获取物品。</td>
</tr>
<tr>
    <td><code>minecraft:consume_item</code></td>
    <td>玩家消耗了相应物品，例如食用食物、饮用药水等。</td>
</tr>

<tr>
    <td><code>minecraft:entity_hurt_player</code></td>
    <td>实体伤害玩家时触发。</td>
</tr>
<tr>
    <td><code>minecraft:entity_killed_player</code></td>
    <td>实体杀死玩家时触发。</td>
</tr>
<tr>
    <td><code>minecraft:player_killed_entity</code></td>
    <td>玩家伤害实体（包括自己）时触发。</td>
</tr>
<tr>
    <td><code>minecraft:player_hurt_entity</code></td>
    <td>玩家杀死实体时触发。</td>
</tr>
<tr>
    <td><code>minecraft:player_interacted_with_entity</code></td>
    <td>玩家用手中物品与实体互动时触发，例如驯服、喂养、上鞍、交易、剪羊毛、旋转物品展示框、收集龙息、与猪灵换物、桶装牛奶、桶装鱼、碗装蘑菇煲、碗装迷之炖菜等。</td>
</tr>

<tr>
    <td><code>minecraft:item_durability_changed</code></td>
    <td>物品栏中任何物品以任何形式损害时触发，例如使用工具消耗了耐久。</td>
</tr>
<tr>
    <td><code>minecraft:item_used_on_block</code></td>
    <td>玩家对方块使用物品时触发，例如对着篝火放置食物、斧给木头剥皮等。</td>
</tr>
</tbody></table>
<p>所有的触发器条件均有 <code>player</code> 字段用于判断玩家是否满足相应的断言。例如</p>
<pre class="file">ex:fatness</pre>
<pre>{
    "display": {
        "icon": {
            "item": "minecraft:enchanted_golden_apple"
        },
        "title":{
            "translate": "advancements.ex.fatness.title"
        },
        "description": {
            "translate": "advancements.ex.fatness.description"
        },
        "frame": "challenge"
    },
    "parent": "ex:dream_wand",
    "criteria": {
        "fatness": {
            "trigger": "minecraft:tick",
            "conditions": {
                "player": [
                    {
                        "condition": "minecraft:entity_scores",
                        "entity": "this",
                        "scores": {
                            "exHealth": {
                                "min": 40,
                                "max": 2147483647
                            }
                        }
                    }
                ]
            }
        }
    }
}</pre>

<p class="noindent"><strong>奖励</strong> 完成进度后的奖励可以为：</p>
<table><thead><tr><th style="width:7em;">触发器</th><th style="width:6em;">触发器的条件</th><th>说明</th></tr></thead><tbody>
<tr>
    <th>函数</th>
    <td><code>rewards.function</code></td>
    <td>为函数引用格式。完成进度时执行之，不可为函数标签。</td>
</tr>
<tr>
    <th>战利品表</th>
    <td><code>rewards.loot</code></td>
    <td>为战利品表引用格式列表。完成进度时给予玩家列表中的所有战利品。</td>
</tr>
<tr>
    <th>解锁配方</th>
    <td><code>rewards.recipes</code></td>
    <td>为配方引用格式列表。数据包添加的配方也应当有相应进度来解锁，参考<a href="recipe">§2.7 配方</a>。</td>
</tr>
<tr>
    <th>经验</th>
    <td><code>rewards.experience</code></td>
    <td>为数值。建议仅在高难度进度完成时给予。</td>
</tr>
</tbody></table>
<p class="noindent">上例中进度完成后会执行函数 <code>ex:foo</code>，给予玩家战利品表 <code>ex:bar</code> 的物品，解锁玩家配方 <code>minecraft:crafting_table</code> 和 <code>ex:strange_block</code>，并给予玩家 <code>200</code> 点经验。</p>

<p>游戏内或函数内使用 <code>advancement</code> 命令可以手动给予或剥夺进度。进度配合奖励函数剥夺玩家该进度，则该进度可反复触发，可用于诸如检测玩家生物群系、饮食等需要循环检测的情形。此时我们通常缺省进度的 <code>display</code> 以对玩家隐藏，例如：</p>
<pre class="file">ex/advancements/food/citrus.json</pre>
<pre>{
    "criteria": {
        "citrus": {
            "trigger": "minecraft:consume_item",
            "conditions": {
                "item": {
                    "nbt": "{id:'ex:citrus'}"
                }
            }
        }
    },
    "rewards":{
        "function": "ex:food/citrus"
    }
}</pre>
<pre class="file">ex/functions/food/citrus.mcfunction</pre>
<pre>effect give @s saturation 1 1 true
advancement revoke @s only ex:food/citrus
</pre>

<h2 id="§2.5_战利品表">§2.5 战利品表</h2>
<p>可参考<a href="https://wiki.biligame.com/mc/战利品表#标签">战利品表</a>。战利品表 (loot_tables) 用于实体的掉落物、方块的掉落物、钓鱼、箱子的随机物品等。战利品表文件为JSON文件。例如：</p>

<pre class="file">minecraft/loot_tables/entities/cow.json</pre>
<pre>
{
    "type": "minecraft:entity",
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:leather",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 0,
                                "max": 2
                            }
                        },
                        {
                            "function": "minecraft:looting_enchant",
                            "count": {
                                "min": 0,
                                "max": 1
                            }
                        }
                    ]
                }
            ]
        },
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:alternatives",
                    "children": [
                        {
                            "conditions": [
                                {
                                    "condition": "minecraft:entity_properties",
                                    "entity": "this",
                                    "predicate": {
                                        "flags": {
                                            "is_on_fire": false
                                        }
                                    }
                                }
                            ],
                            "type": "minecraft:item",
                            "name": "minecraft:beef",
                            "functions": [
                                {
                                    "function": "minecraft:set_count",
                                    "count": {
                                        "min": 1,
                                        "max": 3
                                    }
                                },
                                {
                                    "function": "minecraft:looting_enchant",
                                    "count": {
                                        "min": 0,
                                        "max": 1
                                    }
                                }
                            ]
                        },
                        {
                            "type": "minecraft:item",
                            "name": "minecraft:cooked_beef",
                            "functions": [
                                {
                                    "function": "minecraft:set_count",
                                    "count": {
                                        "min": 1,
                                        "max": 3
                                    }
                                },
                                {
                                    "function": "minecraft:looting_enchant",
                                    "count": {
                                        "min": 0,
                                        "max": 1
                                    }
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "conditions": [
                {
                    "condition": "minecraft:killed_by_player"
                },
                {
                    "condition": "minecraft:random_chance_with_looting",
                    "chance": 0.025,
                    "looting_multiplier": 0.01
                }
            ],
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:loot_table",
                    "name": "ex:limb_of_ridge"
                }
            ]
        },
        {
            "conditions": [
                {
                    "condition": "minecraft:killed_by_player"
                },
                {
                    "condition": "minecraft:random_chance_with_looting",
                    "chance": 0.025,
                    "looting_multiplier": 0.01
                }
            ],
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:loot_table",
                    "name": "ex:cow_head"
                }
            ]
        }
    ]
}
</pre>
<p>该例子战利品表表示牛死亡时</p>
<ul>
    <li>掉落 <code>0-(2+抢夺等级)</code>个皮革；</li>
    <li>掉落 <code>1-(3+抢夺等级)</code>个牛肉，着火则掉落熟牛肉；</li>
    <li>被玩家杀死时，有 <code>(2.5+抢夺等级)%</code> 几率掉落战利品表 <code>ex:limb_of_ridge</code> 的物品；</li>
    <li>被玩家杀死时，有 <code>(2.5+抢夺等级)%</code> 几率掉落战利品表 <code>ex:cow_head</code> 的物品；</li>
</ul>
<p>完整格式可参考</p>
<ul>
    <li><a href="http://www.mcbbs.net/thread-831542-1-1.html">【CBL｜SPG】［1.14］战利品表：从入门到重新入门</a></li>
    <li><a href="https://wiki.biligame.com/mc/战利品表">战利品表 - Minecraft Wiki，最详细的官方我的世界百科</a></li>
    <li><a href="https://www.mcbbs.net/thread-914817-1-4.html">【CBL|SPG】[1.15] 新出的断言是什么东西</a></li>
</ul>
<p><code>minecraft</code> 命名空间下记录了实体的默认掉落物、方块的掉落物、钓鱼和箱子战利品的战利品表，玩家可通过 <code>jar</code> 文件查看其文件结构。若要修改这些内容，在数据包中创建 <code>minecraft</code> 命名空间以及同名文件来覆盖之。</p>
<p>战利品表可以以如下等方式调用</p>
<ul>
    <li><code>setblock ~ ~ ~ chest{LootTable:"ex:chests/something"}</code></li>
    <li><code>give @s minecraft:chest{BlockEntityTag:{LootTable:"ex:chests/something"}}</code></li>
    <li><code>summon minecraft:bat ~ ~ ~ {DeathLootTable:"ex:entities/something"}</code></li>
    <li><code>loot spawn ~ ~ ~ loot ex:something</code></li>
</ul>
<p>战利品表除上述常规用途外，还可用于</p>
<ul>
    <li>生成随机数，见 <a href="#§11.1_随机数">§11.1 随机数</a>。</li>
    <li>修改玩家背包物品，见 <a href="#§11.2_修改玩家背包">§11.2 修改玩家背包</a>，<a href="https://www.mcbbs.net/thread-879073-1-1.html">戴帽子</a>。</li>
    <li>将特定物品输出至容器内，见 <a href="#§11.2_修改玩家背包">§11.2 修改玩家背包</a>，<a href="#§8.4_物品输出">§8.4 物品输出</a>，<a href="https://www.mcbbs.net/thread-898170-1-1.html">物品分类器</a>。</li>
    <li>指定自定义机器的配方，见 <a href="#§7.5_配方处理">§7.5 配方处理</a>。</li>
</ul>


<h2 id="§2.6_断言">§2.6 断言</h2>
<p>断言 (predicate) 可以认为是战利品中的条件。断言文件为JSON文件，可用于</p>
<ul>
    <li>命令 <code>execute (if|unless) predicate foo:bar</code></li>
    <li>实体选择器参数 <code>predicate={foo:bar}</code></li>
    <li>战利品表条件</li>
    <li>进度中判断实体条件</li>
</ul>
<p>可参考<a href="https://www.mcbbs.net/thread-914817-1-4.html">【CBL|SPG】[1.15] 新出的断言是什么东西</a>。例如</p>
<ul>
    <li>判断某个物品是否属于某个物品标签，将物品复制到盔甲架主手，然后判断是否满足相应断言即可。</li>
    <li>按一定概率执行命令，使用 <code>minecraft:random_chance</code> 即可。</li>
</ul>
<p>诸如此类，虽然以前也可以通过在相应位置执行对应的带条件的战利品表执行，但用断言无疑方便更多。</p>

<h2 id="§2.7_配方">§2.7 配方</h2>
<p>配方 (recipes) 包括工作台合成、切石机合成、熔炉烧炼、高炉烧炼、烟熏炉烧炼、营火烧炼，<strong>不支持带 NBT 标签</strong>。配方文件为JSON文件，具体格式见 <a href="#§7_合成与烧炼">§7 合成与烧炼</a>。想要实现带NBT的合成需要藉由其它方式，见<a href="#§9_NBT合成与烧炼">§9 NBT合成与烧炼</a>。</p>
<p>在默认情形(限制配方关闭)下，玩家总是可以使用所有的配方，但是未获得的不会在配方书中显示，因此建议为你的自定义配方添加合适的进度来获取该配方。</p>

<h2 id="§2.8_结构">§2.8 结构</h2>
<p>结构 (structures) 文件为NBT文件，后缀为 <code>nbt</code>。结构存储了一个长方体区域的方块和实体信息，玩家可以创建、保存、调用这样的结构。结构大小一般至多为 <code>48×48×48</code>，1.15及更早版本则至多为 <code>32×32×32</code>。可参考</p>
<ul>
    <li><a href="http://www.mcbbs.net/thread-652937-1-1.html">建筑党也能愉快享用结构方块-图文并茂教会你使用结构方块</a></li>
    <li><a href="http://www.mcbbs.net/thread-801350-1-1.html">如何使用结构方块</a></li>
    <li><a href="https://wiki.biligame.com/mc/结构方块">结构方块 - Minecraft Wiki，最详细的官方我的世界百科</a></li>
</ul>
<p>在游戏中获得结构方块后，放置好所需要的方块结构和实体，然后放置结构方块，设置为保存模式，调整好大小，输入名称，点保存即可（注意区分是否需要实体）。然后从 <code>generated</code> 文件夹复制到数据包内，在结构方块中输入<code>命名空间:文件夹/文件</code>格式加载（注意区分是否需要实体）。</p>
<p>我们也可以在函数中加载，先放置结构方块，然后放置并清除红石块即可。这个技巧配合战利品表和断言，可用于随机在世界生成结构。例如：</p>
<pre class="file">ex/functions/generate/enchanting_room.mcfunction</pre>
<pre>
setblock ~ ~ ~ structure_block{posX:-1,posY:0,posZ:-1,name:"ex:build/enchanting_room",mode:"LOAD"}
setblock ~ ~1 ~ redstone_block
setblock ~ ~1 ~ air
</pre>

<h2 id="§2.9_标签">§2.9 标签</h2>
<p>标签 (tags) 文件为JSON文件，根据子文件夹不同分为5种。Minecraft 中有很多内容都叫做标签，注意区分它们。</p>
<table><thead><tr><th style="width:6em;">类别</th><th style="width:18em;">文件路径</th><th>用途</th></tr></thead><tbody>
<tr>
    <th>方块标签</th>
    <td><code>tags/blocks/[文件名].json</code></td>
    <td>用于在命令、进度、断言、战利品表中检测/调用多个方块。</td>
</tr>
<tr>
    <th>物品标签</th>
    <td><code>tags/items/[文件名].json</code></td>
    <td>用于在配方、进度、断言、战利品表中检测/调用多个物品。</td>
</tr>
<tr>
    <th>函数标签</th>
    <td><code>tags/functions/[文件名].json</code></td>
    <td>用于在 <code>function</code> 命令中一次性按次序执行多个函数。</td>
</tr>
<tr>
    <th>实体类型标签</th>
    <td><code>tags/entity_types/[文件名].json</code></td>
    <td>用于在实体选择器选项 <code>type</code> 中指定多种不同实体。</td>
</tr>
<tr>
    <th>流体标签</th>
    <td><code>tags/fluids/[文件名].json</code></td>
    <td>很少使用。</td>
</tr>
</tbody></table>

<p>标签中可以引用其它标签，例如：</p>
<pre class="file">minecraft/tags/blocks/logs.json</pre>
<pre>
{
    "replace": false,
    "values": [
        "#minecraft:dark_oak_logs",
        "#minecraft:oak_logs",
        "#minecraft:acacia_logs",
        "#minecraft:birch_logs",
        "#minecraft:jungle_logs",
        "#minecraft:spruce_logs"
    ]
}
</pre>
<p>就包含了所有6种原木、木头、去皮原木、去皮木头。标签中 <code>replace</code> 可以为</p>
<ul>
    <li><code>false</code> 表示追加当前 <code>values</code> 内容至该标签。</li>
    <li><code>true</code> 表示覆盖之前原版和其它数据包添加至该标签的内容。</li>
</ul>
<p class="noindent">默认为 <code>false</code>。由于数据包加载次序不定，因此后一种情形较为少用，一般仅用于覆盖原版标签。</p>
<p>调试模式(F3)下，玩家指向方块时会显示含有该方块的所有方块标签。</p>

<p class="ex">当玩家被方块卡住时，输出 I'm stucked!</p>
<pre class="file">ex/tags/blocks/fluid.json</pre>
<pre>{
    "replace": false,
    "values": [
        "minecraft:air",
        "minecraft:cave_air",
        "minecraft:void_air",
        "minecraft:bubble_column",
        "minecraft:water",
        "minecraft:lava",
        "minecraft:fire"
    ]
}
</pre>
<p class="noindent">然后执行命令</p>
<pre class="file">ex/functions/check.mcfunction</pre>
<pre>
execute as @a at @s anchored eyes unless block ^ ^ ^ #ex:fluid run say I'm stucked!
</pre>
<p class="noindent">因为命令执行地点为实体的脚，所以我们使用 <code>anchored eyes</code> 来使得局部坐标的位置变为玩家的眼睛。</p>

<h3 id="§2.9.1_预设标签">§2.9.1 预设标签</h3>
<p><code>minecraft</code> 命名空间中预设了一些标签。其中</p>
<ul>
    <li><code>minecraft/tags/functions/load.json</code> 中的函数会在加载时被执行一次，我们常称之为加载函数、load函数。用于初始化的函数应当添加至该标签。</li>
    <li><code>minecraft/tags/functions/tick.json</code> 中的函数每刻会被执行一次，我们常称之为循环函数、主函数、tick函数。需要高频执行的函数应当添加至该标签。</li>
</ul>
<p>本文中我们有时会不加注明地使用<code>[命名空间]:load</code> 和<code>[命名空间]:tick</code> 表示这两个函数标签中的函数。</p>
<p>利用预设标签还可以实现更多燃料、改变植物种植所需的方块，甚至改变水和熔岩的性质，可参见<a href="https://wiki.biligame.com/mc/标签">标签 - Minecraft Wiki，最详细的官方我的世界百科</a>和 <a href="http://www.mcbbs.net/thread-811990-1-1.html">minecraft 预设tag以及实现随机方块功能</a>。例如：让末影人无法拿起任何方块。</p>
<pre class="file">minecraft/tags/blocks/enderman_holdable</pre>
<pre>
{
    "replace": true,
    "values": [
    ]
}
</pre>

<h2 id="§2.10_维度和维度类型">§2.10 维度和维度类型</h2>

<p>维度 (dimension) 和维度类型 (dimension_type) 用于自定义维度。维度和维度类型文件为JSON文件，格式可参考<a href="https://wiki.biligame.com/mc/维度">维度 - Minecraft Wiki，最详细的官方我的世界百科</a>。原版世界的默认参数可见<a href="https://wiki.biligame.com/mc/%E7%BB%B4%E5%BA%A6/Generator_Defaults">维度/Generator Defaults - Minecraft Wiki，最详细的官方我的世界百科</a>。</p>

<p>维度/维度类型文件需要放在 <code>minecraft/dimension</code> 和 <code>minecraft/dimension_type</code> 下，其子文件夹为命名空间。维度类型文件规定了维度的一些基本信息，例如是否可以使用床，猪人是否会僵尸化等。维度文件规定了维度的生成方式和生物群系。</p>

<pre class="file">minecraft/dimensions/ex/flower.json</pre>
<pre>
{
    "type": "ex:flower",
    "generator": {
        "type": "minecraft:noise",
        "seed": 20200602,
        "settings": {
            "bedrock_roof_position":256,
            "bedrock_floor_position": 0,
            "sea_level": 63,
            "disable_mob_generation": true,
            "default_block": {
                "Name": "minecraft:dirt"
            },
            "default_fluid": {
                "Name": "minecraft:water",
                "Properties": {
                    "level": "0"
                }
            },
            "noise": {
                "top_slide": {
                    "target": 0,
                    "size": 1,
                    "offset": 1
                },
                "bottom_slide": {
                    "target": 0,
                    "size": 1,
                    "offset": 1
                },
                "sampling": {
                    "xz_scale": 0.01,
                    "xz_factor": 1.0,
                    "y_scale": 0.01,
                    "y_factor": 1.0
                },
                "size_vertical": 1,
                "size_horizontal": 1,
                "height": 128,
                "density_factor": 1.0,
                "density_offset": 0.0,
                "simplex_surface_noise": false
            },
            "structures": {
                "structures": {
                    "mineshaft": {
                        "spacing": 2000,
                        "separation": 1000,
                        "salt": 20200602
                    },
                    "ruined_portal": {
                        "spacing": 2000,
                        "separation": 1000,
                        "salt": 20200602
                    }
                }
            }
        },
        "biome_source": {
            "biome": "minecraft:flower_forest",
            "type": "minecraft:fixed",
            "seed": 20200602
        }
    }
}
</pre>
<pre class="file">minecraft/dimension_type/ex/flower.json</pre>
<pre>
{
    "ultrawarm": false,
    "natural": false,
    "shrunk": false,
    "has_skylight": true,
    "has_ceiling": false,
    "ambient_light": 1,
    "fixed_time": 6000,
    "biome_zoomer": "FuzzyOffsetConstantColumnBiomeZoomer", 
    "piglin_safe": false,
    "bed_works": true,
    "respawn_anchor_works": true,
    "has_raids": false,
    "logical_height": 256,
    "infiniburn": "cpp:infiniburn_flower"
}
</pre>

<p>目前自定义维度需使用 <code>execute in ex:flower</code> 来进入。我们可以指定一种多方块结构为传送检测方式。</p>
<p class="ex">将高花摆放成八边形并在中间放置白色羊毛以激活去往 <code>ex:flower</code> 的传送门。</p>
<pre class="file">ex/advancements/block/white_wool</pre>
<pre>
{
    "criteria": {
        "white_wool": {
            "trigger": "minecraft:placed_block",
            "conditions": {
                "block": "minecraft:white_wool"
            }
        }
    },
    "rewards": {
        "function": "ex:block/reset/white_wool"
    }
}
</pre>
<pre class="file">ex:block/reset/white_wool</pre>
<pre>
advancement revoke @s only ex:block/white_wool
scoreboard players set #block_id exValue 3
function ex:misc/loc/pos
execute as @e[type=area_effect_cloud,distance=..9,tag=ex_loc_block_pos] at @s align xyz if predicate ex:flower_portal run function ex:block/put/white_wool
kill @e[type=area_effect_cloud,distance=..9,tag=ex_loc_block_pos]
</pre>
<pre class="file">ex:block/put/white_wool</pre>
<pre>
summon area_effect_cloud ~0.5 ~ ~0.5 {Age:0,Duration:2147483647,Tags:["ex_aec_marker","ex_flower_portal"]}
setblock ~ ~ ~ end_gateway
</pre>
<pre class="file">ex/predicates/flower_portal.json</pre>
<pre>
[
    {
        "condition": "minecraft:location_check",
        "offsetX": 2,
        "offsetZ": 2,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetX": 2,
        "offsetZ": -2,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetX": -2,
        "offsetZ": 2,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetX": -2,
        "offsetZ": -2,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetX": 3,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetX": -3,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetZ": 3,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetZ": -3,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    }
]
</pre>
<pre class="file">ex/predicates/flower_portal_done.json</pre>
<pre>
[
    {
        "condition": "minecraft:location_check",
        "predicate": {
            "block": {
                "block": "minecraft:end_gateway"
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetX": 2,
        "offsetZ": 2,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetX": 2,
        "offsetZ": -2,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetX": -2,
        "offsetZ": 2,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetX": -2,
        "offsetZ": -2,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetX": 3,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetX": -3,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetZ": 3,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    },
    {
        "condition": "minecraft:location_check",
        "offsetZ": -3,
        "predicate": {
            "block": {
                "tag": "minecraft:tall_flowers",
                "state": {
                    "half": "lower"
                }
            }
        }
    }
]
</pre>


<p>检测传送门是否完整。检测玩家位置来传送。</p>
<pre class="file">ex:tick</pre>
<pre>
execute as @e[type=area_effect_cloud,tag=ex_flower_portal] at @s unless predicate ex:flower_portal_done run function ex:misc/flower_portal
execute as @a at @s[predicate=ex:in_overworld,predicate=ex:flower_portal_done] run function ex:misc/to_flower
execute as @a at @s[predicate=ex:in_flower,predicate=ex:flower_portal_done] run function ex:misc/to_overworld
</pre>
<pre class="file">ex:misc/flower_portal</pre>
<pre>
kill @s
setblock ~ ~ ~ white_wool
</pre>
<pre class="file">ex/predicates/in_overworld.json</pre>
<pre>
{
    "condition": "minecraft:location_check",
    "predicate":{
        "dimension": "minecraft:overworld"
    }
}
</pre>
<pre class="file">ex/predicates/in_flower.json</pre>
<pre>
{
    "condition": "minecraft:location_check",
    "predicate":{
        "dimension": "ex:flower"
    }
}
</pre>
<pre class="file">ex:misc/to_flower</pre>
<pre>
execute in ex:flower run tp ~ ~ ~
execute at @s run spreadplayers ~ ~ 1 10 false @s
</pre>
<pre class="file">ex:misc/to_overworld</pre>
<pre>
execute in overworld run tp ~ ~ ~
execute at @s run spreadplayers ~ ~ 1 10 false @s
</pre>

<h1 id="§3_资源包">§3 资源包</h1>
<p>资源包可以极大地提升原版模组的美观程度，因此现在大部分原版模组都需要使用配套的资源包。资源包文件层次为</p>
<pre class="file">resourcepacks/资源包名称或资源包名称.zip/</pre>
<pre>
pack.mcmeta
pack.png
assets
    命名空间
        lang
            zh_cn.json
            zh_tw.json
            en_us.json
        models
        textures
</pre>
<p class="noindent">其中 <code>assets</code> 的文件结构和 <a href="#§1.3.1_游戏文件结构">§1.3.1 游戏文件结构</a>中 <code>versions/[版本号]/[版本号].jar/assets</code> 的结构是一样的。</p>
<p><code>assets</code> 下所有文件和文件夹需使用小写英文、数字或-,_来命名，<strong>不可使用大写字母</strong>，所有文本文件为使用 <code>UTF-8</code> 编码的JSON文件，图片为 <code>png</code> 格式。资源包可以为文件夹格式或 zip 格式，发布时可将所有内容压缩为一个 zip 文件。压缩和解压的时候，注意文件层次，应当打开 zip 文件就可以看到资源包的 pack.mcmeta、pack.png 和 assets 文件夹。稳妥的做法是<code>打开文件夹->全选->右键->发送到->压缩文件夹</code>。</p>
<p>游戏内选择<code>选项->资源包...</code>可以列出所有的资源包。在资源包菜单中，加载次序由下至上，因此上方的资源包内容会覆盖下方的资源包同名内容。由于原版模组往往会修改原版物品自定义模型，因此同时安装多个原版模组的资源包时，很容易出现文件冲突，此时需要玩家手动合并资源包方可使用。具体而言，对比两个资源包的同名文件，将相同的模型文件的 <code>overrides</code> 合并，其它内容选择需要的留下即可。</p>
<p>若资源包位于 <code>saves/[世界名称]/resources.zip</code>，则资源包会在进入存档时自动加载(最顶层)。</p>
<p>本节中我们仅对资源包做简单介绍，更详细的文件说明请参阅<a href="https://wiki.biligame.com/mc/资源包">资源包 - Minecraft Wiki，最详细的官方我的世界百科</a>或论坛材质资源版相关内容。</p>
<p>材质包和资源包是不同的东西，目前 Minecraft Java 只有资源包，请不要使用错误的名称。</p>

<h2 id="§3.1_元信息和图标">§3.1 元信息和图标</h2>

Minecraft 通过 <code>pack.mcmeta</code> 来识别资源包，因此该文件是不可或缺的。例如：
<pre class="file">pack.mcmeta</pre>
<pre>
{
    "pack": {
        "pack_format": 5,
        "description": [
            {
                "text": "Crafting++ v1.10 ",
                "color": "gold"
            },
            {
                "translate": "options.resourcepack"
            },
            {
                "text": "\nruhuasiyu RubberTree",
                "color": "green"
            }
        ]
    }
}    
</pre>
<p class="noindent">其中</p>
<table><thead><tr><th style="width:5em;">含义</th><th style="width:6em;">键</th><th>说明</th></tr></thead><tbody>
<tr>
    <th>资源包版本</th>
    <td><code>pack_format</code></td>
    <td>1.13-1.14 版本为 4，1.15 版本为 5。</td>
</tr>
<tr>
    <th>资源包描述</th>
    <td><code>description</code></td>
    <td>单个字符串或一个<a href="https://wiki.biligame.com/mc/命令#.E5.8E.9F.E5.A7.8BJSON.E6.96.87.E6.9C.AC">原始JSON文本</a>，资源包菜单中可以看到该文本。</td>
</tr>
</tbody></table>
<p>资源包可以包含一个 <code>pack.png</code>，它是大小为<code>16×16</code>的图片，用于在资源包菜单中显示。</p>

<h2 id="§3.2_命名空间">§3.2 命名空间</h2>
<p>命名空间 (namespace) 为玩家自定义的、可操作的空间。使用独立的命名空间也有利于解决和他人的冲突。资源包下可以有多个命名空间，如果不同资源包中有相同的命名空间，则其中相同的文件名内容会根据加载先后顺序被覆盖。特别地，原版内容被保存在 <code>minecraft</code> 命名空间，想要修改和替换原版的模型材质只需在你的数据包内建立 <code>minecraft</code> 命名空间和相应的同名文件并修改即可。</p>


<table><thead><tr><th>类型</th><th>调用格式(命名空间ID)</th><th>文件路径</th></tr></thead><tbody>
<tr>
    <th>模型</th>
    <td><code>[命名空间]:[文件夹]/[文件名]</code></td>
    <td><code>[命名空间]/models/[文件夹]/[文件名].json</code></td>
</tr>
<tr>
    <th>材质</th>
    <td><code>[命名空间]:[文件夹]/[文件名]</code></td>
    <td><code>[命名空间]/textures/[文件夹]/[文件名].png</code></td>
</tr>
</tbody></table>

<p>若命名空间为 <code>minecraft</code>，则可直接省略 <code>minecraft:</code>。</p>
<p>建议和数据包使用相同的命名空间名。</p>

<h2 id="§3.3_语言文件">§3.3 语言文件</h2>
<p>语言文件可以放在任一命名空间下的 <code>lang</code> 文件夹下。语言文件中可以使用样式代码来实现彩色文字。建议至少支持中文简体(<code>zh_cn</code>)、中文繁体(<code>zh_tw</code>)和英文(<code>en_us</code>)三种语言。建议所有物品、进度、游戏提示等文本均采用 <code>translate</code> 文本。例如：</p>
<pre class="file">assets/命名空间/lang/zh_cn.json</pre>
<pre>
{
    "item.ex.magnet":"§r磁铁",
    ...
}
</pre>
<pre class="file">assets/命名空间/lang/en_us.json</pre>
<pre>
{
    "item.ex.magnet":"§rMagnet",
    ...
}
</pre>

<p>也可以用此方法修改物品的默认名称等内容。例如：</p>
<pre class="file">assets/命名空间/lang/zh_cn.json</pre>
<pre>
{
    "item.minecraft.potion.effect.empty": "§r神秘药水",
    ...
}
</pre>
<p class="noindent">则未知的药水的名称不再是<code>不可合成的药水</code>，而是<code>神秘药水</code>。</code>

<p><code>translate</code> 还有个有趣但不一定实用的用法。</p>
<pre class="file">assets/命名空间/lang/zh_cn.json</pre>
<pre>
{
    "The":"§a原版模组《更多的合成》已成功加载,",      
    "resourcepack":"版本",
    "does":"§a1.9.1§a.",
    "not":"§a更多内容请",
    "Install":"§e点击此处进入wiki.",
    "correctly":"§a作者:",
    "or":"§aruhuasiyu,",
    "Launch":"§aRubberTree",
    ...
}
</pre>
<p class="noindent">则在数据包中输出相应文本时，若无资源包或资源包错误，则会显示 <code>The resourcepack does not Installl correctly or Launch</code> 以提示玩家资源包未加载。</p>

<h2 id="§3.4_自定义物品模型">§3.4 自定义物品模型</h2>
<p>由于1.14添加了 <code>CustomModelData</code>，我们可以拥有几乎无穷多的物品模型。为了便于他人整合和解决冲突，建议将 <code>CustomModelData</code> 的前四位固定以确定模组的独有区段，后四位作为模组不同模型的值，例如 <code>12340000-12349999</code> 之间。此外，建议 <code>CustomModelData</code> 不要超过 <code>16777216</code>，原因见 <a href="https://www.mcbbs.net/thread-867051-1-1.html">custom_model_data 的使用限制</a>。</p>

<p>我们会给出一个例子来说明实现流程。首先在 <code>minecraft</code> 下的胡萝卜钓竿物品模型中添加额外的模型 (<code>overrides</code>)，并引用我们自定义的模型。</p>
<pre class="file">assets/minecraft/models/item/carrot_on_a_stick.json</pre>
<pre>
{
    "parent": "item/handheld_rod",
    "textures": {
        "layer0": "item/carrot_on_a_stick"
    },
    "overrides": [
        { "predicate": { "custom_model_data": 12970001 }, "model": "ex:element/blue_force_of_sky"},
        { "predicate": { "custom_model_data": 12970002 }, "model": "ex:element/green_force_of_water"},
        { "predicate": { "custom_model_data": 12970003 }, "model": "ex:element/cyan_force_of_mountain"},
        { "predicate": { "custom_model_data": 12970004 }, "model": "ex:element/orange_force_of_dirt"},
        { "predicate": { "custom_model_data": 12970005 }, "model": "ex:element/yellow_force_of_earth"},
        { "predicate": { "custom_model_data": 12970006 }, "model": "ex:element/red_force_of_fire"}
    ]
}
</pre>
<p class="noindent">注意 <code>custom_model_data</code> 需要按照从小往大的次序，否则会导致后面的覆盖前面的。然后创建自定义的模型</p>
<pre class="file">assets/ex/models/element/red_force_of_fire.json</pre>
<pre>
{
    "parent": "item/handheld",
    "textures": {
        "layer0": "ex:element/red_force_of_fire"
    }
}
</pre>
<p class="noindent">最后绘制材质，并将其保存为 <code>assets/craftingpp/textures/element/red_force_of_fire.png</code>。这样我们就设计好了这个物品模型，在 <a href="#5_物品设计">§5 物品设计</a>我们将会说明如何使用该模型。</p>

<h2 id="§3.5_模型">§3.5 模型</h2>
<p>模型是一个描述形状和指定材质的JSON文件。模型可以理解成一些可以旋转的长方体的拼接，每个长方体的若干个面贴上了材质图案。长方体的厚度可以为0，也可以只有若干个面。</p>
<p>只有 <code>minecraft</code> 命名空间下特定名称的文件才对应特定的物品/方块模型，例如 <code>minecraft/models/item/carrot_on_a_stick.json</code> 表示胡萝卜钓竿的物品模型，<code>minecraft/models/block/stone.json</code> 表示石头的方块模型。</p>
<p>我们通过几个例子来理解下模型文件的语法。</p>
<pre class="file">minecraft/models/item/handheld.json</pre>
<pre>
{
    "parent": "item/generated",
    "display": {
        "thirdperson_righthand": {
            "rotation": [ 0, -90, 55 ],
            "translation": [ 0, 4.0, 0.5 ],
            "scale": [ 0.85, 0.85, 0.85 ]
        },
        "thirdperson_lefthand": {
            "rotation": [ 0, 90, -55 ],
            "translation": [ 0, 4.0, 0.5 ],
            "scale": [ 0.85, 0.85, 0.85 ]
        },
        "firstperson_righthand": {
            "rotation": [ 0, -90, 25 ],
            "translation": [ 1.13, 3.2, 1.13 ],
            "scale": [ 0.68, 0.68, 0.68 ]
        },
        "firstperson_lefthand": {
            "rotation": [ 0, 90, -25 ],
            "translation": [ 1.13, 3.2, 1.13 ],
            "scale": [ 0.68, 0.68, 0.68 ]
        }
    }
}
</pre>
<pre class="file">ex/models/head/rabbit.json</pre>
<pre>
{
    "parent": "block/block",
    "gui_light": "side",
    "elements": [
        {
            "from": [ 5.5, 6, 5.5 ],
            "to": [ 10.5, 10, 10.5 ],
            "faces": {
                "east":    { "uv": [ 8, 2.5, 9.25, 4.5 ], "texture": "#layer" },
                "north":{ "uv": [ 9.25, 2.5, 10.5, 4.5 ], "texture": "#layer"},
                "west":    { "uv": [ 10.5, 2.5, 11.75, 4.5 ], "texture": "#layer" },
                "south":{ "uv": [ 11.75, 2.5, 13, 4.5 ], "texture": "#layer" },
                "up":    { "uv": [ 9.25, 0, 10.5, 2.5 ], "texture": "#layer", "rotation": 180},
                "down":    { "uv": [ 10.5, 0, 11.75, 2.5 ], "texture": "#layer" }
            }
        },
        {
            "from": [ 7.5, 7.5, 5 ],
            "to": [ 8.5, 8.5, 6 ],
            "faces": {
                "east":    { "uv": [ 8, 5, 8.25, 5.5 ], "texture": "#layer" },
                "north":{ "uv": [ 8.25, 5, 8.5, 5.5 ], "texture": "#layer"},
                "west":    { "uv": [ 8.5, 5, 8.75, 5.5 ], "texture": "#layer" },
                "south":{ "uv": [ 8.75, 5, 9, 5.5 ], "texture": "#layer" },
                "up":    { "uv": [ 8.25, 4.5, 8.5, 5 ], "texture": "#layer", "rotation": 180},
                "down":    { "uv": [ 8.5, 4.5, 8.75, 5 ], "texture": "#layer" }
            }
        },
        {
            "from": [ 5.5, 10, 9.5 ],
            "to": [ 7.5, 15, 10.5 ],
            "rotation": {
                "origin": [6.5, 10, 10], "axis": "y", "angle": -22.5
            },
            "faces": {
                "east":    { "uv": [ 14.5, 0.5, 14.75, 3 ], "texture": "#layer" },
                "north":{ "uv": [ 14.75, 0.5, 15.25, 3 ], "texture": "#layer"},
                "west":    { "uv": [ 15.25, 0.5, 15.5, 3 ], "texture": "#layer" },
                "south":{ "uv": [ 15.5, 0.5, 16, 3 ], "texture": "#layer" },
                "up":    { "uv": [ 14.75, 0, 15.25, 0.5 ], "texture": "#layer", "rotation": 180},
                "down":    { "uv": [ 15.25, 0, 15.75, 0.5 ], "texture": "#layer" }
            }
        },
        {
            "from": [ 8.5, 10, 9.5 ],
            "to": [ 10.5, 15, 10.5 ],
            "rotation": {
                "origin": [9.5, 10, 10], "axis": "y", "angle": 22.5
            },
            "faces": {
                "east":    { "uv": [ 13, 0.5, 13.25, 3 ], "texture": "#layer" },
                "north":{ "uv": [ 13.25, 0.5, 13.75, 3 ], "texture": "#layer"},
                "west":    { "uv": [ 13.75, 0.5, 14, 3 ], "texture": "#layer" },
                "south":{ "uv": [ 14, 0.5, 14.5, 3 ], "texture": "#layer" },
                "up":    { "uv": [ 13.25, 0, 13.75, 0.5 ], "texture": "#layer", "rotation": 180},
                "down":    { "uv": [ 13.75, 0, 14.25, 0.5 ], "texture": "#layer" }
            }
        }
    ],
    "display": {
        "head": {
            "scale": [ 3.28, 3.28, 3.28 ]
        },
        "gui": {
            "rotation": [ 30, 225, 0 ],
            "translation": [0, -2, 0],
            "scale": [ 1.6, 1.6, 1.6 ]
        },
        "ground": {
            "rotation": [ 0, 0, 0 ],
            "translation": [ 0, 3, 0],
            "scale":[ 0.64, 0.64, 0.64 ]
        },
        "fixed": {
            "rotation": [ 0, 0, 0 ],
            "translation": [ 0, 0, 0],
            "scale":[ 1.28, 1.28, 1.28 ]
        },
        "thirdperson_righthand": {
            "rotation": [ 75, 45, 0 ],
            "translation": [ 0, 2.5, 0],
            "scale": [ 0.96, 0.96, 0.96 ]
        },
        "firstperson_righthand": {
            "rotation": [ 0, 45, 0 ],
            "translation": [ 0, 0, 0 ],
            "scale": [ 1.02, 1.02, 1.02 ]
        },
        "firstperson_lefthand": {
            "rotation": [ 0, 225, 0 ],
            "translation": [ 0, 0, 0 ],
            "scale": [ 1.02, 1.02, 1.02 ]
        }
    },
    "textures": {
        "particle": "entity/rabbit/brown",
        "layer": "entity/rabbit/brown"
    }
}
</pre>

<table><thead><tr><th style="width:6em;">含义</th><th style="width:15em;">键</th><th>说明</th></tr></thead><tbody>
<tr>
    <th>父模型</th>
    <td><code>parent</code></td>
    <td>继承指定位置的模型内容，相当于将其文件内容复制到该位置，可以缺省。Minecraft 已经定义了很多常见模型，我们可以直接调用而无需自己编写。对于自定义的多个类似的模型，我们也可以写好一个模板后继承之。常见的默认模型有<ul>
            <li><code>minecraft:item/generated</code> 普通手持物，指定了手持物在不同位置的显示效果。</li>
            <li><code>minecraft:item/handheld</code> 手持工具物，与上一条有不同的旋转效果。</li>
            <li><code>minecraft:block/block</code> 方块，指定了方块在不同位置的显示效果。</li>
            <li><code>minecraft:block/cube</code> 完整方块，指定了一个1×1×1大小的方块模型。</li>
        </ul></td>
</tr>
<tr>
    <th>光照</th>
    <td><code>gui_light</code></td>
    <td>1.15.2版本起，表示光照方向，分为side(从左上背面打光)和front(从正面打光)。错误的选择会导致模型显得非常的暗。</td>
</tr>
<tr>
    <th>显示</th>
    <td><code>display</code></td>
    <td>物品在不同位置的显示效果。</td>
</tr>
<tr>
    <th>掉落物显示</th>
    <td><code>display.ground</code></td>
    <td>物品作为掉落物的显示效果。</td>
</tr>
<tr>
    <th>头部显示</th>
    <td><code>display.head</code></td>
    <td>物品佩戴在生物头部的显示效果。</td>
</tr>
<tr>
    <th>手持物显示</th>
    <td><code>display.firstperson_lefthand</code><br/>
        <code>display.firstperson_righthand</code><br/>
        <code>display.thirdperson_lefthand</code><br/>
        <code>display.thirdperson_righthand</code>
    </td>
    <td>物品在第一人称左手、第一人称右手、第三人称左手、第三人称右手的显示效果。</td>
</tr>
<tr>
    <th>展示框显示</th>
    <td><code>display.fixed</code></td>
    <td>物品在物品展示框内的显示效果。</td>
</tr>
<tr>
    <th>展示框显示</th>
    <td><code>display.gui</code></td>
    <td>物品在玩家背包或容器内的显示效果。</td>
</tr>
<tr>
    <th>变换</th>
    <td><code>display.[位置].scale</code><br/>
        <code>display.[位置].translation</code><br/>
        <code>display.[位置].rotation</code>
    </td>
    <td>物品在相应位置进行的放缩、平移和旋转。至多放缩至4倍，平移至±80。</td>
</tr>
<tr>
    <th>元素</th>
    <td><code>elements</code></td>
    <td>列表的每个项确定一个长方体。</td>
</tr>
<tr>
    <th>元素范围</th>
    <td><code>elements.from</code><br/>
        <code>elements.to</code></td>
    <td>确定元素的范围。其三个坐标xyz范围为-16到32之间，不做放缩时，0~16即一个方块的完整大小。放置方块后，方块的x轴从右往左，y轴从下往上，z轴从近往远。在背包或展示框中时，x轴从左往右，y轴从上往下，z轴从远往近。</td>
</tr>
<tr>
    <th>元素旋转</th>
    <td><code>rotation.origin</code><br/>
        <code>rotation.axis</code><br/>
        <code>rotation.angle</code></td>
    <td>将元素进行旋转，分别表示旋转中心、旋转的坐标轴、旋转的角度。其中角度只能是<code>0, 22.5, 45, -22.5, -45</code>。</td>
</tr>
<tr>
    <th>元素的面</th>
    <td><code>elements.face</code></td>
    <td>为方块的6个面材质信息，东南西北上下6个面由xyz轴的方向确定，例如+x轴的面为东。</td>
</tr>
<tr>
    <th>元素材质引用</th>
    <td><code>elements.face.[方向].texture</code></td>
    <td>指定所使用的材质。建议绘制材质时按照元素的南面展开图来排列各个面的材质，即 <img src="items/南面展开图.png" alt="南面展开图" /> 或分为6个单独的材质。可以为材质的引用路径或以#开头的变量，使用变量的好处是便于修改。</td>
</tr>
<tr>
    <th>元素材质范围</th>
    <td><code>elements.face.[方向].uv</code></td>
    <td>指定材质的选取范围。将材质放缩为16×16大小，该数值指定的便是相应区域。例如材质文件为64×64大小，则 <code>"uv": [ 3.5, 3, 4, 4 ]</code> 使用的是距左上角横向14-16、纵向12-16的2×4个像素。</td>
</tr>
<tr>
    <th>材质</th>
    <td><code>textures</code></td>
    <td>指定元素材质引用中的变量所指的材质文件位置。可以缺省并在子模型中指定以确定最终模型。</td>
</tr>
<tr>
    <th>颗粒材质</th>
    <td><code>textures.particle</code></td>
    <td>指定作为物品或方块模型时，物品被损耗或方块被挖掘时显示的颗粒材质。</td>
</tr>
</tbody></table>
<p class="noindent">更详细的语法参考<a href="https://wiki.biligame.com/mc/模型">模型 - Minecraft Wiki，最详细的官方我的世界百科</a>。</p>
<figure>
    <img src="items/方向示意图.png" alt="方向示意图" />
    <figcaption>图3.1 方向示意图</figcaption>
</figure>

<p>如果我们循着模型 <code>minecraft:item/handheld</code> 往上，最终会得到模型 <code>builtin/generated</code>。这种模型是内建的，不能通过资源包来修改。</p>

<p>由于 <code>scale</code> 至多为4，而 <code>from to</code> 至多为<code>-16</code>到<code>32</code>，因此模型最多可以放大至<code>12</code>倍。想要更大的模型可以通过分段来旋转拼接而成，参阅</p>
<ul>
    <li><a href="https://www.mcbbs.net/thread-637959-1-1.html">因为不知道发到哪里只好发过来了 也不知道火没火星 毕竟我没有画材质的朋友。。。</a></li>
    <li><a href="https://www.bilibili.com/video/av24626290">四十米长的大刀？我在minecraft里做1200米的！</a></li>
    <li><a href="https://www.bilibili.com/video/av39646162">【魔改材质包】数体积专用-3轴标尺</a></li>
</ul>

<p>模型在不同位置仅有放缩旋转平移的差别，想要实现视觉上的明显不同，可参阅<a href="https://www.mcbbs.net/thread-833056-1-1.html">【1.14】物品头部/背包/手持显示不同材质/模型</a>。</p>

<p>方块状态我们一般不会用到，而且语法比较简单，可直接参阅 wiki，这里不做赘述。</p>

<h2 id="§3.6_材质">§3.6 材质</h2>
<p>材质的绘制需要用到诸如 Photoshop 之类的画图软件，具体请参考材质版或网络上的相关教程。</p>
<p>当模型调用的材质不存在时，会显示紫黑色的材质。如果模型是正确的，你仍然可以看出正确的模型形状。</p>
<p>材质可以是动态的。动态材质需要高为宽的整数，以及一个 <code>mcmeta</code> 文件确定动画，例如 <code>foo.png</code> 对应</p>
<pre class="file">foo.png.mcmeta</pre>
<pre>
{
      "animation": {
        "interpolate": false,
        "frametime": 4,
        "frames": [
            0,
            1,
            2,
            3,
            {"index":4,"time": 2},
            5
        ]
      }
}
</pre>
<table><thead><tr><th>含义</th><th>键</th><th>说明</th></tr></thead><tbody>
<tr>
    <th>插值</th>
    <td><code>interpolate</code></td>
    <td>是否需要插值过渡，缺省为<code>false</code>。</td>
</tr>
<tr>
    <th>帧长</th>
    <td><code>frametime</code></td>
    <td>每一帧的默认时长(刻)。</td>
</tr>
<tr>
    <th>帧</th>
    <td><code>frames</code></td>
    <td>指定播放帧的次序。</td>
</tr>
<tr>
    <th>帧的序号</th>
    <td><code>frames.[数字]</code></td>
    <td>材质的高度为宽度的x倍时，可以有x帧，分别对应材质自上而下均匀划分的x个块。从0开始。</td>
</tr>
<tr>
    <th>帧的序号和时长</th>
    <td><code>frames.index</code><br/>
        <code>frames.time</code></td>
    <td>单独指定这一帧的序号和时长(刻)。</td>
</tr>
</tbody></table>

<h2 id="§3.7_声音">§3.7 声音</h2>
<p>音效文件为 <code>assets/命名空间/sounds.json</code>，它调用的是 <code>assets/命名空间/sounds</code> 文件夹下的 <code>ogg</code> 文件。例如：</p>
<pre class="file">assets/rf/sounds.json</pre>
<pre>
{
    "juicer": {
        "category": "block",
        "sounds": [
            "rf:juicer"
        ]
    },
    "swing": {
        "sounds": [
            "rf:lightsaber/swing1",
            "rf:lightsaber/swing2",
            "rf:lightsaber/swing3",
            "rf:lightsaber/swing4"
        ],
        "category": "hostile"
    }
}
</pre>
<table><thead><tr><th>含义</th><th>键</th><th>说明</th></tr></thead><tbody>
<tr>
    <th>替换</th>
    <td><code>[自定义名称].replace</code></td>
    <td>是否覆盖原有的声音信息，缺省为<code>false</code>，即不覆盖。</td>
</tr>
<tr>
    <th>声音列表</th>
    <td><code>[自定义名称].sounds</code></td>
    <td>触发时会随机选择列表中一个播放。</td>
</tr>
<tr>
    <th>字幕</th>
    <td><code>[自定义名称].subtitle</code></td>
    <td>播放声音时显示的字幕。</td>
</tr>
<tr>
    <th>种类</th>
    <td><code>[自定义名称].category</code></td>
    <td>在<code>选项->音乐和声音中</code>可以选择开启/关闭特定种类的声音。</td>
</tr>
</tbody></table>

<h2 id="§3.8_字体">§3.8 字体</h2>
<p>我们着重介绍字体图片。添加下述路径文件可以追加/覆盖特殊字符的显示：</p>
<pre class="file">assets/minecraft/font/default.json</pre>
<pre>
{
    "providers": [
        {
            "type": "bitmap",
            "file": "minecraft:font/mana0.png",
            "height": 91,
            "ascent": 85,
            "chars": ["\ue010"]
        },
        {
            "type": "bitmap",
            "file": "minecraft:font/mana1.png",
            "height": 91,
            "ascent": 85,
            "chars": ["\ue011"]
        }
    ]
}
</pre>
<p>例子中我们追加了字符 <code>\ue010</code> 和 <code>\ue011</code> 的材质。</p>
<table><thead><tr><th>含义</th><th>键</th><th>说明</th></tr></thead><tbody>
<tr>
    <th>类型</th>
    <td><code>type</code></td>
    <td><code>legacy_unicode</code> 指附魔台文字，我们一般设置为 <code>bitmap</code> 即可。</td>
</tr>
<tr>
    <th>字符列表</th>
    <td><code>chars</code></td>
    <td>每个字符串可以包含多个字符。</td>
</tr>
<tr>
    <th>材质文件</th>
    <td><code>file</code></td>
    <td>该字符列表所用的材质，将该文件划分为若干行以与字符列表的每个字符串一一对应。</td>
</tr>
<tr>
    <th>字符高度</th>
    <td><code>height</code></td>
    <td>该字符列表字符的高度。</td>
</tr>
<tr>
    <th>字符重心</th>
    <td><code>ascent</code></td>
    <td>该字符图案向上移动的长度。</td>
</tr>
</tbody></table>
<p>我们可以用 <code>\u</code> 开头来表示不容易打出的字符，参见<a href="https://unicode-table.com">Unicode® Character Table</a>。直接使用字符也是可以的。</p>
<p>利用这种方式，我们可以做到在成书、玩家快捷栏上方、聊天区域、物品名称等地方显示图片，见<a href="https://www.mcbbs.net/thread-835539-1-1.html">【1.13】如何添加图片?</a>。如果可以包含了使用负长度的空格的字体（需要 Nvidia 显卡以支持），还可以实现更为炫酷的效果，例如字体黑科技 —— 潜影盒内容预览：<a href="https://www.bilibili.com/video/av67508247">https://www.bilibili.com/video/av67508247</a>。</p>

<h2 id="§3.9_着色器">§3.9 着色器</h2>
<p>着色器可以对游戏内的视觉效果进行修改，目前可以通过</p>
<ul>
    <li>旁观特定生物，可使用 <code>/spectate</code> 命令强制旁观；</li>
    <li>屏幕中有发光的实体</li>
</ul>
<p class="noindent">两种情形来达成。着色器文件为位于 <code>assets/minecraft/shaders/program</code> 下方的 <code>fsh</code> 文件，具体用法可参考<a href="https://www.mcbbs.net/thread-916150-1-1.html">原版着色器指导</a>和<a href="https://www.mcbbs.net/thread-917679-1-1.html">几个原版着色器示例</a>。</p>


<h1 id="§4_规划">§4 规划</h1>
<p>当我们有了一定的命令基础和数据包与资源包的相关知识之后，我们可以开始考虑做一个模组了。模组的目的是在原版的基础上做出一定的修改，模组的核心是内容，命令和技巧都只是为实现这一目的的手段。通常的设计路线如下图所示：</p>
<figure>
    <img src="items/设计路线.png" alt="设计路线" />
    <figcaption>图4.1 设计路线</figcaption>
</figure>
<p class="noindent">平衡性可以从合成难度和触发条件等方面来调整。</p>

<p>原版模组不比基于 Forge/Liteloader 等 API 的模组，在实现效率上一般会有所欠缺，因此我们在制作和测试过程中，应当优先保证流畅度，再考虑内容的充实性。</p>
<p>模组的整个生命周期中，所有内容都应当有完整的文档记录，以便于随时查看和修改。</p>
<p>为你的模组设定合理的版本管理方式，例如使用 Git 托管，有利于保存模组的所有历史版本。这可以减少因误操作导致的损失。</p>

<h2 id="§4.1_名称设计">§4.1 名称设计</h2>
<p>模组的所有内容都应当被合理地命名，尽量采用简洁且有意义的命名，同时便于他人处理数据包冲突。这些内容包括数据包下所有的文件和文件夹名以及记分板、标签、组的名称等。建议各种名称均使用大驼峰、小驼峰或下划线记法。如果模组包含多个模块，可以在不同数据包下使用相同的命名空间、不同的文件夹，来分门别类。</p>
<table><thead><tr><th style="width:7em;">类型</th><th>示例</th><th>说明</th></tr></thead><tbody>
<tr>
    <th>数据包名称</th>
    <td><code>craftingpp<br/>更多的合成v1.10<br/>CraftingPlusPlus</code></td>
    <td>建议使用模组全名，空格和特殊字符使用下划线代替或忽略，也可使用中文名称。</td>
</tr>
<tr>
    <th>资源包名称</th>
    <td><code>craftingpp_resourcepack<br/>更多的合成v1.10资源包<br/>CraftingPlusPlus_Resources</code></td>
    <td>建议使用数据包名称+资源包等。</td>
</tr>
<tr>
    <th>命名空间</th>
    <td><code>craftingpp<br/>ex<br/>fisma<br/>mek</code></td>
    <td>过短的命名空间容易冲突，可使用模组名称的全程或缩写来表示。命名空间必须由小写或下划线组成。建议整个模组使用一个命名空间，或若干相同前缀的命名空间。</td>
</tr>
<tr>
    <th>物品名称</th>
    <td><code>红色火之力<br/>Red Force of Fire<br/>ex:red_force_of_fire</code></td>
    <td>建议使用物品英文名称对应的小写+下划线写法作为物品id，具体设计见下一节。</td>
</tr>
<tr>
    <th>记分板和组</th>
    <td><code>exValue<br/>exCraft<br/>macTicks<br/>ex_health</code></td>
    <td>建议使用命名空间为前缀的驼峰记法，因为记分板名称长度不可超过16。长度允许的话，使用下划线记法也可以。</td>
</tr>
<tr>
    <th>实体标签</th>
    <td><code>ex_entities_checker<br/>ex_generate_dead<br/>ex_machines_marker<br/>exDarkAnimals</code></td>
    <td>建议使用命名空间为前缀。</td>
</tr>
<tr>
    <th>自定义NBT键</th>
    <td><code>exGenratorMarker<br/>exLeavesDecayMarker<br/>exSkyislandDrop</code></td>
    <td>建议使用命名空间为前缀。</td>
</tr>
<tr>
    <th>记分板假名</th>
    <td><code>#temp<br/>$machineWorkPeriod<br/>$mod_leaves_speed</code></td>
    <td>临时变量建议使用#开头，配置参数建议使用$开头，因为#开头的计分板不会在记分板列表中显示而$开头的可以。因记分板已使用前缀，此处可以不使用前缀。</td>
</tr>
<tr>
    <th>tick函数</th>
    <td><code>_main.mcfunction<br/>tick.mcfunction<br/>loop.mcfunction</code></td>
    <td>即函数标签 <code>minecraft:tick</code> 下的函数，见 <a href="#§2.9.1_预设标签">§2.9.1 预设标签</a>。</td>
</tr>
<tr>
    <th>load函数</th>
    <td><code>load.mcfunction<br/>_init.mcfunction<br/>root.mcfunction</code></td>
    <td>即函数标签 <code>minecraft:load</code> 下的函数，见 <a href="#§2.9.1_预设标签">§2.9.1 预设标签</a>。</td>
</tr>
</tbody></table>

<h2 id="§4.2_调试">§4.2 调试</h2>
<p>加载中出现的资源包和数据包错误一般会在 <code>logs/latest.log</code> 中提示，见 <a href="#§1.3.1_游戏文件结构">§1.3.1 游戏文件结构</a>。测试时，打开这个文件，可以看到具体是哪个文件的哪个位置发生了错误。常见错误包括</p>

<table><thead><tr><th>日志</th><th>说明</th></tr></thead><tbody>
<tr>
    <td><code>Unable to load model: '模型引用名' referenced from: 某物品#inventory: java.lang.IllegalStateException: Not aJSONObject: "parent"</code></td>
    <td>该物品模型文件中调用的另一模型出错，错误出在 <code>"parent"</code></td>
</tr>
<tr>
    <td><code>Using missing texture, unable to load</code></td>
    <td>相应路径的材质不存在。</td>
</tr>
<tr>
    <td><code>Couldn't load function at 函数路径 java.util.concurrent.CompletionException: java.lang.IllegalArgumentException: Whilst parsing command on line 行号 at position 列号</code></td>
    <td>相应函数的相应位置出错。</td>
</tr>
<tr>
    <td><code>Couldn't read function tag list 标签引用名 from 标签路径 in data pack 数据包</code></td>
    <td>相应数据包的相应路径的标签出错，检查下是否调用了不存在的物品、方块或出错的函数，或是逗号使用错误。</td>
</tr>
</tbody></table>
<p class="noindent">使用 <code>/datapack list</code> 来查看你的模组是否被识别了，如果压根没识别说明你的模组缺少 <code>pack.mcmeta</code> 或其错误。</p>
<p>如果进游戏异常卡顿，输入 <code>/function 相应高频函数</code>，如果提示执行了65535条函数，那么可能是函数使用了无限自我递归调用。检查相应的函数递归是否跳出条件有误。</p>
<p>调试时，可添加适当的 <code>tellraw</code> 命令来查看方块、实体、记分板值等，来确定何处出错。</p>

<h2 id="§4.3_前置与附属">§4.3 前置与附属</h2>
<p>使用他人已写好的前置可以在减少自己的工作量，例如</p>
<ul>
    <li><a href="https://www.mcbbs.net/thread-900914-1-1.html">战利品表随机数</a></li>
    <li><a href="https://www.mcbbs.net/thread-916294-1-1.html">方块通用处理</a></li>
    <li><a href="https://github.com/ruhuasiyu/CraftingPlusPlus/tree/master/other_datapacks/%E5%90%88%E6%88%90%E9%80%9A%E7%94%A8%E5%A4%84%E7%90%86">合成通用处理</a></li>
    <li><a href="https://github.com/ruhuasiyu/CraftingPlusPlus/tree/master/other_datapacks/%E5%8E%9F%E7%89%88%E6%A8%A1%E7%BB%84%E5%AE%B9%E5%99%A8%E6%89%A9%E5%B1%95">原版模组容器扩展</a></li>
    <li><a href="https://www.mcbbs.net/thread-775667-1-1.html">【UIN】数据包——标签分类</a></li>
</ul>
<p class="noindent">等。这些前置已经包含了诸如生成随机数、处理模组方块、合成、容器等内容，这样开发者就不用再花费精力在这些事件的处理上，只需要调用它们提供的接口即可。使用这些数据包之前，应当对其内容有充分的了解再考虑引用，他人的代码未必是合理高效无漏洞的。</p>

<p>建议在前置中添加函数</p>
<pre class="file">foo:datapack</pre>
<pre>
scoreboard players set #datapack_version fooValue 101
</pre>
<p class="noindent">这样他人便可通过在<code>load函数</code>中添加
<pre class="file">bar:load</pre>
<pre>
scoreboard objective add fooValue dummy
scoreboard players set #datapack_version fooValue 0
function foo:datapack
execute unless score #datapack_version fooValue matches 101 run tellraw @a {"text":"[Bar模组]：缺少必要的数据包前置[Foo模组v1.0.1]！"}
</pre>
<p class="noindent">以在缺少相应版本的前置时提醒使用者。</p>

<p>附属一般通过函数标签来实现。例如在你的模组中添加了一种机器，里面对物品进行了一些处理：</p>
<pre class="file">foo:machine/tick</pre>
<pre>
execute if block ~ ~ ~ barrel{Items:[{Slot:3b,id:"minecraft:mycelium"},{Slot:12b,id:"minecraft:dirt"}]} run replaceitem block ~ ~ ~ container.15 minecraft:mycelium
function #foo:item_processer
</pre>
<p class="noindent">那么其它开发者就可以通过在函数标签 <code>#foo:item_processer</code> 中添加相应的函数命令来实现更多的机器配方。</p>

<h2 id="§4.4_发布">§4.4 发布</h2>
<p>当你设计并制作好全部内容且通过测试后，将你的数据包以及其它可能的内容，如资源包、地图、data文件等一同发布。采用合适的版本号管理，并在发布时注明你所使用的命名空间、记分板、组、标签、地图区段、资源包等内容，以便于其他开发者整合或避免冲突。</p>
<p>如果你的模组内容较多，可以建立一个wiki页面来方便玩家查询资料。例如国内最大的中文 Minecraft 模组百科<a href="https://www.mcmod.cn/">MC 百科</a>，建立模组后，可以申请编辑员来方便地管理你的模组wiki页面。也可以 Github 的项目中创建 wiki。</p>


<h1 id="§5_物品设计">§5 物品设计</h1>
<h2 id="§5.1_通用处理">§5.1 通用处理</h2>
<p>由于原版模组从不添加原版不存在的物品，所以我们需要为物品加上NBT来进行区分。我们以一例来看模组物品通常包含哪些NBT。</p>
<p class="ex"> 添加物品红色火之力，不可叠加，右键触发执行命令。我们可使用胡萝卜钓竿/诡异疣钓竿作为物品本体，这里我们以胡萝卜钓竿为例。我们建议为模组添加的所有物品添加相应的战利品表来便于获取/修改/合成等。</p>

<pre class="file">ex/loot_tables/red_force_of_fire.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "item",
                    "name": "minecraft:carrot_on_a_stick",
                    "functions": [
                        {
                            "function": "set_nbt",
                            "tag": "{id:'ex:red_force_of_fire',display:{Name:'{\"translate\":\"item.ex.red_force_of_fire\"}'},CustomModelData:12970013}"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>
<table><thead><tr><th>NBT</th><th>说明</th></tr></thead><tbody>
<tr>
    <td><code>id:"ex:red_force_of_fire"</code></td>
    <td>建议使用<code>id:"命名空间:物品名称"</code>来表示原版模组物品的唯一标签，以与其它模组的物品区分。</td>
</tr>
<tr>
    <td><code>display:{Name:'{"translate":"item.ex.red_force_of_fire"}'}</code></td>
    <td>物品的显示名称，建议使用<code>translate</code>文本，以支持多种语言，见 <a href="#§3.3_语言文件">§3.3 语言文件</a>。</td>
</tr>
<tr>
    <td><code>CustomModelData:12970013</code></td>
    <td>物品的自定义模型数据，见 <a href="#§3.4_自定义物品模型">§3.4 自定义物品模型</a>。</td>
</tr>
<tr>
    <td><code>dict:['iron_dust']</code></td>
    <td>可选的矿物辞典，用于表示同类物品，并不一定指矿物类物品。例如矿物、矿物粉、矿物粒、水果等。矿物辞典可用来解决不同的原版模组/插件的同种物品互相调用的问题，见<a href="https://www.mcmod.cn/post/927.html">原版模组矿物辞典</a>。</td>
</tr>
</tbody></table>

<p class="noindent">然后为物品添加模型，见 <a href="#§3.5_模型">§3.5 模型</a>。</p>
<pre class="file">assets/minecraft/models/item/carrot_on_a_stick.json</pre>
<pre>
{
    "parent": "item/handheld_rod",
    "textures": {
        "layer0": "item/carrot_on_a_stick"
    },
    "overrides": [
        { "predicate": { "custom_model_data": 12970013 }, "model": "ex:tools/red_force_of_fire"}
    ]
}
</pre>
<pre class="file">assets/ex/models/tools/red_force_of_fire.json</pre>
<pre>
{
    "parent": "item/handheld_rod",
    "textures": {
        "layer0": "ex:tools/red_force_of_fire"
    }
}
</pre>
<p class="noindent">最后，为其绘制材质 <code>assets/ex/textures/tools/red_force_of_fire.png</code>。这样我们便将这个物品初步设计完成。</p>

<p>我们会在本节接下来的段落介绍不同功能物品的设计。对于方块形式，我们则会在后续章节中介绍。</p>

<h2 id="§5.2_右键交互">§5.2 右键交互</h2>
<p>对于右键具有交互功能的物品，我们可以使用胡萝卜钓竿，通过使用胡萝卜钓竿的记分板来探测。例如使用上一节中的示例物品：</p>
<pre class="file">ex:load</pre>
<pre>
scoreboard objectives add exUseCSt minecraft.used:minecraft.carrot_on_a_stick
</pre>
<pre class="file">ex:tick</pre>
<pre>
execute as @a[scores={exUseCSt=1..}] run function ex:use_cst
</pre>
<pre class="file">ex:use_cst</pre>
<pre>
execute as @s[predicate=ex:hand/red_force_of_fire] run function ex:tools/red_force_of_fire
scoreboard players reset @s exUseCSt
</pre>
<pre class="file">ex/predicates/hand/red_force_of_fire.json</pre>
<pre>
{
    "condition": "minecraft:alternative",
    "terms":[
        {
            "condition": "minecraft:entity_properties",
            "entity": "this",
            "predicate": {
                "equipment": {
                    "mainhand":{
                        "item": "minecraft:carrot_on_a_stick",
                        "nbt": "{id:'ex:red_force_of_fire'}"
                    }
                }
            }
        },
        {
            "condition": "minecraft:inverted",
            "term": {
                "condition": "minecraft:alternative",
                "terms": [
                    {
                        "condition": "minecraft:entity_properties",
                        "entity": "this",
                        "predicate": {
                            "equipment": {
                                "mainhand":{
                                    "item": "minecraft:carrot_on_a_stick"
                                }
                            }
                        }
                    },
                    {
                        "condition": "minecraft:inverted",
                        "term": {
                            "condition": "minecraft:entity_properties",
                            "entity": "this",
                            "predicate": {
                                "equipment": {
                                    "offhand":{
                                        "item": "minecraft:carrot_on_a_stick",
                                        "nbt": "{id:'ex:red_force_of_fire'}"
                                    }
                                }
                            }
                        }
                    }
                ]
            }
        }
    ]
}
</pre>

<p>如果模组含多个以胡萝卜钓竿为本体的物品需要探测，我们可以先判断是主手还是副手使用的，然后再分情形讨论。</p>
<pre class="file">ex:use_cst</pre>
<pre>
execute as @s[predicate=ex:mainhand/carrot_on_a_stick] run function ex:use_cst_main
execute as @s[predicate=!ex:mainhand/carrot_on_a_stick] run function ex:use_cst_off
scoreboard players reset @s exUseCSt
</pre>
<pre class="file">ex:use_cst_main</pre>
<pre>
execute as @s[predicate=ex:mainhand/red_force_of_fire] run function ex:tools/red_force_of_fire
execute as @s[predicate=ex:mainhand/blue_force_of_sky] run function ex:tools/blue_force_of_sky
...
</pre>
<pre class="file">ex:use_cst_off</pre>
<pre>
execute as @s[predicate=ex:offhand/red_force_of_fire] run function ex:tools/red_force_of_fire
execute as @s[predicate=ex:offhand/blue_force_of_sky] run function ex:tools/blue_force_of_sky
...
</pre>

<pre class="file">ex/predicates/mainhand/carrot_on_a_stick.json</pre>
<pre>
{
    "condition": "minecraft:entity_properties",
    "entity": "this",
    "predicate": {
        "equipment": {
            "mainhand":{
                "item": "minecraft:carrot_on_a_stick"
            }
        }
    }
}
</pre>
<pre class="file">ex/predicates/mainhand/red_force_of_fire.json</pre>
<pre>
{
    "condition": "minecraft:entity_properties",
    "entity": "this",
    "predicate": {
        "equipment": {
            "mainhand":{
                "nbt": "{id:'ex:red_force_of_fire'}"
            }
        }
    }
}
</pre>

<pre class="file">ex/predicates/offhand/red_force_of_fire.json</pre>
<pre>
{
    "condition": "minecraft:entity_properties",
    "entity": "this",
    "predicate": {
        "equipment": {
            "offhand":{
                "nbt": "{id:'ex:red_force_of_fire'}"
            }
        }
    }
}
</pre>

<p>如果需要的话，我们还可以手动模拟胡萝卜钓竿的耐久损耗。</p>
<pre class="file">ex:damage_cst</pre>
<pre>
execute as @s[predicate=ex:mainhand/carrot_on_a_stick] run data modify storage ex:damage Item set from entity @s SelectedItem
execute as @s[predicate=!ex:mainhand/carrot_on_a_stick] run data modify storage ex:damage Item set from entity @s Inventory[{Slot:-106b}]
function ex:damage
execute if score #damage exValue matches 26.. run data remove storage ex:damage Item
setblock ~ 255 ~ shulker_box
data modify storage ex:damage Item.Slot set value 0b
data modify block ~ 255 ~ Items append from storage ex:damage Item
loot replace entity @s[predicate=ex:mainhand/carrot_on_a_stick] weapon.mainhand 1 mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
loot replace entity @s[predicate=!ex:mainhand/carrot_on_a_stick] weapon.offhand 1 mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ air
</pre>
<p class="noindent">处理耐久的函数 <code>ex:damage</code> 见 <a href="#§11.3_耐久处理">§11.3 耐久处理</a>。</p>

<p>投掷物如雪球、末影珍珠等可用于一次性右键工具，不同的物品有着各自的特点。投掷带自定义NBT标签的物品，对应的投掷物实体NBT <code>Item</code> 会包含这些NBT标签。注意，在1.14和更早版本，由于Mojang先消耗手持物再存储手持物信息，导致投掷最后一个物品时没有存储相应的 <code>Item</code> 信息，此时我们需要提前1刻存储玩家手持物信息方可。</p>
<p class="ex">扔出 <code>minecraft:experience_bottle{exXpNumber:99s}</code> 生成 <code>exXpNumber</code> 点经验值的经验球。</p>
<pre class="file">ex:tick</pre>
<pre>
execute as @e[type=experience_bottle] if data entity @s Item.tag.exXpNumber at @s run function ex:xp/throw
</pre>
<pre class="file">ex:xp/throw</pre>
<pre>
summon experience_orb ~ ~ ~ {ags:["ex_XpNumber"]}
execute store result entity @e[type=experience_orb,tag=ex_XpNumber,limit=1,distance=..1] Value short 1 run data get entity @s Item.tag.ex_XpNumber
tag @e[type=experience_orb,tag=ex_XpNumber,limit=1,distance=..1] remove ex_XpNumber
kill @s        
</pre>
<p>注意使用发射器发射该附魔之瓶仍然会表现如同普通附魔之瓶。</p>

<h2 id="§5.3_食物">§5.3 食物</h2>

<p>我们一般要求食物的本体无合成用途，且和其它生物没有交互，饥饿值较低以便于通过饱和效果实现高饥饿值。由此，可选的有：</p>
<table><thead><tr><th>物品</th><th>优点</th><th>缺点</th></tr></thead><tbody>
<tr><td>曲奇</td>
    <td>饥饿值低，容易通过饱和效果实现至少2点饥饿值的食物。无合成用途。</td>
    <td>和鹦鹉可交互。</td>
</tr>
<tr><td>苹果</td>
    <td>饥饿值低，容易通过饱和效果实现至少4点饥饿值的食物。</td>
    <td>可用于合成金苹果。</td>
</tr>
<tr><td>熟鳕鱼</td>
    <td>饥饿值低，容易通过饱和效果实现至少5点饥饿值的食物。无合成用途。</td>
    <td>-</td>
</tr>
<tr><td>面包</td>
    <td>饥饿值低，容易通过饱和效果实现至少5点饥饿值的食物。无合成用途。和村民可交互。</td>
    <td>-</td>
</tr>
<tr><td>迷之炖菜</td>
    <td>容易实现状态效果。不可堆叠，食用后有碗。</td>
    <td>饥饿值过高，只能通过饱和效果实现至少8点饥饿值的食物。</td>
</tr>
</tbody></table>
<p class="ex">食用肉松面包回复10点饥饿值，并获得30秒的速度效果，且可扔给村民。</p>
<pre class="file">ex/loot_tables/meat_floss_bread.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:bread",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.ex.meat_floss_bread\"}'},id:'ex:meat_floss_bread',CustomModelData:12970001}"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>
<pre class="file">ex/advancements/foods/meat_floss_bread.json</pre>
<pre>
{
    "criteria": {
        "meat_floss_bread": {
            "trigger": "minecraft:consume_item",
            "conditions": {
                "item": {
                    "nbt": "{id:'ex:meat_floss_bread'}"
                }
            }
        }
    },
    "rewards":{
        "function": "ex:foods/meat_floss_bread"
    }
}
</pre>
<pre class="file">ex:foods/meat_floss_bread</pre>
<pre>
effect give @s saturation 1 4
effect give @s speed 30
advancement revoke @s only ex:foods/meat_floss_bread
</pre>
<p class="noindent">这里，1秒的饱和IV可以恢复5点饥饿值，加上面包本身的5点，正好为10点。</p>

<p>如果我们想要制作不可堆叠类食物，可以为食物附加上随机的盔甲属性，且令其在 <code>chest</code> 栏位生效。由于一般食物无法放入玩家胸甲栏位，因此该属性并不会有实际效果。</p>
<pre class="file">ex/loot_tables/colorful_vegetable.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:cooked_cod",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"italic\":false,\"translate\":\"item.cpp.colorful_vegetable\"}'},id:'cpp:colorful_vegetable',CustomModelData:12970002,HideFlags:63}"
                        },
                        {
                            "function": "minecraft:set_attributes",
                            "modifiers": [
                                {
                                    "slot": "chest",
                                    "name": "food_armor",
                                    "attribute": "generic.armor",
                                    "amount": 0,
                                    "operation": "addition"
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>
<p>更为简便的做法是使用迷之炖菜，注意会剩下碗。迷之炖菜可以自带药水效果，无需进度和函数来额外实现药水效果，但由于只能设置为1级，因此额外的饥饿值仍然需要进度。</p>
<p class="ex">食用缤纷菜蔬回复6点饥饿值，并获得30秒的跳跃提升效果。</p>
<pre class="file">ex/loot_tables/colorful_vegetable.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:suspicious_stew",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.ex.colorful_vegetable\"}',Lore:['{\"translate\":\"lore.ex.leap\"}']},id:'ex:colorful_vegetable',CustomModelData:12970002,Effects:[{EffectDuration:600,EffectId:8b}]}"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>
<p>对于想要使用饥饿效果来降低饥饿值的情形，注意饥饿效果会先消耗饱食度，且如果玩家食用后饥饿值已满，还需要通过记分板来实时检测上一刻玩家的饥饿值以确定当前的饥饿值应当为多少。因此实现较为繁琐，这里便不做详解。</p>

<h2 id="§5.4_药水">§5.4 药水</h2>
<p>我们使用药水来实现自定义的药水效果。</p>
<p class="ex">饮用潮汐药水后获得8分钟的潮涌之力效果。</p>
<pre class="file">ex/loot_tables/potion_of_tide.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:potion",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.ex.potion_of_tide\"}'},id:"ex:potion_of_tide",CustomPotionColor:1950417,CustomPotionEffects:[{Id:29b,Amplifier:0b,Duration:9600}]}"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>

<p>如果我们想要药水可以堆叠，可以使用食物(64堆叠数)或蜂蜜瓶(16堆叠数)来实现，但要注意它们可以恢复饥饿值，且可能可参与合成。我们需要手动为食物加上显示药水效果的<code>Lore</code>。</p>
<p class="ex">饮用天空药水(16堆叠数)后回复6点饥饿值，并获得6分钟的速度II和6分钟的缓降效果。</p>
<pre class="file">ex/loot_tables/agentia_of_sky.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:honey_bottle",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.ex.agentia_of_sky\"}',Lore:['[{\"translate\":\"effect.minecraft.speed\",\"italic\":\"false\",\"color\":\"blue\"},{\"text\":\" II (6:00)\"}]','[{\"translate\":\"effect.minecraft.slow_falling\",\"italic\":\"false\",\"color\":\"blue\"},{\"text\":\" (6:00)\"}]','\" \"','{\"translate\":\"potion.whenDrank\",\"italic\":\"false\"}','[{\"text\":\"+40% \",\"italic\":\"false\",\"color\":\"blue\"},{\"translate\":\"attribute.name.generic.movementSpeed\"}]']},id:'ex:agentia_of_sky',CustomModelData:12970101}"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>
<pre class="file">ex/advancements/agentia_of_sky.json</pre>
<pre>
{
    "criteria": {
        "consume": {
            "trigger": "minecraft:consume_item",
            "conditions": {
                "item": {
                    "nbt": "{id:'ex:agentia_of_sky'}"
                }
            }
        }
    },
    "rewards":{
        "function": "ex:potion/agentia_of_sky"
    }
}
</pre>
<pre class="file">ex:potion/agentia_of_sky</pre>
<pre>
effect give @s speed 360 1
effect give @s slow_falling 360
advancement revoke @s only ex:potion/agentia_of_sky
</pre>

<h2 id="§5.5_自定义状态效果">§5.5 自定义状态效果</h2>
<p>原版定义新的状态效果是不可能的，但是我们可以通过进度来模拟食用特定物品后的效果。我们使用记分板来记录时长，模拟药水的颗粒效果，并在<code>actionbar</code>显示剩余时长。</p>
<p class="ex">饮用泥土药水后获得12分钟的隐身和12分钟的连锁效果，这里我们不涉及实际效果的实现。</p>
<pre class="file">ex/loot_tables/agentia_of_dirt.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:honey_bottle",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.ex.agentia_of_dirt\"}',Lore:['[{\"translate\":\"effect.minecraft.invisibility\",\"italic\":\"false\",\"color\":\"blue\"},{\"text\":\" (12:00)\"}]','[{\"translate\":\"lore.ex.chain\",\"italic\":\"false\",\"color\":\"blue\"},{\"text\":\" (12:00)\"}]']},id:'ex:agentia_of_dirt',CustomModelData:12970104}"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>
<pre class="file">ex/advancements/agentia_of_dirt.json</pre>
<pre>
{
    "criteria": {
        "consume": {
            "trigger": "minecraft:consume_item",
            "conditions": {
                "item": {
                    "nbt": "{id:'ex:agentia_of_dirt'}"
                }
            }
        }
    },
    "rewards":{
        "function": "ex:potion/agentia_of_dirt"
    }
}
</pre>
<pre class="file">ex:potion/agentia_of_dirt</pre>
<pre>
effect give @s invisibility 720
execute unless score @s exChainTick matches 14400.. run scoreboard players set @s exChainTick 14400
advancement revoke @s only ex:potion/agentia_of_dirt
</pre>
<pre class="file">ex:tick</pre>
<pre>
execute as @a[scores={exChainTick=1..}] at @s anchored eyes run function ex:chain/type
</pre>
<pre class="file">ex:chain/type</pre>
<pre>
execute positioned ^ ^ ^0.2 run particle entity_effect ~ ~-1 ~ 0.734375 0.37890625 0.3046875 1 0
scoreboard players remove @s exChainTick 1
[省略实际效果部分]
</pre>
<p class="noindent">我们使用周期为20刻的低频来显示剩余时长。</p>
<pre class="file">ex:load</pre>
<pre>
function ex:tick20
</pre>
<pre class="file">ex:tick20</pre>
<pre>
execute as @a[scores={exChainTick=1..}] run function ex:chain/showtime
schedule function ex:tick20 20t
</pre>
<pre class="file">ex:chain/showtime</pre>
<pre>
scoreboard players operation #min exValue = @s exChainTick
scoreboard players operation #min exValue /= #20 exValue
scoreboard players operation #sec exValue = #min exValue
scoreboard players operation #min exValue /= #60 exValue
scoreboard players operation #sec exValue %= #60 exValue
execute as @s[scores={exChainTick=20..}] if score #sec exValue matches 10.. run title @s actionbar [{"translate":"title.effect.chain"},{"score":{"name":"#min","objective":"exValue"},"color":"gray"},{"text":":"},{"score":{"name":"#sec","objective":"exValue"},"color":"gray"}]
execute as @s[scores={exChainTick=20..}] if score #sec exValue matches ..9 run title @s actionbar [{"translate":"title.effect.chain"},{"score":{"name":"#min","objective":"exValue"},"color":"gray"},{"text":":"},{"text":"0","color":"gray"},{"score":{"name":"#sec","objective":"exValue"},"color":"gray"}]
title @s[scores={exChainTick=..19}] actionbar [{"text":" "}]
</pre>

<p>我们无法在背包页面显示图标和时长，但是我们可以在特定分辨率下在右上角显示图标。这里需要使用<a href="§3.8_字体">§3.8 字体</a>的负空格字体技巧。我们假设当前分辨率为<code>1920×1080</code>，通过试验得知使用<code>actionbar</code>占据整个右上角需要的大小为<code>480×182</code>，因此我们使用<code>298</code>像素宽的空格和<code>182×182</code>的图案。</p>
<pre class="file">assets/ex/font/default.json</pre>
<pre>
{
    "providers": [
        {
            "type": "bitmap",
            "file": "ex:font/space.png",
            "ascent": -32768,
            "height": 297,
            "chars": ["1"]
        },
        {
            "type": "bitmap",
            "file": "ex:font/chain.png",
            "height": 182,
            "ascent": 182,
            "chars": ["2"]
        }
    ]
}
</pre>
<p class="noindent">其中文件 <code>assets/ex/textures/font/space.png</code> 为 <code>1×1</code> 的透明文件，<code>assets/ex/textures/font/chain.png</code> 为 <code>182×182</code> 的文件，右上角为需要显示的状态效果图案。我们使用自定义的字体以避免占据原版字符。</p>
<figure>
    <img src="items/space.png" alt="空格材质" />
    <figcaption>图5.1 空格材质</figcaption>
</figure>

<figure>
    <img src="items/chain.png" alt="状态效果材质" />
    <figcaption>图5.2 状态效果材质</figcaption>
</figure>

<pre class="file">ex:chain/showtime</pre>
<pre>
title @s actionbar {"font":"cpp:default","text":"12"}
</pre>

<figure>
    <img src="items/chain_effect.png" alt="自定义状态效果" />
    <figcaption>图5.3 自定义状态效果</figcaption>
</figure>
<p>状态效果即将结束时的闪烁效果也可以类似实现，这里不再赘述。</p>


<h2 id="§5.6_头饰">§5.6 头饰</h2>
<p>我们使用雕刻过的南瓜来实现头饰。</p>
<p class="ex">可佩戴在头部的花环。</p>
<pre class="file">ex/loot_tables/garland.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:carved_pumpkin",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.ex.garland\"}'},id:'ex:garland',CustomModelData:12970124,exHatSlot:'hand'}"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>
<p class="noindent">由于雕刻过的南瓜可以放置，为了避免我们需要处理放置方块事件，细节见 <a href="§6_方块设计">§6 方块设计</a>。我们假设已探测到南瓜位置，且玩家放置的方块的NBT信息已存储在存储区<code>ex:block Item</code>，我们对其进行破坏并生成原物品。</p>
<pre class="file">ex/block/carved_pumpkin.json</pre>
<pre>
setblock ~ ~ ~ air
kill @s
summon item ~ ~ ~ {Item:{id:"minecraft:firework_star",Count:1b,tag:{CustomModelData:12971000}},Tags:["ex_temp"]}
data modify entity @e[type=item,tag=ex_temp,distance=..0.1,limit=1] Item set from storage ex:block Item
tag @e[type=item,tag=ex_temp,distance=..0.1,limit=1] remove ex_temp
</pre>

<p>我们将资源包内文件 <code>assets/minecraft/textures/misc/pumpkinblur.png</code> 设置为完全透明的图片以清除雕刻过的南瓜戴在头上的视野限制效果。</p>
<p>对于头饰而言，我们希望其像盔甲一样在背包物品栏显示为物品的平面材质，而在玩家头部显示为立体模型。因此我们需要两套模型，并处理物品进入玩家头部和手部的事件，见<a href="https://www.mcbbs.net/thread-833056-1-1.html">【1.14】物品头部/背包/手持显示不同材质/模型</a>。</p>

<pre class="file">minecraft/models/item/carved_pumpkin.json</pre>
<pre>
{
    "parent": "block/orientable",
    "textures": {
        "top": "block/pumpkin_top",
        "front": "block/carved_pumpkin",
        "side": "block/pumpkin_side"
    },
    "overrides": [
        { "predicate": { "custom_model_data": 12970024 }, "model": "ex:decor/garland"},
        { "predicate": { "custom_model_data": 12970124 }, "model": "ex:decor/garland1"}
    ]
}
</pre>
<p>在手部时，为普通物品模型。</p>
<pre class="file">ex/models/decor/garland1.json</pre>
<pre>
{
    "parent": "item/generated",
    "textures": {
        "layer0": "ex:decor/garland_item"
    }
}
</pre>
<figure>
    <img src="items/garland_item.png" alt="花环物品材质" />
    <figcaption>图5.4 花环物品材质</figcaption>
</figure>

<p>在头部时，我们将其在背包的显示旋转使得只能看到方块底部，而底部材质为对应的普通物品材质。其它5个面用于显示花环的立体材质模型。</p>
<pre class="file">ex/models/decor/garland.json</pre>
<pre>
{
    "parent": "ex:decor/hat",
    "textures": {
        "hat": "ex:decor/garland",
        "item": "ex:decor/garland_item"
    }
}
</pre>
<pre class="file">ex/models/decor/hat.json</pre>
<pre>
{
    "parent": "block/block",
    "display": {
        "gui": {
            "rotation": [ -90, 0, 0 ]
        }
    },
    "elements": [
        {
            "from": [ 0, 0, 0 ],
            "to": [ 16, 16, 16 ],
            "faces": {
                "down":  { "uv": [ 0, 0,16,16 ], "texture": "#item", "cullface": "down" },
                "up":     { "uv": [ 4, 0, 8, 4 ], "texture": "#hat", "cullface": "up" },
                "north": { "uv": [ 4, 4, 8, 8 ], "texture": "#hat", "cullface": "north" },
                "south": { "uv": [12, 4,16, 8 ], "texture": "#hat", "cullface": "south" },
                "west":  { "uv": [ 8, 4,12, 8 ], "texture": "#hat", "cullface": "west" },
                "east":  { "uv": [ 0, 4, 4, 8 ], "texture": "#hat", "cullface": "east" }
            }
        }
    ]
}
</pre>
<figure>
    <img src="items/garland.png" alt="花环方块材质" />
    <figcaption>图5.5 花环方块材质</figcaption>
</figure>

<pre class="file">ex/predicates/mainhand_hat.json</pre>
<pre>
{
    "condition": "minecraft:entity_properties",
    "entity": "this",
    "predicate": {
        "equipment": {
            "mainhand":{
                "item": "minecraft:carved_pumpkin",
                "nbt": "{exHatSlot:'head'}"
            }
        }
    }
}
</pre>
<pre class="file">ex/loot_tables/offhand_hat.json</pre>
<pre>
{
    "condition": "minecraft:entity_properties",
    "entity": "this",
    "predicate": {
        "equipment": {
            "offhand":{
                "item": "minecraft:carved_pumpkin",
                "nbt": "{exHatSlot:'head'}"
            }
        }
    }
}
</pre>
<pre class="file">ex/loot_tables/head_hat.json</pre>
<pre>
{
    "condition": "minecraft:entity_properties",
    "entity": "this",
    "predicate": {
        "equipment": {
            "head":{
                "item": "minecraft:carved_pumpkin",
                "nbt": "{exHatSlot:'hand'}"
            }
        }
    }
}
</pre>
<pre class="file">ex:tick</pre>
<pre>
execute as @a[predicate=ex:mainhand_hat] run function ex:decor/mainhand_hat
execute as @a[predicate=ex:offhand_hat] run function ex:decor/offhand_hat
execute as @a[predicate=ex:head_hat] run function ex:decor/head_hat
</pre>
<pre class="file">ex:decor/mainhand_hat</pre>
<pre>
setblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:"minecraft:carved_pumpkin",Count:1b}]}
data modify block ~ 255 ~ Items[0] merge from entity @s SelectedItem
execute store result score #temp exValue run data get block ~ 255 ~ Items[0].tag.CustomModelData
execute store result block ~ 255 ~ Items[0].tag.CustomModelData int 1 run scoreboard players add #temp exValue 100
data modify block ~ 255 ~ Items[0].tag.exHatSlot set value "hand"
loot replace entity @s weapon.mainhand 1 mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ air
</pre>
<pre class="file">ex:decor/off_hat</pre>
<pre>
setblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:"minecraft:carved_pumpkin",Count:1b}]}
data modify block ~ 255 ~ Items[0].Count set from entity @s Inventory[{Slot:-106b}].Count
data modify block ~ 255 ~ Items[0].tag set from entity @s Inventory[{Slot:-106b}].tag
execute store result score #temp exValue run data get block ~ 255 ~ Items[0].tag.CustomModelData
execute store result block ~ 255 ~ Items[0].tag.CustomModelData int 1 run scoreboard players add #temp exValue 100
data modify block ~ 255 ~ Items[0].tag.exHatSlot set value "hand"
loot replace entity @s weapon.offhand 1 mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ air
</pre>
<pre class="file">ex:decor/head_hat</pre>
<pre>
setblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:"minecraft:carved_pumpkin",Count:1b}]}
data modify block ~ 255 ~ Items[0].Count set from entity @s Inventory[{Slot:103b}].Count
data modify block ~ 255 ~ Items[0].tag set from entity @s Inventory[{Slot:103b}].tag
execute store result score #temp exValue run data get block ~ 255 ~ Items[0].tag.CustomModelData
execute store result block ~ 255 ~ Items[0].tag.CustomModelData int 1 run scoreboard players remove #temp exValue 100
data modify block ~ 255 ~ Items[0].tag.exHatSlot set value "head"
loot replace entity @s armor.head 1 mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ air
</pre>
<p class="noindent">这里我们使用了潜影盒战利品表技巧来修改玩家背包物品，见 <a href="#§2.5_战利品表">§2.5 战利品表</a>。</p>

<h2 id="§5.7_盔甲">§5.7 盔甲</h2>
<p>头饰通过添加属性可以实现为头盔，但是胸甲、护腿和靴子无法通过资源包和数据包来修改其穿戴在身上时的显示材质，因为这三个栏位只接受相应类别的物品。我们只能通过诸如修改皮革盔甲颜色来达到视觉上的不同。例如：绿宝石靴子穿在脚上时，增加5点盔甲、2点盔甲韧性、4点生命值。注意，这个靴子和耐久和皮革靴子一样低。</p>

<pre class="file">ex/loot_tables/emerald_boots.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:leather_boots",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.ex.emerald_boots\"}',color:1564002},id:'ex:emerald_boots'}"
                        },
                        {
                            "function": "minecraft:set_attributes",
                            "modifiers": [
                                {
                                    "amount": 3,
                                    "name": "ex_armor",
                                    "attribute": "generic.armor",
                                    "operation": "addition","slot": "feet"
                                },
                                {
                                    "amount": 2,
                                    "name": "ex_armorToughness",
                                    "attribute": "generic.armorToughness",
                                    "operation": "addition",
                                    "slot": "feet"},
                                {
                                    "amount": 4,
                                    "name": "ex_maxHealth",
                                    "attribute": "generic.maxHealth",
                                    "operation": "addition",
                                    "slot": "feet"
                                }        
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>

<h2 id="§5.8_工具和武器">§5.8 工具和武器</h2>
<p>工具和武器同样可以通过原版工具和武器修改得到。例如：使用玻璃镐挖掘玻璃时，玻璃掉落自身。</p>

<pre class="file">ex/loot_tables/glass_pickaxe.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:stone_pickaxe",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.ex.glass_pickaxe\"}'},id:'ex:glass_pickaxe',CustomModelData:12970001}"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>

<p>我们对所有的玻璃和玻璃板的战利品表进行修改。</p>
<pre class="file">minecraft/loot_tables/blocks/red_stained_glass.json</pre>
<pre>
{
    "type": "minecraft:block",
    "pools": [
        {
            "rolls": 1,
            "conditions": [
                {
                    "condition": "minecraft:reference",
                    "name": "ex:drop_glass"
                }
            ],
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:red_stained_glass"
                }
            ]
        }
    ]
}
</pre>

<pre class="file">ex/predicates/drop_glass.json</pre>
<pre>
{
    "condition": "minecraft:alternative",
    "terms": [
        {
            "condition": "minecraft:match_tool",
            "predicate": {
                "enchantments": [
                    {
                        "enchantment": "minecraft:silk_touch",
                        "levels": {
                            "min": 1
                        }
                    }
                ]
            }
        },
        {
            "condition": "minecraft:match_tool",
            "predicate": {
                "nbt": "{id:'ex:glass_pickaxe'}"
            }
        }
    ]
}
</pre>

<p>这些物品的耐久都是不可修改的，但是我们可以将其设置为不可破坏，然后每次使用后模拟耐久降低的过程。</p>

<pre class="file">ex:load</pre>
<pre>
scoreboard objectives add exUseSPick minecraft.used:minecraft.stone_pickaxe
</pre>
<pre class="file">ex:tick</pre>
<pre>
execute as @s[scores={exUseSPick=1..}] run function ex:tools/glass_pickaxe/reset
</pre>
<pre class="file">ex:tools/glass_pickaxe/reset</pre>
<pre>
scoreboard players reset @s exUseSPick
execute as @s[nbt={SelectedItem:{tag:{id:"ex:glass_pickaxe"}}}] run function ex:tools/glass_pickaxe/damage
</pre>
<pre class="file">ex:tools/glass_pickaxe/damage</pre>
<pre>
data modify storage ex:temp Item set from entity @s SelectedItem
function ex:damage_tool
execute if score #damage exValue matches 99.. run data remove storage ex:temp Item
setblock ~ 255 ~ shulker_box
data modify block ~ 255 ~ Items append from storage ex:temp Item
loot replace entity @s weapon.mainhand 1 mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ air
</pre>
<p class="noindent">函数 <code>ex:damage_tool</code> 见<a href="§5.2_右键交互">§5.2 右键交互</a>，这里省略。这里我们使用 <a href="#§11.2_修改玩家背包">§11.2 修改玩家背包</a>中的潜影盒战利品表来将物品输出到玩家手中。</p>


<h2 id="§5.9_画">§5.9 画</h2>
<p>我们使用指定内含物的物品展示框来实现自定义的画。例如：放置经典画作后显示一幅画，右键可以切换。</p>
<p>我们为烟火之星 <code>CustomModelData</code> 为 <code>12974001-12974100</code> 指定100个平面画模型。</p>
<pre class="file">ex/loot_tables/classical_painting.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:item_frame",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.ex.classical_painting\"}'},id:'ex:classical_painting',CustomModelData:12970002,EntityTag:{Item:{id:'minecraft:firework_star',Count:1b,tag:{CustomModelData:12974001,machinBg:1b}},Tags:['ex_item_frame_classical_painting','ex_special_item_frame']}}"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>
<pre class="file">ex:tick</pre>
<pre>
execute as @e[type=item_frame,tag=ex_special_item_frame] at @s run function ex:item_frame/special
</pre>
<pre class="file">ex:item_frame/special</pre>
<pre>
execute as @s[nbt={Facing:0b}] if block ~ ~1 ~ #ex:fluid run function ex:item_frame/special_break
execute as @s[nbt={Facing:1b}] if block ~ ~-1 ~ #ex:fluid run function ex:item_frame/special_break
execute as @s[nbt={Facing:2b}] if block ~ ~ ~1 #ex:fluid run function ex:item_frame/special_break
execute as @s[nbt={Facing:3b}] if block ~ ~ ~-1 #ex:fluid run function ex:item_frame/special_break
execute as @s[nbt={Facing:4b}] if block ~1 ~ ~ #ex:fluid run function ex:item_frame/special_break
execute as @s[nbt={Facing:5b}] if block ~-1 ~ ~ #ex:fluid run function ex:item_frame/special_break
execute unless block ~ ~ ~ #ex:fluid run function ex:item_frame/special_break
execute unless data entity @s Item.id run function ex:item_frame/special_break
execute as @s[nbt={ItemRotation:1b}] run function ex:item_frame/special_rot
</pre>
<p class="noindent">方块标签 <code>ex:fluid</code> 见 <a href="#§2.9_标签">§2.9 标签</a>。</p>
<pre class="file">ex:item_frame/special_break</pre>
<pre>
execute as @s[tag=ex_item_frame_classical_painting] run loot spawn ~ ~ ~ loot ex:classical_painting
kill @s
</pre>
<pre class="file">ex:item_frame/special_rot</pre>
<pre>
execute store result entity @s Item.tag.CustomModelData int 1.00000008 run data get entity @s Item.tag.CustomModelData
data modify entity @s ItemRotation set value 0b
data modify entity @s[nbt={Item:{tag:{CustomModelData:12974101}}}] Item.tag.CustomModelData set value 12974001
</pre>

<p>自定义地图也可以用来显示自定义的图案，这个方法可避免使用资源包，但需将<code>data</code>文件与数据包一同发布。首先确定好长宽比例，然后使用<a href="https://mc-map.djfun.de">MC Map Item Tool</a>在线转换。注意这个网站生成的地图已经不符合1.14+版本的地图格式了，请在本地生成锁定图案的地图后将该网站生成的地图的<code>colors</code>这个NBT复制过来。这些地图文件位于<code>世界名称/data</code>文件夹。发布时，将其和数据包一同发布。使用命令 <code>give @s minecraft:filled_map{map:[数值]}</code> 获取相应地图。选择负数的自定义地图的编号，或者手动将<code>data</code>文件夹中的<code>idcounts</code>调大，可避免和玩家在游戏内生成的地图编号冲突。</p>


<h1 id="§6_方块设计">§6 方块设计</h1>
<p>原版模组无法添加方块，一般的做法是修改方块物品的 <code>CustomModelData</code>的模型后，在方块位置生成并头戴相应物品的盔甲架。参考</p>
<ul>
    <li><a href="https://www.mcbbs.net/thread-771638-1-1.html">使用局部坐标做到找到玩家指的地方</a></li>
    <li><a href="https://www.mcbbs.net/thread-825546-1-1.html">完美的自定义方块堆叠</a></li>
    <li><a href="https://www.mcbbs.net/thread-824528-1-1.html">自定义方块(玩家头颅) </a></li>
    <li><a href="https://www.mcbbs.net/thread-916294-1-1.html">【原版模组】【前置】方块通用处理</a></li>
</ul>
<p class="noindent">首先我们根据 <a href="#§5_物品设计">§5 物品设计</a>来将方块对应的物品设计好。</p>

<h2 id="§6.1_视线追踪法">§6.1 视线追踪法</h2>
<p>使用进度判断玩家放置了某物品，然后剥夺进度，递归获取该方块位置。如果视线上没有该方块，有可能是玩家将其对准下台阶或上台阶放置的，此时需要向上或向下平移一格检测。最后获取该方块位置，放置盔甲架，并将相应物品<code>loot</code>进盔甲架头部位置。例如：放置 <code>stone{id:"foo:bar"}</code>。</p>
<pre class="file">foo/advancements/block/bar.json</pre>
<pre>
{
    "criteria": {
        "put_furnace": {
            "trigger": "minecraft:placed_block",
            "conditions": {
                "item": {
                    "nbt":"{id:'foo:bar'}"
                }
            }
        }
    },
    "rewards": {
        "function": "foo:block/bar/reset"
    }
}
</pre>
<pre class="file">foo:block/bar/reset</pre>
<pre>
advancement revoke @s only foo:block/bar
execute anchored eyes run function foo:block/bar/ray
execute unless entity @e[type=area_effect_cloud,distance=..7,tag=foo_block_pos] positioned ~ ~1 ~ anchored eyes run function foo:block/bar/ray
execute unless entity @e[type=area_effect_cloud,distance=..7,tag=foo_block_pos] positioned ~ ~-1 ~ anchored eyes run function foo:block/bar/ray
execute at @e[type=area_effect_cloud,distance=..7,tag=foo_block_pos] run function foo:block/bar/put
</pre>
<pre class="file">foo:block/bar/ray</pre>
<pre>
execute if entity @s[distance=..7] positioned ^ ^ ^ if block ~ ~ ~ stone align xyz positioned ~0.5 ~ ~0.5 unless entity @e[type=armor_stand,distance=..0.5,tag=foo_block] run summon minecraft:area_effect_cloud ~ ~ ~ {Tags:["foo_block_pos"]}
execute if entity @s[distance=..7] unless entity @e[type=area_effect_cloud,distance=..6,tag=foo_block_pos] positioned ^ ^ ^0.005 anchored feet run function foo:block/bar/ray
</pre>
<pre class="file">foo:block/bar/put</pre>
<pre>
summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Small:1b,Marker:1b,NoGravity:1b,DisabledSlots:7967,Tags:["foo_block","foo_bar"]}
loot replace entity @e[type=armor_stand,limit=1,distance=..0.01] armor.head 1 loot foo:bar
kill @e[type=area_effect_cloud,distance=..0.01,tag=foo_block_pos]
</pre>

<p>注意到我们在视线追踪是进行了当前方块内是否已有 <code>foo_block</code> 标签的盔甲架的判断。这在处理完整方块时是可以省略的，但是对于非完整方块，视线上可能已经有之前放置过的模组物品对应的盔甲架，使用该项判断可以避免在一个格子内放置两个盔甲架，而忽略掉后放的方块。</p>

<p>然而，这个做法仍然对其它模组的方块无效，因为你无法知道其它模组使用了何种标签。所以更严格的做法是判断当前方块处是否有头部佩戴拥有<code>tag.id</code>物品的盔甲架。尽管这也不能保证万无一失，但确实可以降低冲突率。具体代码读者可自行实现。</p>

<p>最后，判断玩家主副手，并将相应的物品信息复制到盔甲架头部。不直接使用 <code>loot</code> 命令复制到盔甲架头部是为了在之后的破坏事件中保留原物品的额外信息，例如玩家重命名的名称等。</p>

<h2 id="§6.2_计算交点法">§6.2 计算交点法</h2>
<p class="ex">放置某模组的所有方块，<code>CustomModelData</code> 位于<code>12970000-12979999</code>。</p>

<p>向物品标签 <code>ex:blocks</code> 添加所有原版的方块，然后添加断言来判断玩家主手是不是方块。</p>
<pre class="file">ex/predicates/block_on_mainhand.json</pre>
<pre>
{
    "condition": "minecraft:entity_properties",
    "entity": "this",
    "predicate": {
        "equipment": {
            "mainhand":{
                "tag": "ex:blocks"
            }
        }
    }
}
</pre>

<pre class="file">ex/advancements/blocks/put_mod_block.json</pre>
<pre>
{
    "criteria": {
        "machine": {
            "trigger": "minecraft:placed_block",
            "conditions": {
                "item": {
                    "tag":"ex:blocks"
                }
            }
        }
    },
    "rewards": {
        "function": "ex:blocks/reset"
    }
}
</pre>

<pre class="file">ex/functions/blocks/reset.mcfunction</pre>
<pre>
advancement revoke @s only ex:blocks/put_mod_block
execute as @s[predicate=ex:block_on_mainhand] if data entity @s SelectedItem.tag.id run function ex:blocks/pos_main
execute as @s[predicate=!ex:block_on_mainhand] if data entity @s Inventory[{Slot:-106b}].tag.id run function ex:blocks/pos_off
</pre>
<p class="indent">根据主副手获取物品信息并存储。</p>
<pre class="file">ex/functions/blocks/pos_main.mcfunction</pre>
<pre>
data modify storage ex:putted_block Item set from entity @s SelectedItem
execute store result score #put_block_cmd exValue run data get storage ex:putted_block Item.tag.CustomModelData
execute if score #put_block_cmd exValue matches 12970000..12979999 run function ex:blocks/pos
</pre>
<pre class="file">ex/functions/blocks/pos_off.mcfunction</pre>
<pre>
data modify storage ex:putted_block Item set from entity @s Inventory[{Slot:-106b}]
data remove storage ex:putted_block Item.Slot
execute store result score #put_block_cmd exValue run data get storage ex:putted_block Item.tag.CustomModelData
execute if score #put_block_cmd exValue matches 12970000..12979999 run function ex:blocks/pos
</pre>

<p>进行计算的初始化。</p>
<pre class="file">ex/functions/blocks/pos.mcfunction</pre>
<pre>
# 调整数量
data modify storage ex:putted_block Item.Count set value 1b
# 然后记录玩家和视线坐标
execute anchored eyes run summon armor_stand ^ ^ ^ {Tags:["ex_block_ray_as"],Invulnerable:1b,Invisible:1b,Small:1b,Marker:1b,NoGravity:1b}
execute store result score #x exValue run data get entity @e[type=armor_stand,distance=..3,tag=ex_block_ray_as,limit=1] Pos[0] 1000
execute store result score #y exValue run data get entity @e[type=armor_stand,distance=..3,tag=ex_block_ray_as,limit=1] Pos[1] 1000
execute store result score #z exValue run data get entity @e[type=armor_stand,distance=..3,tag=ex_block_ray_as,limit=1] Pos[2] 1000
execute anchored eyes run summon armor_stand ^ ^ ^1 {Tags:["ex_face_mk"],Invulnerable:1b,Invisible:1b,Small:1b,Marker:1b,NoGravity:1b}
execute store result score #f exValue run data get entity @e[type=armor_stand,distance=..3,tag=ex_face_mk,limit=1] Pos[0] 1000
execute store result score #g exValue run data get entity @e[type=armor_stand,distance=..3,tag=ex_face_mk,limit=1] Pos[1] 1000
execute store result score #h exValue run data get entity @e[type=armor_stand,distance=..3,tag=ex_face_mk,limit=1] Pos[2] 1000
kill @e[type=armor_stand,tag=ex_face_mk]
# 玩家位置是否是特定方块
execute as @e[type=armor_stand,distance=..9,tag=ex_block_ray_as] at @s align xyz positioned ~0.5 ~ ~0.5 unless entity @e[type=armor_stand,distance=..0.1,tag=ex_block] unless block ~ ~ ~ #ex:fluid run function ex:blocks/compare
# 记录朝向的坐标
scoreboard players operation #f exValue -= #x exValue
scoreboard players operation #g exValue -= #y exValue
scoreboard players operation #h exValue -= #z exValue
# 记录朝向的符号
scoreboard players operation #sf exValue = #f exValue
scoreboard players operation #sg exValue = #g exValue
scoreboard players operation #sh exValue = #h exValue
# 根据朝向符号调整坐标值
execute if score #sf exValue matches ..-1 run scoreboard players operation #x exValue *= #-1 exValue
execute if score #sg exValue matches ..-1 run scoreboard players operation #y exValue *= #-1 exValue
execute if score #sh exValue matches ..-1 run scoreboard players operation #z exValue *= #-1 exValue
execute if score #sf exValue matches ..-1 run scoreboard players operation #f exValue *= #-1 exValue
execute if score #sg exValue matches ..-1 run scoreboard players operation #g exValue *= #-1 exValue
execute if score #sh exValue matches ..-1 run scoreboard players operation #h exValue *= #-1 exValue
# 获取与方块交点
execute unless entity @e[type=armor_stand,distance=..9,tag=ex_block_put_pos] run function ex:blocks/loop
# 若未找到，尝试找上方一格位置
execute unless entity @e[type=armor_stand,distance=..9,tag=ex_block_put_pos] as @e[type=armor_stand,distance=..9,tag=ex_block_ray_as] at @s run tp ~ ~1 ~
execute as @e[type=armor_stand,distance=..9,tag=ex_block_ray_as] at @s align xyz positioned ~0.5 ~ ~0.5 unless entity @e[type=armor_stand,distance=..0.1,tag=ex_block] unless block ~ ~ ~ #ex:fluid run function ex:blocks/compare
# 若未找到，尝试找下方一格位置
execute unless entity @e[type=armor_stand,distance=..9,tag=ex_block_put_pos] as @e[type=armor_stand,distance=..9,tag=ex_block_ray_as] at @s run tp ~ ~-2 ~
execute as @e[type=armor_stand,distance=..9,tag=ex_block_ray_as] at @s align xyz positioned ~0.5 ~ ~0.5 unless entity @e[type=armor_stand,distance=..0.1,tag=ex_block] unless block ~ ~ ~ #ex:fluid run function ex:blocks/compare
# 放置盔甲架
execute at @e[type=armor_stand,distance=..9,tag=ex_block_put_pos,sort=nearest,limit=1] align xyz positioned ~0.5 ~ ~0.5 run function ex:blocks/put
kill @e[type=armor_stand,distance=..9,tag=ex_block_ray_as]
</pre>

<p>递归计算视线上的每一个方块交点。</p>
<pre class="file">ex/functions/blocks/loop.mcfunction</pre>
<pre>
tag @e[type=armor_stand,distance=..0.01,tag=ex_block_ray_as,tag=ex_temp] remove ex_temp
# 计算三交点参数
scoreboard players operation #t1 exValue = #x exValue
scoreboard players operation #t1 exValue *= #-1 exValue
scoreboard players operation #t1 exValue %= #1000 exValue
execute if score #t1 exValue matches 0..1 run scoreboard players add #t1 exValue 1000
scoreboard players operation #t1 exValue *= #1000 exValue
scoreboard players operation #t1 exValue /= #f exValue

scoreboard players operation #t2 exValue = #y exValue
scoreboard players operation #t2 exValue *= #-1 exValue
scoreboard players operation #t2 exValue %= #1000 exValue
execute if score #t2 exValue matches 0..1 run scoreboard players add #t2 exValue 1000
scoreboard players operation #t2 exValue *= #1000 exValue
scoreboard players operation #t2 exValue /= #g exValue

scoreboard players operation #t3 exValue = #z exValue
scoreboard players operation #t3 exValue *= #-1 exValue
scoreboard players operation #t3 exValue %= #1000 exValue
execute if score #t3 exValue matches 0..1 run scoreboard players add #t3 exValue 1000
scoreboard players operation #t3 exValue *= #1000 exValue
scoreboard players operation #t3 exValue /= #h exValue
# 比较交点远近
scoreboard players set #align exValue 1
execute if score #t1 exValue > #t2 exValue if score #t3 exValue > #t2 exValue run scoreboard players set #align exValue 2
execute if score #t1 exValue > #t3 exValue if score #t2 exValue > #t3 exValue run scoreboard players set #align exValue 3
execute if score #align exValue matches 1 run scoreboard players operation #t exValue = #t1 exValue
execute if score #align exValue matches 2 run scoreboard players operation #t exValue = #t2 exValue
execute if score #align exValue matches 3 run scoreboard players operation #t exValue = #t3 exValue
# 计算交点坐标
scoreboard players operation #s1 exValue = #f exValue
scoreboard players operation #s2 exValue = #g exValue
scoreboard players operation #s3 exValue = #h exValue
scoreboard players operation #s1 exValue *= #t exValue
scoreboard players operation #s2 exValue *= #t exValue
scoreboard players operation #s3 exValue *= #t exValue
scoreboard players operation #s1 exValue /= #1000 exValue
scoreboard players operation #s2 exValue /= #1000 exValue
scoreboard players operation #s3 exValue /= #1000 exValue
scoreboard players operation #x exValue += #s1 exValue
scoreboard players operation #y exValue += #s2 exValue
scoreboard players operation #z exValue += #s3 exValue
# 存储交点
summon armor_stand ~ ~ ~ {Tags:["ex_block_ray_as","ex_temp"],Invulnerable:1b,Invisible:1b,Small:1b,Marker:1b,NoGravity:1b}
execute if score #sf exValue matches 0.. store result entity @e[type=armor_stand,distance=..9,tag=ex_block_ray_as,tag=ex_temp,limit=1] Pos[0] double 0.001 run scoreboard players get #x exValue
execute if score #sg exValue matches 0.. store result entity @e[type=armor_stand,distance=..9,tag=ex_block_ray_as,tag=ex_temp,limit=1] Pos[1] double 0.001 run scoreboard players get #y exValue
execute if score #sh exValue matches 0.. store result entity @e[type=armor_stand,distance=..9,tag=ex_block_ray_as,tag=ex_temp,limit=1] Pos[2] double 0.001 run scoreboard players get #z exValue
# 根据朝向符号调整坐标
execute if score #sf exValue matches ..-1 store result entity @e[type=armor_stand,distance=..9,tag=ex_block_ray_as,tag=ex_temp,limit=1] Pos[0] double -0.001 run scoreboard players get #x exValue
execute if score #sg exValue matches ..-1 store result entity @e[type=armor_stand,distance=..9,tag=ex_block_ray_as,tag=ex_temp,limit=1] Pos[1] double -0.001 run scoreboard players get #y exValue
execute if score #sh exValue matches ..-1 store result entity @e[type=armor_stand,distance=..9,tag=ex_block_ray_as,tag=ex_temp,limit=1] Pos[2] double -0.001 run scoreboard players get #z exValue
# 玩家位置是否是特定方块
execute as @e[type=armor_stand,distance=..9,tag=ex_block_ray_as,tag=ex_temp] at @s align xyz positioned ~0.5 ~ ~0.5 unless entity @e[type=armor_stand,distance=..0.1,tag=ex_block] run function ex:blocks/compare
tellraw @p {"nbt":"Pos","entity":"@e[type=armor_stand,distance=..9,tag=ex_block_ray_as,tag=ex_temp,limit=1]"}
# 若未找到，循环
execute unless entity @e[type=armor_stand,distance=..9,tag=ex_block_put_pos] at @e[type=armor_stand,distance=..9,tag=ex_block_ray_as,tag=ex_temp] if entity @s[distance=..6] run function ex:blocks/loop
</pre>

<p>判断当前方块是否为我们所需的。</p>
<pre class="file">ex/functions/blocks/loop.mcfunction</pre>
<pre>
loot replace entity @s weapon.mainhand 1 mine ~ ~ ~ shears{Enchantments:[{id:"minecraft:silk_touch",lvl:1s}]}
execute store result score @s exValue run data modify entity @s HandItems[0].id set from storage ex:putted_block Item.id
tag @s[scores={exValue=0}] add ex_block_put_pos
</pre>

<p>在找到的位置处放置盔甲架。对于特殊的方块物品，我们需要对盔甲架进行预处理或调整，例如</p>
<ul>
    <li>有朝向的我们需要根据玩家朝向来放置不同朝向的方块。</li>
    <li>告示牌我们需要根据朝向来调整盔甲架位置和朝向。</li>
    <li>树苗花草作物我们需要放置后调整 <code>CustomModelData</code>，因为一般手持为平面材质模型。</li>
    <li>需要添加额外标签以便于处理的。</li>
</ul>
<pre class="file">ex/functions/blocks/put.mcfunction</pre>
<pre>
# 预处理朝向、标签
execute if block ~ ~ ~ barrel run function ex:blocks/put/barrel
execute if block ~ ~ ~ chest run function ex:blocks/put/chest
execute if block ~ ~ ~ oak_sign run function ex:blocks/put/oak_sign
execute if block ~ ~ ~ oak_wall_sign run function ex:blocks/put/oak_wall_sign
# 放置头部物
execute unless entity @e[type=armor_stand,distance=..0.5,tag=ex_block] run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Small:1b,Marker:1b,NoGravity:1b,DisabledSlots:7967,Tags:["ex_block"]}
data modify entity @e[type=armor_stand,tag=ex_block,distance=..0.5,limit=1] ArmorItems[3] set from storage ex:putted_block Item
# 调整头部物
execute if block ~ ~ ~ acacia_leaves as @e[type=armor_stand,tag=ex_block,distance=..0.5,limit=1] run function ex:blocks/put/acacia_leaves1
execute if block ~ ~ ~ acacia_sapling as @e[type=armor_stand,tag=ex_block,distance=..0.5,limit=1] run function ex:blocks/put/acacia_sapling1
execute if block ~ ~ ~ barrel as @e[type=armor_stand,tag=ex_block,distance=..0.5,limit=1] run function ex:blocks/put/barrel1
execute if block ~ ~ ~ carved_pumpkin as @e[type=armor_stand,tag=ex_block,distance=..0.5,limit=1] run function ex:blocks/put/carved_pumpkin1
execute if block ~ ~ ~ chest as @e[type=armor_stand,tag=ex_block,distance=..0.5,limit=1] run function ex:blocks/put/chest1
execute if block ~ ~ ~ gold_block as @e[type=armor_stand,tag=ex_block,distance=..0.5,limit=1] run function ex:blocks/put/gold_block1
execute if block ~ ~ ~ oak_sign as @e[type=armor_stand,tag=ex_block,distance=..0.5,limit=1] run function ex:blocks/put/oak_sign1
execute if block ~ ~ ~ oak_wall_sign as @e[type=armor_stand,tag=ex_block,distance=..0.5,limit=1] run function ex:blocks/put/oak_wall_sign1
# 重置存储
data remove storage ex:putted_block Item
</pre>

<p>尽管看上去比较长，但是递归的次数很少，命令数比视线追踪法还是要少很多。注意由于对玩家坐标乘了1000倍，因此玩家坐标绝对值大于2147484时，会溢出而导致无法使用，可以通过降低精准度(修改为70倍)来避免溢出。</p>

<h2 id="§6.3_命令方块替换法">§6.3 命令方块替换法</h2>
<p>为了避免视线追踪不够精确，以及为了避免放置于不完整方块侧面等情形而导致方块不在视线上，我们可以考虑使用特殊方块来识别玩家放置的方块。</p>
<pre class="file">ex:all_in_one_machine</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:petrified_oak_slab",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"italic\":false,\"translate\":\"item.ex.all_in_one_machine\"}'},id:'ex:all_in_one_machine',CustomModelData:12970001,ex_tag:['machine','need_fire','barrel']}"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>
<pre class="file">ex:advancements/block/petrified_oak_slab.json</pre>
<pre>
{
    "criteria": {
        "petrified_oak_slab": {
            "trigger": "minecraft:placed_block",
            "conditions": {
                "item": {
                    "item": "minecraft:petrified_oak_slab"
                }
            }
        }
    },
    "rewards": {
        "function": "ex:block/reset/petrified_oak_slab"
    }
}
</pre>
<pre class="file">ex:block/reset/petrified_oak_slab</pre>
<pre>
advancement revoke @s only ex:block/petrified_oak_slab
execute as @s[predicate=ex:mainhand/petrified_oak_slab] run data modify storage ex:block Item set from entity @s SelectedItem
execute as @s[predicate=!ex:mainhand/petrified_oak_slab] run data modify storage ex:block Item set from entity @s Inventory[{Slot:-106b}]

execute store result score #facing exValue run data get entity @s Rotation[0]
scoreboard players add #facing exValue 225
execute if score #facing exValue matches ..-1 run scoreboard players add #facing exValue 360
execute if score #facing exValue matches 360.. run scoreboard players remove #facing exValue 360
scoreboard players operation #facing exValue /= #90 exValue

fill ~-6 ~-6 ~-6 ~6 ~6 ~6 command_block{auto:1b,Command:"execute align xyz positioned ~0.5 ~ ~0.5 run function ex:block/put/petrified_oak_slab"} replace petrified_oak_slab
execute positioned ~ -6 ~ as @s[dy=12] run fill ~-6 0 ~-6 ~6 12 ~6 command_block{auto:1b,Command:"execute align xyz positioned ~0.5 ~ ~0.5 run function cpp:block/put/petrified_oak_slab"} replace petrified_oak_slab
execute positioned ~ 249 ~ as @s[dy=12] run fill ~-6 243 ~-6 ~6 255 ~6 command_block{auto:1b,Command:"execute align xyz positioned ~0.5 ~ ~0.5 run function cpp:block/put/petrified_oak_slab"} replace petrified_oak_slab
</pre>
<pre class="file">ex:block/put/petrified_oak_slab</pre>
<pre>
execute unless data storage ex:block Item.tag.id run data modify storage ex:block Item.tag.cpp_tag set value ['machine','need_fire','barrel']
data modify storage ex:block Item.Count set value 1b

setblock ~ ~ ~ barrel{CustomName:'{"translate":"block.minecraft.petrified_oak_slab"}'}
data modify block ~ ~ ~ CustomName set from storage ex:block Item.tag.display.Name

execute if score #facing exValue matches 0 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Small:1b,Marker:1b,NoGravity:1b,DisabledSlots:7967,Tags:["ex_block"],Rotation:[0.0f,0.0f]}
execute if score #facing exValue matches 1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Small:1b,Marker:1b,NoGravity:1b,DisabledSlots:7967,Tags:["ex_block"],Rotation:[90.0f,0.0f]}
execute if score #facing exValue matches 2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Small:1b,Marker:1b,NoGravity:1b,DisabledSlots:7967,Tags:["ex_block"],Rotation:[180.0f,0.0f]}
execute if score #facing exValue matches 3 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Small:1b,Marker:1b,NoGravity:1b,DisabledSlots:7967,Tags:["ex_block"],Rotation:[270.0f,0.0f]}
execute as @e[type=armor_stand,tag=ex_block,distance=..0.5,limit=1] run function ex:block/put/petrified_oak_slab_tag
</pre>
<pre class="file">ex:block/put/petrified_oak_slab_tag</pre>
<pre>
execute if data storage ex:temp block.tag{ex_tag:['machine']} run tag @s add ex_machine
execute if data storage ex:temp block.tag{ex_tag:['need_fire']} run tag @s add ex_need_fire
data modify entity @s[tag=ex_need_fire] Fire set value 32767s

execute if data storage ex:temp block.tag{ex_tag:['barrel']} run tag @s add ex_barrel

execute unless data storage ex:temp block.tag.id run tag @s add ex_crafting_machine
execute if data storage ex:temp block.tag{id:"ex:all_in_one_machine"} run tag @s add ex_all_in_one_machine

data modify entity @s ArmorItems[3] set from storage ex:block Item
</pre>
<pre class="file">ex/predicates/mainhand/petrified_oak_slab.json</pre>
<pre>
{
    "condition": "minecraft:entity_properties",
    "entity": "this",
    "predicate": {
        "equipment": {
            "mainhand":{
                "item": "minecraft:petrified_oak_slab"
            }
        }
    }
}
</pre>
<pre class="file">ex/predicates/offhand/petrified_oak_slab.json</pre>
<pre>
{
    "condition": "minecraft:entity_properties",
    "entity": "this",
    "predicate": {
        "equipment": {
            "offhand":{
                "item": "minecraft:petrified_oak_slab"
            }
        }
    }
}
</pre>



<h2 id="§6.4_破坏事件">§6.4 破坏事件</h2>
<p class="ex">破坏自定义的树叶。</p>
<pre class="file">ex:tick</pre>
<pre>
execute as @e[type=armor_stand,tag=ex_leaves] at @s unless block ~ ~ ~ acacia_leaves run function ex:blocks/break/acacia_leaves
</pre>
<pre class="file">ex:blocks/break/acacia_leaves</pre>
<pre>
# 树叶
tag @e[type=item,sort=nearest,nbt={Age:0s,Item:{id:"minecraft:acacia_leaves",Count:1b}},limit=1,distance=..2] add ex_block_drop
tag @e[type=item,sort=nearest,nbt={Age:1s,Item:{id:"minecraft:acacia_leaves",Count:1b}},limit=1,distance=..2] add ex_block_drop
data modify entity @e[type=item,sort=nearest,tag=ex_block_drop,limit=1,distance=..2] Item set from entity @s ArmorItems[3]
tag @e[type=item,distance=..2,tag=ex_block_drop] remove ex_block_drop
# 树苗
tag @e[type=item,sort=nearest,nbt={Age:0s,Item:{id:"minecraft:acacia_sapling",Count:1b}},limit=1,distance=..2] add ex_block_drop
tag @e[type=item,sort=nearest,nbt={Age:1s,Item:{id:"minecraft:acacia_sapling",Count:1b}},limit=1,distance=..2] add ex_block_drop
execute as @s[tag=ex_ore_leaves] at @e[type=item,sort=nearest,tag=ex_block_drop,limit=1,distance=..2] run loot spawn ~ ~ ~ loot ex:ore_sapling
execute as @s[tag=ex_wool_leaves] at @e[type=item,sort=nearest,tag=ex_block_drop,limit=1,distance=..2] run loot spawn ~ ~ ~ loot ex:wool_sapling
execute as @s[tag=ex_fruit_leaves] at @e[type=item,sort=nearest,tag=ex_block_drop,limit=1,distance=..2] run loot spawn ~ ~ ~ loot ex:fruit_sapling
kill @e[type=item,distance=..2,tag=ex_block_drop]
kill @s
</pre>
<p>我们将最近的 <code>Age:0s</code> (挖掘)和 <code>Age:1s</code> (自然腐烂)的物品添加标签，然后修改其为盔甲架头部存储物。</p>

<h2 id="§6.5_模型设置">§6.5 模型设置</h2>
<p>使用如下的 <code>display</code> 来放缩物品在头部的大小，可以保证其与坐标轴基本对齐。</p>
<pre class="file">assets/ex/models/material/moon_stone.json</pre>
<pre>
{
    "parent": "block/cube_all",
    "display": {
        "head": {
            "rotation": [ 0, 0, 0 ],
            "translation": [ 0, -14.65, 0 ],
            "scale": [ 2.29, 2.29, 2.29 ]
        }
    },
    "textures": {
        "all": "ex:material/moon_stone"
    }
}
</pre>

<h1 id="§7_合成与烧炼">§7 合成与烧炼</h1>
<h2 id="§7.1_语法">§7.1 语法</h2>
<p>原版的合成、烧炼使用配方文件即可实现，较为简单，但是无法识别nbt，因此只能实现原版物品的合成和烧炼。同时模组若使用了相关物品，则相应的模组物品亦可代替原物品进行合成。</p>

<p>配方的通用语法为</p>
<table><thead><th style="width:5em;">含义</th><th>键</th><th>值</th><th>说明</th></thead>
<tbody>
<tr>
    <th rowspan="8">合成的类别</th>
    <td rowspan="8"><code>type</code></td>
    <td><code>minecraft:crafting_shaped</code></td>
    <td>工作台有序合成配方</td>
</tr>
<tr>
    <td><code>minecraft:crafting_shapeless</code></td>
    <td>工作台无序合成配方</td>
</tr>
<tr>
    <td><code>minecraft:crafting_special_*</code></td>
    <td>工作台特殊合成配方，处理皮革盔甲染色、烟火之星、地图复制等情形，不可手动配置。 </td>
</tr>
<tr>
    <td><code>minecraft:stonecutting</code></td>
    <td>切石机合成配方</td>
</tr>
<tr>
    <td><code>minecraft:smelting</code></td>
    <td>熔炉烧炼配方</td>
</tr>
<tr>
    <td><code>minecraft:blasting</code></td>
    <td>高炉烧炼配方</td>
</tr>
<tr>
    <td><code>minecraft:smoking</code></td>
    <td></td>
</tr>
<tr>
    <td><code>minecraft:campfire_cooking</code></td>
    <td>营火烧炼配方</td>
</tr>
<tr>
    <th>配方的分类</th>
    <td><code>group</code></td>
    <td>字符串</td>
    <td>具有相同该标识符的配方会在配方书中显示为一组。对特殊合成配方无效。</td>
</tr>
<tr>
    <th>合成样式</th>
    <td><code>pattern</code></td>
    <td>字符串</td>
    <td>有序合成的合成样式，其中每个字符表示一个物品，空格表示空缺。可以比<code>3×3</code>小。</td>
</tr>
<tr>
    <th>配方材料</th>
    <td><code>key.[字符]</code></td>
    <td>列表或JSON对象</td>
    <td>有序合成的 <code>pattern</code> 中字符与物品的对应。可以只含一个 <code>item</code> 或 <code>tag</code>；也可以是一个列表，列表中每个元素是一个 <code>item</code> 或 <code>tag</code>。</td>
</tr>
<tr>
    <th>配方配料</th>
    <td><code>ingredient</code></td>
    <td>列表或JSON对象</td>
    <td>无序合成、切石机、烧炼的原材料。如果是切石机或烧炼，可以为这个列表中的任一物品或物品标签；如果是无序合成，配方就是这个列表中的每一个物品或物品标签。</td>
</tr>
<tr>
    <th>合成的结果物品</th>
    <td><code>result.item</code></td>
    <td>物品ID</td>
    <td>合成的结果物品。</td>
</tr>
<tr>
    <th>合成的结果数量</th>
    <td><code>result.count</code></td>
    <td>数字</td>
    <td>合成配方的物品数量，缺省为<code>1</code>。切石机配方的物品数量，不可省略。</td>
</tr>
<tr>
    <th>烧炼经验</th>
    <td><code>experience</code></td>
    <td>数字</td>
    <td>烧炼配方产生的经验值，可以为小数。</td>
</tr>
<tr>
    <th>烧炼耗时</th>
    <td><code>cookingtime</code></td>
    <td>数字</td>
    <td>烧炼所需的刻数，若缺省则使用默认的时间，熔炉烟熏炉为<code>200<code>，高炉营火为<code>100</code>。</td>
</tr>
</tbody>
</table>

<h2 id="§7.2_有序合成">§7.2 有序合成</h2>
<p class="ex">使用8羊毛+鸡蛋有序合成两个羊刷怪蛋。</p>

<pre class="file">ex/recipes/sheep_spawn_egg.json</pre>
<pre>
{
    "type": "minecraft:crafting_shaped",
    "pattern": [
        "###",
        "#*#",
        "###"
    ],
    "key": {
        "*": {
            "item": "minecraft:egg"
        },
        "#": {
            "tag": "ex:wools"
        }
    },
    "result": {
        "item": "minecraft:sheep_spawn_egg",
        "count":2
    }
}
</pre>
<p class="noindent">这里 <code>ex:wools</code> 为自定义的包含所有颜色羊毛的物品标签。</p>

<h2 id="§7.3_无序合成">§7.3 无序合成</h2>
<p class="ex">2沙子+红石=2红沙。</p>

<pre class="file">ex/recipes/red_sand.json</pre>
<pre>
{
    "type": "minecraft:crafting_shapeless",
    "ingredients": [
        {
            "item": "minecraft:sand"
        },
        {
            "item": "minecraft:sand"
        },
        {
            "item": "minecraft:redstone"
        }
    ],
    "result": {
        "item": "minecraft:red_sand",
        "count":2
    }
}
</pre>
<p>配料可以重复。单个物品配方请使用有序合成而不是无序合成。</p>

<h2 id="§7.4_切石机配方">§7.4 切石机配方</h2>
<p class="ex">使用切石机切割橡木木板为2台阶。</p>

<pre class="file">ex/recipes/stonecutting/oak_slab.json</pre>
<pre>
{
    "type": "minecraft:stonecutting",
    "ingredient": {
        "item": "minecraft:oak_planks"
    },
    "result": "minecraft:oak_slab",
    "count": 2
}
</pre>

<h2 id="§7.5_烧炼配方">§7.5 烧炼配方</h2>
<p class="ex">熔炉烧炼皮革装备、腐肉、鞍为兔子皮。</p>

<pre class="file">ex/recipes/rabbit_hide_from_smelting.json</pre>
<pre>
{
    "type": "minecraft:smelting",
    "ingredient": [
        {
            "item": "minecraft:rotten_flesh"
        },
        {
            "item": "minecraft:leather_helmet"
        },
        {
            "item": "minecraft:leather_chestplate"
        },
        {
            "item": "minecraft:leather_leggings"
        },
        {
            "item": "minecraft:leather_boots"
        },
        {
            "item": "minecraft:saddle"
        }
    ],
    "result": "minecraft:rabbit_hide",
    "experience": 0.1,
    "cookingtime": 200
}
</pre>

<h2 id="§7.6_覆盖原版配方">§7.6 覆盖原版配方</h2>
<p>如果想要修改原版的合成或烧炼配方，先使用压缩软件打开版本 <code>.jar</code> 文件，依次打开 <code>data/minecraft/recipes</code>，找到相应的配方文件，然后在自己的数据包中的相同位置（必然是 <code>minecraft</code> 命名空间下）放入同名文件即可覆盖默认的配方。</p>
<p class="ex">将橡木台阶合成数量改为8。</p>

<pre class="file">minecraft/recipes/oak_stairs.json</pre>
<pre>
{
    "type": "minecraft:crafting_shaped",
    "group": "wooden_stairs",
    "pattern": [
        "#  ",
        "## ",
        "###"
    ],
    "key": {
        "#": {
            "item": "minecraft:oak_planks"
        }
    },
    "result": {
        "item": "minecraft:oak_stairs",
        "count": 8
    }
}
</pre>
<p class="ex">将原版白色床+墨囊=黑色床的合成配方修改为任意床+墨囊=黑色床。</p>

<pre class="file">ex/tags/items/beds.json</pre>
<pre>
{
    "replace": false,
    "values": [
        "minecraft:white_bed",
        "minecraft:orange_bed",
        "minecraft:magenta_bed",
        "minecraft:light_blue_bed",
        "minecraft:yellow_bed",
        "minecraft:lime_bed",
        "minecraft:pink_bed",
        "minecraft:gray_bed",
        "minecraft:light_gray_bed",
        "minecraft:cyan_bed",
        "minecraft:purple_bed",
        "minecraft:blue_bed",
        "minecraft:brown_bed",
        "minecraft:green_bed",
        "minecraft:red_bed",
        "minecraft:black_bed"
    ]
}
</pre>
<pre class="file">minecraft/recipes/black_bed_from_white_bed.json</pre>
<pre>
{
    "type": "crafting_shapeless",
    "group": "dyed_bed",
    "ingredients": [
        {
            "tag": "ex:beds"
        },
        {
            "item": "minecraft:black_dye"
        }
    ],
    "result": {
        "item": "minecraft:black_bed"
    }
}
</pre>
<p>如果需要删除原版配方，可使用生存无法获得的方块如基岩=基岩、屏障=屏障、结构空位等物品来合成。配方文件内容为 <code>{}</code> 时会被认为是错误文件而无法覆盖原配方。</p>

<h2 id="§7.7_配方获取">§7.7 配方获取</h2>
<p>一个完整的配方应当有相应的进度来使玩家获取之，通常触发器为玩家背包含有合成材料。也可以根据需要在函数中使用命令 <code>recipe</code> 给予。</p>

<pre class="file">ex/advancements/recipes/dirt_from_cobblestone_snowball.json</pre>
<pre>
{
    "criteria": {
        "cobblestone": {
            "trigger": "minecraft:inventory_changed",
            "conditions": {
                "items": [
                    {
                        "item": "minecraft:cobblestone",
                        "count": {
                            "min": 8
                        }
                    }
                ]
            }
        },
        "snowball": {
            "trigger": "minecraft:inventory_changed",
            "conditions": {
                "items": [
                    {
                        "item": "minecraft:snowball"
                    }
                ]
            }
        },
        "has_the_recipe": {
            "trigger": "minecraft:recipe_unlocked",
            "conditions": {
                "recipe": "ex:dirt_from_cobblestone_snowball"
            }
        }
    },
    "rewards":{
        "recipes": ["ex:dirt_from_cobblestone_snowball"]
    },
    "requirements": [
        [
            "cobblestone",
            "snowball",
            "has_the_recipe"
        ]
    ]
}
</pre>

<h1 id="§8_机器设计">§8 机器设计</h1>
<p>本节我们将通过一个较为复杂的机器的例子，来了解如何设计一个机器。</p>

<p>首先参考 <a href="#5_物品设计">§5 物品设计</a>和 <a href="#6_方块设计">§6 方块设计</a>将机器方块设计好，我们这里选择木桶，如果有必要，使用箱子也可以。</p>

<pre class="file">mac/loot_tables/all_in_one_machine.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:barrel",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.mac.all_in_one_machine\"}'},id:'mac:all_in_one_machine',CustomModelData:12970001}"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>
<p>然后绘制 GUI。这个机器包括：左侧可选择温度和压强，可将输出栏物品输入到邻近的容器。</p>
<ul>
    <li>GUI 整体是左上槽位的一个物品放大一定倍数并平移之后得到的。</li>
    <li>按钮、进度条、经验均为物品模型。</li>
    <li>其余背景位置以及输出槽均为完全透明物品的模型。</li>
    <li>注意这些物品不可以为方块的自定义模型，因为方块的模型的透明部分会变成黑色或白色（1.15快照版本特性）。1.15的光照也有点问题。</li>
</ul>
<figure>
    <img src="items/机器GUI.png" width="50%" alt="机器GUI" />
    <figcaption>图8.1 机器GUI</figcaption>
</figure>

<h2 id="§8.1_GUI材质模型">§8.1 GUI材质模型</h2>
<p>物品的默认大小为 <code>16×16</code>，所以如果我们想要将其放大 <code>n</code> 倍，就需要绘制大小为 <code>16n×16n</code> 的材质，以对齐边缘和像素。</p>

<p>该模型用于机器的GUI，我们将其大小放大了 <code>12</code> 倍，也就是 <code>192×192</code> 大小。所以我们需要绘制这个大小的整数倍的材质。通过修改z轴高度可调整材质的覆盖次序。</p>

<pre class="file">assets/mac/models/machine/gui/temp.json</pre>
<pre>
{
    "elements": [
        {
            "from": [ -16, -16, 0 ],
            "to": [ 32, 32, 1 ],
            "faces": {
                "south": { "uv":[0,0,16,16],"texture": "#layer1"}
            }
        }
    ],
    "display": {
        "gui": {
            "scale": [ 4, 4, 1 ],
            "translation": [ 79, -52, -80]
        },
        "ground": {
            "scale": [ 0.1, 0.1, 0.1 ]
        }
    }
}
</pre>
<pre class="file">assets/mac/models/machine/gui/all_in_one_machine.json</pre>
<pre>
{
    "parent": "mac:machine/gui/temp",
    "textures": {
        "layer1": "mac:machine/gui/all_in_one_machine"
    }
}
</pre>
<p>这个图片大小为 <code>192×192</code>，同时左下角物品栏距离左下角的距离为 <code>8×14</code>，这样当该物品放置在木桶的左上方时，经过上述平移，最终这个物品栏就正好和木桶的物品栏对齐了。</p>

<figure>
    <img src="items/机器材质.png" alt="机器材质" />
    <figcaption>图8.2 机器材质</figcaption>
</figure>

<p>若想要绘制各边缘超过这个距离限制的，可以重新调整 <code>display.gui.translation</code> 来对齐。</p>

<p>对于机器的按钮，为了保证我们点击时不会出现按钮乱跑的问题，我们可以在按钮的实际模型放置在点击处的右一格。具体函数实现见后文。</p>
<pre class="file">assets/mac/models/machine/option/temp.json</pre>
<pre>
{
    "parent": "item/generated",
    "display": {
        "gui": {
            "translation": [ -18, 0, 1 ]
        }
    }
}
</pre>
<pre class="file">assets/mac/models/machine/option/high_pressure.json</pre>
<pre>
{
    "parent": "mac:machine/option/temp",
    "textures": {
        "layer0": "mac:machine/option/high_pressure"
    }
}
</pre>

<p>如果你擅长绘制UI的话，可以制作出很精美的UI。例如<a href="https://www.youtube.com/watch?v=bv_wYNs5L6M">该视频</a>中的GUI均是采用物品材质绘制的。</p>

<figure>
    <img src="items/机器GUI示例1.png" style="width:50%;" alt="机器GUI示例1" />
    <figcaption>图8.3 机器GUI示例1</figcaption>
</figure>

<figure>
    <img src="items/机器GUI示例2.png" style="width:50%;" alt="机器GUI示例2" />
    <figcaption>图8.4 机器GUI示例2</figcaption>
</figure>

<h2 id="§8.2_GUI背景处理">§8.2 GUI背景处理</h2>
<p>我们为所有的机器背景物品添加 <code>machinBg:1b</code>。我们假设这个物品都是 <code>petrified_oak_slab</code>。如果是多种物品的话，我们可以将这些物品 <code>id</code> 添加至一个物品标签内来处理。</p>

<p>清理玩家背包和地面的相应物品。</p>
<pre class="file">mac:tick</pre>
<pre>
clear @a minecraft:petrified_oak_slab{machinBg:1b}
kill @e[type=item,nbt={Item:{tag:{machinBg:1b}}}]
execute as @e[type=armor_stand,tag=machine_machine] at @s run function mac:blocks/machine
</pre>

<p>清理机器下方的漏斗矿车内物品，将下方漏斗的冷却时间高频设置为2。</p>
<pre class="file">mac:blocks/machine</pre>
<pre>
execute positioned ~-1 ~-2 ~-1 as @e[type=hopper_minecart,dx=2,dy=2,dz=2] run data modify entity @s TransferCooldown set value 2
execute if block ~ ~-1 ~ hopper run data modify block ~ ~-1 ~ TransferCooldown set value 2
</pre>

<h2 id="§8.3_GUI命令">§8.3 GUI命令</h2>
<p>我们需要对机器高频固定住其GUI，同时对于玩家误放入的物品进行弹出处理，并操作机器选项和经验条。我们使用断言来判断木桶内物品信息。</p>

<pre class="file">mac:all_in_one_machine/tick</pre>
<pre>
# 检测GUI
execute unless predicate mac:all_in_one_machine/gui run function mac:all_in_one_machine/gui
execute unless data block ~ ~ ~ Items[{Slot:21b}] run replaceitem block ~ ~ ~ container.21 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.machine.output_slot"}'},CustomModelData:12971000}
execute unless data block ~ ~ ~ Items[{Slot:22b}] run replaceitem block ~ ~ ~ container.22 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.machine.output_slot"}'},CustomModelData:12971000}
data modify block ~ ~ ~ Items[{Slot:12b}].tag.CustomModelData set value 12971020
data modify entity @s ArmorItems[3].tag.CustomModelData set value 12970001
execute if score @s macStoredxp matches ..39 if data block ~ ~ ~ Items[{Slot:6b,id:"minecraft:experience_bottle"}] run function ex:misc/xp_add
tag @s remove mac_machine_work
# 配方
execute as @s[scores={macStoredxp=1..}] unless predicate mac:redstone_power if predicate mac:all_in_one_machine/type run function mac:all_in_one_machine/type
execute unless data block ~ ~ ~ Items[{Slot:21b,tag:{machinBg:1b}}] run function mac:all_in_one_machine/dist21
execute unless data block ~ ~ ~ Items[{Slot:22b,tag:{machinBg:1b}}] run function mac:all_in_one_machine/dist22
scoreboard players set @s[tag=!mac_machine_work] macTick 0
</pre>

<p>对于玩家误放入背景的物品，我们使用 <a href="#§11.2_修改玩家背包">§11.2 修改玩家背包</a>中的潜影盒战利品表来将物品输出到容器中。</p>

<pre class="file">mac:all_in_one_machine/gui</pre>
<pre>
setblock ~ 255 ~ shulker_box
data modify block ~ 255 ~ Items set from block ~ ~ ~ Items
data remove block ~ 255 ~ Items[{tag:{machinBg:1b}}]
data remove block ~ 255 ~ Items[{Slot:3b}]
data remove block ~ 255 ~ Items[{Slot:4b}]
data remove block ~ 255 ~ Items[{Slot:6b}]
data remove block ~ 255 ~ Items[{Slot:21b}]
data remove block ~ 255 ~ Items[{Slot:22b}]
loot give @p mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ air

replaceitem block ~ ~ ~ container.0 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971011}
replaceitem block ~ ~ ~ container.5 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.7 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.8 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.xp_bar"}',Lore:['"§a0/48"']},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.9 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.12 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.process_shower"}'},CustomModelData:12971020}
replaceitem block ~ ~ ~ container.13 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.process_shower"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.14 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.15 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.16 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.17 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.xp_bar"}',Lore:['"§a0/48"']},CustomModelData:12972000}
replaceitem block ~ ~ ~ container.18 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.23 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.24 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.25 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.26 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.xp_bar"}',Lore:['"§a0/48"']},CustomModelData:12971000}

execute unless data block ~ ~ ~ Items[{Slot:1b}] run function mac:all_in_one_machine/option/pressure
execute as @s[scores={macPressure=0}] run replaceitem block ~ ~ ~ container.1 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.low_pressure"}',Lore:['{"translate":"lore.ex.switch"}']},CustomModelData:12971000}
execute as @s[scores={macPressure=1}] run replaceitem block ~ ~ ~ container.1 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.normal_pressure"}',Lore:['{"translate":"lore.ex.switch"}']},CustomModelData:12971000}
execute as @s[scores={macPressure=2}] run replaceitem block ~ ~ ~ container.1 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.high_pressure"}',Lore:['{"translate":"lore.ex.switch"}']},CustomModelData:12971000}
execute as @s[scores={macPressure=0}] run replaceitem block ~ ~ ~ container.2 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971051}
execute as @s[scores={macPressure=1}] run replaceitem block ~ ~ ~ container.2 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971052}
execute as @s[scores={macPressure=2}] run replaceitem block ~ ~ ~ container.2 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971053}

execute unless data block ~ ~ ~ Items[{Slot:10b}] run function mac:all_in_one_machine/option/temperature
execute as @s[scores={macTemperature=0}] run replaceitem block ~ ~ ~ container.10 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.low_temperature"}',Lore:['{"translate":"lore.ex.switch"}']},CustomModelData:12971000}
execute as @s[scores={macTemperature=1}] run replaceitem block ~ ~ ~ container.10 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.normal_temperature"}',Lore:['{"translate":"lore.ex.switch"}']},CustomModelData:12971000}
execute as @s[scores={macTemperature=2}] run replaceitem block ~ ~ ~ container.10 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.high_temperature"}',Lore:['{"translate":"lore.ex.switch"}']},CustomModelData:12971000}
execute as @s[scores={macTemperature=0}] run replaceitem block ~ ~ ~ container.11 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971054}
execute as @s[scores={macTemperature=1}] run replaceitem block ~ ~ ~ container.11 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971055}
execute as @s[scores={macTemperature=2}] run replaceitem block ~ ~ ~ container.11 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971056}

execute unless data block ~ ~ ~ Items[{Slot:19b}] run function mac:all_in_one_machine/option/output
execute as @s[scores={macOutputFace=1}] run replaceitem block ~ ~ ~ container.19 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.output_east"}',Lore:['{"translate":"lore.ex.switch"}']},CustomModelData:12971000}
execute as @s[scores={macOutputFace=2}] run replaceitem block ~ ~ ~ container.19 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.output_south"}',Lore:['{"translate":"lore.ex.switch"}']},CustomModelData:12971000}
execute as @s[scores={macOutputFace=3}] run replaceitem block ~ ~ ~ container.19 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.output_west"}',Lore:['{"translate":"lore.ex.switch"}']},CustomModelData:12971000}
execute as @s[scores={macOutputFace=4}] run replaceitem block ~ ~ ~ container.19 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.output_north"}',Lore:['{"translate":"lore.ex.switch"}']},CustomModelData:12971000}
execute as @s[scores={macOutputFace=5}] run replaceitem block ~ ~ ~ container.19 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.output_down"}',Lore:['{"translate":"lore.ex.switch"}']},CustomModelData:12971000}
execute as @s[scores={macOutputFace=6}] run replaceitem block ~ ~ ~ container.19 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.output_up"}',Lore:['{"translate":"lore.ex.switch"}']},CustomModelData:12971000}
execute as @s[scores={macOutputFace=1}] run replaceitem block ~ ~ ~ container.20 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971041}
execute as @s[scores={macOutputFace=2}] run replaceitem block ~ ~ ~ container.20 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971042}
execute as @s[scores={macOutputFace=3}] run replaceitem block ~ ~ ~ container.20 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971043}
execute as @s[scores={macOutputFace=4}] run replaceitem block ~ ~ ~ container.20 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971044}
execute as @s[scores={macOutputFace=5}] run replaceitem block ~ ~ ~ container.20 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971045}
execute as @s[scores={macOutputFace=6}] run replaceitem block ~ ~ ~ container.20 minecraft:firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.all_in_one_machine"}'},CustomModelData:12971046}

function mac:misc/xp_show
</pre>

<p>当玩家点击按钮时，调整选项。</p>
<pre class="file">mac:all_in_one_machine/option/pressure</pre>
<pre>
scoreboard players add @s macPressure 1
scoreboard players set @s[scores={macPressure=3..}] macPressure 0
scoreboard players set @s[tag=!ex_high_pressure,scores={macPressure=2}] macPressure 0
scoreboard players set @s[tag=!ex_low_pressure,scores={macPressure=0}] macPressure 1
</pre>

<p>调整经验条的显示，我们使用告示牌来显示分数，然后转移到机器中。</p>
<pre class="file">mac:misc/xp_show</pre>
<pre>
setblock ~ 255 ~ oak_sign
scoreboard players operation #t macStoredxp = @s macStoredxp
data modify block ~ 255 ~ Text1 set value '[{"score":{"name":"#t","objective":"macStoredxp"},"color":"green","italic":"false"},{"text":"/48"}]'
execute store result block ~ ~ ~ Items[{Slot:17b}].tag.CustomModelData int 1 run scoreboard players add #t macStoredxp 12972000
data modify block ~ ~ ~ Items[{Slot:8b}].tag.display.Lore[0] set from block ~ 255 ~ Text1
data modify block ~ ~ ~ Items[{Slot:17b}].tag.display.Lore[0] set from block ~ 255 ~ Text1
data modify block ~ ~ ~ Items[{Slot:26b}].tag.display.Lore[0] set from block ~ 255 ~ Text1
setblock ~ 255 ~ air
</pre>

<p>当经验栏经验不足且有附魔之瓶时，添加经验值。</p>
<pre class="file">mac:misc/xp_add</pre>
<pre>
execute store result score #temp macValue run data get block ~ ~ ~ Items[{Slot:6b}].Count
execute store result block ~ ~ ~ Items[{Slot:6b}].Count byte 1 run scoreboard players remove #temp macValue 1
scoreboard players add @s macStoredxp 9
function mac:misc/xp_show
</pre>

<p>然后判断机器处是否有红石信号强充能，断言 <code>mac:redstone_power</code> 见 <a href="§11.4_红石信号">§11.4 红石信号</a>。当机器未被强充能、有经验值、有输入物、输出栏空闲时，进入配方判断。这里我们根据要求的温度压强来分类。</p>
<pre class="file">mac:all_in_one_machine/type</pre>
<pre>
execute as @s[scores={macTemperature=0,macPressure=0}] run function mac:all_in_one_machine/recipes/ll
execute as @s[scores={macTemperature=0,macPressure=1}] run function mac:all_in_one_machine/recipes/ln
execute as @s[scores={macTemperature=0,macPressure=2}] run function mac:all_in_one_machine/recipes/lh
execute as @s[scores={macTemperature=1,macPressure=0,macStoredxp=4..}] run function mac:all_in_one_machine/recipes/nl
execute as @s[scores={macTemperature=1,macPressure=1,macStoredxp=2..}] run function mac:all_in_one_machine/recipes/nn
execute as @s[scores={macTemperature=1,macPressure=2}] run function mac:all_in_one_machine/recipes/nh
execute as @s[scores={macTemperature=2,macPressure=0,macStoredxp=4..}] run function mac:all_in_one_machine/recipes/hl
execute as @s[scores={macTemperature=2,macPressure=1}] run function mac:all_in_one_machine/recipes/hn
execute as @s[scores={macTemperature=2,macPressure=2,macStoredxp=4..}] run function mac:all_in_one_machine/recipes/hh
function #mac:all_in_one_machine
execute unless data block ~ ~ ~ Items[{Slot:21b,tag:{machinBg:1b}}] run function mac:all_in_one_machine/clear
execute as @s[scores={macTick=1..}] run function mac:all_in_one_machine/option/process
data modify entity @s[tag=mac_machine_work] ArmorItems[3].tag.CustomModelData set value 12971001
</pre>

<p>显示进度条。这里我们预先计算了半个进度条的刻数，然后加到当前刻数，计算后取整出来的进度条更加准确。</p>
<pre class="file">mac:all_in_one_machine/option/process</pre>
<pre>
scoreboard players set #t exValue 16
scoreboard players operation #t exValue *= @s macTick
scoreboard players operation #t exValue += #process_pre exValue
scoreboard players operation #t exValue /= #allInOneMachinePeriod exValue
execute store result block ~ ~ ~ Items[{Slot:12b}].tag.CustomModelData int 1 run scoreboard players add #t exValue 12971020
</pre>

<p>最后我们将输出栏的物品输入到邻近的容器内。</p>
<pre class="file">mac:all_in_one_machine/dist21</pre>
<pre>
data modify storage ex:dist Item set from block ~ ~ ~ Items[{Slot:21b}]
function ex:dist/type
data remove storage ex:dist Item
execute as @s[tag=ex_dist_success] run replaceitem block ~ ~ ~ container.21 firework_star{machinBg:1b,display:{Name:'{"translate":"item.ex.output_slot"}'},CustomModelData:12971000}
</pre>

<h2 id="§8.4_物品输出">§8.4 物品输出</h2>
<p>上一节我们调用了一个函数用于输出物品，我们来看一下它的算法。</p>

<p>根据机器的输出方向调整位置。这里我们把容器、大箱子添加至方块标签中。</p>
<pre class="file">function ex:dist/type</pre>
<pre>
tag @s remove ex_dist_success
execute as @s[scores={macOutputFace=1}] positioned ~1 ~ ~ if block ~ ~ ~ #container:all run function ex:dist/pos
execute as @s[scores={macOutputFace=2}] positioned ~ ~ ~1 if block ~ ~ ~ #container:all run function ex:dist/pos
execute as @s[scores={macOutputFace=3}] positioned ~-1 ~ ~ if block ~ ~ ~ #container:all run function ex:dist/pos
execute as @s[scores={macOutputFace=4}] positioned ~ ~ ~-1 if block ~ ~ ~ #container:all run function ex:dist/pos
execute as @s[scores={macOutputFace=5}] positioned ~ ~-1 ~ if block ~ ~ ~ #container:all run function ex:dist/pos
execute as @s[scores={macOutputFace=6}] positioned ~ ~1 ~ if block ~ ~ ~ #container:all run function ex:dist/pos
</pre>

<p>如果是大箱子的右半个，将其修改为左半个位置。</p>
<pre class="file">ex/function/dist/pos</pre>
<pre>
execute if block ~ ~ ~ #container:chests[type=left,facing=east] positioned ~ ~ ~1 run function ex:dist/pos2
execute if block ~ ~ ~ #container:chests[type=left,facing=west] positioned ~ ~ ~-1 run function ex:dist/pos2
execute if block ~ ~ ~ #container:chests[type=left,facing=south] positioned ~-1 ~ ~ run function ex:dist/pos2
execute if block ~ ~ ~ #container:chests[type=left,facing=north] positioned ~1 ~ ~ run function ex:dist/pos2
execute unless block ~ ~ ~ #container:chests[type=left] run function ex:dist/pos2
</pre>

<p>计算当前容器的空栏位数。这里我们将计算容器的栏位数添加为函数标签，以便于对更多容器可以做扩充。如果当前位置没有空栏位且为大箱子，调整输出的位置。</p>
<pre class="file">ex/function/dist/pos2</pre>
<pre>
execute store result score @s container run data get block ~ ~ ~ Items
function #container:check
execute unless block ~ ~ ~ #container:all run scoreboard players set @s container 0
execute as @s[scores={container=..-1}] run function ex:dist/dist
execute as @s[tag=!ex_dist_success,scores={container=0..}] if block ~ ~ ~ #container:chests[type=right,facing=east] positioned ~ ~ ~-1 run function ex:dist/double
execute as @s[tag=!ex_dist_success,scores={container=0..}] if block ~ ~ ~ #container:chests[type=right,facing=west] positioned ~ ~ ~1 run function ex:dist/double
execute as @s[tag=!ex_dist_success,scores={container=0..}] if block ~ ~ ~ #container:chests[type=right,facing=south] positioned ~1 ~ ~ run function ex:dist/double
execute as @s[tag=!ex_dist_success,scores={container=0..}] if block ~ ~ ~ #container:chests[type=right,facing=north] positioned ~-1 ~ ~ run function ex:dist/double
</pre>

<p>函数标签 <code>#container:check</code> 包括函数：</p>
<pre>
execute if block ~ ~ ~ hopper run scoreboard players remove @s container 5
execute if block ~ ~ ~ #container:slots9 run scoreboard players remove @s container 9
execute if block ~ ~ ~ #container:slots27 run scoreboard players remove @s container 27
</pre>

<pre class="file">ex:dist/double</pre>
<pre>
execute store result score @s container run data get block ~ ~ ~ Items
scoreboard players remove @s container 27
execute as @s[scores={container=..-1}] run function ex:dist/dist
</pre>

<p>最后使用 <a href="#§11.2_修改玩家背包">§11.2 修改玩家背包</a>中的潜影盒战利品表来将物品输出到容器中。</p>
<pre class="file">ex:dist/dist</pre>
<pre>
tag @s add ex_dist_success
setblock ~ 255 ~ shulker_box
data remove storage ex:dist Item.Slot
data modify block ~ 255 ~ Items[{Slot:0b}] merge from storage ex:dist Item
loot insert ~ ~ ~ mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ air
</pre>

<h2 id="§8.5_配方处理">§8.5 配方处理</h2>
<p>我们使用断言判断机器的物品是否满足相应配方的条件，然后进入计时。计时完成后进行产物生成，产物的生成通过使用战利品表判断当前位置的NBT得到。</p>
<pre class="file">mac:all_in_one_machine/recipes/nn</pre>
<pre>
execute if block ~ ~ ~ barrel{Items:[{tag:{id:"ex:fertilizer"}}]} if predicate mac:all_in_one_machine/nn_2_2 run function mac:all_in_one_machine/recipes/nn/nn_2_2
</pre>
<pre class="file">mac/predicates/all_in_one_machine/nn_2_2.json</pre>
<pre>
{
    "condition": "minecraft:alternative",
    "terms": [
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{id:'minecraft:wheat_seeds'}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{id:'minecraft:beetroot_seeds'}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{id:'minecraft:pumpkin_seeds'}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{id:'minecraft:melon_seeds'}]}"
                }
            }
        }
    ]
}
</pre>

<p>这里需要注意一种极端情形，如果同一条件下的函数中，有多条判断原材料的命令，而且这些为无序配方（即不检测具体栏位），而且所有产物和原材料中，有部分物品可以进行其它合成，那么我们需要在这些判断中添加 <code>as @s[tag=!mac_machine_work]</code> 或者 <code>if block ~ ~ ~ barrel{Items:[{Slot:16b,tag:{machinBg:1b}}]}</code> 来对机器是否已工作进行判断，否则有可能导致前一个配方的产物正常被后一个配方识别到，而导致配方出现混乱。</p>

<pre class="file">mac:all_in_one_machine/recipes/nn/nn_2_2</pre>
<pre>
tag @s add mac_machine_work
scoreboard players add @s macTick 30
execute if score @s macTick >= #allInOneMachinePeriod exValue run function mac:all_in_one_machine/recipes/nn/nn_2_2_done
</pre>
<pre class="file">mac:all_in_one_machine/recipes/nn/nn_2_2_done</pre>
<pre>
scoreboard players remove @s macStoredxp 1
loot replace block ~ ~ ~ container.21 2 loot mac:all_in_one_machine/nn_2_2
</pre>
<pre class="file">ex/loot_tables/all_in_one_machine/nn_2_2.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:alternatives",
                    "children": [
                        {
                            "conditions": [
                                {
                                    "condition": "minecraft:location_check",
                                    "predicate": {
                                        "block": {
                                            "nbt": "{Items:[{id:'minecraft:wheat_seeds'}]}"
                                        }
                                    }
                                }
                            ],
                            "type": "minecraft:loot_table",
                            "name": "mac:all_in_one_machine/items/wheats"
                        },
                        {
                            "conditions": [
                                {
                                    "condition": "minecraft:location_check",
                                    "predicate": {
                                        "block": {
                                            "nbt": "{Items:[{id:'minecraft:beetroot_seeds'}]}"
                                        }
                                    }
                                }
                            ],
                            "type": "minecraft:loot_table",
                            "name": "mac:all_in_one_machine/items/beetroots"
                        },
                        {
                            "conditions": [
                                {
                                    "condition": "minecraft:location_check",
                                    "predicate": {
                                        "block": {
                                            "nbt": "{Items:[{id:'minecraft:pumpkin_seeds'}]}"
                                        }
                                    }
                                }
                            ],
                            "type": "minecraft:item",
                            "name": "minecraft:pumpkin",
                            "functions":[
                                {
                                    "function": "minecraft:set_count",
                                    "count": 2
                                }
                            ]
                        },
                        {
                            "conditions": [
                                {
                                    "condition": "minecraft:location_check",
                                    "predicate": {
                                        "block": {
                                            "nbt": "{Items:[{id:'minecraft:melon_seeds'}]}"
                                        }
                                    }
                                }
                            ],
                            "type": "minecraft:item",
                            "name": "minecraft:melon",
                            "functions":[
                                {
                                    "function": "minecraft:set_count",
                                    "count": 2
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>

<p>这样，输出槽就产生了物品，然后通过上一节中相关函数命令，进入清理环节。如果你的配方并不是100%有产物的，则需要在计时完成中添加机器完成工作的标签，然后根据标签来判断是否进入清理环节。</p>
<pre class="file">mac:all_in_one_machine/clear</pre>
<pre>
scoreboard players set @s macTick 0
execute store result score #temp exValue run data get block ~ ~ ~ Items[{Slot:4b}].Count
execute store result block ~ ~ ~ Items[{Slot:4b}].Count byte 1 run scoreboard players remove #temp exValue 1
execute store result score #temp exValue run data get block ~ ~ ~ Items[{Slot:3b}].Count
execute store result block ~ ~ ~ Items[{Slot:3b}].Count byte 1 run scoreboard players remove #temp exValue 1
</pre>

<p>对于特殊的物品，例如药水、水桶等，我们可能希望能够返还玻璃瓶、桶等，此时我们需要进行额外的预处理。</p>
<pre>
execute if data block ~ ~ ~ Items[{id:"minecraft:water_bucket"}] run function ex:crafting_machine/craft/clear/water_bucket
execute if data block ~ ~ ~ Items[{id:"minecraft:lava_bucket"}] run function ex:crafting_machine/craft/clear/lava_bucket
execute if data block ~ ~ ~ Items[{id:"minecraft:milk_bucket"}] run function ex:crafting_machine/craft/clear/milk_bucket
execute if data block ~ ~ ~ Items[{id:"minecraft:potion"}] run function ex:crafting_machine/craft/clear/potion
execute if data block ~ ~ ~ Items[{id:"minecraft:honey_bottle"}] run function ex:crafting_machine/craft/clear/honey_bottle
</pre>

<p>我们通过计算单个堆叠和多个堆叠的栏位数，来得到该有多少玻璃瓶进入输出的容器。如果容器满了，计算进入玩家背包的数量，处理应当留下的数量。尽管水桶等物品不可堆叠，但我们仍保留考虑其它模组使其可堆叠的情形。</p>
<pre class="file">ex:crafting_machine/craft/clear/honey_bottle</pre>
<pre>
data modify storage ex:temp Items set from block ~ ~ ~ Items
execute store result score #t1 exValue run data remove storage ex:temp Items[{id:"minecraft:honey_bottle",Count:1b}]
execute store result score #t2 exValue run data remove storage ex:temp Items[{id:"minecraft:honey_bottle"}]

data modify storage ex:dist Item set value {id:"minecraft:glass_bottle",Count:1b}
execute store result storage ex:dist Item.Count byte 1 run scoreboard players operation #t1 exValue += #t2 exValue
function ex:dist
data remove storage ex:dist Item

execute as @s[tag=!ex_dist_success] run data remove block ~ ~ ~ Items[{id:"minecraft:honey_bottle",Count:1b}].tag
execute as @s[tag=!ex_dist_success] if data block ~ ~ ~ Items[{id:"minecraft:honey_bottle",Count:1b}] run data modify block ~ ~ ~ Items[{id:"minecraft:honey_bottle",Count:1b}] merge value {id:"minecraft:glass_bottle",Count:2b}
execute as @s[tag=!ex_dist_success] run setblock ~ 255 ~ shulker_box{Items:[{Slot:0b,Count:1b,id:"minecraft:glass_bottle"}]}
execute as @s[tag=!ex_dist_success] store result block ~ 255 ~ Items[0].Count byte 1 run scoreboard players get #t2 exValue
execute as @s[tag=!ex_dist_success] run loot give @p mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
execute as @s[tag=!ex_dist_success] run setblock ~ 255 ~ air
</pre>

<h2 id="§8.6_插件">§8.6 插件</h2>
<p>前面我们提到机器有多种模式，包括温度和压强的调整。我们可以要求玩家使用特定物品插件shift右击机器来安装。插件原型为胡萝卜钓竿。</p>

<p>我们省略副手情形的处理。</p>

<pre class="file">ex:tick</pre>
<pre>
execute as @a[scores={exUseCSt=1..}] run function ex:use_cst/type
</pre>
<pre class="file">ex:use_cst/type</pre>
<pre>
execute as @s[nbt={SelectedItem:{id:"minecraft:carrot_on_a_stick"}}] run function ex:use_cst/mainhand
execute as @s[nbt=!{SelectedItem:{id:"minecraft:carrot_on_a_stick"}}] run function ex:use_cst/offhand
scoreboard players reset @s exUseCSt
</pre>
<pre class="file">ex:use_cst/mainhand</pre>
<pre>
execute as @s[nbt={SelectedItem:{tag:{MachinePlugin:1b}}}] at @a anchored eyes run function mac:all_in_one_machine/ray
</pre>
<pre class="file">mac:all_in_one_machine/ray</pre>
<pre>
execute as @s[distance=..6] if block ~ ~ ~ barrel align xyz positioned ~0.5 ~ ~0.5 run function mac:all_in_one_machine/install
execute as @s[distance=..6] unless block ~ ~ ~ barrel positioned ^ ^ ^0.005 anchored feet run function mac:all_in_one_machine/ray
</pre>
<pre class="file">mac:all_in_one_machine/install</pre>
<pre>
execute as @s[nbt=!{SelectedItem:{tag:{MachinePlugin:1b}}}] run function mac:all_in_one_machine/install/off
execute as @s[nbt={SelectedItem:{tag:{MachinePlugin:1b}}}] run function mac:all_in_one_machine/install/main
</pre>
<pre class="file">mac:all_in_one_machine/install/main</pre>
<pre>
execute as @s[nbt={SelectedItem:{tag:{id:"ex:high_pressure_plugin"}}}] if entity @e[type=armor_stand,nbt={ArmorItems:[{},{},{},{tag:{id:"mac:all_in_one_machine"}}]},distance=..0.5,limit=1,tag=!ex_high_pressure] run function mac:all_in_one_machine/install/hp

execute as @s[nbt={SelectedItem:{tag:{id:"ex:low_pressure_plugin"}}}] if entity @e[type=armor_stand,nbt={ArmorItems:[{},{},{},{tag:{id:"mac:all_in_one_machine"}}]},distance=..0.5,limit=1,tag=!ex_low_pressure] run function mac:all_in_one_machine/install/lp

execute as @s[nbt={SelectedItem:{tag:{id:"ex:high_temperature_plugin"}}}] if entity @e[type=armor_stand,nbt={ArmorItems:[{},{},{},{tag:{id:"mac:all_in_one_machine"}}]},distance=..0.5,limit=1,tag=!ex_high_temperature] run function mac:all_in_one_machine/install/ht

execute as @s[nbt={SelectedItem:{tag:{id:"ex:low_temperature_plugin"}}}] if entity @e[type=armor_stand,nbt={ArmorItems:[{},{},{},{tag:{id:"mac:all_in_one_machine"}}]},distance=..0.5,limit=1,tag=!ex_low_temperature] run function mac:all_in_one_machine/install/lt
</pre>
<pre class="file">mac:all_in_one_machine/install/hp</pre>
<pre>
tellraw @s [{"translate":"info.ex.high_pressure_plugin"}]
tag @e[type=armor_stand,nbt={ArmorItems:[{},{},{},{tag:{id:"mac:all_in_one_machine"}}]},distance=..0.5,limit=1,tag=!ex_high_pressure] add ex_high_pressure
replaceitem entity @s[gamemode=!creative,nbt=!{SelectedItem:{tag:{MachinePlugin:1b}}}] weapon.offhand air
replaceitem entity @s[gamemode=!creative,nbt={SelectedItem:{tag:{MachinePlugin:1b}}}] weapon.mainhand air
</pre>

<p>我们也可以使用 <a href="#§11.5_方块交互">§11.5 方块交互</a>的方式来安装插件。</p>


<h2 id="§8.7_容器扩展">§8.7 容器扩展</h2>
<p>在 <a href="#§8.4_物品输出">§8.4 物品输出</a>中，方块标签 <code>#container:all</code> 记录了各种容器，<code>#container:chests</code> 记录了各种大箱子，函数标签 <code>#container:check</code> 处理容器的栏位数量。我们希望添加更多可支持的容器，例如<a href="https://www.curseforge.com/minecraft/mc-mods/iron-chests">更多箱子</a>和<a href="https://www.curseforge.com/minecraft/mc-mods/stone-chest">石箱子</a>中的容器。</p>

<pre class="file">container/tags/blocks/all.json</pre>
<pre>
{
    "replace": false,
    "values": [
        "ironchest:copper_chest",
        "ironchest:iron_chest",
        "ironchest:silver_chest",
        "ironchest:gold_chest",
        "#ironchest:diamond",
        "stonechest:chest_andesite",
        "stonechest:chest_cobblestone",
        "stonechest:chest_diorite",
        "stonechest:chest_granite",
        "stonechest:chest_stone"
    ]
}
</pre>
<pre class="file">container/tags/blocks/chests.json</pre>
<pre>
{
    "replace": false,
    "values": [
        "stonechest:chest_andesite",
        "stonechest:chest_cobblestone",
        "stonechest:chest_diorite",
        "stonechest:chest_granite",
        "stonechest:chest_stone"
    ]
}
</pre>

<p>方块标签 <code>#container:slots27</code> 中的容器容量已经在函数 <code>container:check</code> 中处理过了，所以不用再额外检查。</p>
<pre class="file">container/tags/blocks/slots27.json</pre>
<pre>
{
    "replace": false,
    "values": [
        "stonechest:chest_andesite",
        "stonechest:chest_cobblestone",
        "stonechest:chest_diorite",
        "stonechest:chest_granite",
        "stonechest:chest_stone"
    ]
}
</pre>
<pre class="file">container/tags/functions/check.json</pre>
<pre>
{
    "replace": false,
    "values": [
        "ironchest:check"
    ]
}
</pre>

<pre class="file">ironchest/functions/check</pre>
<pre>
execute if block ~ ~ ~ ironchest:copper_chest run scoreboard players remove @s container 45
execute if block ~ ~ ~ ironchest:iron_chest run scoreboard players remove @s container 54
execute if block ~ ~ ~ ironchest:silver_chest run scoreboard players remove @s container 72
execute if block ~ ~ ~ ironchest:gold_chest run scoreboard players remove @s container 81
execute if block ~ ~ ~ #ironchest:diamond run scoreboard players remove @s container 108
</pre>
<p>这里 <code>#ironchest:diamond</code> 包含了钻石箱子、黑曜石箱子和水晶箱子，它们容量均为108。</p>

<p>添加完这样的数据包之后，我们便可以如 <a href="§8.4_物品输出">§8.4 物品输出</a>般调用它们了。这里是已经写好的<a href="https://github.com/ruhuasiyu/CraftingPlusPlus/tree/master/other_datapacks/原版模组容器扩展">原版模组容器扩展</a>。</p>

<h2 id="§8.8_接口">§8.8 接口</h2>
<p>函数 <code>mac:all_in_one_machine/type</code> 中包含一条命令 <code>function #mac:all_in_one_machine</code>。我们也创建了相应的函数标签。然后其他开发者便可向该函数标签写入内容来达到扩展或修改内容的目的，这也在 <a href="#§4.3_前置与附属">§4.3 前置与附属</a>中提及。例如</p>

<pre class="file">foo:all_in_one_machine/type</pre>
<pre>
execute as @s[scores={macStoredxp=8..,macTemperature=0,macPressure=0}] run function foo:all_in_one_machine/recipes/bar
</pre>
<p>然后类似创建后续的断言、战利品表、函数。</p>

<h2 id="§8.9_管道">§8.9 管道</h2>
<p>科技类模组人们需要添加管道来传输电力、流体、物品等。物品管道是类似的，我们将物品的信息存储在管道上并传输即可，最终将其输入到容器中。常见的几种做法有：</p>

<h3 id="§8.9.1_无线传输">§8.9.1 无线传输</h3>
<p>优点是简洁易操作，判断输出电力的机器附近是否有需要输入电力的机器并计算即可。</p>

<pre class="file">ex:tick</pre>
<pre>
execute as @e[type=armor_stand,tag=machine_machine,tag=ex_power_source,scores={exPower=1..}] at @s if entity @e[type=armor_stand,tag=machine_machine,tag=ex_power_target,distance=..16] run function ex:machine/power/translate
</pre>
<pre class="file">ex:machine/power/translate</pre>
<pre>
tag @s add ex_power_out
scoreboard players operation #t0 exPower = @e[type=armor_stand,tag=machine_machine,tag=ex_power_source,scores={exPower=1..},distance=..1,limit=1] exPower
execute as @e[type=armor_stand,tag=machine_machine,tag=ex_power_target] if score @s exPower < @s exPowerMax run function ex:machine/power/translate1
scoreboard players operation @e[type=armor_stand,tag=machine_machine,tag=ex_power_source,scores={exPower=1..},distance=..1,limit=1] exPower -= #t0 exPower
tag @s remove ex_power_out
</pre>
<pre class="file">ex:machine/power/translate1</pre>
<pre>
scoreboard players operation #t exPower = @s exPowerMax
scoreboard players operation #t exPower -= @s exPower
execute if score #t exPower > #t0 exPower run scoreboard players operation #t exPower = #t0 exPower
scoreboard players operation @s exPower += #t exPower
scoreboard players operation #t0 exPower -= #t exPower
</pre>

<p>我们也可以在传输中添加类似投射物的特效来提高视觉效果。</p>

<h3 id="§8.9.2_管道式">§8.9.2 管道式 (WIP)</h3>
<p>优点是具有传统科技模组的风格，缺点是每个管道都是一个实体（仅有原版方块限制颇多），管道多的时候会较为卡顿。</p>
<p>涌流式：能量从高处向周围比它低的管道/机器处流动，来最终实现能量传输。管道内会留有缓存。实现和无线传输类似，只是范围限定在1米内。</p>
<p>遍历式：从能量源出发，遇到过的管道做标记一直向下，如果遇到终点就回溯到分叉点，一直循环直到返回源头。</p>

<h3 id="§8.9.3_激光式">§8.9.3 激光式</h3>
<p>为了降低管道式的管道数量，我们可以将管道替换为可以一次传输多格的激光式管道。这里我们使用展示框来表示，计算其与前方方块的距离并调整外观（长度）。</p>

<pre class="file">ex:tick</pre>
<pre>
execute as @e[type=item_frame,tag=ind_wire] at @s run function indcore:wire/face
execute as @e[type=armor_stand,tag=ind_power_out,scores={indPower=1..}] at @s run function indcore:power/face
</pre>
<pre class="file">indcore:wire/face</pre>
<pre>
scoreboard players set @s indValue 7500000
execute as @s[nbt={Facing:0b}] align xyz positioned ~0.5 ~-1 ~0.5 run function indcore:wire/down
execute as @s[nbt={Facing:1b}] align xyz positioned ~0.5 ~1 ~0.5 run function indcore:wire/up
execute as @s[nbt={Facing:2b}] align xyz positioned ~0.5 ~ ~-0.5 run function indcore:wire/north
execute as @s[nbt={Facing:3b}] align xyz positioned ~0.5 ~ ~1.5 run function indcore:wire/south
execute as @s[nbt={Facing:4b}] align xyz positioned ~-0.5 ~ ~0.5 run function indcore:wire/west
execute as @s[nbt={Facing:5b}] align xyz positioned ~1.5 ~ ~0.5 run function indcore:wire/east
execute store result entity @s Item.tag.CustomModelData int 1 run scoreboard players get @s indValue
</pre>
<pre class="file">indcore:wire/east</pre>
<pre>
scoreboard players add @s indValue 1
execute if block ~ ~ ~ #indcore:fluid positioned ~1 ~ ~ run function indcore:wire/east
</pre>
<p>同样我们递归向前来获得接收能量的方块。</p>

<pre class="file">indcore:power/face</pre>
<pre>
execute positioned ~0.5 ~0.5 ~ if entity @e[tag=ind_wire,distance=..0.1] align xyz positioned ~1.5 ~ ~0.5 run function indcore:power/east
execute positioned ~-0.5 ~0.5 ~ if entity @e[tag=ind_wire,distance=..0.1] align xyz positioned ~-1.5 ~ ~0.5 run function indcore:power/west
execute positioned ~ ~0.5 ~0.5 if entity @e[tag=ind_wire,distance=..0.1] align xyz positioned ~0.5 ~ ~1.5 run function indcore:power/south
execute positioned ~ ~0.5 ~-0.5 if entity @e[tag=ind_wire,distance=..0.1] align xyz positioned ~0.5 ~ ~-1.5 run function indcore:power/north
execute positioned ~ ~1 ~ if entity @e[tag=ind_wire,distance=..0.1] align xyz positioned ~0.5 ~2 ~0.5 run function indcore:power/up
execute if entity @e[tag=ind_wire,distance=..0.1] align xyz positioned ~0.5 ~-2 ~0.5 run function indcore:power/down
</pre>
<pre class="file">indcore:power/east</pre>
<pre>
execute if entity @s[distance=..16] if entity @e[tag=ind_power_in,distance=..0.1] entity @e[tag=ind_power_in,distance=..0.1,limit=1,scores={indPower=..9999}] if score @e[tag=ind_power_in,distance=..0.1,limit=1] indPower < @e[tag=ind_power_in,distance=..0.1,limit=1] indPowerLimit run function indcore:power/in
execute if entity @s[distance=..16] unless entity @e[tag=ind_power_in,distance=..0.1] positioned ~1 ~ ~ run function indcore:power/east
</pre>
<pre class="file">indcore:power/in</pre>
<pre>
scoreboard players remove @s indPower 1
scoreboard players add @e[tag=ind_power_in,distance=..0.1,limit=1] indPower 1
</pre>

<h3 id="§8.9.4_载体式">§8.9.4 载体式</h3>
<p>我们使用一个可移动的实体来传输能量，这个实体受方块控制。</p>

<pre class="file">wire:golem/tick</pre>
<pre>
data merge entity @s {PortalCooldown:900}
execute if block ~ ~ ~ #ex:golem_east run scoreboard players set @s exGolemFace 0
execute if block ~ ~ ~ #ex:golem_south run scoreboard players set @s exGolemFace 1
execute if block ~ ~ ~ #ex:golem_west run scoreboard players set @s exGolemFace 2
execute if block ~ ~ ~ #ex:golem_north run scoreboard players set @s exGolemFace 3
execute if block ~ ~ ~ #ex:golem_up run scoreboard players set @s exGolemFace 4
execute if block ~ ~ ~ #ex:golem_down run scoreboard players set @s exGolemFace 5
execute as @s[scores={exGolemFace=0}] run tp @s ~1 ~0 ~0 270 0
execute as @s[scores={exGolemFace=1}] run tp @s ~0 ~0 ~1 0 0
execute as @s[scores={exGolemFace=2}] run tp @s ~-1 ~0 ~0 90 0
execute as @s[scores={exGolemFace=3}] run tp @s ~0 ~0 ~-1 180 0
execute as @s[scores={exGolemFace=4}] run tp @s ~0 ~1 ~0 0 90
execute as @s[scores={exGolemFace=5}] run tp @s ~0 ~-1 ~0 0 -90
execute as @s[scores={exPower=1..}] if entity @e[type=armor_stand,tag=machine_machine,tag=ex_power_in] run function ex:power/translate
</pre>
<p>然后和其它传输方式一样，计算传输值即可。</p>

<h3 id="§8.9.5_管道设计">§8.9.5 管道设计</h3>
<p>我们可以使用屏障方块来作为管道的本体方块，使用扳手(胡萝卜钓竿)来右键拆解。</p>

<p>管道需要高频判断是否与周边方块连接，以调整其自身显示。</p>
<pre class="file">ex:pipe/tick</pre>
<pre>
scoreboard players set @s exModel 12970000
execute positioned ~1 ~ ~ if entity @e[type=armor_stand,tag=ex_pipe,distance=..0.2] run scoreboard players add @s exModel 1
execute positioned ~-1 ~ ~ if entity @e[type=armor_stand,tag=ex_pipe,distance=..0.2] run scoreboard players add @s exModel 2
execute positioned ~ ~ ~1 if entity @e[type=armor_stand,tag=ex_pipe,distance=..0.2] run scoreboard players add @s exModel 4
execute positioned ~ ~ ~-1 if entity @e[type=armor_stand,tag=ex_pipe,distance=..0.2] run scoreboard players add @s exModel 8
execute positioned ~ ~1 ~ if entity @e[type=armor_stand,tag=ex_pipe,distance=..0.2] run scoreboard players add @s exModel 16
execute positioned ~ ~-1 ~ if entity @e[type=armor_stand,tag=ex_pipe,distance=..0.2] run scoreboard players add @s exModel 32
execute store result entity @s ArmorItems[3].tag.CustomModelData int 1 run scoreboard players get @s exModel
</pre>

<h1 id="§9_NBT合成与烧炼">§9 NBT合成与烧炼</h1>
<h2 id="§9.1_地板合成">§9.1 地板合成</h2>
<p>将物品扔在地面进行合成，是模组配方数量少时采用的一种便捷做法。优点是无需设计 GUI。</p>

<p class="ex">将磁铁（<code>id:"ex:magnet"</code>）和4个钻石合成为充能指南针（<code>id:"ex:powered_magnet"</code>）。</p>

<pre class="file">ex:tick</pre>
<pre>
execute as @e[type=item,nbt={Item:{tag:{id:"ex:magnet"}}}] at @s if entity @e[type=item,distance=..1,nbt={Item:{id:"minecraft:diamond",Count:4b}}] run function ex:powered_magnet
</pre>
<pre class="file">ex:powered_magnet</pre>
<pre>
kill @e[type=item,limit=1,distance=..1,nbt={Item:{id:"minecraft:diamond",Count:4b}}]
kill @s
summon item ~ ~ ~ {Item:{id:"minecraft:compass",Count:1b,tag:{id:"ex:powered_magnet"}}}
</pre>

<h2 id="§9.2_实体背包合成">§9.2 实体背包合成</h2>
<p>利用玩家的背包、末影箱、箱子矿车、驴等生物的背包用于合成，也是一种较为便捷的方式，不受方块的限制。</p>

<p>由于玩家的NBT难以修改，玩家背包和末影箱并不便于合成处理，而且一般只能用于有序合成。其它情形可以通过不指定 <code>Slot</code> 来实现无序合成。</p>

<p>当合成配方较多时，我们应当考虑分类以降低每刻命令数。常见的做法是先按配方的原材料种类数、或者合成的形状分类。</p>

<p class="ex">利用玩家背包的右方3×3区域进行合成。</p>

<pre class="file">ex:tick</pre>
<pre>
scoreboard players set @a exCraftSlot 0
scoreboard players add @a[nbt={Inventory:[{Slot:15b}]}] exCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:16b}]}] exCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:17b}]}] exCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:24b}]}] exCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:25b}]}] exCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:26b}]}] exCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:33b}]}] exCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:34b}]}] exCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:35b}]}] exCraftSlot 1
execute as @a[scores={exCraftSlot=1..}] run function ex:craft
</pre>
<pre class="file">ex:craft</pre>
<pre>
execute as @s[scores={exCraftSlot=1}] run function ex:craft/items1
execute as @s[scores={exCraftSlot=2}] run function ex:craft/items2
execute as @s[scores={exCraftSlot=3}] run function ex:craft/items3
execute as @s[scores={exCraftSlot=4}] run function ex:craft/items4
execute as @s[scores={exCraftSlot=5}] run function ex:craft/items5
execute as @s[scores={exCraftSlot=6}] run function ex:craft/items6
execute as @s[scores={exCraftSlot=7}] run function ex:craft/items7
execute as @s[scores={exCraftSlot=8}] run function ex:craft/items8
execute as @s[scores={exCraftSlot=9}] run function ex:craft/items9
</pre>
<pre class="file">ex:craft/items5</pre>
<pre>
execute as @s[nbt={Inventory:[{Slot:15b,id:"minecraft:sugar",Count:1b},{Slot:16b,id:"minecraft:rotten_flesh",Count:1b},{Slot:17b,id:"minecraft:glistering_melon_slice",Count:1b},{Slot:24b,id:"minecraft:gunpowder",Count:1b},{Slot:25b,id:"minecraft:potion",tag:{Potion:"minecraft:water"},Count:1b}]} run function ex:craft/items5/acid
</pre>
<pre class="file">ex:craft/items5/acid</pre>
<pre>
loot replace entity @s inventory.16 loot ex:acid
replaceitem entity @s inventory.6 minecraft:air
replaceitem entity @s inventory.7 minecraft:air
replaceitem entity @s inventory.8 minecraft:air
replaceitem entity @s inventory.15 minecraft:air
replaceitem entity @s inventory.17 minecraft:air
</pre>

<h2 id="§9.3_容器合成">§9.3 容器合成</h2>
<p>使用投掷器、箱子、木桶等容器可以更为便捷地实现合成。我们可以直接使用容器，或者使用 <a href="#8_机器设计">§8 机器设计</a>的方法设计好自定义工作台的GUI。</p>

<p>输出方式我们可以选择输出到输出栏（木桶）、输出到自身（精准匹配+投掷器）、弹出。具体实现与 <a href="#8_机器设计">§8 机器设计</a>并无二致。</p>

<h2 id="§9.4_NBT烧炼">§9.4 NBT烧炼</h2>
<h2 id="§9.4.1_替换产物法">§9.4.1 替换产物法</h2>
<p>放置熔炉、高炉、烟熏炉、营火的过程已省略。我们假设相应方块位置已有标签为 <code>ex_furnace</code> 的盔甲架。</p>
<p class="ex">将蛋烧炼为战利品表物品 <code>ex:egg_stew</code>。创建烧炼配方以激活烧炼蛋。</p>
<pre class="file">ex/recipes/egg.json</pre>
<pre>
{
    "type": "smelting",
    "ingredient": {
        "item": "minecraft:egg"
    },
    "result": "minecraft:mushroom_stew",
    "experience": 0.1,
    "cookingtime": 200
}
</pre>
<p class="noindent">然后在烧炼时间达到 <code>199s</code> 时，替换熔炉内的物品。</p>
<pre class="file">ex:tick</pre>
<pre>
execute as @e[type=armor_stand,tag=ex_furnace] at @s unless block ~ ~ ~ furnace run kill @s
execute as @e[type=armor_stand,tag=ex_furnace] at @s if block ~ ~ ~ furnace{CookTime:199s} run function ex:foods/cook/check
</pre>
<pre class="file">ex:foods/cook/check</pre>
<pre>
execute if block ~ ~ ~ furnace{Items:[{Slot:0b,id:"minecraft:egg"}]} run function ex:foods/cook/egg_stew
</pre>
<pre class="file">ex:foods/cook/egg_stew</pre>
<pre>
loot replace entity @s weapon.mainhand 1 loot ex:egg_stew
data modify block ~ ~ ~ Items[{Slot:2b}] set from entity @s HandItems[0]
replaceitem entity @s weapon.mainhand minecraft:air
execute store result block ~ ~ ~ Items[0].Count byte 0.999 run data get block ~ ~ ~ Items[0].Count
data merge block ~ ~ ~ {CookTime:0s}
</pre>
<p>注意这里不能通过战利品表将产物loot replace到熔炉的输出栏。</p>
<p>这种做法的局限性一是若要求待烧炼物含指定NBT，则必须添加该物品的的烧炼配方，这就导致即使没有相应的NBT也会烧炼，个人建议为原物品也添加合理的烧炼配方，或者烧炼配方的产物和待烧炼物相同，同时不奖励经验值；二是即使产物应当可堆叠也无法正常堆叠，这时需配合漏斗等设备传输方可持续烧炼。</p>

<table><thead><tr><th style="width:11em;">情形</th><th style="width:4em;">添加配方</th><th>注意事项</th></tr></thead><tbody>
<tr>
    <th>原版物品A->NBT物品B</th>
    <td>A->B</td>
    <td>在烧炼即将完成时生成产物。</td>
</tr>
<tr>
    <th rowspan="2">NBT物品A->原版物品B</th>
    <td>A->B</td>
    <td>同上一条。对于原版物品A，还需要清理产物或添加其它合适的烧炼效果。</td>
</tr>
<tr>
    <td>A->C</td>
    <td>同上一条。产物无法堆叠，需配合漏斗等设备传输方可持续烧炼。</td>
</tr>
<tr>
    <th rowspan="2">NBT物品A->NBT物品B</th>
    <td>A->B</td>
    <td>同上上条。若有其它烧炼配方可以得到原版物品B，则进行相应配方烧炼时的产物会直接变为NBT物品B，因此要排除这种情形。</td>
</tr>
<tr>
    <td>A->C</td>
    <td>同前两条。</td>
</tr>
</tbody></table>

<h2 id="§9.4.2_记分板模拟">§9.4.2 记分板模拟</h2>
<p>另一种做法就是并不添加相应的烧炼配方，而是通过记分板计时来达到控制烧炼时间的目的。当物品进入熔炉后，判断其是否需要烧炼以及是否有燃料，然后判断输出栏是否为空或其产物，如果确实可以烧炼，那么临时存储输入输出栏物品至存储区，然后放入任意可烧炼物品以触发燃料的消耗和烧炼动画。下一刻再将存储区的物品返回熔炉。反复操作直到烧炼时间达到了烧炼该物品所需的时间，此时产出产物即可。(by chaoren019)</p>
<p>该方法在计算时会导致熔炉内物品闪烁一下(这可以通过自定义空白模型的铁矿石来解决)，更换不同燃烧值物品时，燃烧火焰条也会有所变化，这和通常烧炼配方有差异。</p>
<pre class="file">ex:furnace/tick</pre>
<pre>
execute unless block ~ ~ ~ furnace run kill @s
execute as @s[tag=ex_check_fuel] run function ex:furnace/fuel_get
execute unless predicate ex:furnace/outfull if predicate ex:furnace/furnace run function ex:furnace/type
</pre>
<p>当检测到燃料改变时，重新计算燃烧值。注意这需要在检测到改变的下一刻才能获得，因此该部分在最前面。</p>
<pre class="file">ex:furnace/fuel_get</pre>
<pre>
tag @s remove ex_check_fuel
execute store result score @s exValue run data get block ~ ~ ~ BurnTime
replaceitem block ~ ~ ~ container.0 air
data modify block ~ ~ ~ {} merge from entity @s HandItems[0].tag.storage
</pre>
<pre class="file">ex/predicates/furnace/outfull.json</pre>
<pre>
{
    "condition": "minecraft:location_check",
    "predicate": {
        "block": {
            "nbt": "{Items:[{Slot:2b,Count:64b}]}"
        }
    }
}
</pre>
<p>使用断言和战利品表来记录配方。这里断言需要分输出栏空和输出栏为相应产物两种情形。</p>
<pre class="file">ex/predicates/furnace/furnace.json</pre>
<pre>
{
    "condition": "minecraft:alternative",
    "terms": [
        {
            "condition": "minecraft:inverted",
            "term": {
                "condition": "minecraft:alternative",
                "terms": [
                    {
                        "condition": "minecraft:inverted",
                        "term": {
                            "condition": "minecraft:reference",
                            "name": "ex:furnace/furnace1"
                        }
                    },
                    {
                        "condition": "minecraft:location_check",
                        "predicate": {
                            "block": {
                                "nbt": "{Items:[{Slot:2b}]}"
                            }
                        }
                    }
                ]
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{id:'ex:clay_bucket'}},{Slot:2b,id:'minecraft:bucket'}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{id:'ex:lycoris_radiata'}},{Slot:2b,id:'minecraft:red_dye'}]}"
                }
            }
        }
    ]
}
</pre>
<pre class="file">ex/predicates/furnace/furnace1.json</pre>
<pre>
{
    "condition": "minecraft:alternative",
    "terms": [
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{id:'ex:clay_bucket'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{id:'ex:lycoris_radiata'}}]}"
                }
            }
        }
    ]
}
</pre>
<pre class="file">ex:furnace/type</pre>
<pre>
# 燃料改变
execute if block ~ ~ ~ furnace{BurnTime:0s,Items:[{Slot:1b}]} if data block ~ ~ ~ Items[{Slot:1b}] run function ex:furnace/fuel_change_check
# 消耗燃料
execute as @s[tag=!ex_check_fuel] if block ~ ~ ~ furnace{BurnTime:0s,Items:[{Slot:1b}]} run function ex:furnace/fuel_use
# 进度
execute unless block ~ ~ ~ furnace{BurnTime:0s} store result block ~ ~ ~ CookTime short 1 run scoreboard players add @s exTick 1
execute if score @s exTick matches 200.. run function ex:furnace/done
# 停止
execute if block ~ ~ ~ furnace{BurnTime:0s} run scoreboard players reset @s exTick
# 发光
execute if block ~ ~ ~ furnace[lit=false] unless block ~ ~ ~ furnace{BurnTime:0s} run function ex:furnace/lit_true
execute if block ~ ~ ~ furnace[lit=true]{BurnTime:0s} run function ex:furnace/lit_false
</pre>
<p>在熔炉的盔甲架添加手持物来记录燃料的变化。</p>
<pre class="file">ex:furnace/fuel_change_check</pre>
<pre>
execute store result score #change exValue run data modify entity @s HandItems[0].tag.id set from block ~ ~ ~ Items[{Slot:1b}].id
execute if score #change exValue matches 1 run function ex:furnace/fuel_change
</pre>
<pre class="file">ex:furnace/fuel_change</pre>
<pre>
data modify entity @s HandItems[0].tag.storage set from block ~ ~ ~
replaceitem block ~ ~ ~ container.0 iron_ore
replaceitem block ~ ~ ~ container.2 air
tag @s add ex_check_fuel
</pre>
<pre class="file">ex:furnace/fuel_use</pre>
<pre>
execute store result block ~ ~ ~ BurnTime short 1 run scoreboard players get @s exValue
execute store result block ~ ~ ~ Items[{Slot:1b}].Count byte 1 run data get block ~ ~ ~ Items[{Slot:1b}].Count 0.9999
</pre>
<p>烧炼完成时添加获取经验的配方记录，这里我们统一设定为每次0.15点，可以根据需要实现不同配方不同经验值。</p>
<pre class="file">ex:furnace/done</pre>
<pre>
execute if data block ~ ~ ~ Items[{Slot:2b}] store result block ~ ~ ~ Items[{Slot:2b}].Count byte -1 run data get block ~ ~ ~ Items[{Slot:2b}].Count -1.0001
execute unless data block ~ ~ ~ Items[{Slot:2b}] run function ex:furnace/done_loot
execute store result block ~ ~ ~ Items[{Slot:0b}].Count byte 1 run data get block ~ ~ ~ Items[{Slot:0b}].Count 0.9999
scoreboard players reset @s exTick
data modify block ~ ~ ~ CookTime set value 0s
execute store result score #t exValue run data get block ~ ~ ~ RecipesUsed."minecraft:charcoal"
execute store result block ~ ~ ~ RecipesUsed."minecraft:charcoal" int 1 run scoreboard players add #t exValue 1
</pre>
<p>烧炼完毕时，通过战利品表生成产物，注意不能直接 loot replace 进熔炉的输出槽。</p>
<pre class="file">ex:furnace/done_loot</pre>
<pre>
clone ~ ~ ~ ~ ~ ~ ~ 255 ~
loot replace block ~ 255 ~ container.0 loot ex:furnace/furnace
data modify block ~ 255 ~ Items[{Slot:0b}].Slot set value 2b
data modify block ~ ~ ~ Items append from block ~ 255 ~ Items[{Slot:2b}]
setblock ~ 255 ~ air
</pre>
<pre class="file">ex/loot_tables/furnace/furnace.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:alternatives",
                    "children": [
                        {
                            "conditions": [
                                {
                                    "condition": "minecraft:location_check",
                                    "predicate": {
                                        "block": {
                                            "nbt": "{Items:[{Slot:0b,tag:{id:'ex:clay_bucket'}}]}"
                                         }
                                     }
                                 }
                             ],
                             "type": "minecraft:item",
                             "name": "minecraft:bucket"
                        },
                        {
                            "conditions": [
                                {
                                    "condition": "minecraft:location_check",
                                    "predicate": {
                                        "block": {
                                            "nbt": "{Items:[{Slot:0b,tag:{id:'ex:lycoris_radiata'}}]}"
                                         }
                                     }
                                 }
                             ],
                             "type": "minecraft:item",
                             "name": "minecraft:red_dye"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>
<p>修改熔炉的火焰外观。</p>
<pre class="file">ex:furnace/lit_true</pre>
<pre>
data modify storage ex:furnace {} merge from block ~ ~ ~ {}
execute if block ~ ~ ~ furnace[facing=east] run setblock ~ ~ ~ furnace[lit=true,facing=east]
execute if block ~ ~ ~ furnace[facing=west] run setblock ~ ~ ~ furnace[lit=true,facing=west]
execute if block ~ ~ ~ furnace[facing=south] run setblock ~ ~ ~ furnace[lit=true,facing=south]
execute if block ~ ~ ~ furnace[facing=north] run setblock ~ ~ ~ furnace[lit=true,facing=north]
data modify block ~ ~ ~ {} merge from storage ex:furnace {}
</pre>
<pre class="file">ex:furnace/lit_false</pre>
<pre>
data modify storage ex:furnace {} merge from block ~ ~ ~ {}
execute if block ~ ~ ~ furnace[facing=east] run setblock ~ 255 ~ furnace[lit=false,facing=east]
execute if block ~ ~ ~ furnace[facing=west] run setblock ~ 255 ~ furnace[lit=false,facing=west]
execute if block ~ ~ ~ furnace[facing=south] run setblock ~ 255 ~ furnace[lit=false,facing=south]
execute if block ~ ~ ~ furnace[facing=north] run setblock ~ 255 ~ furnace[lit=false,facing=north]
data modify block ~ ~ ~ {} merge from storage ex:furnace {}
</pre>
<p>对于烟熏炉和高炉，操作是类似的，但是需要每次增加exTick 2。营火由于会判断材料是否合法，因此无法用该方法。</p>

<h2 id="§9.5_NBT酿造">§9.5 NBT酿造</h2>
<p>类似于自定义烧炼的方法，我们可以自定义酿造。但是由于酿造台的限制，酿造材料必须为原版酿造材料物品，待酿造的物品只能为药水或玻璃瓶。除了红石、萤石、火药、龙息外，建议使用兔子腿，因为兔子腿只有酿造功能。</p>
<p>如果酿造材料和待酿造的物品本身就属于原版可酿造的配方，我们只需在酿造即将完成时，将药水替换掉即可。例如：使用大地之证 (兔子腿 <code>ex:certification_of_earth</code>) 将粗制的药水酿造成有多重药水效果的大地药水（<code>potion_of_earth</code>），同时支持延长、加强、喷溅、滞留版本。</code>

<p>放置和探测酿造台的部分省略。</p>
<pre class="file">ex:tick</pre>
<pre>
execute as @e[type=armor_stand,tag=ex_brewing_stand] at @s run function ex:brewing/tick
</pre>
<pre class="file">ex:brewing/tick</pre>
<pre>
execute unless block ~ ~ ~ brewing_stand run kill @s
execute if block ~ ~ ~ brewing_stand{BrewTime:1s,Items:[{Slot:3b,tag:{id:"ex:certification_of_earth"}}]} run function ex:brewing/earth
execute if block ~ ~ ~ brewing_stand{BrewTime:1s,Items:[{Slot:3b,tag:{id:"ex:redstone"}}]} if predicate ex:brewing/long run function ex:brewing/long
execute if block ~ ~ ~ brewing_stand{BrewTime:1s,Items:[{Slot:3b,tag:{id:"ex:glowstone_dust"}}]} if predicate ex:brewing/strong run function ex:brewing/strong
execute if block ~ ~ ~ brewing_stand{BrewTime:1s,Items:[{Slot:3b,tag:{id:"ex:gunpowder"}}]} if predicate ex:brewing/splash run function ex:brewing/splash
execute if block ~ ~ ~ brewing_stand{BrewTime:1s,Items:[{Slot:3b,tag:{id:"ex:dragon_breath"}}]} if predicate ex:brewing/lingering run function ex:brewing/lingering
</pre>
<p>我们在大地药水中添加 <code>Potion</code>，这样后续可以实现延长、加强、喷溅、投掷版本的酿造。</p>
<pre class="file">ex/loot_tables/potion_of_dirt.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "item",
                    "name": "minecraft:potion",
                    "functions": [
                        {
                            "function": "set_nbt",
                            "tag": "{Potion:'minecraft:leaping',CustomPotionColor:14137114,display:{Name:'{\"translate\":\"item.ex.potion_of_earth\"}'},CustomPotionEffects:[{Id:3b,Duration:3600}],id:'ex:potion_of_earth'}"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>

<pre class="file">ex:brewing/earth</pre>
<pre>
loot replace entity @s weapon.mainhand 1 loot ex:potion_of_earth
data modify block ~ ~ ~ Items[{tag:{Potion:"minecraft:awkward"}}].tag set from entity @s HandItems[0].tag
loot replace entity @s weapon.mainhand 1 loot minecraft:
execute store result block ~ ~ ~ Items[{Slot:3b}].Count byte 0.999 run data get block ~ ~ ~ Items[{Slot:3b}].Count
</pre>

<pre class="file">ex/predicates/brewing/long</pre>
<pre>
{
    "condition": "minecraft:alternative",
    "terms": [
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:night_vision'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:invisibility'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:leaping'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:fire_resistance'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:swiftness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:slowness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:turtle_master'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:water_breathing'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:poison'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:regeneration'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:strength'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:weakness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:slow_falling'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:night_vision'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:invisibility'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:leaping'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:fire_resistance'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:swiftness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:slowness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:turtle_master'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:water_breathing'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:poison'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:regeneration'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:strength'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:weakness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:slow_falling'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:night_vision'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:invisibility'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:leaping'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:fire_resistance'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:swiftness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:slowness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:turtle_master'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:water_breathing'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:poison'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:regeneration'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:strength'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:weakness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:slow_falling'}}]}"
                }
            }
        }
    ]
}
</pre>
<p>处理延长版药水时，还需要一并处理原版酿造的药水。加强、喷溅、投掷情形类似处理即可。</p>
<pre class="file">ex:brewing/long</pre>
<pre>
loot replace entity @s weapon.mainhand 1 loot ex:potion_of_long_earth
data modify block ~ ~ ~ Items[{tag:{id:"ex:potion_of_earth}}].tag set from entity @s HandItems[0].tag
loot replace entity @s weapon.mainhand 1 loot minecraft:air
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:night_vision"}}]}.tag.Potion set value "minecraft:long_night_vision"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:invisibility"}}]}.tag.Potion set value "minecraft:long_invisibility"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:leaping"}}]}.tag.Potion set value "minecraft:long_leaping"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:fire_resistance"}}]}.tag.Potion set value "minecraft:long_fire_resistance"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:swiftness"}}]}.tag.Potion set value "minecraft:long_swiftness"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:slowness"}}]}.tag.Potion set value "minecraft:long_slowness"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:turtle_master"}}]}.tag.Potion set value "minecraft:long_turtle_master"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:water_breathing"}}]}.tag.Potion set value "minecraft:long_water_breathing"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:poison"}}]}.tag.Potion set value "minecraft:long_poison"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:regeneration"}}]}.tag.Potion set value "minecraft:long_regeneration"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:strength"}}]}.tag.Potion set value "minecraft:long_strength"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:weakness"}}]}.tag.Potion set value "minecraft:long_weakness"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:slow_falling"}}]}.tag.Potion set value "minecraft:long_slow_falling"}
execute store result block ~ ~ ~ Items[{Slot:3b}].Count byte 0.999 run data get block ~ ~ ~ Items[{Slot:3b}].Count
replaceitem entity @s weapon.mainhand minecraft:air
</pre>

<p>如果酿造材料和待酿造的物品不属于原版可酿造的配方，我们需要在二者均进入酿造台时，将其物品修改为具有相同材质名称的、可以实现酿造的物品。当物品进入背包时，将其改回原物品。酿造即将完成时，检测相应NBT是否来自指定的物品，并修改产物。</p>


<h1 id="§10_植物">§10 植物</h1>

<p>我们使用寻常作物来实现自定义作物。在相应的方块处放置带有自定义物品模型的盔甲架来实现其外观的不同，并高频判断和重置其生长状态来确定生长。模型可以选择盖住原方块模型，或删除原方块模型并将原作物当做自定义作物实现（会生成盔甲架实体）。如果自定义作物的材质没有覆盖原来的方块，就会导致自定义的作物处，既有自定义作物的材质，又有原本的作物材质。解决方法之一是限定自定义作物模型包含原有的作物模型，另一种是删除原有方块材质并在原方块处放置对应材质的盔甲架解决。</p>

<table><thead><tr>
        <th>作物</th>
        <th>方块需求</th>
        <th>可使用骨粉</th>
        <th>模型处理</th>
        <th>特点</th>
        <th>用途</th>
    </tr></thead><tbody>
    <tr>
        <th>小麦、胡萝卜、马铃薯、甜菜根、瓜梗</th>
        <td>耕地</td>
        <td>是</td>
        <td>瓜梗模型最小，自定义模型只要比其大即可。</td>
        <td>瓜梗模型太小了很难破坏。</td>
        <td>通常作物、瓜类作物</td>
    </tr>
    <tr>
        <th>树苗</th>
        <td>任意土</td>
        <td>是</td>
        <td>模型较大，需要删除原模型，由于金合欢树苗出现场合最少，因此以金合欢为宜。</td>
        <td>有几率在一刻内直接生长为大树</td>
        <td>花卉、树</td>
    </tr>
    <tr>
        <th>甘蔗、仙人掌</th>
        <td>沙子</td>
        <td>否</td>
        <td>可以用较粗的类似甘蔗的模型，或完整方块模型来覆盖。</td>
        <td>需要处理上方一格方块，无法避免玩家手动叠方块</td>
        <td>甘蔗类</td>
    </tr>
    <tr>
        <th>草、蕨</th>
        <td>任意土</td>
        <td>是</td>
        <td>可以用较粗的类似草的模型，或完整方块模型来覆盖。</td>
        <td>需要处理上方一格方块，无法避免玩家手动叠方块</td>
        <td>甘蔗类</td>
    </tr>
    <tr>
        <th>可可豆</th>
        <td>丛林木</td>
        <td>是</td>
        <td>可以用略大的方形模型来覆盖</td>
        <td>可以添加标签来支持种植在其它方块侧</td>
        <td>树生类</td>
    </tr>
    <tr>
        <th>竹子、浆果丛、海草、海带</th>
        <td>-</td>
        <td>部分</td>
        <td>几乎无可能</td>
        <td>模型随机、性质特殊、水生难使用</td>
        <td>-</td>
    </tr>
    <tr>
        <th>屏障</th>
        <td>任意</td>
        <td>否</td>
        <td>任意</td>
        <td>无法直接破坏，需要借助其它方式；需要手动实现生长过程</td>
        <td>任意</td>
    </tr>
    <tr>
        <th>任意</th>
        <td>任意</td>
        <td>否</td>
        <td>完整方块模型</td>
        <td>需要手动实现生长过程，一般无法瞬间破坏</td>
        <td>任意</td>
    </tr>
</tbody></table>

<p>可以看出，可接受的只有瓜梗+模型覆盖、金合欢树苗+删除原模型、任意方块+完整模型三种做法。对于第二种做法，我们还需要修改村庄等结构中相应的模型，而且在玩家大规模种植时会生成大量实体。</p>

<p>另一种实现方式即使用<a href="#§6.3_命令方块替换法">§6.3 命令方块替换法</a>来放置，只需在放置完成后检测下方不是土时将其破坏掉即可。这种方法较为简单，缺点是物品缺少树苗的诸如可作为燃料、可堆肥的特性。</p>

<h2 id="§10.1_作物">§10.1 作物</h2>

<p class="ex">种植铁种子，收获种子和铁锭，可由骨粉催熟。种下后，探测位置放置盔甲架。破坏时，修改附近掉落物。</p>
<pre class="file">ex:advancements/plants/iron_seeds</pre>
<pre>
{
    "parent": "ex:plants/root",
    "criteria": {
        "iron_seeds": {
            "trigger": "minecraft:placed_block",
            "conditions": {
                "item": {
                    "nbt":"{id:'ex:iron_seeds'}"
                }
            }
        }
    },
    "rewards": {
        "function": "ex:plants/plants/iron_seeds"
    }
}
</pre>

<pre class="file">ex:tick</pre>
<pre>
execute as @e[type=armor_stand,tag=ex_beetroots_plants] at @s unless block ~ ~ ~ beetroots run function ex:plants/break/beetroots
</pre>
<pre class="file">ex:plants/break/beetroots</pre>
<pre>
execute as @s[tag=ex_iron_seeds] as @e[type=item,nbt={Item:{id:"minecraft:beetroot_seeds"},Age:0s},distance=..1] run data merge entity @s {Item:{tag:{HideFlags:63,Enchantments:[{}],display:{Name:'{"translate":"item.ex.iron_seeds"}'},id:"ex:iron_seeds"}}}
execute as @s[tag=ex_iron_seeds] as @e[type=item,nbt={Item:{id:"minecraft:beetroot"},Age:0s},distance=..1] run data merge entity @s {Item:{id:"minecraft:iron_ingot"}}
</pre>

<p>实际上，我们也可以通过盔甲架手持物品来实现自定义材质的作物。</p>

<h2 id="§10.2_花草">§10.2 花草</h2>
<p>我们使用金合欢树苗作为花草原型。方块的放置部分我们省略，只需要注意花草的模型通常和物品模型是不同的，因此在放置后需要修改CustomModelData，破坏情形也是同理。</p>
<p class="ex">放置花草种子，长大后收获成熟的花草。</p>
<pre class="file">ex:tick</pre>
<pre>
execute as @e[type=armor_stand,tag=ex_plants] at @s run function ex:plants/tick
</pre>
<pre class="file">ex:plants/tick</pre>
<pre>
# 破坏
execute unless block ~ ~ ~ acacia_sapling run function ex:block/break/acacia_sapling
# 树生长
execute as @s[tag=!ex_acacia_sapling] if block ~ ~ ~ acacia_sapling[stage=1] run function ex:plants/type
</pre>
<pre class="file">ex:plants/type</pre>
<pre>
setblock ~ ~ ~ acacia_sapling
execute as @s[tag=ex_crops] run function ex:plants/crops/grow
execute as @s[tag=ex_trees] run function ex:plants/trees/grow
</pre>
<p>树木的处理见下一节，我们这里只处理花草部分。当花草长到最后一个阶段时，我们将其物品改成成熟的花草，以替代原有的花草种子。</p>
<pre class="file">ex:plants/crops/grow</pre>
<pre>
execute store result score #t exValue run data get entity @s ArmorItems[3].tag.CustomModelData
execute if score #t exValue matches 12975001..12975060 run scoreboard players add #t exValue 20
execute if score #t exValue matches 12975061 run loot replace entity @s armor.head 1 loot ex:lycoris_radiata
execute if score #t exValue matches 12975062 run loot replace entity @s armor.head 1 loot ex:trifolium
execute if score #t exValue matches 12975063 run loot replace entity @s armor.head 1 loot ex:blackthorn
execute if score #t exValue matches 12975064 run loot replace entity @s armor.head 1 loot ex:cattail
execute if score #t exValue matches 12975065 run loot replace entity @s armor.head 1 loot ex:marigold
execute if score #t exValue matches 12975066 run loot replace entity @s armor.head 1 loot ex:hibiscus
execute if score #t exValue matches 12975067 run loot replace entity @s armor.head 1 loot ex:hyacinth
execute if score #t exValue matches 12975068 run loot replace entity @s armor.head 1 loot ex:calamus
execute if score #t exValue matches 12975069 run loot replace entity @s armor.head 1 loot ex:wild_lilium
execute if score #t exValue matches 12975070 run loot replace entity @s armor.head 1 loot ex:bauhinia
execute if score #t exValue matches 12975071 run loot replace entity @s armor.head 1 loot ex:fluffy_grass
execute if score #t exValue matches 12975072 run loot replace entity @s armor.head 1 loot ex:gerbera
execute if score #t exValue matches 12975073 run loot replace entity @s armor.head 1 loot ex:esparto
execute if score #t exValue matches 12975074 run loot replace entity @s armor.head 1 loot ex:glow_forsythia
execute if score #t exValue matches 12975075 run loot replace entity @s armor.head 1 loot ex:glazed_shade
execute if score #t exValue matches 12975076 run loot replace entity @s armor.head 1 loot ex:stelera
execute if score #t exValue matches 12975077 run loot replace entity @s armor.head 1 loot ex:forage_crystal
execute if score #t exValue matches 12975078 run loot replace entity @s armor.head 1 loot ex:isorchid
execute if score #t exValue matches 12975079 run loot replace entity @s armor.head 1 loot ex:burning_chrysanthe
execute if score #t exValue matches 12975080 run loot replace entity @s armor.head 1 loot ex:oxalis
execute if score #t exValue matches 12975021..12975080 store result entity @s ArmorItems[3].tag.CustomModelData int 1 run scoreboard players get #t exValue
</pre>

<h2 id="§10.3_树">§10.3 树</h2>

<p class="ex">种下矿石树树苗，然后会长大。长大后的树叶会逐渐变为矿石。</p>
<pre class="file">ex:plants/trees/grow</pre>
<pre>
setblock ~ ~ ~ acacia_sapling
execute store result score #t exValue run data get entity @s ArmorItems[3].tag.CustomModelData
scoreboard players add @s exValue 1
execute if score @s exValue >= $modTreeAgeMax exConfig if score #t exValue matches 12976002 run function ex:plants/trees/ore
</pre>
<pre class="file">ex:plants/trees/ore</pre>
<pre>
execute positioned ~-2 ~3 ~-2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-2 ~3 ~-1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-2 ~3 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-2 ~3 ~1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-2 ~3 ~2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-1 ~3 ~-2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-1 ~3 ~-1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-1 ~3 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-1 ~3 ~1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-1 ~3 ~2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~3 ~-2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~3 ~-1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~3 ~1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~3 ~2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~1 ~3 ~-2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~1 ~3 ~-1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~1 ~3 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~1 ~3 ~1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~1 ~3 ~2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~2 ~3 ~-2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~2 ~3 ~-1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~2 ~3 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~2 ~3 ~1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~2 ~3 ~2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}

execute positioned ~-2 ~4 ~-2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-2 ~4 ~-1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-2 ~4 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-2 ~4 ~1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-2 ~4 ~2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-1 ~4 ~-2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-1 ~4 ~-1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-1 ~4 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-1 ~4 ~1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-1 ~4 ~2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~4 ~-2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~4 ~-1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~4 ~1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~4 ~2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~1 ~4 ~-2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~1 ~4 ~-1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~1 ~4 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~1 ~4 ~1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~1 ~4 ~2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~2 ~4 ~-2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~2 ~4 ~-1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~2 ~4 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~2 ~4 ~1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~2 ~4 ~2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}

execute positioned ~-2 ~5 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-1 ~5 ~-1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-1 ~5 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~-1 ~5 ~1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~5 ~-2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~5 ~-1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~5 ~1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~5 ~2 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~1 ~5 ~-1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~1 ~5 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~1 ~5 ~1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~2 ~5 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}

execute positioned ~-1 ~6 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~6 ~-1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~6 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~ ~6 ~1 run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}
execute positioned ~1 ~6 ~ run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967,Tags:["ex_block","ex_leaves","ex_need_fire","ex_leaves_on_tree","ex_ore_leaves"],Fire:32767s}

loot replace entity @e[type=armor_stand,tag=ex_ore_leaves,distance=..20] armor.head 1 loot ex:ore_leaves
execute at @e[type=armor_stand,tag=ex_ore_leaves,distance=..20] if block ~ ~ ~ #minecraft:leaves run setblock ~ ~ ~ acacia_leaves replace
execute at @e[type=armor_stand,tag=ex_ore_leaves,distance=..20] run setblock ~ ~ ~ acacia_leaves keep
kill @s
setblock ~ ~ ~ air
fill ~ ~ ~ ~ ~5 ~ spruce_log replace #minecraft:leaves
fill ~ ~ ~ ~ ~5 ~ spruce_log keep
</pre>
<p>然后我们处理树叶转化。我们使用20刻一次的函数。</p>
<pre class="file">ex:tick20</pre>
<pre>
execute store result score #rts exValue run gamerule randomTickSpeed
execute store result score #rtsno exValue if entity @e[type=armor_stand,tag=ex_leaves_on_tree]
scoreboard players operation #rtsno exValue *= #rts exValue
scoreboard players operation #leaves_rts exValue += #rtsno exValue
execute if score #leaves_rts exValue >= $modLeavesThreshold exConfig as @e[type=armor_stand,tag=ex_leaves_on_tree,sort=random,limit=1] at @s run function ex:plants/leaves/type
schedule function ex:tick20 20t
</pre>
<pre class="file">ex:plants/leaves/type</pre>
<pre>
execute as @s[tag=ex_ore_leaves] run function ex:plants/leaves/ore
execute as @s[tag=ex_fruit_leaves] if block ~ ~-1 ~ #ex:air run function ex:plants/leaves/fruit
scoreboard players set #leaves_rts exValue 0
</pre>
<pre class="file">ex:plants/leaves/ore</pre>
<pre>
loot replace entity @s weapon.mainhand 1 loot ex:misc/ore_leaves
execute as @s[nbt={HandItems:[{id:"minecraft:ancient_debris"},{}]}] run setblock ~ ~ ~ ancient_debris
execute as @s[nbt={HandItems:[{id:"minecraft:emerald_ore"},{}]}] run setblock ~ ~ ~ emerald_ore
execute as @s[nbt={HandItems:[{id:"minecraft:diamond_ore"},{}]}] run setblock ~ ~ ~ diamond_ore
execute as @s[nbt={HandItems:[{id:"minecraft:lapis_ore"},{}]}] run setblock ~ ~ ~ lapis_ore
execute as @s[nbt={HandItems:[{id:"minecraft:redstone_ore"},{}]}] run setblock ~ ~ ~ redstone_ore
execute as @s[nbt={HandItems:[{id:"minecraft:gold_ore"},{}]}] run setblock ~ ~ ~ gold_ore
execute as @s[nbt={HandItems:[{id:"minecraft:nether_quartz_ore"},{}]}] run setblock ~ ~ ~ nether_quartz_ore
execute as @s[nbt={HandItems:[{id:"minecraft:iron_ore"},{}]}] run setblock ~ ~ ~ iron_ore
execute as @s[nbt={HandItems:[{id:"minecraft:coal_ore"},{}]}] run setblock ~ ~ ~ coal_ore
kill @s
</pre>


<h1 id="§11_物品与实体处理">§11 物品与实体处理</h1>
<p>本节内容较杂，主要包括常见的一些物品与实体处理方式。</p>

<h2 id="§11.1_随机数">§11.1 随机数</h2>
<p>随机数有多种生成方式，最简单的使用实体选择器 <code>@r</code> 来从若干实体中选取一个。我们可以生成两个并对其中随机一个的计分板增加 <code>1, 2, 4, ..., 2<sup>30</sup></code>，那么其中一个的分数就是 <code>0</code> 至 <code>2<sup>31</sup>-1</code> 之间的随机数，然后对我们想要的随机数区间取模，即可得到近似的均匀分布。</p>
<p>但是，我们使用战利品的 <code>set_attribute</code> 函数可以便捷地得到 <code>0</code> 至 <code>2048</code> 之间的一个随机浮点数。由此可得到下述算法。</p>

<pre class="file">ex/loot_tables/misc/random.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:stone",
                    "functions": [
                        {
                            "function": "minecraft:set_attributes",
                            "modifiers": [
                                {
                                    "slot": "mainhand",
                                    "name": "random_luck",
                                    "attribute": "generic.luck",
                                    "operation": "addition",
                                    "amount": {
                                        "min": 0,
                                        "max": 2048
                                    }
                                }
                            ]
                        },
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{exRandomMarker:1b}"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>

<pre class="file">ex:misc/random</pre>
<pre>
loot spawn ~ -1 ~ loot ex:misc/random
execute positioned ~ -1 ~ store result score #rand exValue run data get entity @e[type=item,distance=..1,nbt={Item:{tag:{exRandomMarker:1b}}},limit=1] Item.tag.AttributeModifiers[0].Amount 1048575
execute positioned ~ -1 ~ run kill @e[type=item,nbt={Item:{tag:{exRandomMarker:1b}}},limit=1,distance=..1]
scoreboard players operation #random_interval exValue = #random_max exValue
scoreboard players operation #random_interval exValue -= #random_min exValue
scoreboard players add #random_interval exValue 1
scoreboard players operation #rand exValue %= #random_interval exValue
scoreboard players operation #rand exValue += #random_min exValue
</pre>

<p>先设置 <code>#random_min</code> 和 <code>#random_max</code> 的 <code>exValue</code> 为随机数的上下界，然后执行该函数，则 <code>#rand</code> 的 <code>exValue</code> 即为该区间的一个随机数。</p>

<p>另一种做法更为简单，生成一个药水云并将其 <code>UUID[0]</code> 作为随机数来源即可。</p>
<pre class="file">ex:random</pre>
<pre>
summon area_effect_cloud ~ 0 ~ {Tags:["ex_random"]}
execute store result score #rand exValue run data get entity @e[tag=ex_random,limit=1,type=area_effect_cloud] UUID[0]
kill @e[tag=ex_random,type=area_effect_cloud]
scoreboard players operation #random_interval exValue = #random_max exValue
scoreboard players operation #random_interval exValue -= #random_min exValue
scoreboard players add #random_interval exValue 1
scoreboard players operation #rand exValue %= #random_interval exValue
scoreboard players operation #rand exValue += #random_min exValue
</pre>
<p>对于固定范围的随机数，我们可以直接在战利品表内设置好，可省去部分记分板的计算。</p>


<h2 id="§11.2_修改玩家背包">§11.2 修改玩家背包</h2>

<p>用于修改实体方块、实体、存储区NBT的 <code>data</code> 命令无法用来修改玩家NBT。在1.13-1.14版本中可以使用 <code>execute store</code> 和 <code>data modify</code> 命令来修改玩家背包内物品的 <code>tag</code> 标签下的信息，尽管使用该命令会提示错误。而在1.15版本则将该功能去除，想要修改玩家背包就必须借助其它方式。</p>

<p>一种方式是将修改后的物品信息复制到生物头部，并修改生物的死亡战利品表NBT。在战利品表中穷举获得该物品 <code>id</code> 和数量，并使用 <code>copy_nbt</code> 函数来将头部物品的NBT复制到战利品的NBT中。见 <a href="https://www.mcbbs.net/thread-837334-1-1.html">关于如何绕过moj不让改玩家的限制</a>。</p>

<pre class="file">ex/loot_tables/misc/loot</pre>
<pre>
{
    "type": "entity",
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:alternatives",
                    "children": [
                        {
                            "type": "item",
                            "name": "minecraft:andesite",
                            "conditions": [
                                {
                                    "condition": "minecraft:entity_properties",
                                    "entity": "this",
                                    "predicate": {
                                        "nbt": "{ArmorItems:[{},{},{}{id:'minecraft:andesite'}}"
                                    }
                                }
                            ]
                        },
                        [中间省略其它物品的穷举过程]
                        {
                            "type": "item",
                            "name": "minecraft:zombie_head",
                            "conditions": [
                                {
                                    "condition": "minecraft:entity_properties",
                                    "entity": "this",
                                    "predicate": {
                                        "nbt": "{ArmorItems:[{},{},{}{id:'minecraft:zombie_head'}}"
                                    }
                                }
                            ]
                        }
                    ],
                    functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": 2,
                            "conditions": [
                                {
                                    "condition": "minecraft:entity_properties",
                                    "entity": "this",
                                    "predicate": {
                                        "nbt": "{ArmorItems:[{},{},{},{Count:2b}]}"
                                    }
                                }
                            ]
                        },
                        [中间省略其它数量的穷举过程]
                        {
                            "function": "minecraft:set_count",
                            "count": 64,
                            "conditions": [
                                {
                                    "condition": "minecraft:entity_properties",
                                    "entity": "this",
                                    "predicate": {
                                        "nbt": "{ArmorItems:[{},{},{},{Count:64b}}"
                                    }
                                }
                            ]
                        },
                        {
                            "function": "minecraft:copy_nbt",
                            "source": "this",
                            "ops": [
                                {
                                    "source": "ArmorItems[3].tag",
                                    "target": "{}",
                                    "op": "merge"
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>

<p>最后我们使用 <code>loot</code> 函数来将战利品表物品输出到玩家背包中。可以看出，该方法使用的战利品表非常长，而且需要根据版本更新或模组内容添加新的物品 <code>id</code>。这里我们提及一个可能的误区，一般生物的装备和手持物并不会出现在生物的战利品表中，想要通过直接 <code>loot ... kill</code> 获取生物的装备或手持物是不可能的。</p>

<p>另一种方式是对潜影盒战利品表使用项目 <code>dynamic</code>，该项目配合 <code>"name": "minecraft:contents"</code> 可以将潜影盒内物品作为战利品表输出。</p>

<pre class="file">minecraft/loot_tables/blocks/shulker_box.json</pre>
<pre>
{
    "type": "minecraft:block",
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:alternatives",
                    "children": [
                        {
                            "type": "minecraft:dynamic",
                            "name": "minecraft:contents",
                            "conditions": [
                                {
                                    "condition": "minecraft:match_tool",
                                    "predicate": {
                                        "nbt":"{isShulkerMarker:1b}"
                                    }
                                }
                            ]
                        },
                        {
                            "type": "minecraft:item",
                            "functions": [
                                {
                                    "function": "minecraft:copy_name",
                                    "source": "block_entity"
                                },
                                {
                                    "function": "minecraft:copy_nbt",
                                    "source": "block_entity",
                                    "ops": [
                                        {
                                            "source": "Lock",
                                            "target": "BlockEntityTag.Lock",
                                            "op": "replace"
                                        },
                                        {
                                            "source": "LootTable",
                                            "target": "BlockEntityTag.LootTable",
                                            "op": "replace"
                                        },
                                        {
                                            "source": "LootTableSeed",
                                            "target": "BlockEntityTag.LootTableSeed",
                                            "op": "replace"
                                        }
                                    ]
                                },
                                {
                                    "function": "minecraft:set_contents",
                                    "entries": [
                                        {
                                            "type": "minecraft:dynamic",
                                            "name": "minecraft:contents"
                                        }
                                    ]
                                }
                            ],
                            "name": "minecraft:shulker_box"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>

<p>我们将物品复制到潜影盒内，然后使用命令 <code>loot ... mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}</code>。通常我们将这种辅助用的方块放置在 <code>255</code> 高度以免破坏地形和建筑。</p>

<p>除了用于修改玩家背包，该命令还可配合 <code>loot insert</code> 来将物品输出到容器内，并使物品尽量堆叠。这常用于机器的输出，见 <a href="#§8.4_物品输出">§8.4 物品输出</a>。</p>


<h2 id="§11.3_耐久处理">§11.3 耐久处理</h2>

<p>有时候我们需要模拟使用工具的过程，但工具并没有真正被使用，耐久也没有被消耗。此时我们需要手动对其耐久进行处理。</p>
<p>我们将物品信息复制到存储区 <code>ex:damage</code> 的 <code>Item</code> 中，然后使用断言判断是否减少耐久。最后判断其是否已经耐久耗尽，若耗尽则清除之。</p>

<pre class="file">ex:damage</pre>
<pre>
execute store result score @s exUnbreakLvl run data get storage ex:damage Item.tag.Enchantments[{id:"minecraft:unbreaking"}].lvl
execute store result score #damage exValue run data get storage ex:damage Item.tag.Damage
execute unless predicate ex:no_damage store result storage ex:damage Item.tag.Damage int 1 run scoreboard players add #damage exValue 1
</pre>

<pre class="file">ex/predicate/no_damage.json</pre>
<pre>
[
    {
        "condition": "minecraft:inverted",
        "term": {
            "condition": "minecraft:entity_scores",
            "entity": "this",
            "scores": {
                "exUnbreakLvl": 0
            }
        }
    },
    {
        "condition": "minecraft:alternative",
        "terms": [
            {
                "condition": "minecraft:inverted",
                "term": {
                    "condition": "minecraft:entity_scores",
                    "entity": "this",
                    "scores": {
                        "exUnbreakLvl": 1
                    }
                }
            },
            {
                "condition": "minecraft:random_chance",
                "chance": 0.5
            }
        ]
    },
    {
        "condition": "minecraft:alternative",
        "terms": [
            {
                "condition": "minecraft:inverted",
                "term": {
                    "condition": "minecraft:entity_scores",
                    "entity": "this",
                    "scores": {
                        "exUnbreakLvl": 2
                    }
                }
            },
            {
                "condition": "minecraft:random_chance",
                "chance": 0.66666667
            }
        ]
    },
    {
        "condition": "minecraft:alternative",
        "terms": [
            {
                "condition": "minecraft:inverted",
                "term": {
                    "condition": "minecraft:entity_scores",
                    "entity": "this",
                    "scores": {
                        "exUnbreakLvl": 3
                    }
                }
            },
            {
                "condition": "minecraft:random_chance",
                "chance": 0.75
            }
        ]
    },
    {
        "condition": "minecraft:alternative",
        "terms": [
            {
                "condition": "minecraft:inverted",
                "term": {
                    "condition": "minecraft:entity_scores",
                    "entity": "this",
                    "scores": {
                        "exUnbreakLvl": 4
                    }
                }
            },
            {
                "condition": "minecraft:random_chance",
                "chance": 0.8
            }
        ]
    },
    {
        "condition": "minecraft:alternative",
        "terms": [
            {
                "condition": "minecraft:inverted",
                "term": {
                    "condition": "minecraft:entity_scores",
                    "entity": "this",
                    "scores": {
                        "exUnbreakLvl": 5
                    }
                }
            },
            {
                "condition": "minecraft:random_chance",
                "chance": 0.83333333
            }
        ]
    },
    {
        "condition": "minecraft:alternative",
        "terms": [
            {
                "condition": "minecraft:inverted",
                "term": {
                    "condition": "minecraft:entity_scores",
                    "entity": "this",
                    "scores": {
                        "exUnbreakLvl": 6
                    }
                }
            },
            {
                "condition": "minecraft:random_chance",
                "chance": 0.85714286
            }
        ]
    },
    {
        "condition": "minecraft:alternative",
        "terms": [
            {
                "condition": "minecraft:inverted",
                "term": {
                    "condition": "minecraft:entity_scores",
                    "entity": "this",
                    "scores": {
                        "exUnbreakLvl": 7
                    }
                }
            },
            {
                "condition": "minecraft:random_chance",
                "chance": 0.875
            }
        ]
    },
    {
        "condition": "minecraft:alternative",
        "terms": [
            {
                "condition": "minecraft:inverted",
                "term": {
                    "condition": "minecraft:entity_scores",
                    "entity": "this",
                    "scores": {
                        "exUnbreakLvl": 8
                    }
                }
            },
            {
                "condition": "minecraft:random_chance",
                "chance": 0.88888889
            }
        ]
    },
    {
        "condition": "minecraft:alternative",
        "terms": [
            {
                "condition": "minecraft:inverted",
                "term": {
                    "condition": "minecraft:entity_scores",
                    "entity": "this",
                    "scores": {
                        "exUnbreakLvl": 9
                    }
                }
            },
            {
                "condition": "minecraft:random_chance",
                "chance": 0.9
            }
        ]
    },
    {
        "condition": "minecraft:alternative",
        "terms": [
            {
                "condition": "minecraft:inverted",
                "term": {
                    "condition": "minecraft:entity_scores",
                    "entity": "this",
                    "scores": {
                        "exUnbreakLvl": 10
                    }
                }
            },
            {
                "condition": "minecraft:random_chance",
                "chance": 0.90909091
            }
        ]
    }
]</pre>
<p>对于旧版本，我们也可以通过生成<code>0~耐久附魔等级</code>的随机数，并判断是否为0来确定是否消耗耐久，参见<a href="§11.1_随机数">§11.1 随机数</a>。</p>

<h2 id="§11.4_红石信号">§11.4 红石信号</h2>

<p>为了检测当前方块是否被强充能了，我们将所有能激活当前方块的红石元件和方块状态记录在断言文件中来判断。注意我们没有对当前方块是否完整进行检测。陷阱箱触发的红石信号也是无法直接探测到的。</p>

<pre class="file">mac/predicates/redstone_power.json</pre>
<pre>
{
    "condition": "minecraft:alternative",
    "terms": [
        {
            "condition": "minecraft:location_check",
            "offsetY": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:lever",
                    "state": {
                        "powered": true,
                        "face": "ceiling"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:lever",
                    "state": {
                        "powered": true,
                        "face": "floor"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:lever",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "east"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:lever",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "west"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:lever",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "south"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:lever",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "north"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": -1,
            "predicate": {
                "block": {
                    "tag": "minecraft:buttons",
                    "state": {
                        "powered": true,
                        "face": "ceiling"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": 1,
            "predicate": {
                "block": {
                    "tag": "minecraft:buttons",
                    "state": {
                        "powered": true,
                        "face": "floor"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": 1,
            "predicate": {
                "block": {
                    "tag": "minecraft:buttons",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "east"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": -1,
            "predicate": {
                "block": {
                    "tag": "minecraft:buttons",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "west"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": 1,
            "predicate": {
                "block": {
                    "tag": "minecraft:buttons",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "south"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": -1,
            "predicate": {
                "block": {
                    "tag": "minecraft:buttons",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "north"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:redstone_torch",
                    "state": {
                        "lit": true
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:redstone_wall_torch",
                    "state": {
                        "lit": true
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:observer",
                    "state": {
                        "powered": true,
                        "facing": "down"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:observer",
                    "state": {
                        "powered": true,
                        "facing": "up"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:observer",
                    "state": {
                        "powered": true,
                        "facing": "east"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:observer",
                    "state": {
                        "powered": true,
                        "facing": "west"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:observer",
                    "state": {
                        "powered": true,
                        "facing": "south"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:observer",
                    "state": {
                        "powered": true,
                        "facing": "north"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:repeater",
                    "state": {
                        "powered": true,
                        "facing": "east"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:repeater",
                    "state": {
                        "powered": true,
                        "facing": "west"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:repeater",
                    "state": {
                        "powered": true,
                        "facing": "south"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:repeater",
                    "state": {
                        "powered": true,
                        "facing": "north"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:comparator",
                    "state": {
                        "powered": true,
                        "facing": "east"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:comparator",
                    "state": {
                        "powered": true,
                        "facing": "west"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:comparator",
                    "state": {
                        "powered": true,
                        "facing": "south"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:comparator",
                    "state": {
                        "powered": true,
                        "facing": "north"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:tripwire_hook",
                    "state": {
                        "powered": true,
                        "facing": "east"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:tripwire_hook",
                    "state": {
                        "powered": true,
                        "facing": "west"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:tripwire_hook",
                    "state": {
                        "powered": true,
                        "facing": "south"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:tripwire_hook",
                    "state": {
                        "powered": true,
                        "facing": "north"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": 1,
            "predicate": {
                "block": {
                    "tag": "minecraft:wooden_pressure_plates",
                    "state": {
                        "powered": true
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:stone_pressure_plate",
                    "state": {
                        "powered": true
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:light_weighted_pressure_plate",
                    "state": {
                        "powered": true
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:heavy_weighted_pressure_plate",
                    "state": {
                        "powered": true
                    }
                }
            }
        }
    ]
}
</pre>

<p>弱充能情形更为繁琐。</p>

<p>想要产生一个红石信号，可以通过在当前位置放置红石块再放置空气来产生。注意保存当前方块的信息。这样的红石信号可以用于激活结构方块，因此可用于 <a href="§12_世界生成">§12 世界生成</a>。</p>

<h2 id="§11.5_方块交互">§11.5 方块交互</h2>

<p>与某些特定方块交互，可通过相应的交互判据的计分板来探测。如果仅需要右击而不打开，可对容器进行上锁，但玩家快捷栏上方会提示容器已上锁，需要使用资源包来消除；或者使用传送来实现强制关闭GUI，但画面会有闪烁感。</p>

<p class="ex">右键方块破坏器将其上方的石头变为砂砾，圆石变为沙子。方块破坏器为上锁的熔炉，且相应位置已有盔甲架标记。这里我们直接使用 <a href="#§6.1_视线追踪法">§6.1 视线追踪法</a>来获取方块破坏器位置。</p>

<pre class="file">ex:load</pre>
<pre>
scoreboard objectives add exBsdIntFur minecraft.custom:minecraft.interact_with_furnace
</pre>
<pre class="file">ex:tick</pre>
<pre>
execute as @a[scores={exBsdIntFur=1..}] at @s anchored eyes run function ex:block_breaker/ray
</pre>
<pre class="file">ex:block_breaker/ray</pre>
<pre>
execute if entity @s[distance=..7] unless block ~ ~ ~ furnace positioned ^ ^ ^0.005 anchored feet run function ex:block_breaker/ray
execute if entity @s[distance=..7] if block ~ ~ ~ furnace{Lock:"zsx&lt;3wtt"} if block ~ ~1 ~ #ex:block_breaker run function ex:block_breaker/done
scoreboard players reset @s exBsdIntFur
</pre>
<pre class="file">ex/tags/blocks/block_breaker</pre>
<pre>
{
    "replace": false,
    "values": [
        "minecraft:stone",
        "minecraft:cobblestone",
    ]
}
</pre>
<pre class="file">ex:block_breaker/done</pre>
<pre>
execute if block ~ ~1 ~ stone run setblock ~ ~1 ~ gravel
execute if block ~ ~1 ~ cobblestone run setblock ~ ~1 ~ sand
</pre>

<p>同理，<a href="#§8.6_插件">§8.6 插件</a>中的插件安装也可以通过打开木桶的判据来实现。我们使用传送来实现强制关闭GUI。</p>

<pre class="file">mac:load</pre>
<pre>
scoreboard objectives add macOpenFrame minecraft.custom:minecraft.open_barrel
</pre>
<pre class="file">mac:tick</pre>
<pre>
execute as @a[tag=machine_close_gui] at @s positioned ~ ~-256 ~ run function mac:misc/close_gui_back
execute as @a[scores={macOpenFrame=1..}] if predicate mac:all_in_one_machine/hand_machine_plugin at @s anchored eyes run function mac:all_in_one_machine/ray
</pre>
<pre class="file">mac/predicates/all_in_one_machine/hand_machine_plugin.json</pre>
<pre>
{
    "condition": "minecraft:alternative",
    "terms": [
        {
            "condition": "minecraft:entity_properties",
            "entity": "this",
            "predicate": {
                "equipment": {
                    "mainhand":{
                        "nbt": "{macMachinePlugin:1b}"
                    }
                }
            }
        },
        {
            "condition": "minecraft:entity_properties",
            "entity": "this",
            "predicate": {
                "equipment": {
                    "offhand":{
                        "nbt": "{macMachinePlugin:1b}"
                    }
                }
            }
        }
    ]
}
</pre>
<pre class="file">mac:all_in_one_machine/ray</pre>
<pre>
execute as @s[distance=..6] if block ~ ~ ~ barrel align xyz positioned ~0.5 ~ ~0.5 run function mac:all_in_one_machine/init
execute as @s[distance=..6] unless block ~ ~ ~ barrel positioned ^ ^ ^0.005 anchored feet run function mac:all_in_one_machine/ray
</pre>
<pre class="file">ex:all_in_one_machine/init</pre>
<pre>
execute as @s[nbt=!{SelectedItem:{tag:{macMachinePlugin:1b}}}] run data modify storage mac:plugin Item set from entity @s Inventory[{Slot:-106b}]
execute as @s[nbt={SelectedItem:{tag:{macMachinePlugin:1b}}}] run data modify storage mac:plugin Item set from entity @s SelectedItem
execute if data storage mac:plugin Item.tag{id:"mac:high_pressure_plugin"} if entity @e[tag=machine_all_in_one_machine,distance=..0.5,limit=1,tag=!machine_high_pressure] run function ex:all_in_one_machine/init/high_pressure
execute if data storage mac:plugin Item.tag{id:"mac:low_pressure_plugin"} if entity @e[tag=machine_all_in_one_machine,distance=..0.5,limit=1,tag=!machine_low_pressure] run function ex:all_in_one_machine/init/low_pressure
execute if data storage mac:plugin Item.tag{id:"mac:high_temperature_plugin"} if entity @e[tag=machine_all_in_one_machine,distance=..0.5,limit=1,tag=!machine_high_temperature] run function ex:all_in_one_machine/init/high_temperature
execute if data storage mac:plugin Item.tag{id:"mac:low_temperature_plugin"} if entity @e[tag=machine_all_in_one_machine,distance=..0.5,limit=1,tag=!machine_low_temperature] run function ex:all_in_one_machine/init/low_temperature
execute as @s[tag=machine_plugin_used] at @s run function mac:close_gui
tag @s[tag=machine_plugin_used] remove machine_plugin_used
</pre>
<pre class="file">ex:all_in_one_machine/init/high_pressure</pre>
<pre>
tellraw @s [{"translate":"info.machine.high_pressure_plugin"}]
tag @s add machine_plugin_used
tag @e[tag=machine_all_in_one_machine,distance=..0.5,limit=1,tag=!machine_high_pressure] add machine_high_pressure
clear @s[tag=machine_plugin_used] minecraft:firework_star{id:"mac:high_pressure_plugin"} 1
</pre>
<pre class="file">mac:misc/close_gui</pre>
<pre>
summon minecraft:area_effect_cloud ~ ~ ~ {Tags:["machine_close_gui_pos"],Duration:2}
summon minecraft:area_effect_cloud ^ ^ ^3 {Tags:["machine_close_gui_facing"],Duration:2}
tp @s ~ ~256 ~
tag @s add machine_close_gui
</pre>
<pre class="file">mac:misc/close_gui_back</pre>
<pre>
tp @s @e[type=area_effect_cloud,tag=machine_close_gui_pos,distance=..10,sort=nearest,limit=1]
tag @s remove machine_close_gui
execute at @s facing entity @e[type=area_effect_cloud,tag=machine_close_gui_facing,distance=..10,sort=nearest,limit=1] feet run tp ~ ~ ~
</pre>

<h2 id="§11.6_生物移动">§11.6 生物移动</h2>

<p class="ex">手持绿宝石块的玩家吸引 <code>16</code> 米内的村民到自身位置。</p>

<pre class="file">ex:tick</pre>
<pre>
tag @a remove ex_player_hand_emerald_block
execute as @e[type=villager] at @s if entity @a[distance=1..16,predicate=ex:hand_emerald_block] run function ex:misc/attract_villager
</pre>
<pre class="file">ex/predicates/hand_emerald_block.json</pre>
<pre>
{
    "condition": "minecraft:alternative",
    "terms": [
        {
            "condition": "minecraft:entity_properties",
            "entity": "this",
            "predicate": {
                "equipment": {
                    "mainhand":{
                        "item": "minecraft:emerald_block"
                    }
                }
            }
        },
        {
            "condition": "minecraft:entity_properties",
            "entity": "this",
            "predicate": {
                "equipment": {
                    "offhand":{
                        "item": "minecraft:emerald_block"
                    }
                }
            }
        }
    ]
}
</pre>
<pre class="file">ex:misc/attract_villager</pre>
<pre>
tag @p[distance=1..16,predicate=ex:hand_emerald_block] add ex_player_hand_emerald_block
tp @s ~ ~ ~ facing entity @p[tag=ex_player_hand_emerald_block]
data merge entity @s {Motion:[0.0d,-1.0d,0.0d]}
execute facing entity @p[tag=ex_player_hand_emerald_block] feet positioned ^ ^ ^0.75 unless block ~ ~ ~ #ex:attract_through if block ~ ~1 ~ #ex:air run data merge entity @s {Motion:[0.0d,1.0d,0.0d]}
execute store result score #temp0 exValue run data get entity @p[tag=ex_player_hand_emerald_block] Pos[0] 100
execute store result score #temp1 exValue run data get entity @s Pos[0] 100
execute store result entity @s Motion[0] double 0.0005 run scoreboard players operation #temp0 exValue -= #temp1 exValue
execute store result score #temp0 exValue run data get entity @p[tag=ex_player_hand_emerald_block] Pos[2] 100
execute store result score #temp1 exValue run data get entity @s Pos[2] 100
execute store result entity @s Motion[2] double 0.0005 run scoreboard players operation #temp0 exValue -= #temp1 exValue
</pre>
<pre class="file">ex/tags/blocks/fluid.json</pre>
<pre>
{
    "replace": false,
    "values": [
        "minecraft:air",
        "minecraft:cave_air",
        "minecraft:void_air",
        "minecraft:bubble_column",
        "minecraft:water",
        "minecraft:lava",
        "minecraft:fire"
    ]
}
</pre>
<pre class="file">ex/tags/blocks/attract_through.json</pre>
<pre>
{
    "replace": false,
    "values": [
        "#ex:fluid",
        "#minecraft:saplings",
        "minecraft:grass",
        "minecraft:fern",
        "minecraft:dead_bush",
        "minecraft:seagrass",
        "minecraft:sea_pickle",
        "#minecraft:small_flowers",
        "minecraft:brown_mushroom",
        "minecraft:red_mushroom",
        "minecraft:torch",
        "minecraft:end_rod",
        "minecraft:ladder",
        "minecraft:snow",
        "#minecraft:carpets",
        "minecraft:sunflower",
        "minecraft:lilac",
        "minecraft:rose_bush",
        "minecraft:peony",
        "minecraft:tall_grass",
        "minecraft:large_fern",
        "#minecraft:corals",
        "#minecraft:signs",
        "minecraft:vine",
        "minecraft:dead_tube_coral",
        "minecraft:dead_horn_coral",
        "minecraft:dead_fire_coral",
        "minecraft:dead_bubble_coral",
        "minecraft:dead_brain_coral",
        "minecraft:dead_tube_coral_fan",
        "minecraft:dead_horn_coral_fan",
        "minecraft:dead_fire_coral_fan",
        "minecraft:dead_bubble_coral_fan",
        "minecraft:dead_brain_coral_fan",
        "minecraft:lever",
        "minecraft:repeater",
        "minecraft:comparator",
        "#minecraft:wooden_pressure_plates",
        "minecraft:light_weighted_pressure_plate",
        "minecraft:heavy_weighted_pressure_plate",
        "#minecraft:buttons",
        "minecraft:redstone_torch",
        "minecraft:tripwire_hook",
        "minecraft:tripwire",
        "#minecraft:doors",
        "#minecraft:rails",
        "minecraft:redstone_wire",
        "#minecraft:walls",
        "#minecraft:fences",
        "minecraft:oak_fence_gate",
        "minecraft:spruce_fence_gate",
        "minecraft:birch_fence_gate",
        "minecraft:jungle_fence_gate",
        "minecraft:acacia_fence_gate",
        "minecraft:dark_oak_fence_gate"
    ]
}
</pre>

<p>这里我们进行了繁复的判断是为了让村民能够爬坡，但不能爬过栅栏类方块。如果是想要实现吸引物品掉落物的效果，则很多内容可以省略。</p>


<h2 id="§11.7_交易">§11.7 交易</h2>
<p>使用村民交易是一种常见的特殊物品获得方式。在1.14+版本，建议使用流浪商人而不是村民，因为村民的交易会根据工作方块而进行变化，导致设定的交易被覆盖或出现不想要的交易。如果不希望交易产生经验值，需将 <code>rewardExp</code> 设置为 <code>0b</code>。通过让村民佩戴物品，可以让村民头部实现不同的外观，但是其它部位不能如此修改，使用佩戴在头部全身模型也会因村民头部移动而发生错乱。</p>

<p>建议使用战利品来随机生成村民的交易项。</p>

<pre class="file">trade:load</pre>
<pre>
function trade:tick20 20t
</pre>
<pre class="file">trade:tick20</pre>
<pre>
execute as @e[type=wandering_trader,tag=!trade_trade_added] run function trade:check
schedule function trade:tick20 20t
</pre>
<pre class="file">trade:check</pre>
<pre>
data merge entity @s {ArmorItems:[{},{},{},{id:"minecraft:carved_pumpkin",Count:1b,tag:{CustomModelData:12970051}}],ArmorDropChances:[-1.0f,-1.0f,-1.0f,-1.0f]}
data modify entity @s Offers.Recipes prepend value {buy:{id:"minecraft:stone",Count:64b},sell:{id:"minecraft:emerald",Count:1b},maxUses:12}
data modify entity @s Offers.Recipes append value {buy:{id:"minecraft:emerald",Count:64b},sell:{id:"minecraft:stone",Count:1b},maxUses:12}
loot replace entity @s weapon.mainhand 1 loot trade:trade/buy
data modify entity @s Offers.Recipes[0].buy.id set from entity @s HandItems[0].id
data modify entity @s Offers.Recipes[0].buy.Count set from entity @s HandItems[0].Count
loot replace entity @s weapon.mainhand 1 loot trade:trade/sell
data modify entity @s Offers.Recipes[9].sell.id set from entity @s HandItems[0].id
data modify entity @s Offers.Recipes[9].buy.Count set from entity @s HandItems[0].Count
replaceitem entity @s weapon.mainhand minecraft:air
tag @s add trade_trade_added
</pre>
<pre class="file">trade/loot_tables/trade/buy.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:oak_log",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 36,
                                "max": 40
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:spruce_log",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 36,
                                "max": 40
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:birch_log",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 36,
                                "max": 40
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:jungle_log",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 36,
                                "max": 40
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:acacia_log",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 36,
                                "max": 40
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:dark_oak_log",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 36,
                                "max": 40
                            }
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>
<pre class="file">trade/loot_tables/trade/sell.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:piston",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 4,
                                "max": 6
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:redstone_lamp",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 4,
                                "max": 6
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:tnt",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 4,
                                "max": 6
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:observer",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 4,
                                "max": 6
                            }
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>

<p>这样，我们便为每个流浪商人的最前面添加了交易 <code>36-40</code> 个原木换 <code>1</code> 个绿宝石，最后面添加了交易 <code>4-6</code> 个绿宝石换活塞、红石灯、TNT、观察者。</p>

<p>1.13版本可将村民的NBT修改为 <code>{VillagerData:{profession:"minecraft:none"}</code> 以确保村民不含交易。</p>

<h2 id="§11.8_清理特定物品">§11.8 清理特定物品</h2>

<p>在自动种植、自动繁殖或放置方块等情形，我们需要对容器内的特定物品进行消耗。例如：当含有 <code>ex:toughen_hand</code> 的物品展示框下方容器内有胡萝卜、金胡萝卜、蒲公英时，令附近的兔子进入繁殖状态并清除一个相应物品。</p>

<pre class="file">ex:tick</pre>
<pre>
execute as @e[type=item_frame,nbt={Item:{tag:{id:"ex:toughen_hand"}}}] at @s if entity @e[type=rabbit,distance=..9,nbt={Age:0,InLove:0}] run function ex:toughen_hand/rabbit_check
</pre>
<pre class="file">ex:toughen_hand/rabbit_check</pre>
<pre>
scoreboard players set @s exValue 0
execute if data block ~ ~-1 ~ Items[{id:"minecraft:carrot"}] run scoreboard players set @s exValue 1
execute if data block ~ ~-1 ~ Items[{id:"minecraft:golden_carrot"}] run scoreboard players set @s exValue 2
execute if data block ~ ~-1 ~ Items[{id:"minecraft:dandelion"}] run scoreboard players set @s exValue 3
execute if score @s exValue matches 1.. run function ex:toughen_hand/rabbit
</pre>
<pre class="file">ex:toughen_hand/rabbit</pre>
<pre>
execute if score @s exValue matches 1 run data modify storage ex:toughen_hand Item set from block ~ ~-1 ~ Items[{id:"minecraft:carrot"}]
execute if score @s exValue matches 2 run data modify storage ex:toughen_hand Item set from block ~ ~-1 ~ Items[{id:"minecraft:golden_carrot"}]
execute if score @s exValue matches 3 run data modify storage ex:toughen_hand Item set from block ~ ~-1 ~ Items[{id:"minecraft:dandelion"}]
execute store result storage ex:toughen_hand Item.Count byte 0.999 run data get storage ex:toughen_hand Item.Count
data modify block ~ ~-1 ~ Items append from storage ex:toughen_hand Item
data merge entity @e[type=item_framerabbit,distance=..9,nbt={Age:0,InLove:0},limit=1] {InLove:600}
</pre>

<p>注意到一点，<code>Items[{id:"minecraft:carrot"}]</code> 只会选择容器内的最后一个拥有胡萝卜的栏位。如果 <code>ex:toughen_hand</code> 的物品被消耗完，则追加到容器的 <code>Items</code> 时，仍然会先覆盖已有的同 <code>Slot</code> 项，然后由于 <code>Count</code> 变为 <code>0</code> 而清除该栏位。</p>

<h2 id="§11.9_连锁">§11.9 连锁</h2>

<p>当玩家使用原版镐时，破坏所有相连的矿石。</p>

<pre class="file">chain:load</pre>
<pre>
scoreboard objectives add chainUsePick1 minecraft.used:minecraft.diamond_pickaxe
scoreboard objectives add chainUsePick2 minecraft.used:minecraft.iron_pickaxe
scoreboard objectives add chainUsePick3 minecraft.used:minecraft.golden_pickaxe
scoreboard objectives add chainUsePick4 minecraft.used:minecraft.stone_pickaxe
</pre>
<pre class="file">chain:tick</pre>
<pre>
execute as @a at @s anchored eyes run function chain:chain/type
</pre>
<pre class="file">chain:chain/type</pre>
<pre>
execute as @s[scores={chainUsePick1=1..}] run function chain:chain/pickaxe1/init
execute as @s[scores={chainUsePick2=1..}] run function chain:chain/pickaxe2/init
execute as @s[scores={chainUsePick3=1..}] run function chain:chain/pickaxe3/init
execute as @s[scores={chainUsePick4=1..}] run function chain:chain/pickaxe4/init
scoreboard players reset @s chainUsePick1
scoreboard players reset @s chainUsePick2
scoreboard players reset @s chainUsePick3
scoreboard players reset @s chainUsePick4
</pre>
<pre class="file">chain:chain/pickaxe1/init</pre>
<pre>
scoreboard players set #max_durality chainValue 1562
data modify storage ex:damage Item set from entity @s SelectedItem
execute store result score #temp chainValue run data get storage ex:damage Item.tag.Damage
execute at @e[type=item,nbt={Age:0s},distance=..6,sort=nearest,limit=1] run function chain:chain/pickaxe1/mark
execute at @e[type=item,nbt={Age:1s},distance=..6,sort=nearest,limit=1] run function chain:chain/pickaxe1/mark
scoreboard players reset @s chainUsePick1
execute if score #temp chainValue &gt;= #max_durality chainValue run replaceitem entity @s weapon.mainhand minecraft:air
</pre>
<pre class="file">chain:chain/pickaxe1/mark</pre>
<pre>
execute positioned ~1 ~ ~ if block ~ ~ ~ #chain:pickaxe1_chain run function chain:chain/pickaxe1/damage
execute positioned ~-1 ~ ~ if block ~ ~ ~ #chain:pickaxe1_chain run function chain:chain/pickaxe1/damage
execute positioned ~ ~1 ~ if block ~ ~ ~ #chain:pickaxe1_chain run function chain:chain/pickaxe1/damage
execute positioned ~ ~-1 ~ if block ~ ~ ~ #chain:pickaxe1_chain run function chain:chain/pickaxe1/damage
execute positioned ~ ~ ~1 if block ~ ~ ~ #chain:pickaxe1_chain run function chain:chain/pickaxe1/damage
execute positioned ~ ~ ~-1 if block ~ ~ ~ #chain:pickaxe1_chain run function chain:chain/pickaxe1/damage
</pre>
<pre class="file">chain/tags/blocks/pickaxe1.json</pre>
<pre>
{
    "replace": false,
    "values": [
        "minecraft:iron_ore",
        "minecraft:gold_ore",
        "minecraft:coal_ore",
        "minecraft:diamond_ore",
        "minecraft:emerald_ore",
        "minecraft:nether_quartz_ore",
        "minecraft:redstone_ore",
        "minecraft:lapis_ore"
    ]
}
</pre>
<pre class="file">chain:chain/pickaxe1/damage</pre>
<pre>
execute as @s[nbt=!{SelectedItem:{tag:{Enchantments:[{id:"minecraft:silk_touch"}]}}}] run function chain:chain/xp
loot spawn ~ ~ ~ mine ~ ~ ~ mainhand
setblock ~ ~ ~ air
function ex:damage
execute if score #temp chainValue &lt; #max_durality chainValue run function chain:chain/pickaxe1/mark
</pre>

<p>函数 <code>ex:damage</code> 见 <a href="§11.3_耐久处理">§11.3 耐久处理</a>。</p>

<h1 id="§12_算法">§12 算法</h1>
<h2 id="§12.1_世界生成结构">§12.1 世界生成结构</h2>
<p class="ex">世界生成时，随机生成结构。判断玩家东南32×32范围内是否有标记，如无，添加相应标记在32整数倍坐标处，然后生成战利品表、分散，通过战利品表掉落物来生成结构。也可以使用方块来标记，例如普通生存下y=0使用屏障替换基岩或超平坦生存y=255处使用air替换void_air来实现，这在某些对实体加载有修改的服务端会很有效。</p>

<pre class="file">ex:tick</pre>
<pre>
execute as @a at @s unless block ~ 0 ~ bedrock run function ex:generate/check
</pre>
<pre class="file">ex:generate/check</pre>
<pre>
execute positioned ~-64 -1 ~-64 unless entity @e[type=area_effect_cloud,tag=ex_chunk,dx=32,dy=2,dz=32] run function ex:generate/mark
execute positioned ~-64 -1 ~-32 unless entity @e[type=area_effect_cloud,tag=ex_chunk,dx=32,dy=2,dz=32] run function ex:generate/mark
execute positioned ~-64 -1 ~ unless entity @e[type=area_effect_cloud,tag=ex_chunk,dx=32,dy=2,dz=32] run function ex:generate/mark
execute positioned ~-32 -1 ~-64 unless entity @e[type=area_effect_cloud,tag=ex_chunk,dx=32,dy=2,dz=32] run function ex:generate/mark
execute positioned ~-32 -1 ~-32 unless entity @e[type=area_effect_cloud,tag=ex_chunk,dx=32,dy=2,dz=32] run function ex:generate/mark
execute positioned ~-32 -1 ~ unless entity @e[type=area_effect_cloud,tag=ex_chunk,dx=32,dy=2,dz=32] run function ex:generate/mark
execute positioned ~ -1 ~-64 unless entity @e[type=area_effect_cloud,tag=ex_chunk,dx=32,dy=2,dz=32] run function ex:generate/mark
execute positioned ~ -1 ~-32 unless entity @e[type=area_effect_cloud,tag=ex_chunk,dx=32,dy=2,dz=32] run function ex:generate/mark
execute positioned ~ -1 ~ unless entity @e[type=area_effect_cloud,tag=ex_chunk,dx=32,dy=2,dz=32] run function ex:generate/mark
</pre>
<pre class="file">ex:generate/mark</pre>
<pre>
summon area_effect_cloud ~32 0 ~32 {Age:0,Duration:2147483647,Tags:["ex_aec_marker","ex_chunk","ex_temp"]}
execute as @e[type=area_effect_cloud,tag=ex_temp] run function ex:generate/aec
loot spawn ~ ~ ~ loot ex:misc/generate
execute store result score #t exValue run spreadplayers ~ ~ 0 15 false @e[type=item,nbt={Item:{tag:{ex_generate_marker:1b}}}]
execute as @e[type=item,nbt={Item:{tag:{ex_generate_marker:1b}}}] at @s if block ~ ~-1 ~ #ex:replacable run tp ~ ~-1 ~
execute as @e[type=item,nbt={Item:{tag:{ex_generate_marker:1b}}}] at @s if block ~ ~-1 ~ #ex:replacable run tp ~ ~-1 ~
execute as @e[type=item,nbt={Item:{tag:{ex_generate_marker:1b}}}] at @s run function ex:generate/build
</pre>
<pre class="file">ex:generate/aec</pre>
<pre>
execute store result entity @s Pos[0] double 32 run data get entity @s Pos[0] 0.03125
execute store result entity @s Pos[2] double 32 run data get entity @s Pos[2] 0.03125
tag @s remove ex_temp
</pre>
<pre class="file">ex:generate/build</pre>
<pre>
# 附魔室
execute as @s[nbt={Item:{tag:{ex_generate_type:"enchanting_room"}}}] if score #t exValue matches 1.. run function ex:generate/structures/enchanting_room
# 图腾柱
execute as @s[nbt={Item:{tag:{ex_generate_type:"tp_overworld"}}}] run function ex:generate/structures/tp_overworld
execute as @s[nbt={Item:{tag:{ex_generate_type:"tp_the_nether"}}}] run function ex:generate/structures/tp_the_nether
execute as @s[nbt={Item:{tag:{ex_generate_type:"tp_flower"}}}] run function ex:generate/structures/tp_flower
# 树
execute as @s[nbt={Item:{tag:{ex_generate_type:"fruit_tree"}}}] if block ~ ~-1 ~ #ex:sapling_plantable_on align xyz positioned ~0.5 ~ ~0.5 run function ex:plants/trees/fruit0
execute as @s[nbt={Item:{tag:{ex_generate_type:"ore_tree"}}}] if block ~ ~-1 ~ #ex:sapling_plantable_on align xyz positioned ~0.5 ~ ~0.5 run function ex:plants/trees/ore0
execute as @s[nbt={Item:{tag:{ex_generate_type:"wool_tree"}}}] if block ~ ~-1 ~ #ex:sapling_plantable_on align xyz positioned ~0.5 ~ ~0.5 run function ex:plants/trees/wool0
execute as @s[nbt={Item:{tag:{ex_generate_type:"sakura_tree"}}}] if block ~ ~-1 ~ #ex:sapling_plantable_on align xyz positioned ~0.5 ~ ~0.5 run function ex:plants/trees/sakura0
# 死珊瑚扇
execute as @s[nbt={Item:{tag:{ex_generate_type:"dead_coral_fan"}}}] run function ex:generate/structures/dead_coral_fan
# 灌木丛
execute as @s[nbt={Item:{tag:{ex_generate_type:"small_bush"}}}] if block ~ ~-1 ~ #ex:sapling_plantable_on run function ex:generate/structures/small_bush
# 死云杉树
execute as @s[nbt={Item:{tag:{ex_generate_type:"dead_spruce"}}}] if block ~ ~-1 ~ #ex:sapling_plantable_on run function ex:generate/structures/dead_spruce
# 农作物
execute as @s[nbt={Item:{tag:{ex_generate_type:"crops"}}}] if block ~ ~-1 ~ minecraft:grass_block run function ex:generate/structures/crops
# 花草
execute as @s[nbt={Item:{tag:{ex_generate_type:"modcrops"}}}] run function ex:generate/structures/modcrops
kill @s
</pre>
<pre class="file">ex:generate/structures/enchanting_room</pre>
<pre>
setblock ~ ~20 ~ structure_block{posX:-1,posY:-20,posZ:-1,name:"ex:build/enchanting_room",mode:"LOAD"}
setblock ~ ~21 ~ redstone_block
fill ~ ~20 ~ ~ ~21 ~ air

loot insert ~1 ~5 ~ loot ex:chests/enchanting_room
loot insert ~2 ~5 ~ loot ex:chests/enchanting_room
loot insert ~3 ~5 ~ loot ex:chests/enchanting_room
loot insert ~ ~5 ~1 loot ex:chests/enchanting_room
loot insert ~ ~5 ~2 loot ex:chests/enchanting_room
loot insert ~ ~5 ~3 loot ex:chests/enchanting_room
loot insert ~1 ~5 ~4 loot ex:chests/enchanting_room
loot insert ~2 ~5 ~4 loot ex:chests/enchanting_room
loot insert ~3 ~5 ~4 loot ex:chests/enchanting_room
loot insert ~4 ~5 ~1 loot ex:chests/enchanting_room
loot insert ~4 ~5 ~2 loot ex:chests/enchanting_room
loot insert ~4 ~5 ~3 loot ex:chests/enchanting_room
</pre>
<pre class="file">ex/loot_tables/misc/generate.json</pre>
<pre>
{
    "pools": [
        {
            "rolls": 1,
            "conditions":[
                {
                    "condition": "minecraft:random_chance",
                    "chance": 0.006
                },
                {
                    "condition": "minecraft:location_check",
                    "predicate": {
                        "dimension": "minecraft:overworld"
                    }
                }
            ],
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:firework_star",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{ex_generate_marker:1b,ex_clear:1b,CustomModelData:12970000,ex_generate_type:'enchanting_room'}"
                        }
                    ]
                }
            ]
        },
        {
            "rolls": 1,
            "conditions":[
                {
                    "condition": "minecraft:random_chance",
                    "chance": 0.006
                },
                {
                    "condition": "minecraft:location_check",
                    "predicate": {
                        "dimension": "minecraft:overworld"
                    }
                }
            ],
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:firework_star",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{ex_generate_marker:1b,ex_clear:1b,CustomModelData:12970000,ex_generate_type:'tp_overworld'}"
                        }
                    ]
                }
            ]
        },
        {
            "rolls": 1,
            "conditions":[
                {
                    "condition": "minecraft:random_chance",
                    "chance": 0.006
                },
                {
                    "condition": "minecraft:location_check",
                    "predicate": {
                        "dimension": "minecraft:the_nether"
                    }
                }
            ],
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:firework_star",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{ex_generate_marker:1b,ex_clear:1b,CustomModelData:12970000,ex_generate_type:'tp_the_nether'}"
                        }
                    ]
                }
            ]
        },
        {
            "rolls": 1,
            "conditions":[
                {
                    "condition": "minecraft:random_chance",
                    "chance": 0.006
                },
                {
                    "condition": "minecraft:location_check",
                    "predicate": {
                        "dimension": "ex:flower"
                    }
                }
            ],
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:firework_star",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{ex_generate_marker:1b,ex_clear:1b,CustomModelData:12970000,ex_generate_type:'tp_flower'}"
                        }
                    ]
                }
            ]
        },
        {
            "rolls": 1,
            "conditions":[
                {
                    "condition": "minecraft:random_chance",
                    "chance": 0.09
                },
                {
                    "condition": "minecraft:alternative",
                    "terms": [
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "dimension": "minecraft:overworld"
                            }
                        },
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "dimension": "ex:flower"
                            }
                        }						
                    ]
                }
            ],
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:firework_star",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{ex_generate_marker:1b,ex_clear:1b,CustomModelData:12970000,ex_generate_type:'fruit_tree'}"
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:firework_star",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{ex_generate_marker:1b,ex_clear:1b,CustomModelData:12970000,ex_generate_type:'ore_tree'}"
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:firework_star",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{ex_generate_marker:1b,ex_clear:1b,CustomModelData:12970000,ex_generate_type:'wool_tree'}"
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:firework_star",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{ex_generate_marker:1b,ex_clear:1b,CustomModelData:12970000,ex_generate_type:'sakura_tree'}"
                        }
                    ]
                }
            ]
        },
        {
            "rolls": 1,
            "conditions":[
                {
                    "condition": "minecraft:random_chance",
                    "chance": 0.15
                },
                {
                    "condition": "minecraft:alternative",
                    "terms": [
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "biome": "minecraft:desert"
                            }
                        },
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "biome": "minecraft:desert_hills"
                            }
                        },
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "biome": "minecraft:desert_lakes"
                            }
                        },
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "biome": "minecraft:badlands"
                            }
                        },
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "biome": "minecraft:badlands_plateau"
                            }
                        },
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "biome": "minecraft:modified_badlands_plateau"
                            }
                        },
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "biome": "minecraft:wooded_badlands_plateau"
                            }
                        },
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "biome": "minecraft:modified_wooded_badlands_plateau"
                            }
                        },
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "biome": "minecraft:eroded_badlands"
                            }
                        }
                    ]
                }
            ],
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:firework_star",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{ex_generate_marker:1b,ex_clear:1b,CustomModelData:12970000,ex_generate_type:'dead_coral_fan'}"
                        },
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 1,
                                "max": 5
                            }
                        }
                    ]
                }
            ]
        },
        {
            "rolls": 1,
            "conditions":[
                {
                    "condition": "minecraft:random_chance",
                    "chance": 0.1
                },
                {
                    "condition": "minecraft:alternative",
                    "terms": [
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "dimension": "minecraft:overworld"
                            }
                        },
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "dimension": "ex:flower"
                            }
                        }						
                    ]
                }
            ],
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:firework_star",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{ex_generate_marker:1b,ex_clear:1b,CustomModelData:12970000,ex_generate_type:'small_bush'}"
                        }
                    ]
                }
            ]
        },
        {
            "rolls": 1,
            "conditions":[
                {
                    "condition": "minecraft:random_chance",
                    "chance": 0.08
                },
                {
                    "condition": "minecraft:alternative",
                    "terms": [
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "biome": "minecraft:taiga"
                            }
                        },
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "biome": "minecraft:taiga_hills"
                            }
                        },
                        {
                            "condition": "minecraft:location_check",
                            "predicate": {
                                "biome": "minecraft:taiga_mountains"
                            }
                        }
                    ]
                }
            ],
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:firework_star",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{ex_generate_marker:1b,ex_clear:1b,CustomModelData:12970000,ex_generate_type:'dead_spruce'}"
                        },
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 1,
                                "max": 4
                            }
                        }
                    ]
                }
            ]
        },
        {
            "rolls": 1,
            "conditions":[
                {
                    "condition": "minecraft:random_chance",
                    "chance": 0.04
                },
                {
                    "condition": "minecraft:location_check",
                    "predicate": {
                        "dimension": "minecraft:overworld"
                    }
                }
            ],
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:firework_star",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{ex_generate_marker:1b,ex_clear:1b,CustomModelData:12970000,ex_generate_type:'crops'}"
                        },
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 1,
                                "max": 4
                            }
                        }
                    ]
                }
            ]
        },
        {
            "rolls": 1,
            "conditions":[
                {
                    "condition": "minecraft:random_chance",
                    "chance": 0.5
                },
                {
                    "condition": "minecraft:location_check",
                    "predicate": {
                        "dimension": "ex:flower"
                    }
                }
            ],
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:firework_star",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{ex_generate_marker:1b,ex_clear:1b,CustomModelData:12970000,ex_generate_type:'modcrops'}"
                        }
                    ]
                }
            ]
        }
    ]
}
</pre>
<p>注意在扩散标记物时，当下方为草等方块时，需要将其向下移动以避免结构悬空生成。</p>
<p>我们可以将所有维度的结构标记物均放置在同一战利品表内。</p>
<p>另一种生成为全局替换，例如将主世界的地牢刷怪笼一部分替换为苦力怕刷怪笼，那么在每次检测时，使用 <code>fill</code> 命令强制替换即可。但是该命令开销很大，会导致较大的卡顿。</p>

<h2 id="§12.2_绘制图案">§12.2 绘制图案</h2>
<h2 id="§12.3_循环和递归">§12.3 循环和递归</h2>
<h2 id="§12.4_字符操作">§13.4 字符操作</h2>
<h2 id="§12.5_位运算与种子">§12.5 位运算与种子</h2>


</article>
</div>

</body></html>