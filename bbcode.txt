[postbg]bg2.png[/postbg]
[index]
[#1]§1 预备知识
[#2]§2 数据包
[#3]§3 资源包
[#4]§4 规划
[#5]§5 物品设计
[#6]§6 方块设计
[#7]§7 合成与烧炼
[#8]§8 机器设计
[#9]§9 NBT合成与烧炼
[#10]§10 植物 (WIP)
[#11]§11 物品与实体处理
[#12]§12 世界生成 (WIP)
[#13]§13 算法 (WIP)
[/index]
[align=center][url=https://ruhuasiyu.github.io/VanillaModToturial/][img]https://ruhuasiyu.github.io/VanillaModToturial/items/banner.png[/img][/url][/align]
[align=center][size=32px][b]原版模组入门教程[/b][/size][/align]
　　本文适用 Minecraft Java 版 1.13 及更高版本，部分内容仅适用于部分版本。系统环境为 Windows10，其它环境下有较小的差异。本文参考和吸取了大量其他玩家的意见、建议、教程等。有任何错误和疑问请联系我，谢谢！
　　原版模组一般指在不修改 Minecraft 游戏本体的前提下，通过命令方块、一键命令、数据包、资源包等方式对游戏的可玩性做出修改。而自 Minecraft Java 版 1.13 起的数据包概念问世之后，原版模组的制作已变得十分便捷。因此我将为大家做一个简单的入门，以期抛砖引玉。
　　编写进度：§1-§9.4 (2019/12/05)

[size=5][b]§1 预备知识[/b][/size]
　　部分段落常为部分读者所熟知，若如此可直接跳至自己所需段落。对于首次接触者，请耐心阅读。
[size=4][b]§1.1 新人指引[/b][/size]
　　本文并非命令的入门教程，不会对命令部分做过多的详解。若你对命令尚不了解，可先依次通过如下链接学习并了解：
[list]
[*][b]命令手册[/b]
[list]
[*][url=https://minecraft-zh.gamepedia.com/命令]命令 - Minecraft Wiki，最详细的官方我的世界百科[/url]
[*][url=https://commandtutorials.neocities.org/]新人手册-MC命令方块资源[/url]
[*][url=http://mc-command.oschina.io/command-tutorial/]命令进阶[/url]
[/list][*][b]记分板和nbt手册[/b]
[list]
[*][url=https://minecraft-zh.gamepedia.com/记分板]记分板 - Minecraft Wiki，最详细的官方我的世界百科[/url]
[*][url=https://minecraft-zh.gamepedia.com/区块格式]区块格式 - Minecraft Wiki，最详细的官方我的世界百科[/url]
[*][url=https://minecraft-zh.gamepedia.com/Player.dat格式]Player.dat格式 - Minecraft Wiki，最详细的官方我的世界百科[/url]
[/list][/list]　　可先熟悉各项命令后，再学习记分板和nbt相关命令。实体和方块nbt亦可通过在游戏中使用 [font=Verdana]data get entity/block[/font] 命令来获取，以避免记忆大量的nbt。
　　若你已对1.12或以下的命令较为熟悉，可直接查看[url=https://minecraft-zh.gamepedia.com/1.13]1.13页面[/url]、[url=https://minecraft-zh.gamepedia.com/1.14]1.14页面[/url]、[url=https://minecraft-zh.gamepedia.com/1.15]1.15页面[/url]了解命令改动之处。
[size=4][b]§1.2 工具准备[/b][/size]
[size=3][b]§1.2.1 文本编辑器[/b][/size]
　　我们所涉及的所有文本文件，包括函数文件(.mcfunction)、JSON文件(.json, .mcmeta)，均需使用 [font=Verdana]UTF-8[/font] 编码格式。以下列出的文本编辑器默认均为 [font=Verdana]UTF-8[/font] 编码，可以在编辑页面的右下角状态栏看到。
[list]
[*][b][url=https://code.visualstudio.com/]VS Code[/url][/b] 下载安装后，可以安装如下插件：
[list]
[*][i]Chinese (Simplified) Language Pack for Visual Studio Code[/i] 支持中文语言
[*][i]datapack helper plus (JSON)[/i] 支持JSON语法补全和纠错
[*][i]datapack helper plus (MCF)[/i] 支持函数语法补全和纠错
[*][i]language-mcfunction[/i] 支持函数语法高亮
[/list][*][b]记事本[/b] 为 Windows 系统自带。Windows10 的记事本已经默认是 [font=Verdana]UTF-8[/font] 编码了。点击[font=Verdana]查看->状态栏[/font]可以在右下角状态栏看到，因此可以正常使用。旧版本 Windows 的记事本仍然不是，请勿使用。
[*][b][url=https://notepad-plus-plus.org/]Notepad++[/url][/b] 可从 [url=http://www.mcbbs.net/thread-806816-1-1.html]mcfunction 的语言样式和自动补全[/url]帖中下载相关文件并导入，另外请将 Notepad++ 中[font=Verdana]设置->首选项->其它->自动检测字符编码[/font]选项关闭。
[/list]　　右下角也可以看到 [font=Verdana]LF[/font] 或 [font=Verdana]CRLF[/font]，分别表示两种换行符，二者均可正常使用，建议使用 [font=Verdana]LF[/font]。
　　注意不要误选了 [font=Verdana]UTF-8 with BOM[/font] 格式。
[size=3][b]§1.2.2 压缩工具[/b][/size]
　　数据包和资源包均可以为文件夹或 zip 压缩文件格式。游戏本体和模组本体的 jar 文件也需要压缩工具来打开。
[list]
[*][b]Windows 资源管理器[/b] Windows10 系统自带 zip 格式的压缩和解压缩。zip 格式可以直接打开，压缩则用[font=Verdana]选择->右键->发送到->压缩文件夹[/font]。
[*][b][url=http://www.7-zip.org/]7-zip[/url][/b] 免费软件。
[*][b]winrar[/b] 付费软件。
[/list]　　jar 文件可以通过重命名为 zip 文件直接用 Windows 资源管理器打开。显然，这不如[font=Verdana]右键->7-zip->打开压缩包[/font]方便。
[size=3][b]§1.2.3 NBT编辑器[/b][/size]
　　推荐使用 [url=http://www.mcbbs.net/thread-735265-1-1.html]nbtexplorer[/url] 来打开 dat 和其它 nbt 格式文件。
[size=3][b]§1.2.4 绘图工具[/b][/size]
　　推荐使用 Photoshop 或其它绘图工具，而非 Windows 自带的画图，来绘制材质。
[size=4][b]§1.3 文件结构[/b][/size]
　　本节中我们将对各个主要的文件夹结构和文件做简单的介绍。为便于查看文件后缀，请将[font=Verdana]文件->文件夹选项->查看->隐藏已知文件类型的扩展名[/font]选项去掉勾选。其中可以使用文本编辑器打开的文件可通过新建文本文件并修改后缀来创建。
[size=3][b]§1.3.1 游戏文件结构[/b][/size]
　　打开 [font=Verdana].minecraft[/font] 所在的文件夹，这通常位于你的启动器目录下。如果启动器中设置为各版本独立，则类似的文件结构位于 [font=Verdana]versions/版本号[/font]下。
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]文件[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]文件位置[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]说明[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]资源文件索引[/b][/align][/color][/td][td][font=Verdana]assets/indexes/[版本号].json[/font][/td][td=1,2]从[font=Verdana]minecraft/lang/zh_cn.json[/font]的 hash 值可知中文语言文件位置，找到后使用文本编辑器打开。其它资源文件也可以类似寻找并用相应软件打开。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]资源文件[/b][/align][/color][/td][td][font=Verdana]assets/objects/[hash开头]/[hash][/font][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]备份文件[/b][/align][/color][/td][td][font=Verdana]backups/[日期-世界名称].zip[/font][/td][td]使用压缩工具打开，为存档的备份文件。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]崩溃报告[/b][/align][/color][/td][td][font=Verdana]crash-reports/[日期].txt[/font][/td][td]使用文本编辑器打开，如果是由于资源包或数据包引起的崩溃，可以在该文件中看到原因。[/td][/tr]
[tr=#FFFFFF][td=1,2][color=#000000][align=center][b]日志[/b][/align][/color][/td][td][font=Verdana]logs/[日期].log.gz[/font][/td][td]历史日志，使用压缩工具打开，然后使用文本编辑器打开。[/td][/tr]
[tr=#FFFFFF][td][font=Verdana]logs/latest.log[/font][/td][td]使用文本编辑器打开，当前日志，可随时查看加载资源包和数据包时的错误信息，包括错误的文件名称、位置、错误的行列数等。[/td][/tr]
[tr=#FFFFFF][td=1,2][color=#000000][align=center][b]资源包[/b][/align][/color][/td][td][font=Verdana]resourcepacks/[资源包名][/font][/td][td=1,2]zip格式的使用压缩工具打开，具体结构见 [url=#§3_资源包]§3 资源包[/url]。[/td][/tr]
[tr=#FFFFFF][td][font=Verdana]resourcepacks/[资源包名].zip[/font][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]存档文件[/b][/align][/color][/td][td][font=Verdana]saves/[世界名称][/font][/td][td]具体结构见 [url=#§1.3.2_存档文件结构]§1.3.2 存档文件结构[/url]。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]游戏截图[/b][/align][/color][/td][td][font=Verdana]screenshots/[日期].png[/font][/td][td]使用图片查看工具打开。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]服务器资源包[/b][/align][/color][/td][td][font=Verdana]server-resource-packs/[服务器][/font][/td][td]使用压缩工具打开，具体结构见 [url=#§3_资源包]§3 资源包[/url]。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]存储的物品栏[/b][/align][/color][/td][td][font=Verdana]hotbar.nbt[/font][/td][td]使用 NBT 编辑器打开，游戏内使用[font=Verdana]C+[数字][/font]存储、[font=Verdana]X+[数字][/font]取出的创造模式的物品快捷栏。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]游戏设置[/b][/align][/color][/td][td][font=Verdana]options.txt[/font][/td][td]使用文本编辑器打开，可直接设置游戏内快捷键、音量、视距等选项。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]服务器[/b][/align][/color][/td][td][font=Verdana]servers.dat[/font][/td][td]使用 NBT 编辑器打开，包含服务器信息。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]玩家缓存[/b][/align][/color][/td][td][font=Verdana]usercache.json[/font][/td][td]使用文本编辑器打开，为服务器玩家登录名和 UUID 对应。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]玩家名缓存[/b][/align][/color][/td][td][font=Verdana]usernamecache.json[/font][/td][td]使用文本编辑器打开，为单机玩家登录名和 UUID 对应。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]游戏本体[/b][/align][/color][/td][td][font=Verdana]versions/[版本号]/[版本号].jar[/font][/td][td]使用 NBT 编辑器打开，包含了对应版本的资源和数据文件，[font=Verdana]assets[/font] 结构见 [url=#资源包]§3 资源包[/url]，[font=Verdana]data[/font] 结构见 [url=#数据包]§2 数据包[/url]。[/td][/tr]
[/table]
[align=center][img]https://ruhuasiyu.github.io/VanillaModToturial/items/游戏本体文件结构.png[/img][/align]
[align=center][font=楷体,楷体_GB2312]图1.1 游戏本体文件结构[/font][/align]
[size=3][b]§1.3.2 存档文件结构[/b][/size]
　　位于[font=Verdana].minecraft/saves/[世界名称][/font]。
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]文件[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]文件位置[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]说明[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]进度[/b][/align][/color][/td][td][font=Verdana]advancements/[玩家 UUID].json[/font][/td][td]使用文本编辑器打开，记录了玩家已完成的进度和进度判据的完成时间。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]存储区[/b][/align][/color][/td][td][font=Verdana]data/command_storage_[命名空间].json[/font][/td][td]使用 NBT 编辑器打开，记录了玩家和函数存储在存储区 (storage) 的 NBT。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]地图数[/b][/align][/color][/td][td][font=Verdana]data/idcounts.json[/font][/td][td]使用文本编辑器打开，记录了当前已使用的地图数量，游戏内新使用的空地图会由此开始计数。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]地图[/b][/align][/color][/td][td][font=Verdana]map_[数字].txt[/font][/td][td]使用 NBT 编辑器打开，记录了地图 [font=Verdana]filled_map{data:[数字]}[/font] 的信息。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]记分板[/b][/align][/color][/td][td][font=Verdana]scoreboard.txt[/font][/td][td]使用 NBT 编辑器打开，记录了记分板、记分板的值、组。[/td][/tr]
[tr=#FFFFFF][td=1,3][color=#000000][align=center][b]袭击[/b][/align][/color][/td][td][font=Verdana]raids.txt[/font][/td][td=1,3]使用 NBT 编辑器打开，记录了袭击的信息。[/td][/tr]
[tr=#FFFFFF][td][font=Verdana]DIM-1/data/raids_nether.txt[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]DIM1/data/raids_end.txt[/font][/td][/tr]
[tr=#FFFFFF][td=1,2][color=#000000][align=center][b]数据包[/b][/align][/color][/td][td][font=Verdana]datapacks/[数据包名][/font][/td][td=1,2]zip格式的使用压缩工具打开，具体结构见 [url=#datapack]§2 数据包[/url]。[/td][/tr]
[tr=#FFFFFF][td][font=Verdana]datapacks/[数据包名].zip[/font][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]主世界区块[/b][/align][/color][/td][td][font=Verdana]region/r.[数值].[数值].mca[/font][/td][td=1,3]使用 NBT 编辑器打开，每32×32个区块存储为一个文件。建议使用 MCEdit 等工具来编辑。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]下界区块[/b][/align][/color][/td][td][font=Verdana]DIM-1/r.[数值].[数值].mca[/font][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]末地区块[/b][/align][/color][/td][td][font=Verdana]DIM1/r.[数值].[数值].mca[/font][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]统计[/b][/align][/color][/td][td][font=Verdana]stats/[玩家UUID].json[/font][/td][td]使用文本编辑器打开，记录了玩家的统计信息。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]属性[/b][/align][/color][/td][td][font=Verdana]playerdata/[玩家UUID].dat[/font][/td][td]使用 NBT 编辑器打开，记录了玩家的位置、复活点、飞行速度等。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]世界信息[/b][/align][/color][/td][td][font=Verdana]level.dat[/font][/td][td]使用 NBT 编辑器打开，记录了种子、生成类型、难度、出生点、世界边界、游戏规则等内容。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]结构[/b][/align][/color][/td][td][font=Verdana]generated/[命名空间]/structures/[文件].nbt[/font][/td][td]使用 NBT 编辑器打开，记录了游戏内使用结构方块保存的结构，将其移动至数据包内方可使用。[/td][/tr]
[/table]
[size=3][b]§1.4 JSON文件[/b][/size]
　　数据包的进度、战利品表、标签、断言、配方，资源包的语言文件、模型等文件均为JSON格式文件。[font=Verdana].mcmeta[/font] 文件也是JSON文件，因此格式也是相同的。编写时，使用空格或制表符(Tab)缩进，以便于查看括号匹配和层次。wiki 上有关页面使用了 NBT 的数据类型标注，但其实并不适用于JSON格式。
　　JSON文件包括一对根括号{}，包含类似 [font=Verdana]"abc":"def"[/font] ([font=Verdana]键:值[/font])的对。相同的键后者会覆盖前者。键为需引号圈住的字符串，值的数据类型为
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]数据类型[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]示例[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]说明[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]布尔型[/b][/align][/color][/td][td][list]
[*][font=Verdana]"is_on_fire": false[/font]
[*][font=Verdana]"is_baby": true[/font]
[/list][/td][td]值为[font=Verdana]true[/font]和[font=Verdana]false[/font]。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]数值[/b][/align][/color][/td][td][list]
[*][font=Verdana]"count": 2[/font]
[*][font=Verdana]"chance": 0.025[/font]
[/list][/td][td]2和2.0没有效果上的差异。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]字符串[/b][/align][/color][/td][td][list]
[*][font=Verdana]"item": "minecraft:shears"[/font]
[*][font=Verdana]"condition": "minecraft:match_tool"[/font]
[*][font=Verdana]"layer0": "cpp:crop/bauhinia_seeds"[/font]
[*][font=Verdana]"description": "§6更多的合成 1.10\n§6by ruhuasiyu"[/font]
[/list][/td][td]使用双引号圈住，可以使用颜色代码如§6、换行符\n。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]列表[/b][/align][/color][/td][td][list]
[*][font=Verdana]"chances": [0.05, 0.0625, 0.083333336, 0.1][/font]
[*][font=Verdana]"items": [
    {"item": "minecraft:zombie_head"},
    {"item": "minecraft:skeleton_skull"},
    {"item": minecraft:wither_skeleton_skull"},
    {"item": "minecraft:creeper_head"}
][/font]
[*][font=Verdana]"requirements":[
    ["wing_of_sky", "heart_of_crystal", "nova_of_fire"]
][/font]
[/list][/td][td]使用中括号圈住。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]JSON对象[/b][/align][/color][/td][td][list]
[*][font=Verdana]"count": { "min": 1, "max": 2 }[/font]
[*][font=Verdana]"modifiers": [
    {
        "name": "legs_armor",
        "attribute": "generic.armor",
        "operation": "addition",
        "amount": 4,
        "slot": "legs"
    }
][/font]
[/list][/td][td]使用大括号圈住。整个JSON文件内容本身就是一个JSON对象。[/td][/tr]
[/table]

[page]
[size=5][b]§2 数据包[/b][/size]
　　数据包文件层次为
[table]
[tr=#C0C0C0][td][font=Verdana]datapacks/数据包名称或数据包名称.zip/[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]pack.mcmeta
data
    命名空间
        advancements
        functions
        loot_tables
        predicates
        recipes
        structures
        tags
            blocks
            items
            fluids
            functions
            entity_types
[/font][/td][/tr]
[/table]
　　[font=Verdana]data[/font] 下所有文件和文件夹需使用小写英文、数字或-,_来命名，[b]不可使用大写字母[/b]，所有文本文件使用 [font=Verdana]UTF-8[/font] 编码。数据包可以为文件夹格式或 zip 格式，发布时可将所有内容压缩为一个 zip 文件。压缩和解压的时候，注意文件层次，应当打开 zip 文件就可以看到数据包的 pack.mcmeta 和 data 文件夹。稳妥的做法是[font=Verdana]打开文件夹->全选->右键->发送到->压缩文件夹[/font]。游戏内输入 [font=Verdana]/datapack list[/font] 可以列出所有的数据包。
　　[b]原版数据包 (Vanilla)[/b] 是 Minecraft 自带的一个默认开启的数据包，其 [font=Verdana]data[/font] 文件夹位于 [font=Verdana].minecraft/versions/版本号/版本号.jar/data[/font]。其中包含的原版进度、配方、结构、战利品表等内容，是制作数据包的文件样板。
[size=4][b]§2.1 元信息[/b][/size]
Minecraft 通过文件 [font=Verdana]pack.mcmeta[/font] 来识别数据包，因此该文件是不可或缺的。例如：
[table]
[tr=#C0C0C0][td][font=Verdana]pack.mcmeta[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pack": {
        "pack_format": 4,
        "description": "§6数据包名称\n§a简要介绍 §6by 某某作者"
    }
}
[/font][/td][/tr]
[/table]
其中
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]含义[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]键[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]说明[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]数据包版本[/b][/align][/color][/td][td][font=Verdana]pack_format[/font][/td][td]1.13-1.15 版本为 4。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]数据包描述[/b][/align][/color][/td][td][font=Verdana]description[/font][/td][td]单个字符串或一个[url=https://minecraft-zh.gamepedia.com/命令#.E5.8E.9F.E5.A7.8BJSON.E6.96.87.E6.9C.AC]原始JSON文本[/url]。在输入 [font=Verdana]/datapack list[/font] 命令后，鼠标移至数据包名称上会显示 [font=Verdana]description[/font] 信息。[/td][/tr]
[/table]
[size=4][b]§2.2 命名空间[/b][/size]
　　命名空间 (namespace) 为玩家自定义的、可操作的空间。使用独立的命名空间也有利于解决和他人的冲突。数据包下可以有多个命名空间，如果不同数据包中有相同的命名空间，则其中相同的文件名内容会根据加载先后顺序被覆盖。特别地，原版内容被保存在 [font=Verdana]minecraft[/font] 命名空间，想要修改和替换原版的内容只需在你的数据包内建立 [font=Verdana]minecraft[/font] 命名空间和相应的同名文件并修改即可。
　　标签文件，即 [font=Verdana]tags[/font] 中的文件内容默认追加而不是覆盖。因此标签文件是解决数据包冲突和联动的有力工具。
　　数据包加载顺序并不固定，因此不要在不同数据包中同一命名空间下使用相同的文件名。原版 [font=Verdana]minecraft[/font] 下内容总是最先被加载。可以在游戏内通过手动开启/关闭来调整加载次序，但不建议如此做。
　　进度、战利品表、函数、结构、标签、断言等文件的调用格式均为[font=Verdana]命名空间:文件夹/文件名[/font]对应[font=Verdana]命名空间/xxx/文件夹/文件名.后缀[/font]文件，[font=Verdana]xxx[/font] 为 [font=Verdana]advancements, loot_tables, functions, strutures, tags/blocks, tags/items[/font] 等。
若命名空间为 [font=Verdana]minecraft[/font]，则可直接省略 [font=Verdana]minecraft:[/font]。本文中我们会混用两种写法，注意区分。
[size=4][b]§2.3 进度[/b][/size]
　　可参考
[list]
[*][url=http://www.mcbbs.net/thread-685310-1-1.html]【烯方的那一套理论】猴子都能学会的自定义advancement！[/url]
[*][url=https://minecraft-zh.gamepedia.com/%E8%BF%9B%E5%BA%A6]进度 - Minecraft Wiki，最详细的官方我的世界百科[/url]
[/list]　　进度 (advancements) 为游戏内检测玩家行为，触发后完成进度并执行奖励的系统，游戏内按 L 即可查看。进度文件为JSON文件，文件夹 [font=Verdana]data/[命名空间]/advancements[/font] 或子文件夹下每一个 [font=Verdana]root.json[/font] 文件都对应一个进度页面选项卡，因此可通过文件夹来分离不同的选项卡。例如：
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/advancements/root.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "display": {
        "icon": {
            "item": "minecraft:carrot_on_a_stick",
            "nbt": "{CustomModelData:12970010}"
        },
        "title":{
            "translate": "advancements.cpp.root.title"
        },
        "description": {
            "translate": "advancements.cpp.root.description"
        },
        "frame": "goal",
        "background": "cpp:bg.png"
    },
    "criteria": {
        "dream_wand": {
            "trigger": "minecraft:inventory_changed",
            "conditions":{
                "items":[
                    {
                        "nbt":"{id:'cpp:dream_wand'}"
                    }
                ]
            }
        }
    },
    "rewards": {
        "function": "cpp:adv/root",
        "recipes": ["minecraft:crafting_table","cpp:strange_block"],
        "experience": 200
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/advancements/mahoushoujo.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "cpp:root",
    "display": {
        "icon": {
            "item": "minecraft:carrot_on_a_stick",
            "nbt":"{CustomModelData:12970062}"
        },
        "title":{
            "translate": "advancements.cpp.mahoushoujo.title"
        },
        "description": {
            "translate": "advancements.cpp.mahoushoujo.description"
        },
        "frame": "challenge"
    },
    "criteria": {
        "mahoushoujo": {
            "trigger": "minecraft:inventory_changed",
            "conditions":{
                "items":[
                    {
                        "nbt":"{id:'cpp:sealing_wand'}"
                    }
                ]
            }
        },
        "dream_wand": {
            "trigger": "minecraft:inventory_changed",
            "conditions":{
                "items":[
                    {
                        "nbt":"{id:'cpp:dream_wand'}"
                    }
                ]
            }
        }
    },
    "rewards":{
        "experience": 100
    },
    "requirements": [
        [
            "mahoushoujo",
            "dream_wand"
        ]
    ]
}[/font][/td][/tr]
[/table]
其中
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]含义[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]层次和键[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]说明[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]父进度[/b][/align][/color][/td][td][font=Verdana]parent[/font][/td][td]仅除根进度外的进度有。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]显示效果[/b][/align][/color][/td][td][font=Verdana]display[/font][/td][td]若无，则该进度不会出现在进度页面。 [/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]图标[/b][/align][/color][/td][td][font=Verdana]display.icon[/font][/td][td]这里为胡萝卜钓竿的自定义物品模型。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]图标物品ID[/b][/align][/color][/td][td][font=Verdana]display.item[/font][/td][td]这里为胡萝卜钓竿。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]图标物品NBT[/b][/align][/color][/td][td][font=Verdana]display.nbt[/font][/td][td]物品的材质模型可能会根据 NBT 不同而不同。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]标题[/b][/align][/color][/td][td][font=Verdana]display.title[/font][/td][td]进度的名称，可以是单个字符串或一个[url=https://minecraft-zh.gamepedia.com/命令#.E5.8E.9F.E5.A7.8BJSON.E6.96.87.E6.9C.AC]原始JSON文本[/url]，样例中 [font=Verdana]translate[/font] 文本是会随着语言改变的文本，参考 [url=thread-784662-1-1.html?cp=3]§3 资源包[/url]。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]描述[/b][/align][/color][/td][td][font=Verdana]display.description[/font][/td][td]格式同上。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]边框[/b][/align][/color][/td][td][font=Verdana]display.frame[/font][/td][td]分为 [font=Verdana]task[/font](任务 方形边框)，[font=Verdana]challenge[/font](挑战 尖形边框)，[font=Verdana]goal[/font](目标 圆形边框)。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]背景[/b][/align][/color][/td][td][font=Verdana]display.background[/font][/td][td]仅根进度有，决定该选项卡的背景图，为资源包内图片引用，参考 [url=thread-784662-1-1.html?cp=3]§3.6 材质[/url]，这里为资源包中图片文件 [font=Verdana]cpp/textures/bg.png[/font]。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]判据[/b][/align][/color][/td][td][font=Verdana]criteria[/font][/td][td]其下为判据名称、触发器和触发器的条件，判据可以有多个。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]奖励[/b][/align][/color][/td][td][font=Verdana]rewards[/font][/td][td]完成进度后的效果。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]奖励函数[/b][/align][/color][/td][td][font=Verdana]rewards.function[/font][/td][td]完成进度时执行之，不可为函数标签。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]解锁配方[/b][/align][/color][/td][td][font=Verdana]rewards.recipes[/font][/td][td]为配方引用列表。数据包添加的配方也应当有相应进度来解锁，参考[url=recipe]§2.7 配方[/url]。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]奖励经验[/b][/align][/color][/td][td][font=Verdana]rewards.experience[/font][/td][td]建议仅在高难度进度完成时给予。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]判据需求[/b][/align][/color][/td][td][font=Verdana]requirements[/font][/td][td]缺省时默认所有条件都需要满足。格式为或的与(合取范式)，例如 [font=Verdana]"requirements": [["a","b"],["c","d"][font=Verdana] 表示当 [font=Verdana]a[font=Verdana] 和 [font=Verdana]b[font=Verdana] 至少有一个满足且 [font=Verdana]c[/font] 和 [font=Verdana]d[/font] 至少有一个满足时，会成功触发。[/font][/font][/font][/font][/font][/font][/td][/tr]
[/table]　　进度配合奖励函数剥夺玩家该进度，则该进度可反复触发，可用于诸如检测玩家生物群系、饮食等需要循环检测的情形。
　　游戏内或函数内使用 [font=Verdana]advancement[/font] 命令可以手动给予或剥夺进度。
[size=4][b]§2.4 函数[/b][/size]
　　函数 (functions) 为一些命令的集合。函数文件为纯文本文件，后缀为 [font=Verdana]mcfunction[/font]，每一行表示一个单独的命令，无需/开头。执行时会按顺序依次执行，使用 [font=Verdana]#[/font] 开头的行为注释。游戏内或函数内使用 [font=Verdana]function [命名空间]:[路径][/font]命令来依次执行函数的每一条命令。函数还可用于完成进度时的奖励函数。
　　如果需要函数在游戏加载/每刻执行，则需要将其加入函数标签中，参考 [url=thread-784662-1-1.html?cp=2]§2.9.1 预设标签[/url]。
[size=4][b]§2.5 战利品表[/b][/size]
　　战利品表 (loot_tables) 用于实体的掉落物、方块的掉落物、钓鱼、箱子的随机物品等。战利品表文件为JSON文件。例如：
[table]
[tr=#C0C0C0][td][font=Verdana]minecraft/loot_tables/entities/cow.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "type": "minecraft:entity",
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:leather",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 0,
                                "max": 2
                            }
                        },
                        {
                            "function": "minecraft:looting_enchant",
                            "count": {
                                "min": 0,
                                "max": 1
                            }
                        }
                    ]
                }
            ]
        },
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:alternatives",
                    "children": [
                        {
                            "conditions": [
                                {
                                    "condition": "minecraft:entity_properties",
                                    "entity": "this",
                                    "predicate": {
                                        "flags": {
                                            "is_on_fire": false
                                        }
                                    }
                                }
                            ],
                            "type": "minecraft:item",
                            "name": "minecraft:beef",
                            "functions": [
                                {
                                    "function": "minecraft:set_count",
                                    "count": {
                                        "min": 1,
                                        "max": 3
                                    }
                                },
                                {
                                    "function": "minecraft:looting_enchant",
                                    "count": {
                                        "min": 0,
                                        "max": 1
                                    }
                                }
                            ]
                        },
                        {
                            "type": "minecraft:item",
                            "name": "minecraft:cooked_beef",
                            "functions": [
                                {
                                    "function": "minecraft:set_count",
                                    "count": {
                                        "min": 1,
                                        "max": 3
                                    }
                                },
                                {
                                    "function": "minecraft:looting_enchant",
                                    "count": {
                                        "min": 0,
                                        "max": 1
                                    }
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "conditions": [
                {
                    "condition": "minecraft:killed_by_player"
                },
                {
                    "condition": "minecraft:random_chance_with_looting",
                    "chance": 0.025,
                    "looting_multiplier": 0.01
                }
            ],
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:loot_table",
                    "name": "cpp:limb_of_ridge"
                }
            ]
        },
        {
            "conditions": [
                {
                    "condition": "minecraft:killed_by_player"
                },
                {
                    "condition": "minecraft:random_chance_with_looting",
                    "chance": 0.025,
                    "looting_multiplier": 0.01
                }
            ],
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:loot_table",
                    "name": "cpp:cow_head"
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
　　该例子战利品表表示牛死亡时
[list]
[*]掉落 [font=Verdana]0-(2+抢夺等级)[/font]个皮革；
[*]掉落 [font=Verdana]1-(3+抢夺等级)[/font]个牛肉，着火则掉落熟牛肉；
[*]被玩家杀死时，有 [font=Verdana](2.5+抢夺等级)%[/font] 几率掉落战利品表 [font=Verdana]cpp:limb_of_ridge[/font] 的物品；
[*]被玩家杀死时，有 [font=Verdana](2.5+抢夺等级)%[/font] 几率掉落战利品表 [font=Verdana]cpp:cow_head[/font] 的物品；
[/list]　　完整格式可参考
[list]
[*][url=http://www.mcbbs.net/thread-619468-1-1.html][CBL∫2b]Loottable - 创造一个看脸讲玄的世界 总索引[/url]
[*][url=http://www.mcbbs.net/thread-831542-1-1.html]【CBL｜SPG】［1.14］战利品表：从入门到重新入门[/url]
[*][url=https://minecraft-zh.gamepedia.com/战利品表]战利品表 - Minecraft Wiki，最详细的官方我的世界百科[/url]
[*][url=thread-914817-1-4.html]【CBL|SPG】[1.15] 新出的断言是什么东西[/url]
[/list]　　[font=Verdana]minecraft[/font] 命名空间下记录了实体的默认掉落物、方块的掉落物、钓鱼和箱子战利品的战利品表，玩家可通过 [font=Verdana]jar[/font] 文件查看其文件结构。若要修改这些内容，在数据包中创建 [font=Verdana]minecraft[/font] 命名空间以及同名文件来覆盖之。
　　战利品表可以以如下等方式调用
[list]
[*][font=Verdana]setblock ~ ~ ~ minecraft:chest{LootTable:"cpp:chests/something"}[/font]
[*][font=Verdana]give @s minecraft:chest{BlockEntityTag:{LootTable:"cpp:chests/something"}}[/font]
[*][font=Verdana]summon minecraft:bat ~ ~ ~ {DeathLootTable:"cpp:entities/something"}[/font]
[*][font=Verdana]loot spawn ~ ~ ~ loot cpp:something[/font]
[/list]　　战利品表除上述常规用途外，还可用于
[list]
[*]生成随机数，见[url=thread-900914-1-1.html]战利品表随机数[/url]。
[*]修改玩家背包物品，见[url=thread-879073-1-1.html]戴帽子[/url]、[url=thread-860954-1-1.html]修改玩家背包物品信息[/url]。
[*]将特定物品输出至容器内，见[url=thread-898170-1-1.html]物品分类器[/url]。
[*]指定自定义机器的配方，见[url=thread-784662-1-1.html?cp=7]§7.5 配方处理[/url]。
[/list]
我们经常会用到通过修改潜影盒战利品表，然后使用 [font=Verdana]loot[/font] 命令来将不定的物品输入到玩家背包或容器中。
[table]
[tr=#C0C0C0][td][font=Verdana]minecraft/loot_tables/blocks/shulker_box.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "type": "minecraft:block",
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:alternatives",
                    "children": [
                        {
                            "type": "minecraft:dynamic",
                            "name": "minecraft:contents",
                            "conditions": [
                                {
                                    "condition": "minecraft:match_tool",
                                    "predicate": {
                                        "nbt":"{isShulkerMarker:1b}"
                                    }
                                }
                            ]
                        },
                        {
                            "type": "minecraft:item",
                            "functions": [
                                {
                                    "function": "minecraft:copy_name",
                                    "source": "block_entity"
                                },
                                {
                                    "function": "minecraft:copy_nbt",
                                    "source": "block_entity",
                                    "ops": [
                                        {
                                            "source": "Lock",
                                            "target": "BlockEntityTag.Lock",
                                            "op": "replace"
                                        },
                                        {
                                            "source": "LootTable",
                                            "target": "BlockEntityTag.LootTable",
                                            "op": "replace"
                                        },
                                        {
                                            "source": "LootTableSeed",
                                            "target": "BlockEntityTag.LootTableSeed",
                                            "op": "replace"
                                        }
                                    ]
                                },
                                {
                                    "function": "minecraft:set_contents",
                                    "entries": [
                                        {
                                            "type": "minecraft:dynamic",
                                            "name": "minecraft:contents"
                                        }
                                    ]
                                }
                            ],
                            "name": "minecraft:shulker_box"
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
[size=4][b]§2.6 断言[/b][/size]
　　断言 (predicate) 可以认为是战利品中的条件。断言文件为JSON文件，可用于
[list]
[*]命令 [font=Verdana]execute (if|unless) predicate foo:bar[/font]
[*]实体选择器参数 [font=Verdana]predicate={foo:bar}[/font]
[*]战利品表条件
[/list]　　可参考[url=thread-914817-1-4.html]【CBL|SPG】[1.15] 新出的断言是什么东西[/url]。例如
[list]
[*]判断某个物品是否属于某个物品标签，将物品复制到盔甲架主手，然后判断是否满足相应断言即可。
[*]按一定概率执行命令，使用 [font=Verdana]minecraft:random_chance[/font] 即可。
[/list]　　诸如此类，虽然以前也可以通过在相应位置执行对应的带条件的战利品表执行，但用断言无疑方便更多。
[size=4][b]§2.7 配方[/b][/size]
　　配方 (recipes) 包括工作台合成、切石机合成、熔炉烧炼、高炉烧炼、烟熏炉烧炼、营火烧炼，[b]不支持带 nbt 标签[/b]。配方文件为JSON文件，具体格式见 [url=thread-784662-1-1.html?cp=7]§7 合成与烧炼[/url]。想要实现带NBT的合成需要藉由其它方式，见 [url=thread-784662-1-1.html?cp=9]§9 NBT合成与烧炼[/url]。
　　在默认情形(限制配方关闭)下，玩家总是可以使用所有的配方，但是未获得的不会在配方书中显示，因此建议为你的自定义配方添加合适的进度来获取该配方。
[size=4][b]§2.8 结构[/b][/size]
　　结构 (structures) 文件为NBT文件，后缀为 [font=Verdana]nbt[/font]。结构存储了一个长方体区域的方块和实体信息，玩家可以创建、保存、调用这样的结构。结构大小一般至多为[font=Verdana]32×32×32[/font]。可参考
[list]
[*][url=http://www.mcbbs.net/thread-652937-1-1.html]建筑党也能愉快享用结构方块-图文并茂教会你使用结构方块[/url]
[*][url=http://www.mcbbs.net/thread-801350-1-1.html]如何使用结构方块[/url]
[*][url=https://minecraft-zh.gamepedia.com/结构方块]结构方块 - Minecraft Wiki，最详细的官方我的世界百科[/url]
[/list]　　在游戏中获得结构方块后，放置好所需要的方块结构和实体，然后放置结构方块，设置为保存模式，调整好大小，输入名称，点保存即可（注意区分是否需要实体）。然后从 [font=Verdana]generated[/font] 文件夹复制到数据包内，在结构方块中输入[font=Verdana]命名空间:文件夹/文件[/font]格式加载（注意区分是否需要实体）。
　　我们也可以在函数中加载，先放置结构方块，然后放置并清除红石块即可。这个技巧配合战利品表和断言，可用于随机在世界生成结构。例如：
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/functions/generate/enchanting_room.mcfunction[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]setblock ~ ~ ~ minecraft:structure_block{posX:-1,posY:0,posZ:-1,name:"cpp:build/enchanting_room",mode:"LOAD"}
setblock ~ ~1 ~ minecraft:redstone_block
setblock ~ ~1 ~ minecraft:air
[/font][/td][/tr]
[/table]
[size=4][b]§2.9 标签[/b][/size]
　　标签 (tags) 文件为JSON文件，根据子文件夹不同分为5种。Minecraft 中有很多内容都叫做标签，注意区分它们。
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]类别[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]文件路径[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]用途[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]方块标签[/b][/align][/color][/td][td][font=Verdana]tags/blocks/[文件名].json[/font][/td][td]用于在命令、进度、战利品表中检测/调用多个方块。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]物品标签[/b][/align][/color][/td][td][font=Verdana]tags/items/[文件名].json[/font][/td][td]用于在命令、进度、战利品表中检测/调用多个物品。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]函数标签[/b][/align][/color][/td][td][font=Verdana]tags/functions/[文件名].json[/font][/td][td]用于在 [font=Verdana]function[/font] 命令中一次性按次序执行多个函数。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]实体类型标签[/b][/align][/color][/td][td][font=Verdana]tags/entity_types/[文件名].json[/font][/td][td]用于在实体选择器选项 [font=Verdana]type[/font] 中指定多种不同实体。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]流体标签[/b][/align][/color][/td][td][font=Verdana]tags/fluids/[文件名].json[/font][/td][td]很少使用。[/td][/tr]
[/table]　　标签中可以引用其它标签，例如：
[table]
[tr=#C0C0C0][td][font=Verdana]minecraft/tags/blocks/logs.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "replace": false,
    "values": [
        "#minecraft:dark_oak_logs",
        "#minecraft:oak_logs",
        "#minecraft:acacia_logs",
        "#minecraft:birch_logs",
        "#minecraft:jungle_logs",
        "#minecraft:spruce_logs"
    ]
}
[/font][/td][/tr]
[/table]就包含了所有6种原木、木头、去皮原木、去皮木头。标签中 [font=Verdana]replace[/font] 可以为
[list]
[*][font=Verdana]false[/font] 表示追加当前 [font=Verdana]values[/font] 内容至该标签。
[*][font=Verdana]true[/font] 表示覆盖之前原版和其它数据包添加至该标签的内容。
[/list]默认为 [font=Verdana]false[/font]。由于数据包加载次序不定，因此后一种情形较为少用，一般仅用于覆盖原版标签。
　　调试模式(F3)下，玩家指向方块时会显示含有该方块的所有方块标签。
　　例如：当玩家被方块卡住时，输出 I'm stucked!
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/tags/blocks/fluid.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "replace": false,
    "values": [
        "minecraft:air",
        "minecraft:cave_air",
        "minecraft:void_air",
        "minecraft:bubble_column",
        "minecraft:water",
        "minecraft:lava",
        "minecraft:fire"
    ]
}
[/font][/td][/tr]
[/table]然后执行命令
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/functions/check.mcfunction[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @a at @s anchored eyes unless block ^ ^ ^ #cpp:fluid run say I'm stucked!
[/font][/td][/tr]
[/table]因为命令执行地点为实体的脚，所以我们使用 [font=Verdana]anchored eyes[/font] 来使得局部坐标的位置变为玩家的眼睛。
[size=3][b]§2.9.1 预设标签[/b][/size]
　　[font=Verdana]minecraft[/font] 命名空间中预设了一些标签。其中
[list]
[*][font=Verdana]minecraft/tags/functions/load.json[/font] 中的函数会在加载时被执行一次，我们常称之为加载函数、load函数。用于初始化的函数应当添加至该标签。
[*][font=Verdana]minecraft/tags/functions/tick.json[/font] 中的函数每刻会被执行一次，我们常称之为循环函数、主函数、tick函数。需要高频执行的函数应当添加至该标签。
[/list]　　本文中我们有时会不加注明地使用[font=Verdana][命名空间]:load[/font] 和[font=Verdana][命名空间]:tick[/font] 表示这两个函数标签中的函数。
　　利用预设标签还可以实现更多燃料、改变植物种植所需的方块，甚至改变水和熔岩的性质，可参见[url=https://minecraft-zh.gamepedia.com/标签]标签 - Minecraft Wiki，最详细的官方我的世界百科[/url]和 [url=http://www.mcbbs.net/thread-811990-1-1.html]minecraft 预设tag以及实现随机方块功能[/url]。例如：让末影人无法拿起任何方块。
[table]
[tr=#C0C0C0][td][font=Verdana]minecraft/tags/blocks/enderman_holdable[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "replace": true,
    "values": [
    ]
}
[/font][/td][/tr]
[/table]

[page]
[size=5][b]§3 资源包[/b][/size]
　　资源包可以极大地提升原版模组的美观程度，因此现在大部分原版模组都需要使用配套的资源包。资源包文件层次为
[table]
[tr=#C0C0C0][td][font=Verdana]resourcepacks/资源包名称或资源包名称.zip/[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]pack.mcmeta
pack.png
assets
    命名空间
        lang
            zh_cn.json
            zh_tw.json
            en_us.json
        models
        textures
[/font][/td][/tr]
[/table]其中 [font=Verdana]assets[/font] 的文件结构和 [url=thread-784662-1-1.html?cp=1]§1.3.1 游戏文件结构[/url]中 [font=Verdana]versions/[版本号]/[版本号].jar/assets[/font] 的结构是一样的。
　　[font=Verdana]assets[/font] 下所有文件和文件夹需使用小写英文、数字或-,_来命名，[b]不可使用大写字母[/b]，所有文本文件为使用 [font=Verdana]UTF-8[/font] 编码的JSON文件，图片为 [font=Verdana]png[/font] 格式。资源包可以为文件夹格式或 zip 格式，发布时可将所有内容压缩为一个 zip 文件。压缩和解压的时候，注意文件层次，应当打开 zip 文件就可以看到资源包的 pack.mcmeta、pack.png 和 assets 文件夹。稳妥的做法是[font=Verdana]打开文件夹->全选->右键->发送到->压缩文件夹[/font]。
　　游戏内选择[font=Verdana]选项->资源包...[/font]可以列出所有的资源包。在资源包菜单中，加载次序由下至上，因此上方的资源包内容会覆盖下方的资源包同名内容。由于原版模组往往会修改原版物品自定义模型，因此同时安装多个原版模组的资源包时，很容易出现文件冲突，此时需要玩家手动合并资源包方可使用。具体而言，对比两个资源包的同名文件，将相同的模型文件的 [font=Verdana]overrides[/font] 合并，其它内容选择需要的留下即可。
　　若资源包位于 [font=Verdana]saves/[世界名称]/resources.zip[/font]，则资源包会在进入存档时自动加载(最顶层)。
　　本节中我们仅对资源包做简单介绍，更详细的文件说明请参阅[url=https://minecraft-zh.gamepedia.com/资源包]资源包 - Minecraft Wiki，最详细的官方我的世界百科[/url]或论坛材质资源版相关内容。
　　材质包和资源包是不同的东西，目前 Minecraft Java 只有资源包，请不要使用错误的名称。
[size=4][b]§3.1 元信息和图标[/b][/size]
Minecraft 通过 [font=Verdana]pack.mcmeta[/font] 来识别资源包，因此该文件是不可或缺的。例如：
[table]
[tr=#C0C0C0][td][font=Verdana]pack.mcmeta[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pack": {
        "pack_format": 5,
        "description": [
            {
                "text": "Crafting++ v1.10 ",
                "color": "gold"
            },
            {
                "translate": "options.resourcepack"
            },
            {
                "text": "\nruhuasiyu RubberTree",
                "color": "green"
            }
        ]
    }
}
[/font][/td][/tr]
[/table]其中
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]含义[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]键[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]说明[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]数据包版本[/b][/align][/color][/td][td][font=Verdana]pack_format[/font][/td][td]1.13-1.14 版本为 4，1.15 版本为 5。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]数据包描述[/b][/align][/color][/td][td][font=Verdana]description[/font][/td][td]单个字符串或一个[url=https://minecraft-zh.gamepedia.com/命令#.E5.8E.9F.E5.A7.8BJSON.E6.96.87.E6.9C.AC]原始JSON文本[/url]，资源包菜单中可以看到该文本。[/td][/tr]
[/table]　　资源包可以包含一个 [font=Verdana]pack.png[/font]，它是大小为[font=Verdana]16×16[/font]的图片，用于在资源包菜单中显示。
[size=4][b]§3.2 命名空间[/b][/size]
　　命名空间 (namespace) 为玩家自定义的、可操作的空间。使用独立的命名空间也有利于解决和他人的冲突。资源包下可以有多个命名空间，如果不同资源包中有相同的命名空间，则其中相同的文件名内容会根据加载先后顺序被覆盖。特别地，原版内容被保存在 [font=Verdana]minecraft[/font] 命名空间，想要修改和替换原版的模型材质只需在你的数据包内建立 [font=Verdana]minecraft[/font] 命名空间和相应的同名文件并修改即可。
　　模型和材质的调用格式为[font=Verdana]命名空间:文件夹/文件名[/font]对应[font=Verdana]命名空间/xxx/文件夹/文件名.后缀[/font]文件，[font=Verdana]xxx[/font] 为 [font=Verdana]models[/font] 或 [font=Verdana]textures[/font]。若命名空间为 [font=Verdana]minecraft[/font]，则可直接省略 [font=Verdana]minecraft:[/font]。
　　建议和数据包使用相同的命名空间名。
[size=4][b]§3.3 语言文件[/b][/size]
　　语言文件可以放在任一命名空间下的 [font=Verdana]lang[/font] 文件夹下。语言文件中可以使用样式代码来实现彩色文字。建议至少支持中文简体([font=Verdana]zh_cn[/font])、中文繁体([font=Verdana]zh_tw[/font])和英文([font=Verdana]en_us[/font])三种语言。建议所有物品、进度、游戏提示等文本均采用 [font=Verdana]translate[/font] 文本。例如：
[table]
[tr=#C0C0C0][td][font=Verdana]assets/命名空间/lang/zh_cn.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "item.cpp.magnet":"§r磁铁",
    ...
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]assets/命名空间/lang/en_us.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "item.cpp.magnet":"§rMagnet",
    ...
}
[/font][/td][/tr]
[/table]　　也可以用此方法修改物品的默认名称等内容。例如：
[table]
[tr=#C0C0C0][td][font=Verdana]assets/命名空间/lang/zh_cn.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "item.minecraft.potion.effect.empty": "§r神秘药水",
    ...
}
[/font][/td][/tr]
[/table]则未知的药水的名称不再是[font=Verdana]不可合成的药水[/font]，而是[font=Verdana]神秘药水[/font]。
　　[font=Verdana]translate[/font] 还有个有趣但不一定实用的用法。
[table]
[tr=#C0C0C0][td][font=Verdana]assets/命名空间/lang/zh_cn.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "The":"§a原版模组《更多的合成》已成功加载,", 
    "resourcepack":"版本",
    "does":"§a1.9.1§a.",
    "not":"§a更多内容请",
    "Install":"§e点击此处进入wiki.",
    "correctly":"§a作者:",
    "or":"§aruhuasiyu,",
    "Launch":"§aRubberTree",
    ...
}
[/font][/td][/tr]
[/table]则在数据包中输出相应文本时，若无资源包或资源包错误，则会显示 [font=Verdana]The resourcepack does not Installl correctly or Launch[/font] 以提示玩家资源包未加载。
[size=4][b]§3.4 自定义物品模型[/b][/size]
　　由于1.14添加了 [font=Verdana]CustomModelData[/font]，我们可以拥有几乎无穷多的物品模型。为了便于他人整合和解决冲突，我们建议将 [font=Verdana]CustomModelData[/font] 的前四位固定以确定模组的独有区段，后四位作为模组不同模型的值，例如 [font=Verdana]12340000-12349999[/font] 之间。此外，建议 [font=Verdana]CustomModelData[/font] 不要超过 [font=Verdana]16777216[/font]，原因见 [url=thread-867051-1-1.html]custom_model_data 的使用限制[/url]。
　　我们会给出一个例子来说明实现流程。首先在 [font=Verdana]minecraft[/font] 下的胡萝卜钓竿物品模型中添加额外的模型 ([font=Verdana]overrides[/font])，并引用我们自定义的模型。
[table]
[tr=#C0C0C0][td][font=Verdana]assets/minecraft/models/item/carrot_on_a_stick.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "item/handheld_rod",
    "textures": {
        "layer0": "item/carrot_on_a_stick"
    },
    "overrides": [
        { "predicate": { "custom_model_data": 12970001 }, "model": "cpp:element/blue_force_of_sky"},
        { "predicate": { "custom_model_data": 12970002 }, "model": "cpp:element/green_force_of_water"},
        { "predicate": { "custom_model_data": 12970003 }, "model": "cpp:element/cyan_force_of_mountain"},
        { "predicate": { "custom_model_data": 12970004 }, "model": "cpp:element/orange_force_of_dirt"},
        { "predicate": { "custom_model_data": 12970005 }, "model": "cpp:element/yellow_force_of_earth"},
        { "predicate": { "custom_model_data": 12970006 }, "model": "cpp:element/red_force_of_fire"}
    ]
}
[/font][/td][/tr]
[/table]注意 [font=Verdana]custom_model_data[/font] 需要按照从小往大的次序，否则会导致后面的覆盖前面的。然后创建自定义的模型
[table]
[tr=#C0C0C0][td][font=Verdana]assets/cpp/models/element/red_force_of_fire.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "item/handheld",
    "textures": {
        "layer0": "cpp:element/red_force_of_fire"
    }
}
[/font][/td][/tr]
[/table]最后绘制材质，并将其保存为 [font=Verdana]assets/craftingpp/textures/element/red_force_of_fire.png[/font]。这样我们就设计好了这个物品模型，在 [url=thread-784662-1-1.html?cp=5]§5 物品设计[/url]我们将会说明如何使用该模型。
[size=4][b]§3.5 模型[/b][/size]
　　模型是一个描述形状和指定材质的JSON文件。模型可以理解成一些可以旋转的长方体的拼接，每个长方体的若干个面贴上了材质图案。长方体的厚度可以为0，也可以只有若干个面。
　　只有 [font=Verdana]minecraft[/font] 命名空间下特定名称的文件才对应特定的物品/方块模型，例如 [font=Verdana]minecraft/models/item/carrot_on_a_stick.json[/font] 表示胡萝卜钓竿的物品模型，[font=Verdana]minecraft/models/block/stone.json[/font] 表示石头的方块模型。
　　我们通过几个例子来理解下模型文件的语法。
[table]
[tr=#C0C0C0][td][font=Verdana]minecraft/models/item/handheld.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "item/generated",
    "display": {
        "thirdperson_righthand": {
            "rotation": [ 0, -90, 55 ],
            "translation": [ 0, 4.0, 0.5 ],
            "scale": [ 0.85, 0.85, 0.85 ]
        },
        "thirdperson_lefthand": {
            "rotation": [ 0, 90, -55 ],
            "translation": [ 0, 4.0, 0.5 ],
            "scale": [ 0.85, 0.85, 0.85 ]
        },
        "firstperson_righthand": {
            "rotation": [ 0, -90, 25 ],
            "translation": [ 1.13, 3.2, 1.13 ],
            "scale": [ 0.68, 0.68, 0.68 ]
        },
        "firstperson_lefthand": {
            "rotation": [ 0, 90, -25 ],
            "translation": [ 1.13, 3.2, 1.13 ],
            "scale": [ 0.68, 0.68, 0.68 ]
        }
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/models/head/rabbit.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "block/block",
    "elements": [
        {
            "from": [ 5.5, 6, 5.5 ],
            "to": [ 10.5, 10, 10.5 ],
            "faces": {
                "east":    { "uv": [ 8, 2.5, 9.25, 4.5 ], "texture": "#layer" },
                "north":{ "uv": [ 9.25, 2.5, 10.5, 4.5 ], "texture": "#layer"},
                "west":    { "uv": [ 10.5, 2.5, 11.75, 4.5 ], "texture": "#layer" },
                "south":{ "uv": [ 11.75, 2.5, 13, 4.5 ], "texture": "#layer" },
                "up":    { "uv": [ 9.25, 0, 10.5, 2.5 ], "texture": "#layer", "rotation": 180},
                "down":    { "uv": [ 10.5, 0, 11.75, 2.5 ], "texture": "#layer" }
            }
        },
        {
            "from": [ 7.5, 7.5, 5 ],
            "to": [ 8.5, 8.5, 6 ],
            "faces": {
                "east":    { "uv": [ 8, 5, 8.25, 5.5 ], "texture": "#layer" },
                "north":{ "uv": [ 8.25, 5, 8.5, 5.5 ], "texture": "#layer"},
                "west":    { "uv": [ 8.5, 5, 8.75, 5.5 ], "texture": "#layer" },
                "south":{ "uv": [ 8.75, 5, 9, 5.5 ], "texture": "#layer" },
                "up":    { "uv": [ 8.25, 4.5, 8.5, 5 ], "texture": "#layer", "rotation": 180},
                "down":    { "uv": [ 8.5, 4.5, 8.75, 5 ], "texture": "#layer" }
            }
        },
        {
            "from": [ 5.5, 10, 9.5 ],
            "to": [ 7.5, 15, 10.5 ],
            "rotation": {
                "origin": [6.5, 10, 10], "axis": "y", "angle": -22.5
            },
            "faces": {
                "east":    { "uv": [ 14.5, 0.5, 14.75, 3 ], "texture": "#layer" },
                "north":{ "uv": [ 14.75, 0.5, 15.25, 3 ], "texture": "#layer"},
                "west":    { "uv": [ 15.25, 0.5, 15.5, 3 ], "texture": "#layer" },
                "south":{ "uv": [ 15.5, 0.5, 16, 3 ], "texture": "#layer" },
                "up":    { "uv": [ 14.75, 0, 15.25, 0.5 ], "texture": "#layer", "rotation": 180},
                "down":    { "uv": [ 15.25, 0, 15.75, 0.5 ], "texture": "#layer" }
            }
        },
        {
            "from": [ 8.5, 10, 9.5 ],
            "to": [ 10.5, 15, 10.5 ],
            "rotation": {
                "origin": [9.5, 10, 10], "axis": "y", "angle": 22.5
            },
            "faces": {
                "east":    { "uv": [ 13, 0.5, 13.25, 3 ], "texture": "#layer" },
                "north":{ "uv": [ 13.25, 0.5, 13.75, 3 ], "texture": "#layer"},
                "west":    { "uv": [ 13.75, 0.5, 14, 3 ], "texture": "#layer" },
                "south":{ "uv": [ 14, 0.5, 14.5, 3 ], "texture": "#layer" },
                "up":    { "uv": [ 13.25, 0, 13.75, 0.5 ], "texture": "#layer", "rotation": 180},
                "down":    { "uv": [ 13.75, 0, 14.25, 0.5 ], "texture": "#layer" }
            }
        }
    ],
    "display": {
        "head": {
            "scale": [ 3.28, 3.28, 3.28 ]
        },
        "gui": {
            "rotation": [ 30, 225, 0 ],
            "translation": [0, -2, 0],
            "scale": [ 1.6, 1.6, 1.6 ]
        },
        "ground": {
            "rotation": [ 0, 0, 0 ],
            "translation": [ 0, 3, 0],
            "scale":[ 0.64, 0.64, 0.64 ]
        },
        "fixed": {
            "rotation": [ 0, 0, 0 ],
            "translation": [ 0, 0, 0],
            "scale":[ 1.28, 1.28, 1.28 ]
        },
        "thirdperson_righthand": {
            "rotation": [ 75, 45, 0 ],
            "translation": [ 0, 2.5, 0],
            "scale": [ 0.96, 0.96, 0.96 ]
        },
        "firstperson_righthand": {
            "rotation": [ 0, 45, 0 ],
            "translation": [ 0, 0, 0 ],
            "scale": [ 1.02, 1.02, 1.02 ]
        },
        "firstperson_lefthand": {
            "rotation": [ 0, 225, 0 ],
            "translation": [ 0, 0, 0 ],
            "scale": [ 1.02, 1.02, 1.02 ]
        }
    },
    "textures": {
        "particle": "entity/rabbit/brown",
        "layer": "entity/rabbit/brown"
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]含义[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]键[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]说明[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]父模型[/b][/align][/color][/td][td][font=Verdana]parent[/font][/td][td]继承指定位置的模型内容，相当于将其文件内容复制到该位置，可以缺省。Minecraft 已经定义了很多常见模型，我们可以直接调用而无需自己编写。对于自定义的多个类似的模型，我们也可以写好一个模板后继承之。常见的默认模型有[list]
[*][font=Verdana]minecraft:item/generated[/font] 普通手持物，指定了手持物在不同位置的显示效果。
[*][font=Verdana]minecraft:item/handheld[/font] 手持工具物，与上一条有不同的旋转效果。
[*][font=Verdana]minecraft:block/block[/font] 方块，指定了方块在不同位置的显示效果。
[*][font=Verdana]minecraft:block/cube[/font] 完整方块，指定了一个1×1×1大小的方块模型。
[/list][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]显示[/b][/align][/color][/td][td][font=Verdana]display[/font][/td][td]物品在不同位置的显示效果。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]掉落物显示[/b][/align][/color][/td][td][font=Verdana]display.ground[/font][/td][td]物品作为掉落物的显示效果。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]头部显示[/b][/align][/color][/td][td][font=Verdana]display.head[/font][/td][td]物品佩戴在生物头部的显示效果。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]手持物显示[/b][/align][/color][/td][td][font=Verdana]display.firstperson_lefthand[/font]
[font=Verdana]display.firstperson_righthand[/font]
[font=Verdana]display.thirdperson_lefthand[/font]
[font=Verdana]display.thirdperson_righthand[/font]
    [/td][td]物品在第一人称左手、第一人称右手、第三人称左手、第三人称右手的显示效果。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]展示框显示[/b][/align][/color][/td][td][font=Verdana]display.fixed[/font][/td][td]物品在物品展示框内的显示效果。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]展示框显示[/b][/align][/color][/td][td][font=Verdana]display.gui[/font][/td][td]物品在玩家背包或容器内的显示效果。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]变换[/b][/align][/color][/td][td][font=Verdana]display.[位置].scale[/font]
[font=Verdana]display.[位置].translation[/font]
[font=Verdana]display.[位置].rotation[/font]
    [/td][td]物品在相应位置进行的放缩、平移和旋转。至多放缩至4倍，平移至±80。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]元素[/b][/align][/color][/td][td][font=Verdana]elements[/font][/td][td]列表的每个项确定一个长方体。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]元素范围[/b][/align][/color][/td][td][font=Verdana]elements.from[/font]
[font=Verdana]elements.to[/font][/td][td]确定元素的范围。其三个坐标xyz范围为-16到32之间，不做放缩时，0~16即一个方块的完整大小。放置方块后，方块的x轴从右往左，y轴从下往上，z轴从近往远。在背包或展示框中时，x轴从左往右，y轴从上往下，z轴从远往近。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]元素旋转[/b][/align][/color][/td][td][font=Verdana]rotation.origin[/font]
[font=Verdana]rotation.axis[/font]
[font=Verdana]rotation.angle[/font][/td][td]将元素进行旋转，分别表示旋转中心、旋转的坐标轴、旋转的角度。其中角度只能是[font=Verdana]0, 22.5, 45, -22.5, -45[/font]。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]元素的面[/b][/align][/color][/td][td][font=Verdana]elements.face[/font][/td][td]为方块的6个面材质信息，东南西北上下6个面由xyz轴的方向确定，例如+x轴的面为东。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]元素材质引用[/b][/align][/color][/td][td][font=Verdana]elements.face.[方向].texture[/font][/td][td]指定所使用的材质。我们建议绘制材质时按照元素的南面展开图来排列各个面的材质，即 [img]https://ruhuasiyu.github.io/VanillaModToturial/items/南面展开图.png[/img] 或分为6个单独的材质。可以为材质的引用路径或以#开头的变量，使用变量的好处是便于修改。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]元素材质范围[/b][/align][/color][/td][td][font=Verdana]elements.face.[方向].uv[/font][/td][td]指定材质的选取范围。将材质放缩为16×16大小，该数值指定的便是相应区域。例如材质文件为64×64大小，则 [font=Verdana]"uv": [ 3.5, 3, 4, 4 ][/font] 使用的是距左上角横向14-16、纵向12-16的2×4个像素。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]材质[/b][/align][/color][/td][td][font=Verdana]textures[/font][/td][td]指定元素材质引用中的变量所指的材质文件位置。可以缺省并在子模型中指定以确定最终模型。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]颗粒材质[/b][/align][/color][/td][td][font=Verdana]textures.particle[/font][/td][td]指定作为物品或方块模型时，物品被损耗或方块被挖掘时显示的颗粒材质。[/td][/tr]
[/table]更详细的语法参考[url=https://minecraft-zh.gamepedia.com/模型]模型 - Minecraft Wiki，最详细的官方我的世界百科[/url]。
[align=center]
    [img]https://ruhuasiyu.github.io/VanillaModToturial/items/方向示意图.png[/img]
[font=楷体,楷体_GB2312]图3.1 方向示意图[/font]
[/align]　　如果我们循着模型 [font=Verdana]minecraft:item/handheld[/font] 往上，最终会得到模型 [font=Verdana]builtin/generated[/font]。这种模型是内建的，不能通过资源包来修改。
　　由于 [font=Verdana]scale[/font] 至多为4，而 [font=Verdana]from to[/font] 至多为[font=Verdana]-16[/font]到[font=Verdana]32[/font]，因此模型最多可以放大至[font=Verdana]12[/font]倍。想要更大的模型可以通过分段来旋转拼接而成，参阅
[list]
[*][url=thread-637959-1-1.html]因为不知道发到哪里只好发过来了 也不知道火没火星 毕竟我没有画材质的朋友。。。[/url]
[*][url=https://www.bilibili.com/video/av24626290]四十米长的大刀？我在minecraft里做1200米的！[/url]
[*][url=https://www.bilibili.com/video/av39646162]【魔改材质包】数体积专用-3轴标尺[/url]
[/list]　　模型在不同位置仅有放缩旋转平移的差别，想要实现视觉上的明显不同，可参阅[url=thread-833056-1-1.html]【1.14】物品头部/背包/手持显示不同材质/模型[/url]。
　　方块状态我们一般不会用到，而且语法比较简单，可直接参阅 wiki，这里不做赘述。
[size=4][b]§3.6 材质[/b][/size]
　　材质的绘制需要用到诸如 Photoshop 之类的画图软件，具体请参考材质版或网络上的相关教程。
　　当模型调用的材质不存在时，会显示紫黑色的材质。如果模型是正确的，你仍然可以看出正确的模型形状。
　　材质可以是动态的。动态材质需要高为宽的整数，以及一个 [font=Verdana]mcmeta[/font] 文件确定动画，例如 [font=Verdana]foo.png[/font] 对应
[table]
[tr=#C0C0C0][td][font=Verdana]foo.png.mcmeta[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
      "animation": {
        "interpolate": false,
        "frametime": 4,
        "frames": [
            0,
            1,
            2,
            3,
            {"index":4,"time": 2},
            5
        ]
      }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]含义[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]键[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]说明[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]插值[/b][/align][/color][/td][td][font=Verdana]interpolate[/font][/td][td]是否需要插值过渡，缺省为[font=Verdana]false[/font]。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]帧长[/b][/align][/color][/td][td][font=Verdana]frametime[/font][/td][td]每一帧的默认时长(刻)。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]帧[/b][/align][/color][/td][td][font=Verdana]frames[/font][/td][td]指定播放帧的次序。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]帧的序号[/b][/align][/color][/td][td][font=Verdana]frames.[数字][/font][/td][td]材质的高度为宽度的x倍时，可以有x帧，分别对应材质自上而下均匀划分的x个块。从0开始。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]帧的序号和时长[/b][/align][/color][/td][td][font=Verdana]frames.index
[/font][font=Verdana]frames.time[/font][/td][td]单独指定这一帧的序号和时长(刻)。[/td][/tr]
[/table]
[size=4][b]§3.7 声音[/b][/size]
　　音效文件为 [font=Verdana]assets/命名空间/sounds.json[/font]，它调用的是 [font=Verdana]assets/命名空间/sounds[/font] 文件夹下的 [font=Verdana]ogg[/font] 文件。例如：
[table]
[tr=#C0C0C0][td][font=Verdana]assets/rf/sounds.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "juicer": {
        "category": "block",
        "sounds": [
            "rf:juicer"
        ]
    },
    "swing": {
        "sounds": [
            "rf:lightsaber/swing1",
            "rf:lightsaber/swing2",
            "rf:lightsaber/swing3",
            "rf:lightsaber/swing4"
        ],
        "category": "hostile"
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]含义[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]键[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]说明[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]替换[/b][/align][/color][/td][td][font=Verdana][自定义名称].replace[/font][/td][td]是否覆盖原有的声音信息，缺省为[font=Verdana]false[/font]，即不覆盖。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]声音列表[/b][/align][/color][/td][td][font=Verdana][自定义名称].sounds[/font][/td][td]触发时会随机选择列表中一个播放。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]字幕[/b][/align][/color][/td][td][font=Verdana][自定义名称].subtitle[/font][/td][td]播放声音时显示的字幕。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]种类[/b][/align][/color][/td][td][font=Verdana][自定义名称].category[/font][/td][td]在[font=Verdana]选项->音乐和声音中[/font]可以选择开启/关闭特定种类的声音。[/td][/tr]
[/table]
[size=4][b]§3.8 字体[/b][/size]
　　我们着重介绍字体图片。添加下述路径文件可以追加/覆盖特殊字符的显示：
[table]
[tr=#C0C0C0][td][font=Verdana]assets/minecraft/font/default.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "providers": [
        {
            "type": "bitmap",
            "file": "minecraft:font/mana0.png",
            "height": 91,
            "ascent": 85,
            "chars": ["\ue010"]
        },
        {
            "type": "bitmap",
            "file": "minecraft:font/mana1.png",
            "height": 91,
            "ascent": 85,
            "chars": ["\ue011"]
        }
    ]
}
[/font][/td][/tr]
[/table]　　例子中我们追加了字符 [font=Verdana]\ue010[/font] 和 [font=Verdana]\ue011[/font] 的材质。
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]含义[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]键[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]说明[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]类型[/b][/align][/color][/td][td][font=Verdana]type[/font][/td][td][font=Verdana]legacy_unicode[/font] 指附魔台文字，我们一般设置为 [font=Verdana]bitmap[/font] 即可。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]字符列表[/b][/align][/color][/td][td][font=Verdana]chars[/font][/td][td]每个字符串可以包含多个字符。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]材质文件[/b][/align][/color][/td][td][font=Verdana]file[/font][/td][td]该字符列表所用的材质，将该文件划分为若干行以与字符列表的每个字符串一一对应。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]字符高度[/b][/align][/color][/td][td][font=Verdana]height[/font][/td][td]该字符列表字符的高度。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]字符重心[/b][/align][/color][/td][td][font=Verdana]ascent[/font][/td][td]该字符图案向上移动的长度。[/td][/tr]
[/table]　　我们可以用 [font=Verdana]\u[/font] 开头来表示不容易打出的字符，参见[url=https://unicode-table.com]Unicode® Character Table[/url]。直接使用字符也是可以的。
　　利用这种方式，我们可以做到在成书、玩家快捷栏上方、聊天区域、物品名称等地方显示图片，见[url=thread-835539-1-1.html]【1.13】如何添加图片?[/url]。如果可以包含了使用负长度的空格的字体（需要 Nvidia 显卡以支持），还可以实现更为炫酷的效果，例如[url=https://www.bilibili.com/video/av67508247]字体黑科技 —— 潜影盒内容预览[/url]。
[size=4][b]§3.9 着色器[/b][/size]
　　着色器可以对游戏内的视觉效果进行修改，目前可以通过
[list]
[*]旁观特定生物，可使用 [font=Verdana]/spectate[/font] 命令强制旁观；
[*]屏幕中有发光的实体
[/list]两种情形来达成。着色器文件为位于 [font=Verdana]assets/minecraft/shaders/program[/font] 下方的 [font=Verdana]fsh[/font] 文件，具体用法可参考[url=thread-916150-1-1.html]原版着色器指导[/url]和[url=thread-917679-1-1.html]几个原版着色器示例[/url]。

[page]
[size=5][b]§4 规划[/b][/size]
　　当我们有了一定的命令基础和数据包与资源包的相关知识之后，我们可以开始考虑做一个模组了。模组的目的是在原版的基础上做出一定的修改，模组的核心是内容，命令和技巧都只是为实现这一目的的手段。通常的设计路线如下图所示：
[align=center]    [img]https://ruhuasiyu.github.io/VanillaModToturial/items/设计路线.png[/img]
[font=楷体,楷体_GB2312]图4.1 设计路线[/font]
[/align]平衡性可以从合成难度和触发条件等方面来调整。
　　原版模组不比基于 Forge/Liteloader 等 API 的模组，在实现效率上一般会有所欠缺，因此我们在制作和测试过程中，应当优先保证流畅度，再考虑内容的充实性。
　　模组的整个生命周期中，所有内容都应当有完整的文档记录，以便于随时查看和修改。
　　为你的模组设定合理的版本管理方式，例如使用 Git 托管，有利于保存模组的所有历史版本。这可以减少因误操作导致的损失。
[size=4][b]§4.1 名称设计[/b][/size]
　　模组的所有内容都应当被合理地命名，尽量采用简洁且有意义的命名，同时便于他人处理数据包冲突。这些内容包括数据包下所有的文件和文件夹名以及记分板、标签、组的名称等。建议各种名称均使用大驼峰、小驼峰或下划线记法。如果模组包含多个模块，可以在不同数据包下使用相同的命名空间、不同的文件夹，来分门别类。
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]类型[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]示例[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]说明[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]数据包名称[/b][/align][/color][/td][td][font=Verdana]craftingpp[br]更多的合成v1.10[br]CraftingPlusPlus[/font][/td][td]建议使用模组全名，空格和特殊字符使用下划线代替或忽略，也可使用中文名称。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]资源包名称[/b][/align][/color][/td][td][font=Verdana]craftingpp_resourcepack[br]更多的合成v1.10资源包[br]CraftingPlusPlus_Resources[/font][/td][td]建议使用数据包名称+资源包等。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]命名空间[/b][/align][/color][/td][td][font=Verdana]craftingpp[br]cpp[br]fisma[br]mek[/font][/td][td]过短的命名空间容易冲突，可使用模组名称的全程或缩写来表示。命名空间必须由小写或下划线组成。建议整个模组使用一个命名空间，或若干相同前缀的命名空间。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]物品名称[/b][/align][/color][/td][td][font=Verdana]红色火之力[br]Red Force of Fire[br]cpp:red_force_of_fire[/font][/td][td]建议使用物品英文名称对应的小写+下划线写法作为物品id，具体设计见下一节。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]记分板和组[/b][/align][/color][/td][td][font=Verdana]cppValue[br]cppCraft[br]cppTicks[br]cpp_health[/font][/td][td]建议使用命名空间为前缀的驼峰记法，因为记分板名称长度不可超过16。长度允许的话，使用下划线记法也可以。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]实体标签[/b][/align][/color][/td][td][font=Verdana]cpp_entities_checker[br]cpp_generate_dead[br]cpp_machines_marker[br]cppDarkAnimals[/font][/td][td]建议使用命名空间为前缀。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]自定义NBT键[/b][/align][/color][/td][td][font=Verdana]cppGenratorMarker[br]cppLeavesDecayMarker[br]cppSkyislandDrop[/font][/td][td]建议使用命名空间为前缀。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]记分板假名[/b][/align][/color][/td][td][font=Verdana]#temp[br]$machineWorkPeriod[br]$mod_leaves_speed[/font][/td][td]临时变量建议使用#开头，配置参数建议使用$开头，因为#开头的计分板不会在记分板列表中显示而$开头的可以。因记分板已使用前缀，此处可以不使用前缀。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]tick函数[/b][/align][/color][/td][td][font=Verdana]_main.mcfunction[br]tick.mcfunction[br]loop.mcfunction[/font][/td][td]即函数标签 [font=Verdana]minecraft:tick[/font] 下的函数，见 [url=thread-784662-1-1.html?cp=2]§2.9.1 预设标签[/url]。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]load函数[/b][/align][/color][/td][td][font=Verdana]load.mcfunction[br]_init.mcfunction[br]root.mcfunction[/font][/td][td]即函数标签 [font=Verdana]minecraft:load[/font] 下的函数，见 [url=thread-784662-1-1.html?cp=2]§2.9.1 预设标签[/url]。[/td][/tr]
[/table]
[size=4][b]§4.2 调试[/b][/size]
　　加载中出现的资源包和数据包错误一般会在 [font=Verdana]logs/latest.log[/font] 中提示，见 [url=thread-784662-1-1.html?cp=1]§1.3.1 游戏文件结构[/url]。测试时，打开这个文件，可以看到具体是哪个文件的哪个位置发生了错误。常见错误包括
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]日志[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]说明[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]Unable to load model: '模型引用名' referenced from: 某物品#inventory: java.lang.IllegalStateException: Not aJSONObject: "parent"[/font][/td][td]该物品模型文件中调用的另一模型出错，错误出在 [font=Verdana]"parent"[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]Using missing texture, unable to load[/font][/td][td]相应路径的材质不存在。[/td][/tr]
[tr=#FFFFFF][td][font=Verdana]Couldn't load function at 函数路径 java.util.concurrent.CompletionException: java.lang.IllegalArgumentException: Whilst parsing command on line 行号 at position 列号[/font][/td][td]相应函数的相应位置出错。[/td][/tr]
[tr=#FFFFFF][td][font=Verdana]Couldn't read function tag list 标签引用名 from 标签路径 in data pack 数据包[/font][/td][td]相应数据包的相应路径的标签出错，检查下是否调用了不存在的物品、方块或出错的函数，或是逗号使用错误。[/td][/tr]
[/table]使用 [font=Verdana]/datapack list[/font] 来查看你的模组是否被识别了，如果压根没识别说明你的模组缺少 [font=Verdana]pack.mcmeta[/font] 或其错误。
　　如果进游戏异常卡顿，输入 [font=Verdana]/function 相应高频函数[/font]，如果提示执行了65535条函数，那么可能是函数使用了无限自我递归调用。检查相应的函数递归是否跳出条件有误。
　　调试时，可添加适当的 [font=Verdana]tellraw[/font] 命令来查看方块、实体、记分板值等，来确定何处出错。
[size=4][b]§4.3 前置与附属[/b][/size]
　　使用他人已写好的前置可以在减少自己的工作量，例如
[list]
[*][url=thread-900914-1-1.html]战利品表随机数[/url]
[*][url=thread-916294-1-1.html]方块通用处理[/url]
[*][url=https://github.com/ruhuasiyu/CraftingPlusPlus/tree/master/other_datapacks/%E5%90%88%E6%88%90%E9%80%9A%E7%94%A8%E5%A4%84%E7%90%86]合成通用处理[/url]
[*][url=https://github.com/ruhuasiyu/CraftingPlusPlus/tree/master/other_datapacks/%E5%8E%9F%E7%89%88%E6%A8%A1%E7%BB%84%E5%AE%B9%E5%99%A8%E6%89%A9%E5%B1%95]原版模组容器扩展[/url]
[*][url=thread-775667-1-1.html]【UIN】数据包——标签分类[/url]
[/list]等。这些前置已经包含了诸如生成随机数、处理模组方块、合成、容器等内容，这样开发者就不用再花费精力在这些事件的处理上，只需要调用它们提供的接口即可。使用这些数据包之前，应当对其内容有充分的了解再考虑引用，他人的代码未必是合理高效无漏洞的。
　　建议在前置中添加函数
[table]
[tr=#C0C0C0][td][font=Verdana]foo:datapack[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players set #datapack_version fooValue 101
[/font][/td][/tr]
[/table]这样他人便可通过在[font=Verdana]load函数[/font]中添加
[table]
[tr=#C0C0C0][td][font=Verdana]bar:load[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard objective add fooValue dummy
scoreboard players set #datapack_version fooValue 0
function foo:datapack
execute unless score #datapack_version fooValue matches 101 run tellraw @a {"text":"[Bar模组]：缺少必要的数据包前置[Foo模组v1.0.1]！"}
[/font][/td][/tr]
[/table]以在缺少相应版本的前置时提醒使用者。
　　附属一般通过函数标签来实现。例如在你的模组中添加了一种机器，里面对物品进行了一些处理：
[table]
[tr=#C0C0C0][td][font=Verdana]foo:machine/tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute if block ~ ~ ~ barrel{Items:[{Slot:3b,id:"minecraft:mycelium"},{Slot:12b,id:"minecraft:dirt"}]} run replaceitem block ~ ~ ~ container.15 minecraft:mycelium
function #foo:item_processer
[/font][/td][/tr]
[/table]那么其它开发者就可以通过在函数标签[font=Verdana]#foo:item_processer[/font]中添加相应的函数命令来实现更多的机器配方。
[size=4][b]§4.4 发布[/b][/size]
　　当你设计并制作好全部内容且通过测试后，将你的数据包以及其它可能的内容，如资源包、地图、data文件等一同发布。采用合适的版本号管理，并在发布时注明你所使用的命名空间、记分板、组、标签、地图区段、资源包等内容，以便于其他开发者整合或避免冲突。
　　如果你的模组内容较多，可以建立一个wiki页面来方便玩家查询资料。例如国内最大的中文 Minecraft 模组百科[url=https://www.mcmod.cn/]MC 百科[/url]，建立模组后，可以申请编辑员来方便地管理你的模组wiki页面。也可以 Github 的项目中创建 wiki。

[page]
[size=5][b]§5 物品设计[/b][/size]
[size=4][b]§5.1 通用处理[/b][/size]
　　由于原版模组从不添加原版不存在的物品，所以我们需要为物品加上NBT来进行区分。例如：添加物品[font=Verdana]红色火之力 (cpp:red_force_of_fire)[/font]，不可叠加，右键触发执行命令。我们可使用胡萝卜钓竿作为物品本体。建议为模组添加的所有物品添加相应的战利品表来便于获取/修改/合成等。
[table]
[tr=#C0C0C0][td][font=Verdana]craftingpp/data/cpp/loot_tables/red_force_of_fire.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "item",
                    "name": "minecraft:carrot_on_a_stick",
                    "functions": [
                        {
                            "function": "set_nbt",
                            "tag": "{id:'cpp:red_force_of_fire',display:{Name:'{\"translate\":\"item.cpp.red_force_of_fire\"}'},CustomModelData:12970013}"
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]NBT[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]说明[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]id:"cpp:red_force_of_fire"[/font][/td][td]建议使用[font=Verdana]id:"命名空间:物品名称"[/font]来表示原版模组物品的唯一标签，以与其它模组的物品区分。[/td][/tr]
[tr=#FFFFFF][td][font=Verdana]display:{Name:'{"translate":"item.cpp.red_force_of_fire"}'}[/font][/td][td]物品的显示名称，我们建议使用 [font=Verdana]translate[font=Verdana] 文本，以支持多种语言，见 [url=thread-784662-1-1.html?cp=3]§3.3 语言文件[/url]。[/font][/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]CustomModelData:12970013[/font][/td][td]物品的自定义模型数据，见 [url=thread-784662-1-1.html?cp=3]§3.4 自定义物品模型[/url]。[/td][/tr]
[tr=#FFFFFF][td][font=Verdana]dict:['iron_dust'][/font][/td][td]可选的矿物辞典，用于表示同类物品，并不一定指矿物类物品。例如矿物、矿物粉、矿物粒、水果等。矿物辞典可用来解决不同的原版模组/插件的同种物品互相调用的问题，见[url=https://www.mcmod.cn/post/927.html]原版模组矿物辞典[/url]。[/td][/tr]
[/table]然后为物品添加模型，见[url=thread-784662-1-1.html?cp=3]§3.5 模型[/url]。
[table]
[tr=#C0C0C0][td][font=Verdana]assets/minecraft/models/item/carrot_on_a_stick.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "item/handheld_rod",
    "textures": {
        "layer0": "item/carrot_on_a_stick"
    },
    "overrides": [
        { "predicate": { "custom_model_data": 12970013 }, "model": "cpp:element/red_force_of_fire"}
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]assets/cpp/models/element/red_force_of_fire.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "item/handheld_rod",
    "textures": {
        "layer0": "cpp:element/red_force_of_fire"
    }
}
[/font][/td][/tr]
[/table]
最后，为其绘制材质 [font=Verdana]assets/cpp/textures/element/red_force_of_fire.png[/font]。
[size=4][b]§5.2 右键交互[/b][/size]
　　对于右键具有交互功能的物品，我们可以使用胡萝卜钓竿，通过使用胡萝卜钓竿的记分板来探测。例如使用上一节中的示例物品：
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:load[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard objectives add cppUseCSt minecraft.used:minecraft.carrot_on_a_stick
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @a[scores={cppUseCSt=1..}] run function cpp:misc/use_cst
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:misc/use_cst[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[predicate=cpp:hand_red_force_of_fire] run function cpp:element/red_force_of_fire
scoreboard players reset @s cppUseCSt
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/predicates/hand_red_force_of_fire.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "condition": "minecraft:alternative",
    "terms":[
        {
            "condition": "minecraft:entity_properties",
            "entity": "this",
            "predicate": {
                "equipment": {
                    "mainhand":{
                        "item": "minecraft:carrot_on_a_stick",
                        "nbt": "{id:'cpp:red_force_of_fire'}"
                    }
                }
            }
        },
        {
            "condition": "minecraft:inverted",
            "term": {
                "condition": "minecraft:alternative",
                "terms": [
                    {
                        "condition": "minecraft:entity_properties",
                        "entity": "this",
                        "predicate": {
                            "equipment": {
                                "mainhand":{
                                    "item": "minecraft:carrot_on_a_stick"
                                }
                            }
                        }
                    },
                    {
                        "condition": "minecraft:inverted",
                        "term": {
                            "condition": "minecraft:entity_properties",
                            "entity": "this",
                            "predicate": {
                                "equipment": {
                                    "offhand":{
                                        "item": "minecraft:carrot_on_a_stick",
                                        "nbt": "{id:'cpp:red_force_of_fire'}"
                                    }
                                }
                            }
                        }
                    }
                ]
            }
        }   
    ]
}
[/font][/td][/tr]
[/table]
　　如果需要的话，我们还可以手动模拟胡萝卜钓竿的耐久损耗。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:element/red_force_of_fire[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]...
execute as @s[nbt={SelectedItem:{id:"minecraft:carrot_on_a_stick"}}] run function cpp:damage_cst_main
execute as @s[nbt=!{SelectedItem:{id:"minecraft:carrot_on_a_stick"}}] run function cpp:damage_cst_off
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:damage_cst_main[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]data modify storage cpp:temp Item set from entity @s SelectedItem
function cpp:damage_tool
execute if score #damage cppValue matches 26.. run data remove storage cpp:temp Item
setblock ~ 255 ~ shulker_box
data modify block ~ 255 ~ Items append from storage cpp:temp Item
loot replace entity @s weapon.mainhand 1 mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ minecraft:air
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:damage_cst_off[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]data modify storage cpp:temp Item set from entity @s Inventory[{Slot:-106b}]
function cpp:damage_tool
execute if score #damage cppValue matches 26.. run data remove storage cpp:temp Item
setblock ~ 255 ~ shulker_box
data modify block ~ 255 ~ Items append from storage cpp:temp Item
loot replace entity @s weapon.offhand 1 mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ minecraft:air
[/font][/td][/tr]
[/table]
这里我们使用了潜影盒战利品表技巧来修改玩家背包物品，见 [url=thread-784662-1-1.html?cp=2]§2.5 战利品表[/url]。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:damage_tool[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute store result score #unbreak_lvl cppValue run data get storage cpp:temp Item.tag.Enchantments[{id:"minecraft:unbreaking"}].lvl
execute store result score #damage cppValue run data get storage cpp:temp Item.tag.Damage
execute if score #unbreak_lvl cppValue matches 1.. run function cpp:damage
execute store result storage cpp:temp Item.tag.Damage int 1 run scoreboard players add #damage cppValue 1
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:damage[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]loot spawn ~ -1 ~ loot cpp:misc/random
execute positioned ~ -1 ~ store result score #rand cppValue run data get entity @e[type=minecraft:item,nbt={Item:{tag:{cppRandomMarker:1b}}},limit=1,distance=..1] Item.tag.AttributeModifiers[0].Amount 1048575
execute positioned ~ -1 ~ run kill @e[type=minecraft:item,nbt={Item:{tag:{cppRandomMarker:1b}}},limit=1,distance=..1]
scoreboard players operation #rand cppValue %= #unbreak_lvl cppValue
execute if #rand cppValue matches 1.. run scoreboard players remove #damage cppValue 1
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/misc/random.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:stone",
                    "functions": [
                        {
                            "function": "set_attributes",
                            "modifiers": [
                                {
                                    "slot": "mainhand",
                                    "name": "random_attackDamage",
                                    "attribute": "generic.attackDamage",
                                    "operation": "addition",
                                    "amount": {
                                        "min": 0,
                                        "max": 2048
                                    }
                                }
                            ]
                        },
                        {
                            "function": "set_nbt",
                            "tag": "{cppRandomMarker:1b}"
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
　　投掷物如雪球、末影珍珠等可用于一次性右键工具，不同的物品有着各自的特点。投掷带自定义NBT标签的物品，对应的投掷物实体 [font=Verdana]Item[/font] 标签会包含这些NBT标签。注意，在1.14和更早版本，由于Mojang先消耗手持物再存储手持物信息，导致投掷最后一个物品时没有存储相应的 [font=Verdana]Item[/font] 信息，此时我们需要提前1刻存储玩家手持物信息方可。
　　例如：扔出 [font=Verdana]minecraft:experience_bottle{cppXpNumber:99s}[/font] 生成 [font=Verdana]cppXpNumber[/font] 点经验值的经验球。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @e[type=minecraft:experience_bottle] if data entity @s Item.tag.cppXpNumber at @s run function cpp:xp/throw
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:xp/throw[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]summon minecraft:experience_orb ~ ~ ~ {Value:9s,Tags:["cpp_XpNumber"]}
execute store result entity @e[type=minecraft:experience_orb,tag=cpp_XpNumber,limit=1,distance=..1] Value short 1 run data get entity @s Item.tag.cpp_XpNumber
tag @e[type=minecraft:experience_orb,tag=cpp_XpNumber,limit=1,distance=..1] remove cpp_XpNumber
kill @s   
[/font][/td][/tr]
[/table]
[size=4][b]§5.3 食物[/b][/size]
　　我们一般使用曲奇、苹果、面包、南瓜派等来作为食物本体，曲奇的优点是回复的饥饿值低，可用于制作低饥饿值的食物，南瓜派的优点仅可用于食用。我们使用进度来判断玩家是否食用了特定食物。例如：食用肉松面包回复10点饥饿值，并获得30秒的速度效果。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/meat_floss_bread.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:bread",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.cpp.meat_floss_bread\"}'},id:'cpp:meat_floss_bread',CustomModelData:12970001}"
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/advancements/foods/meat_floss_bread.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "criteria": {
        "meat_floss_bread": {
            "trigger": "minecraft:consume_item",
            "conditions": {
                "item": {
                    "nbt": "{id:'cpp:meat_floss_bread'}"
                }
            }
        }
    },
    "rewards":{
        "function": "cpp:foods/meat_floss_bread"
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:foods/meat_floss_bread[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]effect give @s saturation 1 4
effect give @s speed 30
advancement revoke @s only cpp:foods/meat_floss_bread
[/font][/td][/tr]
[/table]
这里，1秒的饱和IV可以恢复5点饥饿值，加上面包本省的5点，正好为10点。
　　如果我们想要制作不可堆叠类食物，可以使用迷之炖菜，注意会剩下碗。而且迷之炖菜的可以自带药水效果，无需进度和函数来额外实现。例如：食用缤纷菜蔬回复14点饥饿值，并获得30秒的跳跃提升效果。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/colorful_vegetable.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:suspicious_stew",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.cpp.colorful_vegetable\"}',Lore:['{\"translate\":\"lore.cpp.leap\"}']},id:'cpp:colorful_vegetable',CustomModelData:12970002,Effects:[{EffectDuration:600,EffectId:8b},{EffectDuration:8,EffectId:23b}]}"
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
[size=4][b]§5.4 药水[/b][/size]
　　通常我们使用药水来实现自定义的药水效果，例如：饮用潮汐药水后获得8分钟的潮涌之力效果。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/potion_of_tide.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:potion",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.cpp.potion_of_tide\"}'},id:"cpp:potion_of_tide",CustomPotionColor:1950417,CustomPotionEffects:[{Id:29b,Amplifier:0b,Duration:9600}]}"
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
　　如果我们想要药水可以堆叠，可以使用食物(64堆叠数)或蜂蜜瓶(16堆叠数)来实现，尽管蜂蜜瓶等具有额外的合成效果。我们需要手动为食物加上显示药水效果的[font=Verdana]Lore[/font]。例如：饮用天空药水后获得6分钟的速度II和6分钟的缓降效果。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/agentia_of_sky.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:honey_bottle",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.cpp.agentia_of_sky\"}',Lore:['[{\"translate\":\"effect.minecraft.speed\",\"italic\":\"false\",\"color\":\"blue\"},{\"text\":\" II (6:00)\"}]','[{\"translate\":\"effect.minecraft.slow_falling\",\"italic\":\"false\",\"color\":\"blue\"},{\"text\":\" (6:00)\"}]','\" \"','{\"translate\":\"potion.whenDrank\",\"italic\":\"false\"}','[{\"text\":\"+40% \",\"italic\":\"false\",\"color\":\"blue\"},{\"translate\":\"attribute.name.generic.movementSpeed\"}]']},id:'cpp:agentia_of_sky',CustomModelData:12970101}"
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/advancements/agentia_of_sky.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "criteria": {
        "consume": {
            "trigger": "minecraft:consume_item",
            "conditions": {
                "item": {
                    "nbt": "{id:'cpp:agentia_of_sky'}"
                }
            }
        }
    },
    "rewards":{
        "function": "cpp:potion/agentia_of_sky"
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:potion/agentia_of_sky[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]effect give @s minecraft:speed 360 1
effect give @s minecraft:slow_falling 360
advancement revoke @s only cpp:potion/agentia_of_sky
[/font][/td][/tr]
[/table]
[size=4][b]§5.5 自定义状态效果[/b][/size]
　　原版定义新的状态效果是不可能的，但是我们可以通过进度来模拟食用特定物品后的效果。我们使用记分板来记录时长，模拟药水的颗粒效果，并在[font=Verdana]actionbar[/font]显示剩余时长。我们无法在背包页面显示图标和时长，也无法在右上角显示图标。例如：饮用泥土药水后获得12分钟的隐身和12分钟的连锁效果，这里我们不涉及实际效果的实现。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/agentia_of_dirt.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:honey_bottle",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.cpp.agentia_of_dirt\"}',Lore:['[{\"translate\":\"effect.minecraft.invisibility\",\"italic\":\"false\",\"color\":\"blue\"},{\"text\":\" (12:00)\"}]','[{\"translate\":\"lore.cpp.chain\",\"italic\":\"false\",\"color\":\"blue\"},{\"text\":\" (12:00)\"}]']},id:'cpp:agentia_of_dirt',CustomModelData:12970104}"
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/advancements/agentia_of_dirt.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "criteria": {
        "consume": {
            "trigger": "minecraft:consume_item",
            "conditions": {
                "item": {
                    "nbt": "{id:'cpp:agentia_of_dirt'}"
                }
            }
        }
    },
    "rewards":{
        "function": "cpp:potion/agentia_of_dirt"
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:potion/agentia_of_dirt[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]effect give @s minecraft:invisibility 720
execute unless score @s cppChainTick matches 14400.. run scoreboard players set @s cppChainTick 14400
advancement revoke @s only cpp:potion/agentia_of_dirt
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @a[scores={cppChainTick=1..}] at @s anchored eyes run function cpp:chain/type
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:chain/type[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute positioned ^ ^ ^0.2 run particle entity_effect ~ ~-1 ~ 0.734375 0.37890625 0.3046875 1 0
scoreboard players remove @s cppChainTick 1
[省略实际效果部分]
[/font][/td][/tr]
[/table]
我们使用周期为20刻的低频来显示剩余时长。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:load[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]function cpp:tick20
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick20[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @a[scores={cppChainTick=1..}] run function cpp:chain/showtime
schedule function cpp:tick20 20t
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:chain/showtime[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players operation #min cppValue = @s cppChainTick
scoreboard players operation #min cppValue /= #20 cppValue
scoreboard players operation #sec cppValue = #min cppValue
scoreboard players operation #min cppValue /= #60 cppValue
scoreboard players operation #sec cppValue %= #60 cppValue
execute as @s[scores={cppChainTick=20..}] if score #sec cppValue matches 10.. run title @s actionbar [{"translate":"title.effect.chain"},{"score":{"name":"#min","objective":"cppValue"},"color":"gray"},{"text":":"},{"score":{"name":"#sec","objective":"cppValue"},"color":"gray"}]
execute as @s[scores={cppChainTick=20..}] if score #sec cppValue matches ..9 run title @s actionbar [{"translate":"title.effect.chain"},{"score":{"name":"#min","objective":"cppValue"},"color":"gray"},{"text":":"},{"text":"0","color":"gray"},{"score":{"name":"#sec","objective":"cppValue"},"color":"gray"}]
title @s[scores={cppChainTick=..19}] actionbar [{"text":" "}]
[/font][/td][/tr]
[/table]
[size=4][b]§5.6 头饰[/b][/size]
　　我们使用雕刻过的南瓜来实现头饰。例如：可佩戴在头部的花环。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/garland.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:carved_pumpkin",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.cpp.garland\"}'},id:'cpp:garland',CustomModelData:12970124,cppHatSlot:'hand'}"
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
处理放置方块事件的细节见 [url=§6_方块设计]§6 方块设计[/url]，我们假设已探测到南瓜位置，且玩家放置的方块的NBT信息已存储在存储区[font=Verdana]cpp:loc_block Item[/font]，我们对其进行破坏并生成原物品。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/block/put/carved_pumpkin1.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]setblock ~ ~ ~ air
kill @s
summon item ~ ~ ~ {Item:{id:"minecraft:firework_star",Count:1b,tag:{CustomModelData:12971000}},Tags:["cpp_temp"]}
data modify entity @e[type=minecraft:item,tag=cpp_temp,distance=..0.1,limit=1] Item set from storage cpp:loc_block Item
tag @e[type=minecraft:item,tag=cpp_temp,distance=..0.1,limit=1] remove cpp_temp
[/font][/td][/tr]
[/table]
　　我们将资源包内文件 [font=Verdana]assets/minecraft/textures/misc/pumpkinblur.png[/font] 设置为完全透明的图片以清除雕刻过的南瓜戴在头上的视野限制效果。对于头饰而言，我们希望其像盔甲一样在背包物品栏显示为物品的平面材质，而在玩家头部显示为立体模型。因此我们需要两套模型，并处理物品进入玩家头部和手部的事件，见[url=thread-833056-1-1.html]【1.14】物品头部/背包/手持显示不同材质/模型[/url]。
[table]
[tr=#C0C0C0][td][font=Verdana]minecraft/models/item/carved_pumpkin.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "block/orientable",
    "textures": {
        "top": "block/pumpkin_top",
        "front": "block/carved_pumpkin",
        "side": "block/pumpkin_side"
    },
    "overrides": [
        { "predicate": { "custom_model_data": 12970024 }, "model": "cpp:decor/garland"},
        { "predicate": { "custom_model_data": 12970124 }, "model": "cpp:decor/garland1"}
    ]
}
[/font][/td][/tr]
[/table]
　　在手部时，为普通物品模型。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/models/decor/garland1.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "item/generated",
    "textures": {
        "layer0": "cpp:decor/garland_item"
    }
}
[/font][/td][/tr]
[/table]
[align=center]
    [img]https://ruhuasiyu.github.io/VanillaModToturial/items/garland_item.png[/img]
   [font=楷体,楷体_GB2312] 图5.1 花环物品材质[/font]
[/align]　　在头部时，我们将其在背包的显示旋转使得只能看到方块底部，而底部材质为对应的普通物品材质。其它5个面用于显示花环的立体材质模型。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/models/decor/garland.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "cpp:decor/hat",
    "textures": {
        "hat": "cpp:decor/garland",
        "item": "cpp:decor/garland_item"
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/models/decor/hat.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "block/block",
    "display": {
        "gui": {
            "rotation": [ -90, 0, 0 ]
        }
    },
    "elements": [
        {
            "from": [ 0, 0, 0 ],
            "to": [ 16, 16, 16 ],
            "faces": {
                "down":  { "uv": [ 0, 0,16,16 ], "texture": "#item", "cullface": "down" },
                "up":     { "uv": [ 4, 0, 8, 4 ], "texture": "#hat", "cullface": "up" },
                "north": { "uv": [ 4, 4, 8, 8 ], "texture": "#hat", "cullface": "north" },
                "south": { "uv": [12, 4,16, 8 ], "texture": "#hat", "cullface": "south" },
                "west":  { "uv": [ 8, 4,12, 8 ], "texture": "#hat", "cullface": "west" },
                "east":  { "uv": [ 0, 4, 4, 8 ], "texture": "#hat", "cullface": "east" }
            }
        }
    ]
}
[/font][/td][/tr]
[/table]
[align=center]
    [img]https://ruhuasiyu.github.io/VanillaModToturial/items/garland.png[/img]
[font=楷体,楷体_GB2312]图5.2 花环方块材质[/font]
[/align][table]
[tr=#C0C0C0][td][font=Verdana]cpp/predicates/mainhand_hat.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "condition": "minecraft:entity_properties",
    "entity": "this",
    "predicate": {
        "equipment": {
            "mainhand":{
                "item": "minecraft:carved_pumpkin",
                "nbt": "{cppHatSlot:'head'}"
            }
        }
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/offhand_hat.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "condition": "minecraft:entity_properties",
    "entity": "this",
    "predicate": {
        "equipment": {
            "offhand":{
                "item": "minecraft:carved_pumpkin",
                "nbt": "{cppHatSlot:'head'}"
            }
        }
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/head_hat.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "condition": "minecraft:entity_properties",
    "entity": "this",
    "predicate": {
        "equipment": {
            "head":{
                "item": "minecraft:carved_pumpkin",
                "nbt": "{cppHatSlot:'hand'}"
            }
        }
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @a[predicate=cpp:mainhand_hat] run function cpp:decor/mainhand_hat
execute as @a[predicate=cpp:offhand_hat] run function cpp:decor/offhand_hat
execute as @a[predicate=cpp:head_hat] run function cpp:decor/head_hat
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:decor/mainhand_hat[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]setblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:"minecraft:carved_pumpkin",Count:1b}]}
data modify block ~ 255 ~ Items[0] merge from entity @s SelectedItem
execute store result score #temp cppValue run data get block ~ 255 ~ Items[0].tag.CustomModelData
execute store result block ~ 255 ~ Items[0].tag.CustomModelData int 1 run scoreboard players add #temp cppValue 100
data modify block ~ 255 ~ Items[0].tag.cppHatSlot set value "hand"
loot replace entity @s weapon.mainhand 1 mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ air
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:decor/off_hat[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]setblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:"minecraft:carved_pumpkin",Count:1b}]}
data modify block ~ 255 ~ Items[0].Count set from entity @s Inventory[{Slot:-106b}].Count
data modify block ~ 255 ~ Items[0].tag set from entity @s Inventory[{Slot:-106b}].tag
execute store result score #temp cppValue run data get block ~ 255 ~ Items[0].tag.CustomModelData
execute store result block ~ 255 ~ Items[0].tag.CustomModelData int 1 run scoreboard players add #temp cppValue 100
data modify block ~ 255 ~ Items[0].tag.cppHatSlot set value "hand"
loot replace entity @s weapon.offhand 1 mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ air
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:decor/head_hat[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]setblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:"minecraft:carved_pumpkin",Count:1b}]}
data modify block ~ 255 ~ Items[0].Count set from entity @s Inventory[{Slot:103b}].Count
data modify block ~ 255 ~ Items[0].tag set from entity @s Inventory[{Slot:103b}].tag
execute store result score #temp cppValue run data get block ~ 255 ~ Items[0].tag.CustomModelData
execute store result block ~ 255 ~ Items[0].tag.CustomModelData int 1 run scoreboard players remove #temp cppValue 100
data modify block ~ 255 ~ Items[0].tag.cppHatSlot set value "head"
loot replace entity @s armor.head 1 mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ air
[/font][/td][/tr]
[/table]
这里我们使用了潜影盒战利品表技巧来修改玩家背包物品，见 [url=thread-784662-1-1.html?cp=2]§2.5 战利品表[/url]。
[size=4][b]§5.7 盔甲[/b][/size]
　　头饰通过添加属性可以实现为头盔，但是胸甲、护腿和靴子无法通过资源包和数据包来修改其穿戴在身上时的显示材质，因为这三个栏位只接受相应类别的物品。我们只能通过诸如修改皮革盔甲颜色来达到视觉上的不同。例如：绿宝石靴子穿在脚上时，增加5点盔甲、2点盔甲韧性、4点生命值。注意，这个靴子和耐久和皮革靴子一样低。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/emerald_boots.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:leather_boots",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.cpp.emerald_boots\"}',color:1564002},id:'cpp:emerald_boots'}"
                        },
                        {
                            "function": "minecraft:set_attributes",
                            "modifiers": [
                                {
                                    "amount": 3,
                                    "name": "cpp_armor",
                                    "attribute": "generic.armor",
                                    "operation": "addition","slot": "feet"
                                },
                                {
                                    "amount": 2,
                                    "name": "cpp_armorToughness",
                                    "attribute": "generic.armorToughness",
                                    "operation": "addition",
                                    "slot": "feet"},
                                {
                                    "amount": 4,
                                    "name": "cpp_maxHealth",
                                    "attribute": "generic.maxHealth",
                                    "operation": "addition",
                                    "slot": "feet"
                                }   
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
[size=4][b]§5.8 工具和武器[/b][/size]
　　工具和武器同样可以通过原版工具和武器修改得到。例如：使用玻璃镐挖掘玻璃时，玻璃掉落自身。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/glass_pickaxe.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
        "pools": [
                {
                        "rolls": 1,
                        "entries": [
                                {
                                        "type": "minecraft:item",
                                        "name": "minecraft:stone_pickaxe",
                                        "functions": [
                                                {
                                                        "function": "minecraft:set_nbt",
                                                        "tag": "{display:{Name:'{\"translate\":\"item.cpp.glass_pickaxe\"}'},id:'cpp:glass_pickaxe',CustomModelData:12970001}"
                                                }
                                        ]
                                }
                        ]
                }
        ]
}
[/font][/td][/tr]
[/table]
　　我们对所有的玻璃和玻璃板的战利品表进行修改。
[table]
[tr=#C0C0C0][td][font=Verdana]minecraft/loot_tables/blocks/red_stained_glass.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
        "type": "minecraft:block",
        "pools": [
                {
                        "rolls": 1,
                        "conditions": [
                                {
                                        "condition": "minecraft:reference",
                                        "name": "cpp:drop_glass"
                                }
                        ],
                        "entries": [
                                {
                                        "type": "minecraft:item",
                                        "name": "minecraft:red_stained_glass"
                                }
                        ]
                }
        ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/predicates/drop_glass.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
        "condition": "minecraft:alternative",
        "terms": [
                {
                        "condition": "minecraft:match_tool",
                        "predicate": {
                                "enchantments": [
                                        {
                                                "enchantment": "minecraft:silk_touch",
                                                "levels": {
                                                        "min": 1
                                                }
                                        }
                                ]
                        }
                },
                {
                        "condition": "minecraft:match_tool",
                        "predicate": {
                                "nbt": "{id:'cpp:glass_pickaxe'}"
                        }
                }
        ]
}
[/font][/td][/tr]
[/table]
　　这些物品的耐久都是不可修改的，但是我们可以将其设置为不可破坏，然后每次使用后模拟耐久降低的过程。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:load[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard objectives add cppUseSPick minecraft.used:minecraft.stone_pickaxe
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[scores={cppUseSPick=1..}] run function cpp:tools/glass_pickaxe/reset
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tools/glass_pickaxe/reset[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players reset @s cppUseSPick
execute as @s[nbt={SelectedItem:{tag:{id:"cpp:glass_pickaxe"}}}] run function cpp:tools/glass_pickaxe/damage
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tools/glass_pickaxe/damage[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]data modify storage cpp:temp Item set from entity @s SelectedItem
function cpp:damage_tool
execute if score #damage cppValue matches 99.. run data remove storage cpp:temp Item
setblock ~ 255 ~ shulker_box
data modify block ~ 255 ~ Items append from storage cpp:temp Item
loot replace entity @s weapon.mainhand 1 mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ minecraft:air
[/font][/td][/tr]
[/table]
函数 [font=Verdana]cpp:damage_tool[/font] 见 [url=thread-784662-1-1.html?cp=5]§5.2 右键交互[/url]，这里省略。这里我们使用了潜影盒战利品表技巧来修改玩家背包物品，见 [url=thread-784662-1-1.html?cp=2]§2.5 战利品表[/url]。
[size=4][b]§5.9 画[/b][/size]
　　我们使用指定内含物的物品展示框来实现自定义的画。例如：放置经典画作后显示一幅画，右键可以切换。
　　我们为烟火之星 [font=Verdana]CustomModelData[/font] 为 [font=Verdana]12974001-12974100[/font] 指定100个平面画模型。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/classical_painting.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
        "pools": [
                {
                        "rolls": 1,
                        "entries": [
                                {
                                        "type": "minecraft:item",
                                        "name": "minecraft:item_frame",
                                        "functions": [
                                                {
                                                        "function": "minecraft:set_nbt",
                                                        "tag": "{display:{Name:'{\"translate\":\"item.cpp.classical_painting\"}'},id:'cpp:classical_painting',CustomModelData:12970002,EntityTag:{Item:{id:'minecraft:firework_star',Count:1b,tag:{CustomModelData:12974001,cppMachineBg:1b}},Tags:['cpp_item_frame_classical_painting','cpp_special_item_frame']}}"
                                                }
                                        ]
                                }
                        ]
                }
        ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @e[type=minecraft:item_frame,tag=cpp_special_item_frame] at @s run function cpp:item_frame/special
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:item_frame/special[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[nbt={Facing:0b}] if block ~ ~1 ~ #cpp:fluid run function cpp:item_frame/special_break
execute as @s[nbt={Facing:1b}] if block ~ ~-1 ~ #cpp:fluid run function cpp:item_frame/special_break
execute as @s[nbt={Facing:2b}] if block ~ ~ ~1 #cpp:fluid run function cpp:item_frame/special_break
execute as @s[nbt={Facing:3b}] if block ~ ~ ~-1 #cpp:fluid run function cpp:item_frame/special_break
execute as @s[nbt={Facing:4b}] if block ~1 ~ ~ #cpp:fluid run function cpp:item_frame/special_break
execute as @s[nbt={Facing:5b}] if block ~-1 ~ ~ #cpp:fluid run function cpp:item_frame/special_break
execute unless block ~ ~ ~ #cpp:fluid run function cpp:item_frame/special_break
execute unless data entity @s Item.id run function cpp:item_frame/special_break
execute as @s[nbt={ItemRotation:1b}] run function cpp:item_frame/special_rot
[/font][/td][/tr]
[/table]
方块标签 [font=Verdana]cpp:fluid[/font] 见 [url=thread-784662-1-1.html?cp=2]§2.9 标签[/url]。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:item_frame/special_break[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[tag=cpp_item_frame_classical_painting] run loot spawn ~ ~ ~ loot cpp:classical_painting
kill @s
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:item_frame/special_rot[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute store result entity @s Item.tag.CustomModelData int 1.00000008 run data get entity @s Item.tag.CustomModelData
data modify entity @s ItemRotation set value 0b
data modify entity @s[nbt={Item:{tag:{CustomModelData:12974101}}}] Item.tag.CustomModelData set value 12974001
[/font][/td][/tr]
[/table]
　　自定义地图也可以用来显示自定义的图案，这个方法可避免使用资源包，但需将[font=Verdana]data[/font]文件与数据包一同发布。首先确定好长宽比例，然后使用[url=https://mc-map.djfun.de]MC Map Item Tool[/url]在线转换。注意这个网站生成的地图已经不符合1.14+版本的地图格式了，请在本地生成锁定图案的地图后将该网站生成的地图的[font=Verdana]colors[/font]这个NBT复制过来。这些地图文件位于[font=Verdana]世界名称/data[/font]文件夹。发布时，将其和数据包一同发布。使用命令 [font=Verdana]give @s minecraft:filled_map{map:[数值]}[/font] 获取相应地图。选择负数的自定义地图的编号，或者手动将[font=Verdana]data[/font]文件夹中的[font=Verdana]idcounts[/font]调大，可避免和玩家在游戏内生成的地图编号冲突。

[page]
[size=5][b]§6 方块设计[/b][/size]
　　原版模组无法添加方块，一般的做法是修改方块物品的 [font=Verdana]CustomModelData[/font]的模型后，在方块位置生成并头戴相应物品的盔甲架。参考
[list]
[*][url=thread-771638-1-1.html]使用局部坐标做到找到玩家指的地方[/url]
[*][url=thread-825546-1-1.html]完美的自定义方块堆叠[/url]
[*][url=thread-824528-1-1.html]自定义方块(玩家头颅)[/url]
[*][url=thread-916294-1-1.html]【原版模组】【前置】方块通用处理[/url]
[/list]
首先我们根据 [url=thread-784662-1-1.html?cp=5]§5 物品设计[/url]来将方块对应的物品设计好。
[size=4][b]§6.1 视线追踪法[/b][/size]
　　使用进度判断玩家放置了某物品，然后剥夺进度，递归获取该方块位置。如果视线上没有该方块，有可能是玩家将其对准下台阶或上台阶放置的，此时需要向上或向下平移一格检测。最后获取该方块位置，放置盔甲架，并将相应物品[font=Verdana]loot[/font]进盔甲架头部位置。例如：放置 [font=Verdana]stone{id:"foo:bar"}[/font]。
[table]
[tr=#C0C0C0][td][font=Verdana]foo/advancements/block/bar.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "criteria": {
        "put_furnace": {
            "trigger": "minecraft:placed_block",
            "conditions": {
                "item": {
                    "nbt":"{id:'foo:bar'}"
                }
            }
        }
    },
    "rewards": {
        "function": "foo:block/bar/reset"
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]foo:block/bar/reset[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]advancement revoke @s only foo:block/bar
execute anchored eyes run function foo:block/bar/ray
execute unless entity @e[type=area_effect_cloud,distance=..7,tag=foo_block_pos] positioned ~ ~1 ~ anchored eyes run function foo:block/bar/ray
execute unless entity @e[type=area_effect_cloud,distance=..7,tag=foo_block_pos] positioned ~ ~-1 ~ anchored eyes run function foo:block/bar/ray
execute at @e[type=area_effect_cloud,distance=..7,tag=foo_block_pos] run function foo:block/bar/put
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]foo:block/bar/ray[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute if entity @s[distance=..7] positioned ^ ^ ^ if block ~ ~ ~ stone align xyz positioned ~0.5 ~ ~0.5 unless entity @e[type=minecraft:armor_stand,distance=..0.5,tag=foo_block] run summon minecraft:area_effect_cloud ~ ~ ~ {Tags:["foo_block_pos"]}
execute if entity @s[distance=..7] unless entity @e[type=minecraft:area_effect_cloud,distance=..6,tag=foo_block_pos] positioned ^ ^ ^0.005 anchored feet run function foo:block/bar/ray
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]foo:block/bar/put[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Small:1b,Marker:1b,NoGravity:1b,DisabledSlots:7967,Tags:["foo_block","foo_bar"]}
loot replace entity @e[type=minecraft:armor_stand,limit=1,distance=..0.01] armor.head 1 loot foo:bar
kill @e[type=area_effect_cloud,distance=..0.01,tag=foo_block_pos]
[/font][/td][/tr]
[/table]
　　注意到我们在视线追踪是进行了当前方块内是否已有 [font=Verdana]foo_block[/font] 标签的盔甲架的判断。这在处理完整方块时是可以省略的，但是对于非完整方块，视线上可能已经有之前放置过的模组物品对应的盔甲架，使用该项判断可以避免在一个格子内放置两个盔甲架，而忽略掉后放的方块。
　　然而，这个做法仍然对其它模组的方块无效，因为你无法知道其它模组使用了何种标签。所以更严格的做法是判断当前方块处是否有头部佩戴拥有[font=Verdana]tag.id[/font]物品的盔甲架。尽管这也不能保证万无一失，但确实可以降低冲突率。具体代码读者可自行实现。
　　最后，判断玩家主副手，并将相应的物品信息复制到盔甲架头部。不直接使用 [font=Verdana]loot[/font] 命令复制到盔甲架头部是为了在之后的破坏事件中保留原物品的额外信息，例如玩家重命名的名称等。
[size=4][b]§6.2 计算交点法[/b][/size]
　　例如：放置某模组的所有方块，[font=Verdana]CustomModelData[/font] 位于[font=Verdana]12970000-12979999[/font]。
　　向物品标签 [font=Verdana]cpp:blocks[/font] 添加所有原版的方块，然后添加断言来判断玩家主手是不是方块。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/predicates/block_on_mainhand.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "condition": "minecraft:entity_properties",
    "entity": "this",
    "predicate": {
        "equipment": {
            "mainhand":{
                "tag": "cpp:blocks"
            }
        }
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/advancements/blocks/put_mod_block.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "criteria": {
        "machine": {
            "trigger": "minecraft:placed_block",
            "conditions": {
                "item": {
                    "tag":"cpp:blocks"
                }
            }
        }
    },
    "rewards": {
        "function": "cpp:blocks/reset"
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/functions/blocks/reset.mcfunction[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]advancement revoke @s only cpp:blocks/put_mod_block
execute as @s[predicate=cpp:block_on_mainhand] if data entity @s SelectedItem.tag.id run function cpp:blocks/pos_main
execute as @s[predicate=!cpp:block_on_mainhand] if data entity @s Inventory[{Slot:-106b}].tag.id run function cpp:blocks/pos_off
[/font][/td][/tr]
[/table]
根据主副手获取物品信息并存储。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/functions/blocks/pos_main.mcfunction[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]data modify storage cpp:putted_block Item set from entity @s SelectedItem
execute store result score #put_block_cmd cppValue run data get storage cpp:putted_block Item.tag.CustomModelData
execute if score #put_block_cmd cppValue matches 12970000..12979999 run function cpp:blocks/pos
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/functions/blocks/pos_off.mcfunction[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]data modify storage cpp:putted_block Item set from entity @s Inventory[{Slot:-106b}]
data remove storage cpp:putted_block Item.Slot
execute store result score #put_block_cmd cppValue run data get storage cpp:putted_block Item.tag.CustomModelData
execute if score #put_block_cmd cppValue matches 12970000..12979999 run function cpp:blocks/pos
[/font][/td][/tr]
[/table]
　　进行计算的初始化。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/functions/blocks/pos.mcfunction[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]# 调整数量
data modify storage cpp:putted_block Item.Count set value 1b
# 然后记录玩家和视线坐标
execute anchored eyes run summon armor_stand ^ ^ ^ {Tags:["cpp_block_ray_as"],Invulnerable:1b,Invisible:1b,Small:1b,Marker:1b,NoGravity:1b}
execute store result score #x cppValue run data get entity @e[type=minecraft:armor_stand,distance=..3,tag=cpp_block_ray_as,limit=1] Pos[0] 1000
execute store result score #y cppValue run data get entity @e[type=minecraft:armor_stand,distance=..3,tag=cpp_block_ray_as,limit=1] Pos[1] 1000
execute store result score #z cppValue run data get entity @e[type=minecraft:armor_stand,distance=..3,tag=cpp_block_ray_as,limit=1] Pos[2] 1000
execute anchored eyes run summon armor_stand ^ ^ ^1 {Tags:["cpp_face_mk"],Invulnerable:1b,Invisible:1b,Small:1b,Marker:1b,NoGravity:1b}
execute store result score #f cppValue run data get entity @e[type=minecraft:armor_stand,distance=..3,tag=cpp_face_mk,limit=1] Pos[0] 1000
execute store result score #g cppValue run data get entity @e[type=minecraft:armor_stand,distance=..3,tag=cpp_face_mk,limit=1] Pos[1] 1000
execute store result score #h cppValue run data get entity @e[type=minecraft:armor_stand,distance=..3,tag=cpp_face_mk,limit=1] Pos[2] 1000
kill @e[type=minecraft:armor_stand,tag=cpp_face_mk]
# 玩家位置是否是特定方块
execute as @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as] at @s align xyz positioned ~0.5 ~ ~0.5 unless entity @e[type=minecraft:armor_stand,distance=..0.1,tag=cpp_block] unless block ~ ~ ~ #cpp:fluid run function cpp:blocks/compare
# 记录朝向的坐标
scoreboard players operation #f cppValue -= #x cppValue
scoreboard players operation #g cppValue -= #y cppValue
scoreboard players operation #h cppValue -= #z cppValue
# 记录朝向的符号
scoreboard players operation #sf cppValue = #f cppValue
scoreboard players operation #sg cppValue = #g cppValue
scoreboard players operation #sh cppValue = #h cppValue
# 根据朝向符号调整坐标值
execute if score #sf cppValue matches ..-1 run scoreboard players operation #x cppValue *= #-1 cppValue
execute if score #sg cppValue matches ..-1 run scoreboard players operation #y cppValue *= #-1 cppValue
execute if score #sh cppValue matches ..-1 run scoreboard players operation #z cppValue *= #-1 cppValue
execute if score #sf cppValue matches ..-1 run scoreboard players operation #f cppValue *= #-1 cppValue
execute if score #sg cppValue matches ..-1 run scoreboard players operation #g cppValue *= #-1 cppValue
execute if score #sh cppValue matches ..-1 run scoreboard players operation #h cppValue *= #-1 cppValue
# 获取与方块交点
execute unless entity @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_put_pos] run function cpp:blocks/loop
# 若未找到，尝试找上方一格位置
execute unless entity @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_put_pos] as @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as] at @s run tp ~ ~1 ~
execute as @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as] at @s align xyz positioned ~0.5 ~ ~0.5 unless entity @e[type=minecraft:armor_stand,distance=..0.1,tag=cpp_block] unless block ~ ~ ~ #cpp:fluid run function cpp:blocks/compare
# 若未找到，尝试找下方一格位置
execute unless entity @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_put_pos] as @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as] at @s run tp ~ ~-2 ~
execute as @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as] at @s align xyz positioned ~0.5 ~ ~0.5 unless entity @e[type=minecraft:armor_stand,distance=..0.1,tag=cpp_block] unless block ~ ~ ~ #cpp:fluid run function cpp:blocks/compare
# 放置盔甲架
execute at @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_put_pos,sort=nearest,limit=1] align xyz positioned ~0.5 ~ ~0.5 run function cpp:blocks/put
kill @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as]
[/font][/td][/tr]
[/table]
　　递归计算视线上的每一个方块交点。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/functions/blocks/loop.mcfunction[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]tag @e[type=minecraft:armor_stand,distance=..0.01,tag=cpp_block_ray_as,tag=cpp_temp] remove cpp_temp
# 计算三交点参数
scoreboard players operation #t1 cppValue = #x cppValue
scoreboard players operation #t1 cppValue *= #-1 cppValue
scoreboard players operation #t1 cppValue %= #1000 cppValue
execute if score #t1 cppValue matches 0..1 run scoreboard players add #t1 cppValue 1000
scoreboard players operation #t1 cppValue *= #1000 cppValue
scoreboard players operation #t1 cppValue /= #f cppValue
scoreboard players operation #t2 cppValue = #y cppValue
scoreboard players operation #t2 cppValue *= #-1 cppValue
scoreboard players operation #t2 cppValue %= #1000 cppValue
execute if score #t2 cppValue matches 0..1 run scoreboard players add #t2 cppValue 1000
scoreboard players operation #t2 cppValue *= #1000 cppValue
scoreboard players operation #t2 cppValue /= #g cppValue
scoreboard players operation #t3 cppValue = #z cppValue
scoreboard players operation #t3 cppValue *= #-1 cppValue
scoreboard players operation #t3 cppValue %= #1000 cppValue
execute if score #t3 cppValue matches 0..1 run scoreboard players add #t3 cppValue 1000
scoreboard players operation #t3 cppValue *= #1000 cppValue
scoreboard players operation #t3 cppValue /= #h cppValue
# 比较交点远近
scoreboard players set #align cppValue 1
execute if score #t1 cppValue > #t2 cppValue if score #t3 cppValue > #t2 cppValue run scoreboard players set #align cppValue 2
execute if score #t1 cppValue > #t3 cppValue if score #t2 cppValue > #t3 cppValue run scoreboard players set #align cppValue 3
execute if score #align cppValue matches 1 run scoreboard players operation #t cppValue = #t1 cppValue
execute if score #align cppValue matches 2 run scoreboard players operation #t cppValue = #t2 cppValue
execute if score #align cppValue matches 3 run scoreboard players operation #t cppValue = #t3 cppValue
# 计算交点坐标
scoreboard players operation #s1 cppValue = #f cppValue
scoreboard players operation #s2 cppValue = #g cppValue
scoreboard players operation #s3 cppValue = #h cppValue
scoreboard players operation #s1 cppValue *= #t cppValue
scoreboard players operation #s2 cppValue *= #t cppValue
scoreboard players operation #s3 cppValue *= #t cppValue
scoreboard players operation #s1 cppValue /= #1000 cppValue
scoreboard players operation #s2 cppValue /= #1000 cppValue
scoreboard players operation #s3 cppValue /= #1000 cppValue
scoreboard players operation #x cppValue += #s1 cppValue
scoreboard players operation #y cppValue += #s2 cppValue
scoreboard players operation #z cppValue += #s3 cppValue
# 存储交点
summon armor_stand ~ ~ ~ {Tags:["cpp_block_ray_as","cpp_temp"],Invulnerable:1b,Invisible:1b,Small:1b,Marker:1b,NoGravity:1b}
execute if score #sf cppValue matches 0.. store result entity @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as,tag=cpp_temp,limit=1] Pos[0] double 0.001 run scoreboard players get #x cppValue
execute if score #sg cppValue matches 0.. store result entity @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as,tag=cpp_temp,limit=1] Pos[1] double 0.001 run scoreboard players get #y cppValue
execute if score #sh cppValue matches 0.. store result entity @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as,tag=cpp_temp,limit=1] Pos[2] double 0.001 run scoreboard players get #z cppValue
# 根据朝向符号调整坐标
execute if score #sf cppValue matches ..-1 store result entity @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as,tag=cpp_temp,limit=1] Pos[0] double -0.001 run scoreboard players get #x cppValue
execute if score #sg cppValue matches ..-1 store result entity @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as,tag=cpp_temp,limit=1] Pos[1] double -0.001 run scoreboard players get #y cppValue
execute if score #sh cppValue matches ..-1 store result entity @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as,tag=cpp_temp,limit=1] Pos[2] double -0.001 run scoreboard players get #z cppValue
# 玩家位置是否是特定方块
execute as @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as,tag=cpp_temp] at @s align xyz positioned ~0.5 ~ ~0.5 unless entity @e[type=minecraft:armor_stand,distance=..0.1,tag=cpp_block] run function cpp:blocks/compare
tellraw @p {"nbt":"Pos","entity":"@e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as,tag=cpp_temp,limit=1]"}
# 若未找到，循环
execute unless entity @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_put_pos] at @e[type=minecraft:armor_stand,distance=..9,tag=cpp_block_ray_as,tag=cpp_temp] if entity @s[distance=..6] run function cpp:blocks/loop
[/font][/td][/tr]
[/table]
　　判断当前方块是否为我们所需的。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/functions/blocks/loop.mcfunction[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]loot replace entity @s weapon.mainhand 1 mine ~ ~ ~ shears{Enchantments:[{id:"minecraft:silk_touch",lvl:1s}]}
execute store result score @s cppValue run data modify entity @s HandItems[0].id set from storage cpp:putted_block Item.id
tag @s[scores={cppValue=0}] add cpp_block_put_pos
[/font][/td][/tr]
[/table]
　　在找到的位置处放置盔甲架。对于特殊的方块物品，我们需要对盔甲架进行预处理或调整，例如
[list]
[*]有朝向的我们需要根据玩家朝向来放置不同朝向的方块。
[*]告示牌我们需要根据朝向来调整盔甲架位置和朝向。
[*]树苗花草作物我们需要放置后调整 [font=Verdana]CustomModelData[/font]，因为一般手持为平面材质模型。
[*]需要添加额外标签以便于处理的。
[/list]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/functions/blocks/put.mcfunction[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]# 预处理朝向、标签
execute if block ~ ~ ~ barrel run function cpp:blocks/put/barrel
execute if block ~ ~ ~ chest run function cpp:blocks/put/chest
execute if block ~ ~ ~ oak_sign run function cpp:blocks/put/oak_sign
execute if block ~ ~ ~ oak_wall_sign run function cpp:blocks/put/oak_wall_sign
# 放置头部物
execute unless entity @e[type=minecraft:armor_stand,distance=..0.5,tag=cpp_block] run summon armor_stand ~ ~ ~ {Invulnerable:1b,Invisible:1b,Small:1b,Marker:1b,NoGravity:1b,DisabledSlots:7967,Tags:["cpp_block"]}
data modify entity @e[type=minecraft:armor_stand,tag=cpp_block,distance=..0.5,limit=1] ArmorItems[3] set from storage cpp:putted_block Item
# 调整头部物
execute if block ~ ~ ~ acacia_leaves as @e[type=minecraft:armor_stand,tag=cpp_block,distance=..0.5,limit=1] run function cpp:blocks/put/acacia_leaves1
execute if block ~ ~ ~ acacia_sapling as @e[type=minecraft:armor_stand,tag=cpp_block,distance=..0.5,limit=1] run function cpp:blocks/put/acacia_sapling1
execute if block ~ ~ ~ barrel as @e[type=minecraft:armor_stand,tag=cpp_block,distance=..0.5,limit=1] run function cpp:blocks/put/barrel1
execute if block ~ ~ ~ carved_pumpkin as @e[type=minecraft:armor_stand,tag=cpp_block,distance=..0.5,limit=1] run function cpp:blocks/put/carved_pumpkin1
execute if block ~ ~ ~ chest as @e[type=minecraft:armor_stand,tag=cpp_block,distance=..0.5,limit=1] run function cpp:blocks/put/chest1
execute if block ~ ~ ~ gold_block as @e[type=minecraft:armor_stand,tag=cpp_block,distance=..0.5,limit=1] run function cpp:blocks/put/gold_block1
execute if block ~ ~ ~ oak_sign as @e[type=minecraft:armor_stand,tag=cpp_block,distance=..0.5,limit=1] run function cpp:blocks/put/oak_sign1
execute if block ~ ~ ~ oak_wall_sign as @e[type=minecraft:armor_stand,tag=cpp_block,distance=..0.5,limit=1] run function cpp:blocks/put/oak_wall_sign1
# 重置存储
data remove storage cpp:putted_block Item
[/font][/td][/tr]
[/table]
　　尽管看上去比较长，但是递归的次数很少，命令数比视线追踪法还是要少很多。注意由于对玩家坐标乘了1000倍，因此玩家坐标绝对值大于2147484时，会溢出而导致无法使用，可以通过降低精准度(修改为70倍)来避免溢出。
[size=4][b]§6.3 破坏事件[/b][/size]
　　例如：破坏自定义的树叶。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @e[type=minecraft:armor_stand,tag=cpp_leaves] at @s unless block ~ ~ ~ acacia_leaves run function cpp:blocks/break/acacia_leaves
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:blocks/break/acacia_leaves[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]# 树叶
tag @e[type=minecraft:item,sort=nearest,nbt={Age:0s,Item:{id:"minecraft:acacia_leaves",Count:1b}},limit=1,distance=..2] add cpp_block_drop
tag @e[type=minecraft:item,sort=nearest,nbt={Age:1s,Item:{id:"minecraft:acacia_leaves",Count:1b}},limit=1,distance=..2] add cpp_block_drop
data modify entity @e[type=minecraft:item,sort=nearest,tag=cpp_block_drop,limit=1,distance=..2] Item set from entity @s ArmorItems[3]
tag @e[type=minecraft:item,distance=..2,tag=cpp_block_drop] remove cpp_block_drop
# 树苗
tag @e[type=minecraft:item,sort=nearest,nbt={Age:0s,Item:{id:"minecraft:acacia_sapling",Count:1b}},limit=1,distance=..2] add cpp_block_drop
tag @e[type=minecraft:item,sort=nearest,nbt={Age:1s,Item:{id:"minecraft:acacia_sapling",Count:1b}},limit=1,distance=..2] add cpp_block_drop
execute as @s[tag=cpp_ore_leaves] at @e[type=minecraft:item,sort=nearest,tag=cpp_block_drop,limit=1,distance=..2] run loot spawn ~ ~ ~ loot cpp:ore_sapling
execute as @s[tag=cpp_wool_leaves] at @e[type=minecraft:item,sort=nearest,tag=cpp_block_drop,limit=1,distance=..2] run loot spawn ~ ~ ~ loot cpp:wool_sapling
execute as @s[tag=cpp_fruit_leaves] at @e[type=minecraft:item,sort=nearest,tag=cpp_block_drop,limit=1,distance=..2] run loot spawn ~ ~ ~ loot cpp:fruit_sapling
kill @e[type=minecraft:item,distance=..2,tag=cpp_block_drop]
kill @s
[/font][/td][/tr]
[/table]
　　我们将最近的 [font=Verdana]Age:0s[/font] (挖掘)和 [font=Verdana]Age:1s[/font] (自然腐烂)的物品添加标签，然后修改其为盔甲架头部存储物。
[size=4][b]§6.4 模型设置[/b][/size]
　　使用如下的 [font=Verdana]display[/font] 来放缩物品在头部的大小，可以保证其与坐标轴基本对齐。
[table]
[tr=#C0C0C0][td][font=Verdana]assets/cpp/models/material/moon_stone.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "block/cube_all",
    "display": {
        "head": {
            "rotation": [ 0, 0, 0 ],
            "translation": [ 0, -14.65, 0 ],
            "scale": [ 2.29, 2.29, 2.29 ]
        }
    },
    "textures": {
        "all": "cpp:material/moon_stone"
    }
}
[/font][/td][/tr]
[/table]

[page]
[size=5][b]§7 合成与烧炼[/b][/size]
[size=4][b]§7.1 语法[/b][/size]
　　原版的合成、烧炼使用配方文件即可实现，较为简单，但是无法识别nbt，因此只能实现原版物品的合成和烧炼。同时模组若使用了相关物品，则相应的模组物品亦可代替原物品进行合成。
　　配方的通用语法为
[table]
[tr=#505050][td][color=#FFFFFF][align=center][b]含义[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]键[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]值[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]说明[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td=1,8][color=#000000][align=center][b]合成的类别[/b][/align][/color][/td][td=1,8][font=Verdana]type[/font][/td][td][font=Verdana]minecraft:crafting_shaped[/font][/td][td]工作台有序合成配方[/td][/tr]
[tr=#FFFFFF][td][font=Verdana]minecraft:crafting_shapeless[/font][/td][td]工作台无序合成配方[/td][/tr]
[tr=#FFFFFF][td][font=Verdana]minecraft:crafting_special_*[/font][/td][td]工作台特殊合成配方，处理皮革盔甲染色、烟火之星、地图复制等情形，不可手动配置。 [/td][/tr]
[tr=#FFFFFF][td][font=Verdana]minecraft:stonecutting[/font][/td][td]切石机合成配方[/td][/tr]
[tr=#FFFFFF][td][font=Verdana]minecraft:smelting[/font][/td][td]熔炉烧炼配方[/td][/tr]
[tr=#FFFFFF][td][font=Verdana]minecraft:blasting[/font][/td][td]高炉烧炼配方[/td][/tr]
[tr=#FFFFFF][td][font=Verdana]minecraft:smoking[/font][/td][td]
[/td][/tr]
[tr=#FFFFFF][td][font=Verdana]minecraft:campfire_cooking[/font][/td][td]营火烧炼配方[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]配方的分类[/b][/align][/color][/td][td][font=Verdana]group[/font][/td][td]字符串[/td][td]具有相同该标识符的配方会在配方书中显示为一组。对特殊合成配方无效。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]合成样式[/b][/align][/color][/td][td][font=Verdana]pattern[/font][/td][td]字符串[/td][td]有序合成的合成样式，其中每个字符表示一个物品，空格表示空缺。可以比[font=Verdana]3×3[/font]小。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]配方材料[/b][/align][/color][/td][td][font=Verdana]key.[字符][/font][/td][td]列表或JSON对象[/td][td]有序合成的 [font=Verdana]pattern[/font] 中字符与物品的对应。可以只含一个 [font=Verdana]item[/font] 或 [font=Verdana]tag[/font]；也可以是一个列表，列表中每个元素是一个 [font=Verdana]item[/font] 或 [font=Verdana]tag[/font]。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]配方配料[/b][/align][/color][/td][td][font=Verdana]ingredient[/font][/td][td]列表或JSON对象[/td][td]无序合成、切石机、烧炼的原材料。如果是切石机或烧炼，可以为这个列表中的任一物品或物品标签；如果是无序合成，配方就是这个列表中的每一个物品或物品标签。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]合成的结果物品[/b][/align][/color][/td][td][font=Verdana]result.item[/font][/td][td]物品ID[/td][td]合成的结果物品。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]合成的结果数量[/b][/align][/color][/td][td][font=Verdana]result.count[/font][/td][td]数字[/td][td]合成配方的物品数量，缺省为[font=Verdana]1[/font]。切石机配方的物品数量，不可省略。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]烧炼经验[/b][/align][/color][/td][td][font=Verdana]experience[/font][/td][td]数字[/td][td]烧炼配方产生的经验值，可以为小数。[/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]烧炼耗时[/b][/align][/color][/td][td][font=Verdana]cookingtime[/font][/td][td]数字[/td][td]烧炼所需的刻数，若缺省则使用默认的时间，熔炉烟熏炉为[font=Verdana]200[font=Verdana]，高炉营火为[font=Verdana]100[/font]。[/font][/font][/td][/tr]
[/table]
[size=4][b]§7.2 有序合成[/b][/size]
　　例：使用8羊毛+鸡蛋有序合成两个羊刷怪蛋。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/recipes/sheep_spawn_egg.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "type": "minecraft:crafting_shaped",
    "pattern": [
        "###",
        "#*#",
        "###"
    ],
    "key": {
        "*": {
            "item": "minecraft:egg"
        },
        "#": {
            "tag": "cpp:wools"
        }
    },
    "result": {
        "item": "minecraft:sheep_spawn_egg",
        "count":2
    }
}
[/font][/td][/tr]
[/table]
这里 [font=Verdana]cpp:wools[/font] 为自定义的包含所有颜色羊毛的物品标签。
[size=4][b]§7.3 无序合成[/b][/size]
　　例：2沙子+红石=2红沙。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/recipes/red_sand.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "type": "minecraft:crafting_shapeless",
    "ingredients": [
        {
            "item": "minecraft:sand"
        },
        {
            "item": "minecraft:sand"
        },
        {
            "item": "minecraft:redstone"
        }
    ],
    "result": {
        "item": "minecraft:red_sand",
        "count":2
    }
}
[/font][/td][/tr]
[/table]
　　配料可以重复。单个物品配方请使用有序合成而不是无序合成。
[size=4][b]§7.4 切石机配方[/b][/size]
　　例：使用切石机切割橡木木板为2台阶。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/recipes/stonecutting/oak_slab.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "type": "minecraft:stonecutting",
    "ingredient": {
        "item": "minecraft:oak_planks"
    },
    "result": "minecraft:oak_slab",
    "count": 2
}
[/font][/td][/tr]
[/table]
[size=4][b]§7.5 烧炼配方[/b][/size]
　　例：熔炉烧炼皮革装备、腐肉、鞍为兔子皮。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/recipes/rabbit_hide_from_smelting.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "type": "minecraft:smelting",
    "ingredient": [
        {
            "item": "minecraft:rotten_flesh"
        },
        {
            "item": "minecraft:leather_helmet"
        },
        {
            "item": "minecraft:leather_chestplate"
        },
        {
            "item": "minecraft:leather_leggings"
        },
        {
            "item": "minecraft:leather_boots"
        },
        {
            "item": "minecraft:saddle"
        }
    ],
    "result": "minecraft:rabbit_hide",
    "experience": 0.1,
    "cookingtime": 200
}
[/font][/td][/tr]
[/table]
[size=4][b]§7.6 覆盖原版配方[/b][/size]
　　如果想要修改原版的合成或烧炼配方，先使用压缩软件打开版本 [font=Verdana].jar[/font] 文件，依次打开 [font=Verdana]data/minecraft/recipes[/font]，找到相应的配方文件，然后在自己的数据包中的相同位置（必然是 [font=Verdana]minecraft[/font] 命名空间下）放入同名文件即可覆盖默认的配方。
　　例：将橡木台阶合成数量改为8。
[table]
[tr=#C0C0C0][td][font=Verdana]minecraft/recipes/oak_stairs.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "type": "minecraft:crafting_shaped",
    "group": "wooden_stairs",
    "pattern": [
        "#  ",
        "## ",
        "###"
    ],
    "key": {
        "#": {
            "item": "minecraft:oak_planks"
        }
    },
    "result": {
        "item": "minecraft:oak_stairs",
        "count": 8
    }
}
[/font][/td][/tr]
[/table]
　　例：将原版白色床+墨囊=黑色床的合成配方修改为任意床+墨囊=黑色床。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/tags/items/beds.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "replace": false,
    "values": [
        "minecraft:white_bed",
        "minecraft:orange_bed",
        "minecraft:magenta_bed",
        "minecraft:light_blue_bed",
        "minecraft:yellow_bed",
        "minecraft:lime_bed",
        "minecraft:pink_bed",
        "minecraft:gray_bed",
        "minecraft:light_gray_bed",
        "minecraft:cyan_bed",
        "minecraft:purple_bed",
        "minecraft:blue_bed",
        "minecraft:brown_bed",
        "minecraft:green_bed",
        "minecraft:red_bed",
        "minecraft:black_bed"
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]minecraft/recipes/black_bed_from_white_bed.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "type": "crafting_shapeless",
    "group": "dyed_bed",
    "ingredients": [
        {
            "tag": "cpp:beds"
        },
        {
            "item": "minecraft:black_dye"
        }
    ],
    "result": {
        "item": "minecraft:black_bed"
    }
}
[/font][/td][/tr]
[/table]
　　如果需要删除原版配方，可使用生存无法获得的方块如基岩=基岩、屏障=屏障、结构空位等物品来合成。配方文件内容为 [font=Verdana]{}[/font] 时会被认为是错误文件而无法覆盖原配方。
[size=4][b]§7.7 配方获取[/b][/size]
　　一个完整的配方应当有相应的进度来使玩家获取之，通常触发器为玩家背包含有合成材料。也可以根据需要在函数中使用命令 [font=Verdana]recipe[/font] 给予。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/advancements/recipes/dirt_from_cobblestone_snowball.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "criteria": {
        "cobblestone": {
            "trigger": "minecraft:inventory_changed",
            "conditions": {
                "items": [
                    {
                        "item": "minecraft:cobblestone",
                        "count": {
                            "min": 8
                        }
                    }
                ]
            }
        },
        "snowball": {
            "trigger": "minecraft:inventory_changed",
            "conditions": {
                "items": [
                    {
                        "item": "minecraft:snowball"
                    }
                ]
            }
        },
        "has_the_recipe": {
            "trigger": "minecraft:recipe_unlocked",
            "conditions": {
                "recipe": "cpp:dirt_from_cobblestone_snowball"
            }
        }
    },
    "rewards":{
        "recipes": ["cpp:dirt_from_cobblestone_snowball"]
    },
    "requirements": [
        [
            "cobblestone",
            "snowball",
            "has_the_recipe"
        ]
    ]
}
[/font][/td][/tr]
[/table]

[page]
[size=5][b]§8 机器设计[/b][/size]
　　本节我们将通过一个较为复杂的机器的例子，来了解如何设计一个机器。
　　首先参考 [url=thread-784662-1-1.html?cp=5]§5 物品设计[/url]和 [url=thread-784662-1-1.html?cp=6]§6 方块设计[/url]将机器方块设计好，我们这里选择木桶，如果有必要，使用箱子也可以。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/all_in_one_machine.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:barrel",
                    "functions": [
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{display:{Name:'{\"translate\":\"item.cpp.all_in_one_machine\"}'},id:'cpp:all_in_one_machine',CustomModelData:12970001}"
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
　　然后绘制 GUI。这个机器包括：左侧可选择温度和压强，可将输出栏物品输入到邻近的容器。
[list]
[*]GUI 整体是左上槽位的一个物品放大一定倍数并平移之后得到的。
[*]按钮、进度条、经验均为物品模型。
[*]其余背景位置以及输出槽均为完全透明物品的模型。
[*]注意这些物品不可以为方块的自定义模型，因为方块的模型的透明部分会变成黑色或白色（1.15快照版本特性）。1.15的光照也有点问题。
[/list]
[align=center]
    [img]https://ruhuasiyu.github.io/VanillaModToturial/items/机器GUI.png" width="50%[/img]
[font=楷体,楷体_GB2312]图8.1 机器GUI[/font]
[/align]
[size=4][b]§8.1 GUI材质模型[/b][/size]
　　物品的默认大小为[font=Verdana]16×16[/font]，所以如果我们想要将其放大n倍，就需要绘制大小为[font=Verdana]16n×16n[/font]的材质，以对齐边缘和像素。
　　该模型用于机器的GUI，我们将其大小放大了12倍，也就是[font=Verdana]192×192[/font]大小。所以我们需要绘制这个大小的整数倍的材质。通过修改z轴高度可调整材质的覆盖次序。
[table]
[tr=#C0C0C0][td][font=Verdana]assets/cpp/models/machine/gui/temp.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "elements": [
        {
            "from": [ -16, -16, 0 ],
            "to": [ 32, 32, 1 ],
            "faces": {
                "south": { "uv":[0,0,16,16],"texture": "#layer1"}
            }
        }
    ],
    "display": {
        "gui": {
            "scale": [ 4, 4, 1 ],
            "translation": [ 79, -52, -80]
        },
        "ground": {
            "scale": [ 0.1, 0.1, 0.1 ]
        }
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]assets/cpp/models/machine/gui/all_in_one_machine.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "cpp:machine/gui/temp",
    "textures": {
        "layer1": "cpp:machine/gui/all_in_one_machine"
    }
}
[/font][/td][/tr]
[/table]
　　这个图片大小为[font=Verdana]192×192[/font]，同时左下角物品栏距离左下角的距离为[font=Verdana]8×14[/font]，这样当该物品放置在木桶的左上方时，经过上述平移，最终这个物品栏就正好和木桶的物品栏对齐了。
[align=center][img]https://ruhuasiyu.github.io/VanillaModToturial/items/机器材质.png[/img]
[font=楷体,楷体_GB2312]图8.2 机器材质[/font]
[/align]　　若想要绘制各边缘超过这个距离限制的，可以重新调整 [font=Verdana]display.gui.translation[/font] 来对齐。
　　对于机器的按钮，为了保证我们点击时不会出现按钮乱跑的问题，我们可以在按钮的实际模型放置在点击处的右一格。具体函数实现见后文。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/models/machine/option/temp.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "item/generated",
    "display": {
        "gui": {
            "translation": [ -18, 0, 1 ]
        }
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/models/machine/option/high_pressure.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "cpp:machine/option/temp",
    "textures": {
        "layer0": "cpp:machine/option/high_pressure"
    }
}
[/font][/td][/tr]
[/table]
　　如果你擅长绘制UI的话，可以制作出很精美的UI。例如[url=https://www.youtube.com/watch?v=bv_wYNs5L6M]该视频[/url]中的GUI均是采用物品材质绘制的。
[align=center][img]https://ruhuasiyu.github.io/VanillaModToturial/items/机器GUI示例1.png[/img]
[font=楷体,楷体_GB2312]图8.3 机器GUI示例1[/font]
[/align][align=center][img]https://ruhuasiyu.github.io/VanillaModToturial/items/机器GUI示例2.png[/img]
[font=楷体,楷体_GB2312]图8.4 机器GUI示例2[/font]
[/align]
[size=4][b]§8.2 GUI背景处理[/b][/size]
　　我们为所有的机器背景物品添加 [font=Verdana]cppMachineBg:1b[/font]。我们假设这个物品都是 [font=Verdana]petrified_oak_slab[/font]。如果是多种物品的话，我们可以将这些物品id添加至一个物品标签内来处理。
　　清理玩家背包和地面的相应物品。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]clear @a petrified_oak_slab{cppMachineBg:1b}
kill @e[type=minecraft:item,nbt={Item:{tag:{cppMachineBg:1b}}}]
execute as @e[type=minecraft:armor_stand,tag=cpp_machine] at @s run function cpp:blocks/machine
[/font][/td][/tr]
[/table]
　　清理机器下方的漏斗矿车内物品，将下方漏斗的冷却时间高频设置为2。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:blocks/machine[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute positioned ~-1 ~-2 ~-1 as @e[type=hopper_minecart,dx=2,dy=2,dz=2] run data modify entity @s TransferCooldown set value 2
execute if block ~ ~-1 ~ hopper run data modify block ~ ~-1 ~ TransferCooldown set value 2
[/font][/td][/tr]
[/table]
[size=4][b]§8.3 GUI命令[/b][/size]
　　我们需要对机器高频固定住其GUI，同时对于玩家误放入的物品进行弹出处理，并操作机器选项和经验条。我们使用断言来判断木桶内物品信息。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:all_in_one_machine/tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]# 检测GUI
execute unless predicate cpp:all_in_one_machine/gui run function cpp:all_in_one_machine/gui
execute unless data block ~ ~ ~ Items[{Slot:21b}] run replaceitem block ~ ~ ~ container.21 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.output_slot"}'},CustomModelData:12971000}
execute unless data block ~ ~ ~ Items[{Slot:22b}] run replaceitem block ~ ~ ~ container.22 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.output_slot"}'},CustomModelData:12971000}
data modify block ~ ~ ~ Items[{Slot:12b}].tag.CustomModelData set value 12971020
data modify entity @s ArmorItems[3].tag.CustomModelData set value 12970001
execute if score @s cppStoredxp matches ..39 if data block ~ ~ ~ Items[{Slot:6b,id:"minecraft:experience_bottle"}] run function cpp:misc/xp_add
tag @s remove cpp_machine_work
# 配方
function cpp:check_power
execute as @s[tag=!cpp_redstone_powered,scores={cppStoredxp=1..}] if predicate cpp:all_in_one_machine/type run function cpp:all_in_one_machine/type
execute unless data block ~ ~ ~ Items[{Slot:21b,tag:{cppMachineBg:1b}}] run function cpp:all_in_one_machine/dist21
execute unless data block ~ ~ ~ Items[{Slot:22b,tag:{cppMachineBg:1b}}] run function cpp:all_in_one_machine/dist22
scoreboard players set @s[tag=!cpp_machine_work] cppTick 0
[/font][/td][/tr]
[/table]
　　对于玩家误放入背景的物品，我们使用潜影盒战利品表技巧来修改玩家背包物品，见 [url=thread-784662-1-1.html?cp=2]§2.5 战利品表[/url]。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:all_in_one_machine/gui[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]setblock ~ 255 ~ shulker_box
data modify block ~ 255 ~ Items set from block ~ ~ ~ Items
data remove block ~ 255 ~ Items[{tag:{cppMachineBg:1b}}]
data remove block ~ 255 ~ Items[{Slot:3b}]
data remove block ~ 255 ~ Items[{Slot:4b}]
data remove block ~ 255 ~ Items[{Slot:6b}]
data remove block ~ 255 ~ Items[{Slot:21b}]
data remove block ~ 255 ~ Items[{Slot:22b}]
loot give @p mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ air
replaceitem block ~ ~ ~ container.0 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971011}
replaceitem block ~ ~ ~ container.5 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.7 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.8 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.xp_bar"}',Lore:['"§a0/48"']},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.9 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.12 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.process_shower"}'},CustomModelData:12971020}
replaceitem block ~ ~ ~ container.13 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.process_shower"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.14 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.15 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.16 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.17 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.xp_bar"}',Lore:['"§a0/48"']},CustomModelData:12972000}
replaceitem block ~ ~ ~ container.18 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.23 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.24 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.25 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971000}
replaceitem block ~ ~ ~ container.26 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.xp_bar"}',Lore:['"§a0/48"']},CustomModelData:12971000}
execute unless data block ~ ~ ~ Items[{Slot:1b}] run function cpp:all_in_one_machine/option/pressure
execute as @s[scores={cppPressure=0}] run replaceitem block ~ ~ ~ container.1 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.low_pressure"}',Lore:['{"translate":"lore.cpp.switch"}']},CustomModelData:12971000}
execute as @s[scores={cppPressure=1}] run replaceitem block ~ ~ ~ container.1 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.normal_pressure"}',Lore:['{"translate":"lore.cpp.switch"}']},CustomModelData:12971000}
execute as @s[scores={cppPressure=2}] run replaceitem block ~ ~ ~ container.1 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.high_pressure"}',Lore:['{"translate":"lore.cpp.switch"}']},CustomModelData:12971000}
execute as @s[scores={cppPressure=0}] run replaceitem block ~ ~ ~ container.2 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971051}
execute as @s[scores={cppPressure=1}] run replaceitem block ~ ~ ~ container.2 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971052}
execute as @s[scores={cppPressure=2}] run replaceitem block ~ ~ ~ container.2 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971053}
execute unless data block ~ ~ ~ Items[{Slot:10b}] run function cpp:all_in_one_machine/option/temperature
execute as @s[scores={cppTemperature=0}] run replaceitem block ~ ~ ~ container.10 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.low_temperature"}',Lore:['{"translate":"lore.cpp.switch"}']},CustomModelData:12971000}
execute as @s[scores={cppTemperature=1}] run replaceitem block ~ ~ ~ container.10 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.normal_temperature"}',Lore:['{"translate":"lore.cpp.switch"}']},CustomModelData:12971000}
execute as @s[scores={cppTemperature=2}] run replaceitem block ~ ~ ~ container.10 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.high_temperature"}',Lore:['{"translate":"lore.cpp.switch"}']},CustomModelData:12971000}
execute as @s[scores={cppTemperature=0}] run replaceitem block ~ ~ ~ container.11 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971054}
execute as @s[scores={cppTemperature=1}] run replaceitem block ~ ~ ~ container.11 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971055}
execute as @s[scores={cppTemperature=2}] run replaceitem block ~ ~ ~ container.11 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971056}
execute unless data block ~ ~ ~ Items[{Slot:19b}] run function cpp:all_in_one_machine/option/output
execute as @s[scores={cppOutputFace=1}] run replaceitem block ~ ~ ~ container.19 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.output_east"}',Lore:['{"translate":"lore.cpp.switch"}']},CustomModelData:12971000}
execute as @s[scores={cppOutputFace=2}] run replaceitem block ~ ~ ~ container.19 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.output_south"}',Lore:['{"translate":"lore.cpp.switch"}']},CustomModelData:12971000}
execute as @s[scores={cppOutputFace=3}] run replaceitem block ~ ~ ~ container.19 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.output_west"}',Lore:['{"translate":"lore.cpp.switch"}']},CustomModelData:12971000}
execute as @s[scores={cppOutputFace=4}] run replaceitem block ~ ~ ~ container.19 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.output_north"}',Lore:['{"translate":"lore.cpp.switch"}']},CustomModelData:12971000}
execute as @s[scores={cppOutputFace=5}] run replaceitem block ~ ~ ~ container.19 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.output_down"}',Lore:['{"translate":"lore.cpp.switch"}']},CustomModelData:12971000}
execute as @s[scores={cppOutputFace=6}] run replaceitem block ~ ~ ~ container.19 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.output_up"}',Lore:['{"translate":"lore.cpp.switch"}']},CustomModelData:12971000}
execute as @s[scores={cppOutputFace=1}] run replaceitem block ~ ~ ~ container.20 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971041}
execute as @s[scores={cppOutputFace=2}] run replaceitem block ~ ~ ~ container.20 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971042}
execute as @s[scores={cppOutputFace=3}] run replaceitem block ~ ~ ~ container.20 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971043}
execute as @s[scores={cppOutputFace=4}] run replaceitem block ~ ~ ~ container.20 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971044}
execute as @s[scores={cppOutputFace=5}] run replaceitem block ~ ~ ~ container.20 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971045}
execute as @s[scores={cppOutputFace=6}] run replaceitem block ~ ~ ~ container.20 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.all_in_one_machine"}'},CustomModelData:12971046}
function cpp:misc/xp_show
[/font][/td][/tr]
[/table]
　　当玩家点击按钮时，调整选项。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:all_in_one_machine/option/pressure[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players add @s cppPressure 1
scoreboard players set @s[scores={cppPressure=3..}] cppPressure 0
scoreboard players set @s[tag=!cpp_high_pressure,scores={cppPressure=2}] cppPressure 0
scoreboard players set @s[tag=!cpp_low_pressure,scores={cppPressure=0}] cppPressure 1
[/font][/td][/tr]
[/table]
　　调整经验条的显示，我们使用告示牌来显示分数，然后转移到机器中。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:misc/xp_show[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]setblock ~ 255 ~ oak_sign
scoreboard players operation #t cppValue = @s cppStoredxp
data modify block ~ 255 ~ Text1 set value '[{"score":{"name":"#t","objective":"cppValue"},"color":"green","italic":"false"},{"text":"/48"}]'
execute store result block ~ ~ ~ Items[{Slot:17b}].tag.CustomModelData int 1 run scoreboard players add #t cppValue 12972000
data modify block ~ ~ ~ Items[{Slot:8b}].tag.display.Lore[0] set from block ~ 255 ~ Text1
data modify block ~ ~ ~ Items[{Slot:17b}].tag.display.Lore[0] set from block ~ 255 ~ Text1
data modify block ~ ~ ~ Items[{Slot:26b}].tag.display.Lore[0] set from block ~ 255 ~ Text1
setblock ~ 255 ~ air
[/font][/td][/tr]
[/table]
　　当经验栏经验不足且有附魔之瓶时，添加经验值。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:misc/xp_add[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute store result score #temp cppValue run data get block ~ ~ ~ Items[{Slot:6b}].Count
execute store result block ~ ~ ~ Items[{Slot:6b}].Count byte 1 run scoreboard players remove #temp cppValue 1
scoreboard players add @s cppStoredxp 9
function cpp:misc/xp_show
[/font][/td][/tr]
[/table]
　　然后判断机器处是否有红石信号强充能，断言 <code>mac:redstone_power</code> 见 <a href="thread-784662-1-1.html?cp=11">§11.4 红石信号</a>。当机器未被强充能、有经验值、有输入物、输出栏空闲时，进入配方判断。这里我们根据要求的温度压强来分类。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:all_in_one_machine/type[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[scores={cppTemperature=0,cppPressure=0}] run function cpp:all_in_one_machine/recipes/ll
execute as @s[scores={cppTemperature=0,cppPressure=1}] run function cpp:all_in_one_machine/recipes/ln
execute as @s[scores={cppTemperature=0,cppPressure=2}] run function cpp:all_in_one_machine/recipes/lh
execute as @s[scores={cppTemperature=1,cppPressure=0,cppStoredxp=4..}] run function cpp:all_in_one_machine/recipes/nl
execute as @s[scores={cppTemperature=1,cppPressure=1,cppStoredxp=2..}] run function cpp:all_in_one_machine/recipes/nn
execute as @s[scores={cppTemperature=1,cppPressure=2}] run function cpp:all_in_one_machine/recipes/nh
execute as @s[scores={cppTemperature=2,cppPressure=0,cppStoredxp=4..}] run function cpp:all_in_one_machine/recipes/hl
execute as @s[scores={cppTemperature=2,cppPressure=1}] run function cpp:all_in_one_machine/recipes/hn
execute as @s[scores={cppTemperature=2,cppPressure=2,cppStoredxp=4..}] run function cpp:all_in_one_machine/recipes/hh
function #cpp:all_in_one_machine
execute unless data block ~ ~ ~ Items[{Slot:21b,tag:{cppMachineBg:1b}}] run function cpp:all_in_one_machine/clear
execute as @s[scores={cppTick=1..}] run function cpp:all_in_one_machine/option/process
data modify entity @s[tag=cpp_machine_work] ArmorItems[3].tag.CustomModelData set value 12971001
[/font][/td][/tr]
[/table]
　　显示进度条。这里我们预先计算了半个进度条的刻数，然后加到当前刻数，计算后取整出来的进度条更加准确。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:all_in_one_machine/option/process[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players set #t cppValue 16
scoreboard players operation #t cppValue *= @s cppTick
scoreboard players operation #t cppValue += #process_pre cppValue
scoreboard players operation #t cppValue /= #allInOneMachinePeriod cppValue
execute store result block ~ ~ ~ Items[{Slot:12b}].tag.CustomModelData int 1 run scoreboard players add #t cppValue 12971020
[/font][/td][/tr]
[/table]
　　最后我们将输出栏的物品输入到邻近的容器内。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:all_in_one_machine/dist21[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]data modify storage cpp:dist Item set from block ~ ~ ~ Items[{Slot:21b}]
function cpp:dist/type
data remove storage cpp:dist Item
execute as @s[tag=cpp_dist_success] run replaceitem block ~ ~ ~ container.21 firework_star{cppMachineBg:1b,display:{Name:'{"translate":"item.cpp.output_slot"}'},CustomModelData:12971000}
[/font][/td][/tr]
[/table]
[size=4][b]§8.4 物品输出[/b][/size]
　　上一节我们调用了一个函数用于输出物品，我们来看一下它的算法。
　　根据机器的输出方向调整位置。这里我们把容器、大箱子添加至方块标签中。
[table]
[tr=#C0C0C0][td][font=Verdana]function cpp:dist/type[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]tag @s remove cpp_dist_success
execute as @s[scores={cppOutputFace=1}] positioned ~1 ~ ~ if block ~ ~ ~ #container:all run function cpp:dist/pos
execute as @s[scores={cppOutputFace=2}] positioned ~ ~ ~1 if block ~ ~ ~ #container:all run function cpp:dist/pos
execute as @s[scores={cppOutputFace=3}] positioned ~-1 ~ ~ if block ~ ~ ~ #container:all run function cpp:dist/pos
execute as @s[scores={cppOutputFace=4}] positioned ~ ~ ~-1 if block ~ ~ ~ #container:all run function cpp:dist/pos
execute as @s[scores={cppOutputFace=5}] positioned ~ ~-1 ~ if block ~ ~ ~ #container:all run function cpp:dist/pos
execute as @s[scores={cppOutputFace=6}] positioned ~ ~1 ~ if block ~ ~ ~ #container:all run function cpp:dist/pos
[/font][/td][/tr]
[/table]
　　如果是大箱子的右半个，将其修改为左半个位置。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/function/dist/pos[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute if block ~ ~ ~ #container:chests[type=left,facing=east] positioned ~ ~ ~1 run function cpp:dist/pos2
execute if block ~ ~ ~ #container:chests[type=left,facing=west] positioned ~ ~ ~-1 run function cpp:dist/pos2
execute if block ~ ~ ~ #container:chests[type=left,facing=south] positioned ~-1 ~ ~ run function cpp:dist/pos2
execute if block ~ ~ ~ #container:chests[type=left,facing=north] positioned ~1 ~ ~ run function cpp:dist/pos2
execute unless block ~ ~ ~ #container:chests[type=left] run function cpp:dist/pos2
[/font][/td][/tr]
[/table]
　　计算当前容器的空栏位数。这里我们将计算容器的栏位数添加为函数标签，以便于对更多容器可以做扩充。如果当前位置没有空栏位且为大箱子，调整输出的位置。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/function/dist/pos2[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute store result score @s container run data get block ~ ~ ~ Items
function #container:check
execute unless block ~ ~ ~ #container:all run scoreboard players set @s container 0
execute as @s[scores={container=..-1}] run function cpp:dist/dist
execute as @s[tag=!cpp_dist_success,scores={container=0..}] if block ~ ~ ~ #container:chests[type=right,facing=east] positioned ~ ~ ~-1 run function cpp:dist/double
execute as @s[tag=!cpp_dist_success,scores={container=0..}] if block ~ ~ ~ #container:chests[type=right,facing=west] positioned ~ ~ ~1 run function cpp:dist/double
execute as @s[tag=!cpp_dist_success,scores={container=0..}] if block ~ ~ ~ #container:chests[type=right,facing=south] positioned ~1 ~ ~ run function cpp:dist/double
execute as @s[tag=!cpp_dist_success,scores={container=0..}] if block ~ ~ ~ #container:chests[type=right,facing=north] positioned ~-1 ~ ~ run function cpp:dist/double
[/font][/td][/tr]
[/table]
　　函数标签 [font=Verdana]#container:check[/font] 包括函数：
[table]
[tr=#FFFFFF][td][font=Verdana]execute if block ~ ~ ~ hopper run scoreboard players remove @s container 5
execute if block ~ ~ ~ #container:slots9 run scoreboard players remove @s container 9
execute if block ~ ~ ~ #container:slots27 run scoreboard players remove @s container 27
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:dist/double[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute store result score @s container run data get block ~ ~ ~ Items
scoreboard players remove @s container 27
execute as @s[scores={container=..-1}] run function cpp:dist/dist
[/font][/td][/tr]
[/table]
　　最后使用潜影盒战利品表技巧来修改玩家背包物品，见 [url=thread-784662-1-1.html?cp=2]§2.5 战利品表[/url]。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:dist/dist[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]tag @s add cpp_dist_success
setblock ~ 255 ~ shulker_box
data remove storage cpp:dist Item.Slot
data modify block ~ 255 ~ Items[{Slot:0b}] merge from storage cpp:dist Item
loot insert ~ ~ ~ mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ air
[/font][/td][/tr]
[/table]
[size=4][b]§8.5 配方处理[/b][/size]
　　我们使用断言判断机器的物品是否满足相应配方的条件，然后进入计时。计时完成后进行产物生成，产物的生成通过使用战利品表判断当前位置的NBT得到。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:all_in_one_machine/recipes/nn[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute if block ~ ~ ~ barrel{Items:[{tag:{id:"cpp:fertilizer"}}]} if predicate cpp:all_in_one_machine/nn_2_2 run function cpp:all_in_one_machine/recipes/nn/nn_2_2
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/predicates/all_in_one_machine/nn_2_2.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "condition": "minecraft:alternative",
    "terms": [
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{id:'minecraft:wheat_seeds'}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{id:'minecraft:beetroot_seeds'}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{id:'minecraft:pumpkin_seeds'}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{id:'minecraft:melon_seeds'}]}"
                }
            }
        }
    ]
}
[/font][/td][/tr]
[/table]
　　这里需要注意一种极端情形，如果同一条件下的函数中，有多条判断原材料的命令，而且这些为无序配方（即不检测具体栏位），而且所有产物和原材料中，有部分物品可以进行其它合成，那么我们需要在这些判断中添加 [font=Verdana]as @s[tag=!cpp_machine_work][/font] 或者 [font=Verdana]if block ~ ~ ~ barrel{Items:[{Slot:16b,tag:{cppMachineBg:1b}}]}[/font] 来对机器是否已工作进行判断，否则有可能导致前一个配方的产物正常被后一个配方识别到，而导致配方出现混乱。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:all_in_one_machine/recipes/nn/nn_2_2[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]tag @s add cpp_machine_work
scoreboard players add @s cppTick 30
execute if score @s cppTick >= #allInOneMachinePeriod cppValue run function cpp:all_in_one_machine/recipes/nn/nn_2_2_done
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:all_in_one_machine/recipes/nn/nn_2_2_done[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players remove @s cppStoredxp 1
loot replace block ~ ~ ~ container.21 2 loot cpp:all_in_one_machine/nn_2_2
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/all_in_one_machine/nn_2_2.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:alternatives",
                    "children": [
                        {
                            "conditions": [
                                {
                                    "condition": "minecraft:location_check",
                                    "predicate": {
                                        "block": {
                                            "nbt": "{Items:[{id:'minecraft:wheat_seeds'}]}"
                                        }
                                    }
                                }
                            ],
                            "type": "minecraft:loot_table",
                            "name": "cpp:all_in_one_machine/items/wheats"
                        },
                        {
                            "conditions": [
                                {
                                    "condition": "minecraft:location_check",
                                    "predicate": {
                                        "block": {
                                            "nbt": "{Items:[{id:'minecraft:beetroot_seeds'}]}"
                                        }
                                    }
                                }
                            ],
                            "type": "minecraft:loot_table",
                            "name": "cpp:all_in_one_machine/items/beetroots"
                        },
                        {
                            "conditions": [
                                {
                                    "condition": "minecraft:location_check",
                                    "predicate": {
                                        "block": {
                                            "nbt": "{Items:[{id:'minecraft:pumpkin_seeds'}]}"
                                        }
                                    }
                                }
                            ],
                            "type": "minecraft:item",
                            "name": "minecraft:pumpkin",
                            "functions":[
                                {
                                    "function": "minecraft:set_count",
                                    "count": 2
                                }
                            ]
                        },
                        {
                            "conditions": [
                                {
                                    "condition": "minecraft:location_check",
                                    "predicate": {
                                        "block": {
                                            "nbt": "{Items:[{id:'minecraft:melon_seeds'}]}"
                                        }
                                    }
                                }
                            ],
                            "type": "minecraft:item",
                            "name": "minecraft:melon",
                            "functions":[
                                {
                                    "function": "minecraft:set_count",
                                    "count": 2
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
　　这样，输出槽就产生了物品，然后通过上一节中相关函数命令，进入清理环节。如果你的配方并不是100%有产物的，则需要在计时完成中添加机器完成工作的标签，然后根据标签来判断是否进入清理环节。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:all_in_one_machine/clear[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players set @s cppTick 0
execute store result score #temp cppValue run data get block ~ ~ ~ Items[{Slot:4b}].Count
execute store result block ~ ~ ~ Items[{Slot:4b}].Count byte 1 run scoreboard players remove #temp cppValue 1
execute store result score #temp cppValue run data get block ~ ~ ~ Items[{Slot:3b}].Count
execute store result block ~ ~ ~ Items[{Slot:3b}].Count byte 1 run scoreboard players remove #temp cppValue 1
[/font][/td][/tr]
[/table]
　　对于特殊的物品，例如药水、水桶等，我们可能希望能够返还玻璃瓶、桶等，此时我们需要进行额外的预处理。
[table]
[tr=#FFFFFF][td][font=Verdana]execute if data block ~ ~ ~ Items[{id:"minecraft:water_bucket"}] run function cpp:crafting_machine/craft/clear/water_bucket
execute if data block ~ ~ ~ Items[{id:"minecraft:lava_bucket"}] run function cpp:crafting_machine/craft/clear/lava_bucket
execute if data block ~ ~ ~ Items[{id:"minecraft:milk_bucket"}] run function cpp:crafting_machine/craft/clear/milk_bucket
execute if data block ~ ~ ~ Items[{id:"minecraft:potion"}] run function cpp:crafting_machine/craft/clear/potion
execute if data block ~ ~ ~ Items[{id:"minecraft:honey_bottle"}] run function cpp:crafting_machine/craft/clear/honey_bottle
[/font][/td][/tr]
[/table]
　　我们通过计算单个堆叠和多个堆叠的栏位数，来得到该有多少玻璃瓶进入输出的容器。如果容器满了，计算进入玩家背包的数量，处理应当留下的数量。尽管水桶等物品不可堆叠，但我们仍保留考虑其它模组使其可堆叠的情形。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:crafting_machine/craft/clear/honey_bottle[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]data modify storage cpp:temp Items set from block ~ ~ ~ Items
execute store result score #t1 cppValue run data remove storage cpp:temp Items[{id:"minecraft:honey_bottle",Count:1b}]
execute store result score #t2 cppValue run data remove storage cpp:temp Items[{id:"minecraft:honey_bottle"}]
data modify storage cpp:dist Item set value {id:"minecraft:glass_bottle",Count:1b}
execute store result storage cpp:dist Item.Count byte 1 run scoreboard players operation #t1 cppValue += #t2 cppValue
function cpp:dist
data remove storage cpp:dist Item
execute as @s[tag=!cpp_dist_success] run data remove block ~ ~ ~ Items[{id:"minecraft:honey_bottle",Count:1b}].tag
execute as @s[tag=!cpp_dist_success] if data block ~ ~ ~ Items[{id:"minecraft:honey_bottle",Count:1b}] run data modify block ~ ~ ~ Items[{id:"minecraft:honey_bottle",Count:1b}] merge value {id:"minecraft:glass_bottle",Count:2b}
execute as @s[tag=!cpp_dist_success] run setblock ~ 255 ~ shulker_box{Items:[{Slot:0b,Count:1b,id:"minecraft:glass_bottle"}]}
execute as @s[tag=!cpp_dist_success] store result block ~ 255 ~ Items[0].Count byte 1 run scoreboard players get #t2 cppValue
execute as @s[tag=!cpp_dist_success] run loot give @p mine ~ 255 ~ diamond_pickaxe{isShulkerMarker:1b}
execute as @s[tag=!cpp_dist_success] run setblock ~ 255 ~ air
[/font][/td][/tr]
[/table]
[size=4][b]§8.6 插件[/b][/size]
　　前面我们提到机器有多种模式，包括温度和压强的调整。我们可以要求玩家使用特定物品插件shift右击机器来安装。插件原型为胡萝卜钓竿。
　　我们省略副手情形的处理。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @a[scores={cppUseCSt=1..}] run function cpp:use_cst/type
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:use_cst/type[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[nbt={SelectedItem:{id:"minecraft:carrot_on_a_stick"}}] run function cpp:use_cst/mainhand
execute as @s[nbt=!{SelectedItem:{id:"minecraft:carrot_on_a_stick"}}] run function cpp:use_cst/offhand
scoreboard players reset @s cppUseCSt
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:use_cst/mainhand[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[nbt={SelectedItem:{tag:{MachinePlugin:1b}}}] at @a anchored eyes run function cpp:all_in_one_machine/ray
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:all_in_one_machine/ray[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[distance=..6] if block ~ ~ ~ barrel align xyz positioned ~0.5 ~ ~0.5 run function cpp:all_in_one_machine/install
execute as @s[distance=..6] unless block ~ ~ ~ barrel positioned ^ ^ ^0.005 anchored feet run function cpp:all_in_one_machine/ray
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:all_in_one_machine/install[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[nbt=!{SelectedItem:{tag:{MachinePlugin:1b}}}] run function cpp:all_in_one_machine/install/off
execute as @s[nbt={SelectedItem:{tag:{MachinePlugin:1b}}}] run function cpp:all_in_one_machine/install/main
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:all_in_one_machine/install/main[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[nbt={SelectedItem:{tag:{id:"cpp:high_pressure_plugin"}}}] if entity @e[type=minecraft:armor_stand,nbt={ArmorItems:[{},{},{},{tag:{id:"cpp:all_in_one_machine"}}]},distance=..0.5,limit=1,tag=!cpp_high_pressure] run function cpp:all_in_one_machine/install/hp
execute as @s[nbt={SelectedItem:{tag:{id:"cpp:low_pressure_plugin"}}}] if entity @e[type=minecraft:armor_stand,nbt={ArmorItems:[{},{},{},{tag:{id:"cpp:all_in_one_machine"}}]},distance=..0.5,limit=1,tag=!cpp_low_pressure] run function cpp:all_in_one_machine/install/lp
execute as @s[nbt={SelectedItem:{tag:{id:"cpp:high_temperature_plugin"}}}] if entity @e[type=minecraft:armor_stand,nbt={ArmorItems:[{},{},{},{tag:{id:"cpp:all_in_one_machine"}}]},distance=..0.5,limit=1,tag=!cpp_high_temperature] run function cpp:all_in_one_machine/install/ht
execute as @s[nbt={SelectedItem:{tag:{id:"cpp:low_temperature_plugin"}}}] if entity @e[type=minecraft:armor_stand,nbt={ArmorItems:[{},{},{},{tag:{id:"cpp:all_in_one_machine"}}]},distance=..0.5,limit=1,tag=!cpp_low_temperature] run function cpp:all_in_one_machine/install/lt
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:all_in_one_machine/install/hp[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]tellraw @s [{"translate":"info.cpp.high_pressure_plugin"}]
tag @e[type=minecraft:armor_stand,nbt={ArmorItems:[{},{},{},{tag:{id:"cpp:all_in_one_machine"}}]},distance=..0.5,limit=1,tag=!cpp_high_pressure] add cpp_high_pressure
replaceitem entity @s[gamemode=!creative,nbt=!{SelectedItem:{tag:{MachinePlugin:1b}}}] weapon.offhand air
replaceitem entity @s[gamemode=!creative,nbt={SelectedItem:{tag:{MachinePlugin:1b}}}] weapon.mainhand air
[/font][/td][/tr]
[/table]
[size=4][b]§8.7 容器扩展[/b][/size]
　　在 [url=thread-784662-1-1.html?cp=8]§8.4 物品输出[/url]中，方块标签 [font=Verdana]#container:all[/font] 记录了各种容器，[font=Verdana]#container:chests[/font] 记录了各种大箱子，函数标签 [font=Verdana]#container:check[/font] 处理容器的栏位数量。我们希望添加更多可支持的容器，例如[url=https://www.curseforge.com/minecraft/mc-mods/iron-chests]更多箱子[/url]和[url=https://www.curseforge.com/minecraft/mc-mods/stone-chest]石箱子[/url]中的容器。
[table]
[tr=#C0C0C0][td][font=Verdana]container/tags/blocks/all.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "replace": false,
    "values": [
        "ironchest:copper_chest",
        "ironchest:iron_chest",
        "ironchest:silver_chest",
        "ironchest:gold_chest",
        "#ironchest:diamond",
        "stonechest:chest_andesite",
        "stonechest:chest_cobblestone",
        "stonechest:chest_diorite",
        "stonechest:chest_granite",
        "stonechest:chest_stone"
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]container/tags/blocks/chests.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "replace": false,
    "values": [
        "stonechest:chest_andesite",
        "stonechest:chest_cobblestone",
        "stonechest:chest_diorite",
        "stonechest:chest_granite",
        "stonechest:chest_stone"
    ]
}
[/font][/td][/tr]
[/table]
　　方块标签 [font=Verdana]#container:slots27[/font] 中的容器容量已经在函数 [font=Verdana]container:check[/font] 中处理过了，所以不用再额外检查。
[table]
[tr=#C0C0C0][td][font=Verdana]container/tags/blocks/slots27.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "replace": false,
    "values": [
        "stonechest:chest_andesite",
        "stonechest:chest_cobblestone",
        "stonechest:chest_diorite",
        "stonechest:chest_granite",
        "stonechest:chest_stone"
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]container/tags/functions/check.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "replace": false,
    "values": [
        "ironchest:check"
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ironchest/functions/check[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute if block ~ ~ ~ ironchest:copper_chest run scoreboard players remove @s container 45
execute if block ~ ~ ~ ironchest:iron_chest run scoreboard players remove @s container 54
execute if block ~ ~ ~ ironchest:silver_chest run scoreboard players remove @s container 72
execute if block ~ ~ ~ ironchest:gold_chest run scoreboard players remove @s container 81
execute if block ~ ~ ~ #ironchest:diamond run scoreboard players remove @s container 108
[/font][/td][/tr]
[/table]
　　这里 [font=Verdana]#ironchest:diamond[/font] 包含了钻石箱子、黑曜石箱子和水晶箱子，它们容量均为108。
　　添加完这样的数据包之后，我们便可以如 [url=thread-784662-1-1.html?cp=8]§8.4 物品输出[/url]般调用它们了。这里是已经写好的[url=https://github.com/ruhuasiyu/CraftingPlusPlus/tree/master/other_datapacks/原版模组容器扩展]原版模组容器扩展[/url]。
[size=4][b]§8.8 接口[/b][/size]
　　函数 [font=Verdana]cpp:all_in_one_machine/type[/font] 中包含一条命令 [font=Verdana]function #cpp:all_in_one_machine[/font]。我们也创建了相应的函数标签。然后其他开发者便可向该函数标签写入内容来达到扩展或修改内容的目的，这也在 [url=thread-784662-1-1.html?cp=4]§4.3 前置与附属[/url]中提及。例如
[table]
[tr=#C0C0C0][td][font=Verdana]foo:all_in_one_machine/type[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[scores={cppStoredXp=8..,cppTemperature=0,cppPressure=0}] run function foo:all_in_one_machine/recipes/bar
[/font][/td][/tr]
[/table]
　　然后类似创建后续的断言、战利品表、函数。
[size=4][b]§8.9 管道[/b][/size]
　　科技类模组人们需要添加管道来传输电力、流体、物品等。物品管道是类似的，我们将物品的信息存储在管道上并传输即可，最终将其输入到容器中。常见的几种做法有：
[size=3][b]§8.9.1 无线传输[/b][/size]
　　优点是简洁易操作，判断输出电力的机器附近是否有需要输入电力的机器并计算即可。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @e[type=minecraft:armor_stand,tag=cpp_machine,tag=cpp_power_source,scores={cppPower=1..}] at @s if entity @e[type=minecraft:armor_stand,tag=cpp_machine,tag=cpp_power_target,distance=..16] run function cpp:machine/power/translate
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:machine/power/translate[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]tag @s add cpp_power_out
scoreboard players operation #t0 cppPower = @e[type=minecraft:armor_stand,tag=cpp_machine,tag=cpp_power_source,scores={cppPower=1..},distance=..1,limit=1] cppPower
execute as @e[type=minecraft:armor_stand,tag=cpp_machine,tag=cpp_power_target] if score @s cppPower < @s cppPowerMax run function cpp:machine/power/translate1
scoreboard players operation @e[type=minecraft:armor_stand,tag=cpp_machine,tag=cpp_power_source,scores={cppPower=1..},distance=..1,limit=1] cppPower -= #t0 cppPower
tag @s remove cpp_power_out
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:machine/power/translate1[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players operation #t cppPower = @s cppPowerMax
scoreboard players operation #t cppPower -= @s cppPower
execute if score #t cppPower > #t0 cppPower run scoreboard players operation #t cppPower = #t0 cppPower
scoreboard players operation @s cppPower += #t cppPower
scoreboard players operation #t0 cppPower -= #t cppPower
[/font][/td][/tr]
[/table]
　　我们也可以在传输中添加类似投射物的特效来提高视觉效果。
[size=3][b]§8.9.2 管道式 (WIP)[/b][/size]
　　优点是具有传统科技模组的风格，缺点是每个管道都是一个实体（仅有原版方块限制颇多），管道多的时候会较为卡顿。
　　涌流式：能量从高处向周围比它低的管道/机器处流动，来最终实现能量传输。管道内会留有缓存。实现和无线传输类似，只是范围限定在1米内。
　　遍历式：从能量源出发，遇到过的管道做标记一直向下，如果遇到终点就回溯到分叉点，一直循环直到返回源头。
[size=3][b]§8.9.3 激光式[/b][/size]
　　为了降低管道式的管道数量，我们可以将管道替换为可以一次传输多格的激光式管道。这里我们使用展示框来表示，计算其与前方方块的距离并调整外观（长度）。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @e[type=minecraft:item_frame,tag=ind_wire] at @s run function indcore:wire/face
execute as @e[type=minecraft:armor_stand,tag=ind_power_out,scores={indPower=1..}] at @s run function indcore:power/face
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]indcore:wire/face[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players set @s indValue 7500000
execute as @s[nbt={Facing:0b}] align xyz positioned ~0.5 ~-1 ~0.5 run function indcore:wire/down
execute as @s[nbt={Facing:1b}] align xyz positioned ~0.5 ~1 ~0.5 run function indcore:wire/up
execute as @s[nbt={Facing:2b}] align xyz positioned ~0.5 ~ ~-0.5 run function indcore:wire/north
execute as @s[nbt={Facing:3b}] align xyz positioned ~0.5 ~ ~1.5 run function indcore:wire/south
execute as @s[nbt={Facing:4b}] align xyz positioned ~-0.5 ~ ~0.5 run function indcore:wire/west
execute as @s[nbt={Facing:5b}] align xyz positioned ~1.5 ~ ~0.5 run function indcore:wire/east
execute store result entity @s Item.tag.CustomModelData int 1 run scoreboard players get @s indValue
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]indcore:wire/east[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players add @s indValue 1
execute if block ~ ~ ~ #indcore:fluid positioned ~1 ~ ~ run function indcore:wire/east
[/font][/td][/tr]
[/table]
　　同样我们递归向前来获得接收能量的方块。
[table]
[tr=#C0C0C0][td][font=Verdana]indcore:power/face[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute positioned ~0.5 ~0.5 ~ if entity @e[tag=ind_wire,distance=..0.1] align xyz positioned ~1.5 ~ ~0.5 run function indcore:power/east
execute positioned ~-0.5 ~0.5 ~ if entity @e[tag=ind_wire,distance=..0.1] align xyz positioned ~-1.5 ~ ~0.5 run function indcore:power/west
execute positioned ~ ~0.5 ~0.5 if entity @e[tag=ind_wire,distance=..0.1] align xyz positioned ~0.5 ~ ~1.5 run function indcore:power/south
execute positioned ~ ~0.5 ~-0.5 if entity @e[tag=ind_wire,distance=..0.1] align xyz positioned ~0.5 ~ ~-1.5 run function indcore:power/north
execute positioned ~ ~1 ~ if entity @e[tag=ind_wire,distance=..0.1] align xyz positioned ~0.5 ~2 ~0.5 run function indcore:power/up
execute if entity @e[tag=ind_wire,distance=..0.1] align xyz positioned ~0.5 ~-2 ~0.5 run function indcore:power/down
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]indcore:power/east[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute if entity @s[distance=..16] if entity @e[tag=ind_power_in,distance=..0.1] entity @e[tag=ind_power_in,distance=..0.1,limit=1,scores={indPower=..9999}] if score @e[tag=ind_power_in,distance=..0.1,limit=1] indPower < @e[tag=ind_power_in,distance=..0.1,limit=1] indPowerLimit run function indcore:power/in
execute if entity @s[distance=..16] unless entity @e[tag=ind_power_in,distance=..0.1] positioned ~1 ~ ~ run function indcore:power/east
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]indcore:power/in[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players remove @s indPower 1
scoreboard players add @e[tag=ind_power_in,distance=..0.1,limit=1] indPower 1
[/font][/td][/tr]
[/table]
[size=3][b]§8.9.4 载体式[/b][/size]
　　我们使用一个可移动的实体来传输能量，这个实体受方块控制。
[table]
[tr=#C0C0C0][td][font=Verdana]wire:golem/tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]data merge entity @s {PortalCooldown:900}
execute if block ~ ~ ~ #cpp:golem_east run scoreboard players set @s cppGolemFace 0
execute if block ~ ~ ~ #cpp:golem_south run scoreboard players set @s cppGolemFace 1
execute if block ~ ~ ~ #cpp:golem_west run scoreboard players set @s cppGolemFace 2
execute if block ~ ~ ~ #cpp:golem_north run scoreboard players set @s cppGolemFace 3
execute if block ~ ~ ~ #cpp:golem_up run scoreboard players set @s cppGolemFace 4
execute if block ~ ~ ~ #cpp:golem_down run scoreboard players set @s cppGolemFace 5
execute as @s[scores={cppGolemFace=0}] run tp @s ~1 ~0 ~0 270 0
execute as @s[scores={cppGolemFace=1}] run tp @s ~0 ~0 ~1 0 0
execute as @s[scores={cppGolemFace=2}] run tp @s ~-1 ~0 ~0 90 0
execute as @s[scores={cppGolemFace=3}] run tp @s ~0 ~0 ~-1 180 0
execute as @s[scores={cppGolemFace=4}] run tp @s ~0 ~1 ~0 0 90
execute as @s[scores={cppGolemFace=5}] run tp @s ~0 ~-1 ~0 0 -90
execute as @s[scores={cppPower=1..}] if entity @e[type=minecraft:armor_stand,tag=cpp_machine,tag=cpp_power_in] run function cpp:power/translate
[/font][/td][/tr]
[/table]
　　然后和其它传输方式一样，计算传输值即可。
[size=3][b]§8.9.5 管道设计[/b][/size]
　　我们可以使用屏障方块来作为管道的本体方块，使用扳手(胡萝卜钓竿)来右键拆解。
　　管道需要高频判断是否与周边方块连接，以调整其自身显示。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:pipe/tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players set @s cppModel 12970000
execute positioned ~1 ~ ~ if entity @e[type=minecraft:armor_stand,tag=cpp_pipe,distance=..0.2] run scoreboard players add @s cppModel 1
execute positioned ~-1 ~ ~ if entity @e[type=minecraft:armor_stand,tag=cpp_pipe,distance=..0.2] run scoreboard players add @s cppModel 2
execute positioned ~ ~ ~1 if entity @e[type=minecraft:armor_stand,tag=cpp_pipe,distance=..0.2] run scoreboard players add @s cppModel 4
execute positioned ~ ~ ~-1 if entity @e[type=minecraft:armor_stand,tag=cpp_pipe,distance=..0.2] run scoreboard players add @s cppModel 8
execute positioned ~ ~1 ~ if entity @e[type=minecraft:armor_stand,tag=cpp_pipe,distance=..0.2] run scoreboard players add @s cppModel 16
execute positioned ~ ~-1 ~ if entity @e[type=minecraft:armor_stand,tag=cpp_pipe,distance=..0.2] run scoreboard players add @s cppModel 32
execute store result entity @s ArmorItems[3].tag.CustomModelData int 1 run scoreboard players get @s cppModel
[/font][/td][/tr]
[/table]

[page]
[size=5][b]§9 NBT合成与烧炼[/b][/size]
[size=4][b]§9.1 地板合成[/b][/size]
　　将物品扔在地面进行合成，是模组配方数量少时采用的一种便捷做法。优点是无需设计 GUI。
　　例：将磁铁（[font=Verdana]id:"cpp:magnet"[/font]）和4个钻石合成为充能指南针（[font=Verdana]id:"cpp:powered_magnet"[/font]）。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @e[type=minecraft:item,nbt={Item:{tag:{id:"cpp:magnet"}}}] at @s if entity @e[type=minecraft:item,distance=..1,nbt={Item:{id:"minecraft:diamond",Count:4b}}] run function cpp:powered_magnet
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:powered_magnet[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]kill @e[type=minecraft:item,limit=1,distance=..1,nbt={Item:{id:"minecraft:diamond",Count:4b}}]
kill @s
summon item ~ ~ ~ {Item:{id:"minecraft:compass",Count:1b,tag:{id:"cpp:powered_magnet"}}}
[/font][/td][/tr]
[/table]
[size=4][b]§9.2 实体背包合成[/b][/size]
　　利用玩家的背包、末影箱、箱子矿车、驴等生物的背包用于合成，也是一种较为便捷的方式，不受方块的限制。
　　由于玩家的NBT难以修改，玩家背包和末影箱并不便于合成处理，而且一般只能用于有序合成。其它情形可以通过不指定 [font=Verdana]Slot[/font] 来实现无序合成。
　　当合成配方较多时，我们应当考虑分类以降低每刻命令数。常见的做法是先按配方的原材料种类数、或者合成的形状分类。
　　例如：利用玩家背包的右方3×3区域进行合成。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players set @a cppCraftSlot 0
scoreboard players add @a[nbt={Inventory:[{Slot:15b}]}] cppCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:16b}]}] cppCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:17b}]}] cppCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:24b}]}] cppCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:25b}]}] cppCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:26b}]}] cppCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:33b}]}] cppCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:34b}]}] cppCraftSlot 1
scoreboard players add @a[nbt={Inventory:[{Slot:35b}]}] cppCraftSlot 1
execute as @a[scores={cppCraftSlot=1..}] run function cpp:craft
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:craft[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[scores={cppCraftSlot=1}] run function cpp:craft/items1
execute as @s[scores={cppCraftSlot=2}] run function cpp:craft/items2
execute as @s[scores={cppCraftSlot=3}] run function cpp:craft/items3
execute as @s[scores={cppCraftSlot=4}] run function cpp:craft/items4
execute as @s[scores={cppCraftSlot=5}] run function cpp:craft/items5
execute as @s[scores={cppCraftSlot=6}] run function cpp:craft/items6
execute as @s[scores={cppCraftSlot=7}] run function cpp:craft/items7
execute as @s[scores={cppCraftSlot=8}] run function cpp:craft/items8
execute as @s[scores={cppCraftSlot=9}] run function cpp:craft/items9
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:craft/items5[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[nbt={Inventory:[{Slot:15b,id:"minecraft:sugar",Count:1b},{Slot:16b,id:"minecraft:rotten_flesh",Count:1b},{Slot:17b,id:"minecraft:glistering_melon_slice",Count:1b},{Slot:24b,id:"minecraft:gunpowder",Count:1b},{Slot:25b,id:"minecraft:potion",tag:{Potion:"minecraft:water"},Count:1b}]} run function cpp:craft/items5/acid
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:craft/items5/acid[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]loot replace entity @s inventory.16 loot cpp:acid
replaceitem entity @s inventory.6 minecraft:air
replaceitem entity @s inventory.7 minecraft:air
replaceitem entity @s inventory.8 minecraft:air
replaceitem entity @s inventory.15 minecraft:air
replaceitem entity @s inventory.17 minecraft:air
[/font][/td][/tr]
[/table]
[size=4][b]§9.4 NBT烧炼[/b][/size]
　　放置熔炉、高炉、烟熏炉、营火的过程已省略。我们假设相应方块位置已有标签为 [font=Verdana]cpp_furnace[/font] 的盔甲架。
　　例如：将蛋烧炼为战利品表物品 [font=Verdana]cpp:egg_stew[/font]。创建烧炼配方以激活烧炼蛋。

[table]
[tr=#C0C0C0][td][font=Verdana]cpp/recipes/egg.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "type": "smelting",
    "ingredient": {
        "item": "minecraft:egg"
    },
    "result": "minecraft:mushroom_stew",
    "experience": 0.1,
    "cookingtime": 200
}
[/font][/td][/tr]
[/table]
然后在烧炼时间达到 [font=Verdana]199s[/font] 时，替换熔炉内的物品。

[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @e[type=minecraft:armor_stand,tag=cpp_furnace] at @s unless block ~ ~ ~ minecraft:furnace run kill @s
execute as @e[type=minecraft:armor_stand,tag=cpp_furnace] at @s if block ~ ~ ~ minecraft:furnace{CookTime:199s} run function cpp:foods/cook/check
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:foods/cook/check[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute if block ~ ~ ~ minecraft:furnace{Items:[{Slot:0b,id:"minecraft:egg"}]} run function cpp:foods/cook/egg_stew
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:foods/cook/egg_stew[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]loot replace entity @s weapon.mainhand 1 loot cpp:egg_stew
data modify block ~ ~ ~ Items[{Slot:2b}] set from entity @s HandItems[0]
replaceitem entity @s weapon.mainhand minecraft:air
execute store result block ~ ~ ~ Items[0].Count byte 0.999 run data get block ~ ~ ~ Items[0].Count
data merge block ~ ~ ~ {CookTime:0s}
[/font][/td][/tr]
[/table]
　　这种做法的局限性一是若要求待烧炼物含指定NBT，则必须添加该物品的的烧炼配方，这就导致即使没有相应的NBT也会烧炼，个人建议为原物品也添加合理的烧炼配方，或者烧炼配方的产物和待烧炼物相同，同时不奖励经验值；二是即使产物应当可堆叠也无法正常堆叠，这时需配合漏斗等设备传输方可持续烧炼。

[table]
[tr=#C0C0C0][td][color=#FFFFFF][align=center][b]情形[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]添加配方[/b][/align][/color][/td][td][color=#FFFFFF][align=center][b]注意事项[/b][/align][/color][/td][/tr]
[tr=#FFFFFF][td][color=#000000][align=center][b]原版物品A->NBT物品B[/b][/align][/color][/td][td]A->B[/td][td]在烧炼即将完成时生成产物。[/td][/tr]
[tr=#FFFFFF][td=1,2][color=#000000][align=center][b]NBT物品A->原版物品B[/b][/align][/color][/td][td]A->B[/td][td]同上一条。对于原版物品A，还需要清理产物或添加其它合适的烧炼效果。[/td][/tr]
[tr=#FFFFFF][td]A->C[/td][td]同上一条。产物无法堆叠，需配合漏斗等设备传输方可持续烧炼。[/td][/tr]
[tr=#FFFFFF][td=1,2][color=#000000][align=center][b]NBT物品A->NBT物品B[/b][/align][/color][/td][td]A->B[/td][td]同上上条。若有其它烧炼配方可以得到原版物品B，则进行相应配方烧炼时的产物会直接变为NBT物品B，因此要排除这种情形。[/td][/tr]
[tr=#FFFFFF][td]A->C[/td][td]同前两条。[/td][/tr]
[/table]
[size=4][b]§9.5 NBT酿造[/b][/size]

　　类似于自定义烧炼的方法，我们可以自定义酿造。但是由于酿造台的限制，酿造材料必须为原版酿造材料物品，待酿造的物品只能为药水或玻璃瓶。除了红石、萤石、火药、龙息外，建议使用兔子腿，因为兔子腿只有酿造功能。
　　如果酿造材料和待酿造的物品本身就属于原版可酿造的配方，我们只需在酿造即将完成时，将药水替换掉即可。例如：使用大地之证 (兔子腿 [font=Verdana]cpp:certification_of_earth[/font]) 将粗制的药水酿造成有多重药水效果的大地药水（[font=Verdana]potion_of_earth[/font]），同时支持延长、加强、喷溅、滞留版本。
　　放置和探测酿造台的部分省略。

[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @e[type=minecraft:armor_stand,tag=cpp_brewing_stand] at @s run function cpp:brewing/tick
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:brewing/tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute unless block ~ ~ ~ minecraft:brewing_stand run kill @s
execute if block ~ ~ ~ minecraft:brewing_stand{BrewTime:1s,Items:[{Slot:3b,tag:{id:"cpp:certification_of_earth"}}]} run function cpp:brewing/earth
execute if block ~ ~ ~ minecraft:brewing_stand{BrewTime:1s,Items:[{Slot:3b,tag:{id:"cpp:redstone"}}]} if predicate cpp:brewing/long run function cpp:brewing/long
execute if block ~ ~ ~ minecraft:brewing_stand{BrewTime:1s,Items:[{Slot:3b,tag:{id:"cpp:glowstone_dust"}}]} if predicate cpp:brewing/strong run function cpp:brewing/strong
execute if block ~ ~ ~ minecraft:brewing_stand{BrewTime:1s,Items:[{Slot:3b,tag:{id:"cpp:gunpowder"}}]} if predicate cpp:brewing/splash run function cpp:brewing/splash
execute if block ~ ~ ~ minecraft:brewing_stand{BrewTime:1s,Items:[{Slot:3b,tag:{id:"cpp:dragon_breath"}}]} if predicate cpp:brewing/lingering run function cpp:brewing/lingering
[/font][/td][/tr]
[/table]
　　我们在大地药水中添加 [font=Verdana]Potion[/font]，这样后续可以实现延长、加强、喷溅、投掷版本的酿造。

[table]
[tr=#C0C0C0][td][font=Verdana]cpp/loot_tables/potion_of_dirt[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "item",
                    "name": "minecraft:potion",
                    "functions": [
                        {
                            "function": "set_nbt",
                            "tag": "{Potion:'minecraft:leaping',CustomPotionColor:14137114,display:{Name:'{\"translate\":\"item.cpp.potion_of_earth\"}'},CustomPotionEffects:[{Id:3b,Duration:3600}],id:'cpp:potion_of_earth'}"
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:brewing/earth[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]loot replace entity @s weapon.mainhand 1 loot cpp:potion_of_earth
data modify block ~ ~ ~ Items[{tag:{Potion:"minecraft:awkward"}}].tag set from entity @s HandItems[0].tag
loot replace entity @s weapon.mainhand 1 loot minecraft:
execute store result block ~ ~ ~ Items[{Slot:3b}].Count byte 0.999 run data get block ~ ~ ~ Items[{Slot:3b}].Count
[/font][/td][/tr]
[/table]

[table]
[tr=#C0C0C0][td][font=Verdana]cpp/predicates/brewing/long[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "condition": "minecraft:alternative",
    "terms": [
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:night_vision'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:invisibility'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:leaping'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:fire_resistance'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:swiftness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:slowness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:turtle_master'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:water_breathing'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:poison'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:regeneration'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:strength'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:weakness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:0b,tag:{Potion:'minecraft:slow_falling'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:night_vision'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:invisibility'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:leaping'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:fire_resistance'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:swiftness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:slowness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:turtle_master'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:water_breathing'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:poison'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:regeneration'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:strength'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:weakness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:1b,tag:{Potion:'minecraft:slow_falling'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:night_vision'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:invisibility'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:leaping'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:fire_resistance'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:swiftness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:slowness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:turtle_master'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:water_breathing'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:poison'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:regeneration'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:strength'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:weakness'}}]}"
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "predicate": {
                "block": {
                    "nbt": "{Items:[{Slot:2b,tag:{Potion:'minecraft:slow_falling'}}]}"
                }
            }
        }
    ]
}
[/font][/td][/tr]
[/table]
　　处理延长版药水时，还需要一并处理原版酿造的药水。加强、喷溅、投掷情形类似处理即可。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:brewing/long[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]loot replace entity @s weapon.mainhand 1 loot cpp:potion_of_long_earth
data modify block ~ ~ ~ Items[{tag:{id:"cpp:potion_of_earth}}].tag set from entity @s HandItems[0].tag
loot replace entity @s weapon.mainhand 1 loot minecraft:air
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:night_vision"}}]}.tag.Potion set value "minecraft:long_night_vision"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:invisibility"}}]}.tag.Potion set value "minecraft:long_invisibility"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:leaping"}}]}.tag.Potion set value "minecraft:long_leaping"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:fire_resistance"}}]}.tag.Potion set value "minecraft:long_fire_resistance"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:swiftness"}}]}.tag.Potion set value "minecraft:long_swiftness"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:slowness"}}]}.tag.Potion set value "minecraft:long_slowness"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:turtle_master"}}]}.tag.Potion set value "minecraft:long_turtle_master"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:water_breathing"}}]}.tag.Potion set value "minecraft:long_water_breathing"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:poison"}}]}.tag.Potion set value "minecraft:long_poison"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:regeneration"}}]}.tag.Potion set value "minecraft:long_regeneration"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:strength"}}]}.tag.Potion set value "minecraft:long_strength"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:weakness"}}]}.tag.Potion set value "minecraft:long_weakness"
data modify block ~ ~ ~ Items:[{tag:{Potion:"minecraft:slow_falling"}}]}.tag.Potion set value "minecraft:long_slow_falling"}
execute store result block ~ ~ ~ Items[{Slot:3b}].Count byte 0.999 run data get block ~ ~ ~ Items[{Slot:3b}].Count
replaceitem entity @s weapon.mainhand minecraft:air
[/font][/td][/tr]
[/table]
　　如果酿造材料和待酿造的物品不属于原版可酿造的配方，我们需要在二者均进入酿造台时，将其物品修改为具有相同材质名称的、可以实现酿造的物品。当物品进入背包时，将其改回原物品。酿造即将完成时，检测相应NBT是否来自指定的物品，并修改产物。

[page]
[size=5][b]§10 植物[/b][/size]

[size=4][b]§10.1 作物[/b][/size]
　　通常使用小麦、胡萝卜、马铃薯、甜菜根、瓜梗、树苗来实现自定义作物。我们在相应的方块处放置带有自定义物品模型的盔甲架来实现其外观的不同，并高频判断和重置其生长状态来确定生长，好处是可以限定其种植在耕地/土上，且可以与骨粉方便地交互。
　　然而，如果自定义作物的材质没有覆盖原来的方块，就会导致自定义的作物处，既有自定义作物的材质，又有原本的作物材质。解决方法之一是限定自定义作物模型包含原有的作物模型，这几乎只有在瓜梗情形容易做到；另一种是删除原有方块材质，并在原版作物/树苗处放置对应材质的盔甲架解决。对于第二种做法，我们需要修改村庄、林地府邸等结构中相应的作物/树苗模型，而且在玩家大规模种植时会生成大量实体。因此第二种情形几乎只有金合欢树苗可以接受，因为通常玩家不会种植太多金合欢树。然而金合欢树苗有个严重的缺点，当其在1刻内接受了两个随机刻，会导致其直接长成大树。
　　对于没有生长阶段的自定义植物，我们也没有太多选择。使用花是不可能的，因其广泛生成在世界各地；使用屏障则交互极为不便。
　　因此，我们一般只有使用瓜梗并要求模型覆盖瓜梗模型；或者使用金合欢树苗并需要忍受偶发的金合欢树。
　　例如：种植铁种子，收获种子和铁锭，可由骨粉催熟。种下后，探测位置放置盔甲架。破坏时，修改附近掉落物。
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:advancements/plants/iron_seeds[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "parent": "cpp:plants/root",
    "criteria": {
        "iron_seeds": {
            "trigger": "minecraft:placed_block",
            "conditions": {
                "item": {
                    "nbt":"{id:'cpp:iron_seeds'}"
                }
            }
        }
    },
    "rewards": {
            "function": "cpp:plants/plants/iron_seeds"
    }
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @e[type=minecraft:armor_stand,tag=cpp_beetroots_plants] at @s unless block ~ ~ ~ beetroots run function cpp:plants/break/beetroots
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:plants/break/beetroots[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[tag=cpp_iron_seeds] as @e[type=minecraft:item,nbt={Item:{id:"minecraft:beetroot_seeds"},Age:0s},distance=..1] run data merge entity @s {Item:{tag:{HideFlags:63,Enchantments:[{}],display:{Name:'{"translate":"item.cpp.iron_seeds\"}"},id:"cpp:iron_seeds"}}}
execute as @s[tag=cpp_iron_seeds] as @e[type=minecraft:item,nbt={Item:{id:"minecraft:beetroot"},Age:0s},distance=..1] run data merge entity @s {Item:{id:"minecraft:iron_ingot"}}
[/font][/td][/tr]
[/table]
　　实际上，我们也可以通过盔甲架手持物品来实现自定义材质的作物。

[size=4][b]§10.2 花草[/b][/size]

WIP


[size=4][b]§10.3 树[/b][/size]
    
WIP

[page]
[size=5][b]§11 物品与实体处理[/b][/size]
　　本节内容较杂，主要包括常见的一些物品与实体处理方式。

[size=4][b]§11.1 随机数[/b][/size]
　　随机数有多种生成方式，最简单的使用实体选择器 [font=Verdana]@r[/font] 来从若干实体中选取一个。我们可以生成两个并对其中随机一个的计分板增加 [font=Verdana]1, 2, 4, ..., 2[sup]30[/sup][/font]，那么其中一个的分数就是 [font=Verdana]0[/font] 至 [font=Verdana]2[sup]31[/sup]-1[/font] 之间的随机数，然后对我们想要的随机数区间取模，即可得到近似的均匀分布。
　　但是，我们使用战利品的 [font=Verdana]set_attribute[/font] 函数可以便捷地得到 [font=Verdana]0[/font] 至 [font=Verdana]2048[/font] 之间的一个随机浮点数。由此可得到下述算法。

[table]
[tr=#C0C0C0][td][font=Verdana]ex/loot_tables/misc/random.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:stone",
                    "functions": [
                        {
                            "function": "minecraft:set_attributes",
                            "modifiers": [
                                {
                                    "slot": "mainhand",
                                    "name": "random_attackDamage",
                                    "attribute": "generic.attackDamage",
                                    "operation": "addition",
                                    "amount": {
                                        "min": 0,
                                        "max": 2048
                                    }
                                }
                            ]
                        },
                        {
                            "function": "minecraft:set_nbt",
                            "tag": "{exRandomMarker:1b}"
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex:misc/random[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]loot spawn ~ -1 ~ loot ex:misc/random
execute positioned ~ -1 ~ store result score #rand exValue run data get entity @e[type=minecraft:item,distance=..1,nbt={Item:{tag:{exRandomMarker:1b}}},limit=1] Item.tag.AttributeModifiers[0].Amount 1048575
execute positioned ~ -1 ~ run kill @e[type=minecraft:item,nbt={Item:{tag:{exRandomMarker:1b}}},limit=1,distance=..1]
scoreboard players operation #random_interval exValue = #random_max exValue
scoreboard players operation #random_interval exValue -= #random_min exValue
scoreboard players add #random_interval exValue 1
scoreboard players operation #rand exValue %= #random_interval exValue
scoreboard players operation #rand exValue += #random_min exValue
[/font][/td][/tr]
[/table]
　　先设置 [font=Verdana]#random_min[/font] 和 [font=Verdana]#random_max[/font] 的 [font=Verdana]exValue[/font] 为随机数的上下界，然后执行该函数，则 [font=Verdana]#rand[/font] 的 [font=Verdana]exValue[/font] 即为该区间的一个随机数。
　　对于固定范围的随机数，我们可以直接在战利品表内设置好，可省去部分记分板的计算。

[size=4][b]§11.2 修改玩家背包[/b][/size]

　　用于修改实体方块、实体、存储区NBT的 [font=Verdana]data[/font] 命令无法用来修改玩家NBT。在1.13-1.14版本中可以使用 [font=Verdana]execute store[/font] 和 [font=Verdana]data modify[/font] 命令来修改玩家背包内物品的 [font=Verdana]tag[/font] 标签下的信息，尽管使用该命令会提示错误。而在1.15版本则将该功能去除，想要修改玩家背包就必须借助其它方式。
　　一种方式是将修改后的物品信息复制到生物头部，并修改生物的死亡战利品表NBT。在战利品表中穷举获得该物品 [font=Verdana]id[/font] 和数量，并使用 [font=Verdana]copy_nbt[/font] 函数来将头部物品的NBT复制到战利品的NBT中。见 [url=thread-837334-1-1.html]关于如何绕过moj不让改玩家的限制[/url]。

[table]
[tr=#C0C0C0][td][font=Verdana]ex/loot_tables/misc/loot[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "type": "entity",
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:alternatives",
                    "children": [
                        {
                            "type": "item",
                            "name": "minecraft:andesite",
                            "conditions": [
                                {
                                    "condition": "minecraft:entity_properties",
                                    "entity": "this",
                                    "predicate": {
                                        "nbt": "{ArmorItems:[{},{},{}{id:'minecraft:andesite'}}"
                                    }
                                }
                            ]
                        },
                        [中间省略其它物品的穷举过程]
                        {
                            "type": "item",
                            "name": "minecraft:zombie_head",
                            "conditions": [
                                {
                                    "condition": "minecraft:entity_properties",
                                    "entity": "this",
                                    "predicate": {
                                        "nbt": "{ArmorItems:[{},{},{}{id:'minecraft:zombie_head'}}"
                                    }
                                }
                            ]
                        }
                    ],
                    functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": 2,
                            "conditions": [
                                {
                                    "condition": "minecraft:entity_properties",
                                    "entity": "this",
                                    "predicate": {
                                        "nbt": "{ArmorItems:[{},{},{},{Count:2b}]}"
                                    }
                                }
                            ]
                        },
                        [中间省略其它数量的穷举过程]
                        {
                            "function": "minecraft:set_count",
                            "count": 64,
                            "conditions": [
                                {
                                    "condition": "minecraft:entity_properties",
                                    "entity": "this",
                                    "predicate": {
                                        "nbt": "{ArmorItems:[{},{},{},{Count:64b}}"
                                    }
                                }
                            ]
                        },
                        {
                            "function": "minecraft:copy_nbt",
                            "source": "this",
                            "ops": [
                                {
                                    "source": "ArmorItems[3].tag",
                                    "target": "{}",
                                    "op": "merge"
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
　　最后我们使用 [font=Verdana]loot[/font] 函数来将战利品表物品输出到玩家背包中。可以看出，该方法使用的战利品表非常长，而且需要根据版本更新或模组内容添加新的物品 [font=Verdana]id[/font]。这里我们提及一个可能的误区，一般生物的装备和手持物并不会出现在生物的战利品表中，想要通过直接 [font=Verdana]loot ... kill[/font] 获取生物的装备或手持物是不可能的。

　　另一种方式是对潜影盒战利品表使用项目 [font=Verdana]dynamic[/font]，该项目配合 [font=Verdana]"name": "minecraft:contents"[/font] 可以将潜影盒内物品作为战利品表输出。
[table]
[tr=#C0C0C0][td][font=Verdana]minecraft/loot_tables/blocks/shulker_box.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "type": "minecraft:block",
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:alternatives",
                    "children": [
                        {
                            "type": "minecraft:dynamic",
                            "name": "minecraft:contents",
                            "conditions": [
                                {
                                    "condition": "minecraft:match_tool",
                                    "predicate": {
                                        "nbt":"{isShulkerMarker:1b}"
                                    }
                                }
                            ]
                        },
                        {
                            "type": "minecraft:item",
                            "functions": [
                                {
                                    "function": "minecraft:copy_name",
                                    "source": "block_entity"
                                },
                                {
                                    "function": "minecraft:copy_nbt",
                                    "source": "block_entity",
                                    "ops": [
                                        {
                                            "source": "Lock",
                                            "target": "BlockEntityTag.Lock",
                                            "op": "replace"
                                        },
                                        {
                                            "source": "LootTable",
                                            "target": "BlockEntityTag.LootTable",
                                            "op": "replace"
                                        },
                                        {
                                            "source": "LootTableSeed",
                                            "target": "BlockEntityTag.LootTableSeed",
                                            "op": "replace"
                                        }
                                    ]
                                },
                                {
                                    "function": "minecraft:set_contents",
                                    "entries": [
                                        {
                                            "type": "minecraft:dynamic",
                                            "name": "minecraft:contents"
                                        }
                                    ]
                                }
                            ],
                            "name": "minecraft:shulker_box"
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
　　我们将物品复制到潜影盒内，然后使用命令 [font=Verdana]loot ... mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}[/font]。通常我们将这种辅助用的方块放置在 [font=Verdana]255[/font] 高度以免破坏地形和建筑。
　　除了用于修改玩家背包，该命令还可配合 [font=Verdana]loot insert[/font] 来将物品输出到容器内，并使物品尽量堆叠。这常用于机器的输出，见 [url=thread-784662-1-1.html?cp=8]§8.4 物品输出[/url]。

[size=4][b]§11.3 耐久处理[/b][/size]

　　有时候我们需要模拟使用工具的过程，但工具并没有被使用，耐久也没有被消耗。此时我们需要手动对其耐久进行处理。

[table]
[tr=#C0C0C0][td][font=Verdana]ex:misc/damage[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute store result score #unbreak_lvl exValue run data get storage ex:damage Item.tag.Enchantments[{id:"minecraft:unbreaking"}].lvl
execute store result score #damage exValue run data get storage ex:damage Item.tag.Damage
execute if score #unbreak_lvl exValue matches 1.. run function ex:misc/damage_check
execute store result storage ex:damage Item.tag.Damage int 1 run scoreboard players add #damage exValue 1
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex:misc/damage_check[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]loot spawn ~ -1 ~ loot ex:misc/random
execute positioned ~ -1 ~ store result score #rand exValue run data get entity @e[type=minecraft:item,nbt={Item:{tag:{cppRandomMarker:1b}}},limit=1,distance=..1] Item.tag.AttributeModifiers[0].Amount 1048575
execute positioned ~ -1 ~ run kill @e[type=minecraft:item,nbt={Item:{tag:{exRandomMarker:1b}}},limit=1,distance=..1]
scoreboard players operation #rand exValue %= #unbreak_lvl exValue
execute if score #rand exValue matches 1.. run scoreboard players remove #damage exValue 1
[/font][/td][/tr]
[/table]
　　我们将物品信息复制到存储区 [font=Verdana]ex:damage[/font] 的 [font=Verdana]Item[/font] 中，然后执行该函数。最后判断其是否已经耐久耗尽，若耗尽则清除之。
[table]
[tr=#C0C0C0][td][font=Verdana]ex:misc/damage_cst_main[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]data modify storage ex:damage Item set from entity @s SelectedItem
function ex:misc/damage
execute if score #damage exValue matches 26.. run data remove storage ex:damage Item
setblock ~ 255 ~ minecraft:shulker_box
data modify storage ex:damage Item.Slot set value 0b
data modify block ~ 255 ~ Items append from storage ex:damage Item
loot replace entity @s weapon.mainhand 1 mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ minecraft:air
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex:misc/damage_cst_off[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]data modify storage ex:damage Item set from entity @s Inventory[{Slot:-106b}]
function ex:misc/damage
execute if score #damage exValue matches 26.. run data remove storage ex:damage Item
setblock ~ 255 ~ minecraft:shulker_box
data modify storage ex:damage Item.Slot set value 0b
data modify block ~ 255 ~ Items append from storage ex:damage Item
loot replace entity @s weapon.offhand 1 mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}
setblock ~ 255 ~ minecraft:air
[/font][/td][/tr]
[/table]
[size=4][b]§11.4 红石信号[/b][/size]

　　为了检测当前方块是否被强充能了，我们将所有能激活当前方块的红石元件和方块状态记录在断言文件中来判断。注意我们没有对当前方块是否完整进行检测。陷阱箱触发的红石信号也是无法直接探测到的。

[table]
[tr=#C0C0C0][td][font=Verdana]mac/predicates/redstone_power.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "condition": "minecraft:alternative",
    "terms": [
        {
            "condition": "minecraft:location_check",
            "offsetY": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:lever",
                    "state": {
                        "powered": true,
                        "face": "ceiling"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:lever",
                    "state": {
                        "powered": true,
                        "face": "floor"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:lever",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "east"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:lever",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "west"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:lever",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "south"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:lever",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "north"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": -1,
            "predicate": {
                "block": {
                    "tag": "minecraft:buttons",
                    "state": {
                        "powered": true,
                        "face": "ceiling"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": 1,
            "predicate": {
                "block": {
                    "tag": "minecraft:buttons",
                    "state": {
                        "powered": true,
                        "face": "floor"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": 1,
            "predicate": {
                "block": {
                    "tag": "minecraft:buttons",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "east"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": -1,
            "predicate": {
                "block": {
                    "tag": "minecraft:buttons",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "west"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": 1,
            "predicate": {
                "block": {
                    "tag": "minecraft:buttons",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "south"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": -1,
            "predicate": {
                "block": {
                    "tag": "minecraft:buttons",
                    "state": {
                        "powered": true,
                        "face": "wall",
                        "facing": "north"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:redstone_torch",
                    "state": {
                        "lit": true
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:redstone_wall_torch",
                    "state": {
                        "lit": true
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:observer",
                    "state": {
                        "powered": true,
                        "facing": "down"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:observer",
                    "state": {
                        "powered": true,
                        "facing": "up"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:observer",
                    "state": {
                        "powered": true,
                        "facing": "east"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:observer",
                    "state": {
                        "powered": true,
                        "facing": "west"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:observer",
                    "state": {
                        "powered": true,
                        "facing": "south"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:observer",
                    "state": {
                        "powered": true,
                        "facing": "north"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:repeater",
                    "state": {
                        "powered": true,
                        "facing": "east"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:repeater",
                    "state": {
                        "powered": true,
                        "facing": "west"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:repeater",
                    "state": {
                        "powered": true,
                        "facing": "south"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:repeater",
                    "state": {
                        "powered": true,
                        "facing": "north"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:comparator",
                    "state": {
                        "powered": true,
                        "facing": "east"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:comparator",
                    "state": {
                        "powered": true,
                        "facing": "west"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:comparator",
                    "state": {
                        "powered": true,
                        "facing": "south"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:comparator",
                    "state": {
                        "powered": true,
                        "facing": "north"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:tripwire_hook",
                    "state": {
                        "powered": true,
                        "facing": "east"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetX": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:tripwire_hook",
                    "state": {
                        "powered": true,
                        "facing": "west"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:tripwire_hook",
                    "state": {
                        "powered": true,
                        "facing": "south"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetZ": -1,
            "predicate": {
                "block": {
                    "block": "minecraft:tripwire_hook",
                    "state": {
                        "powered": true,
                        "facing": "north"
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": 1,
            "predicate": {
                "block": {
                    "tag": "minecraft:wooden_pressure_plates",
                    "state": {
                        "powered": true
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:stone_pressure_plate",
                    "state": {
                        "powered": true
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:light_weighted_pressure_plate",
                    "state": {
                        "powered": true
                    }
                }
            }
        },
        {
            "condition": "minecraft:location_check",
            "offsetY": 1,
            "predicate": {
                "block": {
                    "block": "minecraft:heavy_weighted_pressure_plate",
                    "state": {
                        "powered": true
                    }
                }
            }
        }
    ]
}
[/font][/td][/tr]
[/table]
　　弱充能情形更为繁琐。
　　想要产生一个红石信号，可以通过在当前位置放置红石块再放置空气来产生。注意保存当前方块的信息。这样的红石信号可以用于激活结构方块，因此可用于 [url=thread-784662-1-1.html?cp=12]§12 世界生成[/url]。

[size=4][b]§11.5 方块交互[/b][/size]

　　与某些特定方块交互，可通过相应的交互判据的计分板来探测。如果仅需要右击而不打开，可对容器进行上锁，但玩家快捷栏上方会提示容器已上锁，需要使用资源包来消除；或者使用传送来实现强制关闭GUI，但画面会有闪烁感。
　　例如：右键方块破坏器将其上方的石头变为砂砾，圆石变为沙子。方块破坏器为上锁的熔炉，且相应位置已有盔甲架标记。这里我们直接使用 [url=thread-784662-1-1.html?cp=6]§6.1 视线追踪法[/url]来获取方块破坏器位置。

[table]
[tr=#C0C0C0][td][font=Verdana]ex:load[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard objectives add exBsdIntFur minecraft.custom:minecraft.interact_with_furnace
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @a[scores={exBsdIntFur=1..}] at @s anchored eyes run function ex:block_breaker/ray
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex:block_breaker/ray[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute if entity @s[distance=..7] unless block ~ ~ ~ minecraft:furnace positioned ^ ^ ^0.005 anchored feet run function ex:block_breaker/ray
execute if entity @s[distance=..7] if block ~ ~ ~ minecraft:furnace{Lock:"zsx<3wtt"} if block ~ ~1 ~ #ex:block_breaker run function ex:block_breaker/done
scoreboard players reset @s exBsdIntFur
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex/tags/blocks/block_breaker[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "replace": false,
    "values": [
        "minecraft:stone",
        "minecraft:cobblestone",
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex:block_breaker/done[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute if block ~ ~1 ~ minecraft:stone run setblock ~ ~1 ~ minecraft:gravel
execute if block ~ ~1 ~ minecraft:cobblestone run setblock ~ ~1 ~ minecraft:sand
[/font][/td][/tr]
[/table]
　　同理，[url=thread-784662-1-1.html?cp=8]§8.6 插件[/url]中的插件安装也可以通过打开木桶的判据来实现。我们使用传送来实现强制关闭GUI。
[table]
[tr=#C0C0C0][td][font=Verdana]mac:load[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard objectives add macOpenFrame minecraft.custom:minecraft.open_barrel
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]mac:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @a[tag=machine_close_gui] at @s positioned ~ ~-256 ~ run function mac:misc/close_gui_back
execute as @a[scores={macOpenFrame=1..}] if predicate mac:all_in_one_machine/hand_machine_plugin at @s anchored eyes run function mac:all_in_one_machine/ray
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]mac/predicates/all_in_one_machine/hand_machine_plugin.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "condition": "minecraft:alternative",
    "terms": [
        {
            "condition": "minecraft:entity_properties",
            "entity": "this",
            "predicate": {
                "equipment": {
                    "mainhand":{
                        "nbt": "{macMachinePlugin:1b}"
                    }
                }
            }
        },
        {
            "condition": "minecraft:entity_properties",
            "entity": "this",
            "predicate": {
                "equipment": {
                    "offhand":{
                        "nbt": "{macMachinePlugin:1b}"
                    }
                }
            }
        }
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]mac:all_in_one_machine/ray[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[distance=..6] if block ~ ~ ~ minecraft:barrel align xyz positioned ~0.5 ~ ~0.5 run function mac:all_in_one_machine/init
execute as @s[distance=..6] unless block ~ ~ ~ minecraft:barrel positioned ^ ^ ^0.005 anchored feet run function mac:all_in_one_machine/ray
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex:all_in_one_machine/init[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[nbt=!{SelectedItem:{tag:{macMachinePlugin:1b}}}] run data modify storage mac:plugin Item set from entity @s Inventory[{Slot:-106b}]
execute as @s[nbt={SelectedItem:{tag:{macMachinePlugin:1b}}}] run data modify storage mac:plugin Item set from entity @s SelectedItem
execute if data storage mac:plugin Item.tag{id:"mac:high_pressure_plugin"} if entity @e[tag=machine_all_in_one_machine,distance=..0.5,limit=1,tag=!machine_high_pressure] run function ex:all_in_one_machine/init/high_pressure
execute if data storage mac:plugin Item.tag{id:"mac:low_pressure_plugin"} if entity @e[tag=machine_all_in_one_machine,distance=..0.5,limit=1,tag=!machine_low_pressure] run function ex:all_in_one_machine/init/low_pressure
execute if data storage mac:plugin Item.tag{id:"mac:high_temperature_plugin"} if entity @e[tag=machine_all_in_one_machine,distance=..0.5,limit=1,tag=!machine_high_temperature] run function ex:all_in_one_machine/init/high_temperature
execute if data storage mac:plugin Item.tag{id:"mac:low_temperature_plugin"} if entity @e[tag=machine_all_in_one_machine,distance=..0.5,limit=1,tag=!machine_low_temperature] run function ex:all_in_one_machine/init/low_temperature
execute as @s[tag=machine_plugin_used] at @s run function mac:close_gui
tag @s[tag=machine_plugin_used] remove machine_plugin_used
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex:all_in_one_machine/init/high_pressure[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]tellraw @s [{"translate":"info.machine.high_pressure_plugin"}]
tag @s add machine_plugin_used
tag @e[tag=machine_all_in_one_machine,distance=..0.5,limit=1,tag=!machine_high_pressure] add machine_high_pressure
clear @s[tag=machine_plugin_used] minecraft:firework_star{id:"mac:high_pressure_plugin"} 1
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]mac:misc/close_gui[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]summon minecraft:area_effect_cloud ~ ~ ~ {Tags:["machine_close_gui_pos"],Duration:2}
summon minecraft:area_effect_cloud ^ ^ ^3 {Tags:["machine_close_gui_facing"],Duration:2}
tp @s ~ ~256 ~
tag @s add machine_close_gui
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]mac:misc/close_gui_back[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]tp @s @e[type=minecraft:area_effect_cloud,tag=machine_close_gui_pos,distance=..10,sort=nearest,limit=1]
tag @s remove machine_close_gui
execute at @s facing entity @e[type=minecraft:area_effect_cloud,tag=machine_close_gui_facing,distance=..10,sort=nearest,limit=1] feet run tp ~ ~ ~
[/font][/td][/tr]
[/table]
[size=4][b]§11.6 生物移动[/b][/size]

　　例如：手持绿宝石块的玩家吸引 [font=Verdana]16[/font] 米内的村民到自身位置。
[table]
[tr=#C0C0C0][td][font=Verdana]ex:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]tag @a remove ex_player_hand_emerald_block
execute as @e[type=minecraft:villager] at @s if entity @a[distance=1..16,predicate=ex:hand_emerald_block] run function ex:misc/attract_villager
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex/predicates/hand_emerald_block.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "condition": "minecraft:alternative",
    "terms": [
        {
            "condition": "minecraft:entity_properties",
            "entity": "this",
            "predicate": {
                "equipment": {
                    "mainhand":{
                        "item": "minecraft:emerald_block"
                    }
                }
            }
        },
        {
            "condition": "minecraft:entity_properties",
            "entity": "this",
            "predicate": {
                "equipment": {
                    "offhand":{
                        "item": "minecraft:emerald_block"
                    }
                }
            }
        }
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex:misc/attract_villager[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]tag @p[distance=1..16,predicate=ex:hand_emerald_block] add ex_player_hand_emerald_block
tp @s ~ ~ ~ facing entity @p[tag=ex_player_hand_emerald_block]
data merge entity @s {Motion:[0.0d,-1.0d,0.0d]}
execute facing entity @p[tag=ex_player_hand_emerald_block] feet positioned ^ ^ ^0.75 unless block ~ ~ ~ #ex:attract_through if block ~ ~1 ~ #cpp:air run data merge entity @s {Motion:[0.0d,1.0d,0.0d]}
execute store result score #temp0 exValue run data get entity @p[tag=ex_player_hand_emerald_block] Pos[0] 100
execute store result score #temp1 exValue run data get entity @s Pos[0] 100
execute store result entity @s Motion[0] double 0.0005 run scoreboard players operation #temp0 exValue -= #temp1 exValue
execute store result score #temp0 exValue run data get entity @p[tag=ex_player_hand_emerald_block] Pos[2] 100
execute store result score #temp1 exValue run data get entity @s Pos[2] 100
execute store result entity @s Motion[2] double 0.0005 run scoreboard players operation #temp0 exValue -= #temp1 exValue
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex/tags/blocks/fluid.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "replace": false,
    "values": [
        "minecraft:air",
        "minecraft:cave_air",
        "minecraft:void_air",
        "minecraft:bubble_column",
        "minecraft:water",
        "minecraft:lava",
        "minecraft:fire"
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex/tags/blocks/attract_through.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "replace": false,
    "values": [
        "#ex:fluid",
        "#minecraft:saplings",
        "minecraft:grass",
        "minecraft:fern",
        "minecraft:dead_bush",
        "minecraft:seagrass",
        "minecraft:sea_pickle",
        "#minecraft:small_flowers",
        "minecraft:brown_mushroom",
        "minecraft:red_mushroom",
        "minecraft:torch",
        "minecraft:end_rod",
        "minecraft:ladder",
        "minecraft:snow",
        "#minecraft:carpets",
        "minecraft:sunflower",
        "minecraft:lilac",
        "minecraft:rose_bush",
        "minecraft:peony",
        "minecraft:tall_grass",
        "minecraft:large_fern",
        "#minecraft:corals",
        "#minecraft:signs",
        "minecraft:vine",
        "minecraft:dead_tube_coral",
        "minecraft:dead_horn_coral",
        "minecraft:dead_fire_coral",
        "minecraft:dead_bubble_coral",
        "minecraft:dead_brain_coral",
        "minecraft:dead_tube_coral_fan",
        "minecraft:dead_horn_coral_fan",
        "minecraft:dead_fire_coral_fan",
        "minecraft:dead_bubble_coral_fan",
        "minecraft:dead_brain_coral_fan",
        "minecraft:lever",
        "minecraft:repeater",
        "minecraft:comparator",
        "#minecraft:wooden_pressure_plates",
        "minecraft:light_weighted_pressure_plate",
        "minecraft:heavy_weighted_pressure_plate",
        "#minecraft:buttons",
        "minecraft:redstone_torch",
        "minecraft:tripwire_hook",
        "minecraft:tripwire",
        "#minecraft:doors",
        "#minecraft:rails",
        "minecraft:redstone_wire",
        "#minecraft:walls",
        "#minecraft:fences",
        "minecraft:oak_fence_gate",
        "minecraft:spruce_fence_gate",
        "minecraft:birch_fence_gate",
        "minecraft:jungle_fence_gate",
        "minecraft:acacia_fence_gate",
        "minecraft:dark_oak_fence_gate"
    ]
}
[/font][/td][/tr]
[/table]
　　这里我们进行了繁复的判断是为了让村民能够爬坡，但不能爬过栅栏类方块。如果是想要实现吸引物品的效果，则很多内容可以省略。

[size=4][b]§11.7 交易[/b][/size]
　　使用村民交易是一种常见的特殊物品获得方式。在1.14+版本，建议使用流浪商人而不是村民，因为村民的交易会根据工作方块而进行变化，导致设定的交易被覆盖或出现不想要的交易。如果不希望交易产生经验值，需将 [font=Verdana]rewardExp[/font] 设置为 [font=Verdana]0b[/font]。通过让村民佩戴物品，可以让村民头部实现不同的外观，但是其它部位不能如此修改，使用佩戴在头部全身模型也会因村民头部移动而发生错乱。
　　建议使用战利品来随机生成村民的交易项。

[table]
[tr=#C0C0C0][td][font=Verdana]trade:load[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]function trade:tick20 20t
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]trade:tick20[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @e[type=minecraft:wandering_trader,tag=!trade_trade_added] run function trade:check
schedule function trade:tick20 20t
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]trade:check[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]data merge entity @s {ArmorItems:[{},{},{},{id:"minecraft:carved_pumpkin",Count:1b,tag:{CustomModelData:12970051}}],ArmorDropChances:[-1.0f,-1.0f,-1.0f,-1.0f]}
data modify entity @s Offers.Recipes prepend value {buy:{id:"minecraft:stone",Count:64b},sell:{id:"minecraft:emerald",Count:1b},maxUses:12}
data modify entity @s Offers.Recipes append value {buy:{id:"minecraft:emerald",Count:64b},sell:{id:"minecraft:stone",Count:1b},maxUses:12}
loot replace entity @s weapon.mainhand 1 loot trade:trade/buy
data modify entity @s Offers.Recipes[0].buy.id set from entity @s HandItems[0].id
data modify entity @s Offers.Recipes[0].buy.Count set from entity @s HandItems[0].Count
loot replace entity @s weapon.mainhand 1 loot trade:trade/sell
data modify entity @s Offers.Recipes[9].sell.id set from entity @s HandItems[0].id
data modify entity @s Offers.Recipes[9].buy.Count set from entity @s HandItems[0].Count
replaceitem entity @s weapon.mainhand minecraft:air
tag @s add trade_trade_added
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]trade/loot_tables/trade/buy.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:oak_log",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 36,
                                "max": 40
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:spruce_log",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 36,
                                "max": 40
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:birch_log",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 36,
                                "max": 40
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:jungle_log",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 36,
                                "max": 40
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:acacia_log",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 36,
                                "max": 40
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:dark_oak_log",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 36,
                                "max": 40
                            }
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]trade/loot_tables/trade/sell.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "pools": [
        {
            "rolls": 1,
            "entries": [
                {
                    "type": "minecraft:item",
                    "name": "minecraft:piston",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 4,
                                "max": 6
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:redstone_lamp",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 4,
                                "max": 6
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:tnt",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 4,
                                "max": 6
                            }
                        }
                    ]
                },
                {
                    "type": "minecraft:item",
                    "name": "minecraft:observer",
                    "functions": [
                        {
                            "function": "minecraft:set_count",
                            "count": {
                                "min": 4,
                                "max": 6
                            }
                        }
                    ]
                }
            ]
        }
    ]
}
[/font][/td][/tr]
[/table]
　　这样，我们便为每个流浪商人的最前面添加了交易 [font=Verdana]36-40[/font] 个原木换 [font=Verdana]1[/font] 个绿宝石，最后面添加了交易 [font=Verdana]4-6[/font] 个绿宝石换活塞、红石灯、TNT、观察者。
　　1.13版本可将村民的NBT修改为 [font=Verdana]{VillagerData:{profession:"minecraft:none"}[/font] 以确保村民不含交易。

[size=4][b]§11.8 清理特定物品[/b][/size]

　　在自动种植、自动繁殖或放置方块等情形，我们需要对容器内的特定物品进行消耗。例如：当含有 [font=Verdana]ex:toughen_hand[/font] 的物品展示框下方容器内有胡萝卜、金胡萝卜、蒲公英时，令附近的兔子进入繁殖状态并清除一个相应物品。

[table]
[tr=#C0C0C0][td][font=Verdana]ex:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @e[type=minecraft:item_frame,nbt={Item:{tag:{id:"ex:toughen_hand"}}}] at @s if entity @e[type=minecraft:rabbit,distance=..9,nbt={Age:0,InLove:0}] run function ex:toughen_hand/rabbit_check
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex:toughen_hand/rabbit_check[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players set @s exValue 0
execute if data block ~ ~-1 ~ Items[{id:"minecraft:carrot"}] run scoreboard players set @s exValue 1
execute if data block ~ ~-1 ~ Items[{id:"minecraft:golden_carrot"}] run scoreboard players set @s exValue 2
execute if data block ~ ~-1 ~ Items[{id:"minecraft:dandelion"}] run scoreboard players set @s exValue 3
execute if score @s exValue matches 1.. run function ex:toughen_hand/rabbit
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]ex:toughen_hand/rabbit[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute if score @s exValue matches 1 run data modify storage ex:toughen_hand Item set from block ~ ~-1 ~ Items[{id:"minecraft:carrot"}]
execute if score @s exValue matches 2 run data modify storage ex:toughen_hand Item set from block ~ ~-1 ~ Items[{id:"minecraft:golden_carrot"}]
execute if score @s exValue matches 3 run data modify storage ex:toughen_hand Item set from block ~ ~-1 ~ Items[{id:"minecraft:dandelion"}]
execute store result storage ex:toughen_hand Item.Count byte 0.999 run data get storage ex:toughen_hand Item.Count
data modify block ~ ~-1 ~ Items append from storage ex:toughen_hand Item
data merge entity @e[type=minecraft:item_framerabbit,distance=..9,nbt={Age:0,InLove:0},limit=1] {InLove:600}
[/font][/td][/tr]
[/table]
　　注意到一点，[font=Verdana]Items[{id:"minecraft:carrot"}][/font] 只会选择容器内的最后一个拥有胡萝卜的栏位。如果 [font=Verdana]ex:toughen_hand[/font] 的物品被消耗完，则追加到容器的 [font=Verdana]Items[/font] 时，仍然会先覆盖已有的同 [font=Verdana]Slot[/font] 项，然后由于 [font=Verdana]Count[/font] 变为 [font=Verdana]0[/font] 而清除该栏位。

[size=4][b]§11.9 连锁[/b][/size]

　　当玩家使用原版镐时，破坏所有相连的矿石。
[table]
[tr=#C0C0C0][td][font=Verdana]chain:load[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard objectives add chainUsePick1 minecraft.used:minecraft.diamond_pickaxe
scoreboard objectives add chainUsePick2 minecraft.used:minecraft.iron_pickaxe
scoreboard objectives add chainUsePick3 minecraft.used:minecraft.golden_pickaxe
scoreboard objectives add chainUsePick4 minecraft.used:minecraft.stone_pickaxe
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]chain:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @a at @s anchored eyes run function chain:chain/type
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]chain:chain/type[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[scores={chainUsePick1=1..}] run function chain:chain/pickaxe1/init
execute as @s[scores={chainUsePick2=1..}] run function chain:chain/pickaxe2/init
execute as @s[scores={chainUsePick3=1..}] run function chain:chain/pickaxe3/init
execute as @s[scores={chainUsePick4=1..}] run function chain:chain/pickaxe4/init
scoreboard players reset @s chainUsePick1
scoreboard players reset @s chainUsePick2
scoreboard players reset @s chainUsePick3
scoreboard players reset @s chainUsePick4
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]chain:chain/pickaxe1/init[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]scoreboard players set #max_durality chainValue 1562
data modify storage ex:damage Item set from entity @s SelectedItem
execute store result score #temp chainValue run data get storage ex:damage Item.tag.Damage
execute at @e[type=minecraft:item,nbt={Age:0s},distance=..6,sort=nearest,limit=1] run function chain:chain/pickaxe1/mark
execute at @e[type=minecraft:item,nbt={Age:1s},distance=..6,sort=nearest,limit=1] run function chain:chain/pickaxe1/mark
scoreboard players reset @s chainUsePick1
execute if score #temp chainValue >= #max_durality chainValue run replaceitem entity @s weapon.mainhand minecraft:air
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]chain:chain/pickaxe1/mark[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute positioned ~1 ~ ~ if block ~ ~ ~ #chain:pickaxe1_chain run function chain:chain/pickaxe1/damage
execute positioned ~-1 ~ ~ if block ~ ~ ~ #chain:pickaxe1_chain run function chain:chain/pickaxe1/damage
execute positioned ~ ~1 ~ if block ~ ~ ~ #chain:pickaxe1_chain run function chain:chain/pickaxe1/damage
execute positioned ~ ~-1 ~ if block ~ ~ ~ #chain:pickaxe1_chain run function chain:chain/pickaxe1/damage
execute positioned ~ ~ ~1 if block ~ ~ ~ #chain:pickaxe1_chain run function chain:chain/pickaxe1/damage
execute positioned ~ ~ ~-1 if block ~ ~ ~ #chain:pickaxe1_chain run function chain:chain/pickaxe1/damage
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]chain/tags/blocks/pickaxe1.json[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]{
    "replace": false,
    "values": [
        "minecraft:iron_ore",
        "minecraft:gold_ore",
        "minecraft:coal_ore",
        "minecraft:diamond_ore",
        "minecraft:emerald_ore",
        "minecraft:nether_quartz_ore",
        "minecraft:redstone_ore",
        "minecraft:lapis_ore",
        "minecraft:glowstone",
        "minecraft:obsidian"
    ]
}
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]chain:chain/pickaxe1/damage[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @s[nbt=!{SelectedItem:{tag:{Enchantments:[{id:"minecraft:silk_touch"}]}}}] run function chain:chain/xp
loot spawn ~ ~ ~ mine ~ ~ ~ mainhand
setblock ~ ~ ~ minecraft:air
function ex:damage
execute if score #temp chainValue < #max_durality chainValue run function chain:chain/pickaxe1/mark
[/font][/td][/tr]
[/table]
　　函数 [font=Verdana]ex:damage[/font] 见 [url=thread-784662-1-1.html?cp=11]§11.3 耐久处理[/url]。

[page]
[size=5][b]§12 世界生成[/b][/size]
[size=4][b]§12.1 随机结构[/b][/size]
　　例如：世界生成时，随机生成羊毛树。判断玩家东南32*32是否有标记，如无，添加相应标记在32整数倍坐标处，然后生成战利品表、分散，通过战利品表掉落物来生成结构。也可以使用方块来标记，例如普通生存下y=0使用屏障替换基岩或超平坦生存y=255处使用air替换void_air来实现，这在某些对实体加载有修改的服务端会很有效。

[table]
[tr=#C0C0C0][td][font=Verdana]cpp:tick[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute as @a at @s unless block ~ 0 ~ bedrock run function cpp:generate/check
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:generate/check[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]execute positioned ~-64 -2 ~-64 unless entity @e[tag=cpp_chunk,dx=32,dy=256,dz=32] run function cpp:generate/mark
execute positioned ~-32 -2 ~-64 unless entity @e[tag=cpp_chunk,dx=32,dy=256,dz=32] run function cpp:generate/mark
execute positioned ~ -2 ~-64 unless entity @e[tag=cpp_chunk,dx=32,dy=256,dz=32] run function cpp:generate/mark
execute positioned ~-64 -2 ~-32 unless entity @e[tag=cpp_chunk,dx=32,dy=256,dz=32] run function cpp:generate/mark
execute positioned ~-32 -2 ~-32 unless entity @e[tag=cpp_chunk,dx=32,dy=256,dz=32] run function cpp:generate/mark
execute positioned ~ -2 ~-32 unless entity @e[tag=cpp_chunk,dx=32,dy=256,dz=32] run function cpp:generate/mark
execute positioned ~-64 -2 ~ unless entity @e[tag=cpp_chunk,dx=32,dy=256,dz=32] run function cpp:generate/mark
execute positioned ~-32 -2 ~ unless entity @e[tag=cpp_chunk,dx=32,dy=256,dz=32] run function cpp:generate/mark
execute positioned ~ -2 ~ unless entity @e[tag=cpp_chunk,dx=32,dy=256,dz=32] run function cpp:generate/mark
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:generate/mark[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]summon armor_stand ~ -1 ~ {Tags:["cpp_chunk","cpp_undet"],Invulnerable:1b,Invisible:1b,Marker:1b,NoGravity:1b,Small:1b,DisabledSlots:7967}
scoreboard players set #32 exValue 32
execute store result score #temp exValue run data get entity @e[tag=cpp_undet,limit=1] Pos[0]
scoreboard players operation #temp exValue /= #32 exValue
scoreboard players add #temp exValue 1
execute store result entity @e[tag=cpp_undet,sort=nearest,limit=1] Pos[0] double 1 run scoreboard players operation #temp exValue *= #32 exValue

execute store result score #temp exValue run data get entity @e[tag=cpp_undet,limit=1] Pos[2]
scoreboard players operation #temp exValue /= #32 exValue
scoreboard players add #temp exValue 1
execute store result entity @e[tag=cpp_undet,sort=nearest,limit=1] Pos[2] double 1 run scoreboard players operation #temp exValue *= #32 exValue

loot spawn ~ ~ ~ loot cpp:generate/markers
execute at @e[tag=cpp_undet,sort=nearest,limit=1] run spreadplayers ~16 ~16 0 15 false @e[type=minecraft:item,nbt={Item:{tag:{isStrMark:1b}}}]
tag @e[tag=cpp_undet] remove cpp_undet
execute as @e[type=minecraft:item,nbt={Item:{tag:{isStrMark:1b}}}] at @s run function cpp:generate/build
[/font][/td][/tr]
[/table]
[table]
[tr=#C0C0C0][td][font=Verdana]cpp:generate/build[/font][/td][/tr]
[tr=#FFFFFF][td][font=Verdana]# 爬行者地牢
execute if score #generate_creeper_dungeon exValue matches 1.. as @s[nbt={Item:{tag:{id:"cpp:creeper_dungeon_marker"}}}] if block ~ 15 ~ cave_air run function cpp:generate/structures/creeper_dungeon
# 附魔室
execute if score #generate_enchanting_room exValue matches 1.. as @s[nbt={Item:{tag:{id:"cpp:enchanting_room_marker"}}}] run function cpp:generate/structures/enchanting_room
# 图腾柱
execute if score #generate_totem_pillar exValue matches 1.. as @s[nbt={Item:{tag:{id:"cpp:totem_pillar_marker"}}}] run function cpp:generate/structures/totem_pillar

# 水果树
execute if score #generate_fruit_tree exValue matches 1.. as @s[nbt={Item:{tag:{id:"cpp:fruit_tree_marker"}}}] if block ~ ~-1 ~ grass_block align xyz run function cpp:plants/trees/fruit
# 矿石树
execute if score #generate_ore_tree exValue matches 1.. as @s[nbt={Item:{tag:{id:"cpp:ore_tree_marker"}}}] if block ~ ~-1 ~ grass_block align xyz run function cpp:plants/trees/ore
# 羊毛树
execute if score #generate_wool_tree exValue matches 1.. as @s[nbt={Item:{tag:{id:"cpp:wool_tree_marker"}}}] if block ~ ~-1 ~ grass_block align xyz run function cpp:plants/trees/wool

# 死珊瑚扇
execute if score #generate_dead_coral_fan exValue matches 1.. as @s[nbt={Item:{tag:{id:"cpp:dead_coral_fan_marker"}}}] run function cpp:generate/structures/dead_coral_fan

# 灌木丛
execute if score #generate_small_bush exValue matches 1.. as @s[nbt={Item:{tag:{id:"cpp:small_bush_marker"}}}] if block ~ ~-1 ~ grass_block run function cpp:generate/structures/small_bush

# 死云杉树
execute if score #generate_dead_spruce exValue matches 1.. as @s[nbt={Item:{tag:{id:"cpp:dead_spruce_marker"}}}] unless block ~ ~-1 ~ #cpp:fluid run function cpp:generate/structures/dead_spruce

# 农作物
execute if score #generate_crops exValue matches 1.. as @s[nbt={Item:{tag:{id:"cpp:crops_marker"}}}] if block ~ ~-1 ~ grass_block run function cpp:generate/structures/crops

# 花草
execute if score #generate_modcrops exValue matches 1.. as @s[nbt={Item:{tag:{id:"cpp:modcrops_marker"}}}] if block ~ ~-1 ~ grass_block run function cpp:generate/structures/modcrops

kill @s
[/font][/td][/tr]
[/table]
　　生成羊毛树部分略。

[size=4][b]§12.2 水处理[/b][/size]

[size=4][b]§12.3 下界处理[/b][/size]

[size=4][b]§12.4 重生成[/b][/size]

[size=4][b]§12.5 维度模拟[/b][/size]

[page]
[size=5][b]§13 算法[/b][/size]


[size=4][b]§13.1 绘制图案[/b][/size]

[size=4][b]§13.2 循环和递归[/b][/size]

[size=4][b]§13.3 字符操作[/b][/size]

[size=4][b]§13.4 位运算与种子[/b][/size]



